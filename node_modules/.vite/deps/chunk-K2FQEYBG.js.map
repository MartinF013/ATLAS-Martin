{
  "version": 3,
  "sources": ["../../@arcgis/core/core/support/WatchUpdatingTracking.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import s from\"../Accessor.js\";import t from\"../Handles.js\";import{isNone as i}from\"../maybe.js\";import{watch as n,when as d,on as a,sync as r}from\"../reactiveUtils.js\";import{schedule as h}from\"../scheduling.js\";import{property as o}from\"../accessorSupport/decorators/property.js\";import{subclass as l}from\"../accessorSupport/decorators/subclass.js\";let c=class extends s{constructor(){super(...arguments),this.updating=!1,this.handleId=0,this.handles=new t,this.scheduleHandleId=0,this.pendingPromises=new Set}destroy(){this.removeAll(),this.handles.destroy()}add(e,s,t={}){return this._installWatch(e,s,t,n)}addWhen(e,s,t={}){return this._installWatch(e,s,t,d)}addOnCollectionChange(e,s,{initial:t=!1,final:i=!1}={}){const n=++this.handleId;return this.handles.add([a(e,\"after-changes\",this._createSyncUpdatingCallback(),r),a(e,\"change\",s,{onListenerAdd:t?e=>s({added:e.toArray(),removed:[]}):void 0,onListenerRemove:i?e=>s({added:[],removed:e.toArray()}):void 0})],n),{remove:()=>this.handles.remove(n)}}addPromise(e){if(i(e))return e;const s=++this.handleId;this.handles.add({remove:()=>{this.pendingPromises.delete(e)&&(0!==this.pendingPromises.size||this.handles.has(p)||this._set(\"updating\",!1))}},s),this.pendingPromises.add(e),this._set(\"updating\",!0);const t=()=>this.handles.remove(s);return e.then(t,t),e}removeAll(){this.pendingPromises.clear(),this.handles.removeAll(),this._set(\"updating\",!1)}_installWatch(e,s,t={},i){const n=++this.handleId;t.sync||this._installSyncUpdatingWatch(e,n);const d=i(e,s,t);return this.handles.add(d,n),{remove:()=>this.handles.remove(n)}}_installSyncUpdatingWatch(e,s){const t=this._createSyncUpdatingCallback(),i=n(e,t,{sync:!0,equals:()=>!1});return this.handles.add(i,s),i}_createSyncUpdatingCallback(){return()=>{this.handles.remove(p),++this.scheduleHandleId;const e=this.scheduleHandleId;this._get(\"updating\")||this._set(\"updating\",!0),this.handles.add(h((()=>{e===this.scheduleHandleId&&(this._set(\"updating\",this.pendingPromises.size>0),this.handles.remove(p))})),p)}}};e([o({readOnly:!0})],c.prototype,\"updating\",void 0),c=e([l(\"esri.core.support.WatchUpdatingTracking\")],c);const p=-42;var m;!function(e){e[e.NONE=0]=\"NONE\",e[e.SYNC=1]=\"SYNC\",e[e.INIT=2]=\"INIT\"}(m||(m={}));export{m as WatchFlags,c as WatchUpdatingTracking};\n"],
  "mappings": "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",
  "names": ["e", "t", "n", "d"]
}
