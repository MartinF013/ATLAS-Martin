{
  "version": 3,
  "sources": ["../../@arcgis/core/views/interactive/snapping/featureSources/sceneLayerSource/SceneLayerSnappingSourceWorker.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../../chunks/tslib.es6.js\";import{isNone as t,unwrapOr as s}from\"../../../../../core/maybe.js\";import{throwIfAborted as o}from\"../../../../../core/promiseUtils.js\";import\"../../../../../core/Logger.js\";import\"../../../../../core/accessorSupport/ensureType.js\";import\"../../../../../core/arrayUtils.js\";import\"../../../../../core/has.js\";import\"../../../../../core/accessorSupport/set.js\";import{subclass as n}from\"../../../../../core/accessorSupport/decorators/subclass.js\";import{C as i,a as r,i as d}from\"../../../../../chunks/vec3.js\";import{c,a}from\"../../../../../chunks/vec3f64.js\";import{create as p,fromPoints as u,projectPoint as m}from\"../../../../../geometry/support/lineSegment.js\";import{g as h,m as g,c as l}from\"../../../../../chunks/sphere.js\";import{SnappingTypes as f}from\"../../../../../layers/graphics/data/QueryEngineResult.js\";import _ from\"../../../../3d/webgl-engine/lib/Octree.js\";import{extractComponentsEdgeLocationsLayout as b}from\"../../../../3d/webgl-engine/lib/edgeRendering/EdgeProcessingWorker.js\";let j=class{constructor(){this._idToComponent=new Map,this._components=new _((e=>e.bounds)),this._edges=new _((e=>e.bounds)),this._tmpLineSegment=p(),this._tmpP1=c(),this._tmpP2=c(),this._tmpP3=c(),this.remoteClient=null}async fetchCandidates(e,t){await Promise.resolve(),o(t),await this._ensureEdgeLocations(e,t);const s=[];return this._edges.forEachNeighbor((t=>this._addCandidates(e,t,s)),e.bounds),{result:{candidates:s}}}async _ensureEdgeLocations(e,o){const n=[];if(this._components.forEachNeighbor((e=>{if(t(e.info)){const{id:t,uid:s}=e;n.push({id:t,uid:s})}}),e.bounds),!n.length)return;const i={components:n},r=await this.remoteClient.invoke(\"fetchAllEdgeLocations\",i,s(o,{}));for(const t of r.components)this._setFetchEdgeLocations(t)}async add(e){const t=new C(e.id,e.bounds);return this._idToComponent.set(t.id,t),this._components.add([t]),{result:{}}}async remove(e){const t=this._idToComponent.get(e.id);if(t){const e=[];this._edges.forEachNeighbor((s=>{s.component===t&&e.push(s)}),t.bounds),this._edges.remove(e),this._components.remove([t]),this._idToComponent.delete(t.id)}return{result:{}}}_setFetchEdgeLocations(e){const s=this._idToComponent.get(e.id);if(t(s)||e.uid!==s.uid)return;const o=b.createView(e.locations),n=new Array(o.count),a=c(),p=c();for(let t=0;t<o.count;t++){const c=l(),u=h(c);o.position0.getVec(t,a),o.position1.getVec(t,p),i(u,u,a,.5),i(u,u,p,.5),r(u,u,e.origin),c[3]=d(u,a);const m=new E(s,t,c);n[t]=m}this._edges.add(n);const{objectIds:u,origin:m}=e;s.info={locations:o,objectIds:u,origin:m}}_addCandidates(e,t,s){const{locations:o,origin:n,objectIds:i}=t.component.info,d=o.position0.getVec(t.index,this._tmpP1),c=o.position1.getVec(t.index,this._tmpP2);r(d,d,n),r(c,c,n);const a=i[o.componentIndex.get(t.index)];this._addEdgeCandidate(e,a,d,c,s),this._addVertexCandidate(e,a,d,s),this._addVertexCandidate(e,a,c,s)}_addEdgeCandidate(e,t,s,o,n){if(!(e.types&f.EDGE))return;const i=h(e.bounds),r=u(s,o,this._tmpLineSegment),c=m(r,i,this._tmpP3);if(!g(e.bounds,c))return null;n.push({type:\"edge\",objectId:t,target:a(c),distance:d(i,c),start:a(s),end:a(o)})}_addVertexCandidate(e,t,s,o){if(!(e.types&f.VERTEX))return;const n=h(e.bounds);if(!g(e.bounds,s))return null;o.push({type:\"vertex\",objectId:t,target:a(s),distance:d(n,s)})}};function y(){return new j}j=e([n(\"esri.views.interactive.snapping.featureSources.sceneLayerSource.SceneLayerSnappingSourceWorker\")],j);class C{constructor(e,t){this.id=e,this.bounds=t,this.info=null,this.uid=++C.uid}}C.uid=0;class E{constructor(e,t,s){this.component=e,this.index=t,this.bounds=s}}export{j as SceneLayerSnappingSourceWorker,y as default};\n"],
  "mappings": "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",
  "names": ["e", "n", "t", "c", "u", "E", "m", "d", "y"]
}
