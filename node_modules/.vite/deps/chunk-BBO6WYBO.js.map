{
  "version": 3,
  "sources": ["../../@arcgis/core/views/2d/tiling/TileQueue.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import t from\"../../../core/Accessor.js\";import{property as s}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/arrayUtils.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import{subclass as r}from\"../../../core/accessorSupport/decorators/subclass.js\";import{j as o}from\"../../../chunks/vec2.js\";import{QueueProcessor as i}from\"../../support/QueueProcessor.js\";function n(e,t){return e.length=0,t.forEach((t=>e.push(t))),e}const u=new Set,c=[],a=new Map,h=[0,0];let l=class extends t{constructor(e){super(e),this._keyToItem=new Map,this.concurrency=6,this.strategy=\"scale-first\",this.tileInfoView=null}initialize(){const{concurrency:e,process:t,strategy:s}=this;this._queue=new i({concurrency:e,process:(e,s)=>{const r=this._keyToItem.get(e);return t(r,{signal:s})},peeker:\"scale-first\"===s?e=>this._peekByScaleFirst(e):e=>this._peekByCenterFirst(e)})}destroy(){this.clear(),this._queue.destroy(),this._queue=null}get length(){return this._queue?this._queue.length:0}get onGoingCount(){return this._keyToItem.size}get updating(){return this.length>0||this.onGoingCount>0}abort(e){const t=\"string\"==typeof e?e:e.id;this._queue.abort(t)}clear(){this._queue.clear(),this._keyToItem.clear(),this.notifyChange(\"updating\")}has(e){return\"string\"==typeof e?this._keyToItem.has(e):this._keyToItem.has(e.id)}isOngoing(e){const t=\"string\"==typeof e?e:e.id;return this.has(t)&&this._queue.isOngoing(t)}pause(){this._queue.pause()}push(e){const t=e.key.id;if(this._queue.has(t))return this._queue.get(t);const s=this._queue.push(t),r=()=>{this._keyToItem.delete(t),this.notifyChange(\"updating\")};return this._keyToItem.set(t,e),s.then(r,r),this.notifyChange(\"updating\"),s}reset(){this._queue.reset()}resume(){this._queue.resume()}_peekByScaleFirst(e){if(!this.state)return e.values().next().value;const t=this.tileInfoView;let s=Number.NEGATIVE_INFINITY,r=Number.POSITIVE_INFINITY;e.forEach((e=>{const t=this._keyToItem.get(e),o=this.tileInfoView.getTileScale(t.key);a.has(o)||(a.set(o,[]),s=Math.max(o,s),r=Math.min(o,r)),a.get(o).push(t.key),u.add(o)}));let o=this.state.scale;a.has(o)||(n(c,u),c.sort(((e,t)=>e-t)),o=c.reduce(((e,t)=>Math.abs(t-o)<Math.abs(e-o)?t:e),c[0])),o=Math.min(o,s),o=Math.max(o,r);const i=a.get(o),h=t.getClosestInfoForScale(o),l=h.getColumnForX(this.state.center[0]),p=h.getRowForY(this.state.center[1]);return i.sort(((e,t)=>{const s=h.denormalizeCol(e.col,e.world),r=h.denormalizeCol(t.col,t.world);return Math.sqrt((l-s)*(l-s)+(p-e.row)*(p-e.row))-Math.sqrt((l-r)*(l-r)+(p-t.row)*(p-t.row))})),u.clear(),a.clear(),i[0].id}_peekByCenterFirst(e){if(!this.state)return e.values().next().value;const t=this.tileInfoView,s=this.state.center;let r=Number.POSITIVE_INFINITY,i=null;return e.forEach((e=>{const n=this._keyToItem.get(e);t.getTileCoords(h,n.key);const u=o(h,s);u<r&&(r=u,i=n.key)})),i.id}};e([s({constructOnly:!0})],l.prototype,\"concurrency\",void 0),e([s({constructOnly:!0})],l.prototype,\"process\",void 0),e([s()],l.prototype,\"state\",void 0),e([s({constructOnly:!0})],l.prototype,\"strategy\",void 0),e([s({constructOnly:!0})],l.prototype,\"tileInfoView\",void 0),e([s({readOnly:!0})],l.prototype,\"updating\",null),l=e([r(\"esri.views.2d.tiling.TileQueue\")],l);const p=l;export{p as default};\n"],
  "mappings": "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",
  "names": ["n", "e", "t", "l", "s", "o", "h", "p", "r", "u"]
}
