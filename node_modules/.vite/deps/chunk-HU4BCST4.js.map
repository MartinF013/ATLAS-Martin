{
  "version": 3,
  "sources": ["../../@arcgis/core/views/3d/support/intersectionUtils.js", "../../@arcgis/core/views/3d/support/FrustumExtentIntersection.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport{a as r}from\"../../../chunks/vec2f64.js\";import{e as n,b as t,a as i,g as e,i as c,c as u,n as o}from\"../../../chunks/vec3.js\";import{c as s}from\"../../../chunks/vec3f64.js\";import{signedDistance as f,normal as l}from\"../../../geometry/support/plane.js\";function p(r,n,t){return r[0]*n[0]+r[1]*n[1]+r[2]*n[2]+r[3]<t}function a(r,n,t){const i=n[0],e=n[1],c=n[2];return!(r[0][0]*i+r[0][1]*e+r[0][2]*c+r[0][3]>t)&&(!(r[1][0]*i+r[1][1]*e+r[1][2]*c+r[1][3]>t)&&(!(r[2][0]*i+r[2][1]*e+r[2][2]*c+r[2][3]>t)&&(!(r[3][0]*i+r[3][1]*e+r[3][2]*c+r[3][3]>t)&&(!(r[4][0]*i+r[4][1]*e+r[4][2]*c+r[4][3]>t)&&!(r[5][0]*i+r[5][1]*e+r[5][2]*c+r[5][3]>t)))))}function m(r,n,t,i){return b(r,n,null,k(i,n,t,!1))}function d(r,n){for(let t=0;t<6;t++){if(f(r[t],n)>0)return!1}return!0}function h(r,n,t,i){return b(r,n,t,k(i,n,t,!0))}function j(r,c,u,o){const s=n(u,t(r,o,c));return i(r,c,e(r,u,s))}const g={dir:s(),len:0,clip:r()};function k(r,n,i,s){const f=g;return r?(i&&s&&(f.len=c(n,i)),u(f.dir,r)):s?(f.len=c(n,i),t(f.dir,i,n),e(f.dir,f.dir,1/f.len)):(t(f.dir,i,n),o(f.dir,f.dir)),f}function v(r,t,i){const e=n(l(r),i.dir),c=-f(r,t);if(c<0&&e>=0)return!1;if(e>-1e-6&&e<1e-6)return c>0;if((c<0||e<0)&&!(c<0&&e<0))return!0;const u=c/e;return e>0?u<i.clip[1]&&(i.clip[1]=u):u>i.clip[0]&&(i.clip[0]=u),i.clip[0]<=i.clip[1]}function b(r,n,t,i){i.clip[0]=0,i.clip[1]=t?i.len:Number.MAX_VALUE;for(let e=0;e<r.length;e++)if(!v(r[e],n,i))return!1;return!0}export{j as closestPointOnRay,h as frustumLineSegment,d as frustumPoint,m as frustumRay,a as frustumSphere,p as planeSphere};\n", "/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport{neverReached as t}from\"../../../core/compilerUtils.js\";import{lerp as e}from\"../../../core/mathUtils.js\";import{a as i}from\"../../../chunks/mat4.js\";import{c as r}from\"../../../chunks/mat4f64.js\";import{a as n,g as o,r as s,m as a,s as c,e as p}from\"../../../chunks/vec3.js\";import{c as l}from\"../../../chunks/vec3f64.js\";import{computeTranslationToOriginAndRotation as h,projectVectorToVector as d,projectBoundingRect as m}from\"../../../geometry/projection.js\";import{getReferenceEllipsoid as g}from\"../../../geometry/projectionEllipsoid.js\";import{create as u,empty as x,expandWithVec3 as f}from\"../../../geometry/support/aaBoundingBox.js\";import{create as R,center as y}from\"../../../geometry/support/aaBoundingRect.js\";import{PlaneIndex as j}from\"../../../geometry/support/frustum.js\";import{create as A,fromPoints as b}from\"../../../geometry/support/lineSegment.js\";import{create as E,fromVectorsAndPoint as S,copy as C,negate as H,signedDistance as w}from\"../../../geometry/support/plane.js\";import{wrap as B}from\"../../../geometry/support/ray.js\";import{ViewingMode as G}from\"../../ViewingMode.js\";import{frustumLineSegment as M}from\"./intersectionUtils.js\";const F=.5*Math.PI,N=F/Math.PI*180;class _{constructor(t){this.renderCoordsHelper=t.renderCoordsHelper,this.extent=new Array(4),this.planes=new Array(6),this.maxSpan=0,this.center={origin:l(),direction:l()};for(let e=0;e<4;e++)this.extent[e]={origin:l(),direction:l(),cap:{next:null,direction:l()}},this.planes[e]=E();this.planes[j.NEAR]=E(),this.planes[j.FAR]=E(),this.planesWithoutFar=this.planes.slice(0,5)}update(t,e,i,r=!0){const a=this.extent;this._toRenderBoundingExtent(t,e,i),n(this.center.origin,a[0].origin,a[2].origin),o(this.center.origin,this.center.origin,.5),this.renderCoordsHelper.worldUpAtPosition(this.center.origin,this.center.direction),r||o(this.center.direction,this.center.direction,-1);for(let n=0;n<4;n++){const t=a[n];this.renderCoordsHelper.worldUpAtPosition(t.origin,t.direction);const e=a[3===n?0:n+1];t.cap.next=e.origin,s(t.cap.direction,t.origin,e.origin),S(t.direction,t.cap.direction,t.origin,this.planes[n]),r||o(t.direction,t.direction,-1)}S(a[0].cap.direction,a[1].cap.direction,a[0].origin,this.planes[j.NEAR]),r?H(this.planes[j.NEAR],this.planes[j.FAR]):(C(this.planes[j.FAR],this.planes[j.NEAR]),H(this.planes[j.NEAR],this.planes[j.NEAR])),this.maxSpan=Math.max(Math.abs(t[0]-t[2]),Math.abs(t[1]-t[3])),this.maxSpanSpatialReference=e,this.minGlobalAltitude=.9*g(this.maxSpanSpatialReference).radius}isVisibleInFrustum(t,e,i=!1){if(null==t)return!1;if(this.renderCoordsHelper.viewingMode===G.Global){const i=this.maxSpanSpatialReference.isGeographic?N:F*e;if(this.maxSpan>i)return!0;if(t.altitude>=this.minGlobalAltitude)return this._isVisibleInFrustumGlobal(t)}if(0===this.maxSpan){const e=this.extent[0];return!(i||!t.intersectsRay(B(e.origin,e.direction)))}for(let n=0;n<this.extent.length;n++){const e=this.extent[n];if(!i&&t.intersectsRay(B(e.origin,e.direction)))return!0;if(t.intersectsLineSegment(b(e.origin,e.cap.next,V),e.cap.direction))return!0}const r=i?this.planes:this.planesWithoutFar;for(let n=0;n<t.lines.length;n++){const e=t.lines[n];if(M(r,e.origin,e.endpoint,e.direction))return!0}return!1}_toRenderBoundingExtentGlobal(t,r,n){const o=5;y(t,v),v[2]=n,h(r,v,I,this.renderCoordsHelper.spatialReference),i(U,I),x(L);for(const{x0:i,x1:s,y0:c,y1:p}of k)for(let l=0;l<o;l++){const h=l/(o-1);v[0]=e(t[i],t[s],h),v[1]=e(t[c],t[p],h),v[2]=n,d(v,r,v,this.renderCoordsHelper.spatialReference),a(v,v,U),f(L,v)}c(this.extent[0].origin,L[0],L[1],L[2]),c(this.extent[1].origin,L[3],L[1],L[2]),c(this.extent[2].origin,L[3],L[4],L[2]),c(this.extent[3].origin,L[0],L[4],L[2]);for(let e=0;e<4;++e)a(this.extent[e].origin,this.extent[e].origin,I)}_toRenderBoundingExtentLocal(t,e,i){m(t,e,P,this.renderCoordsHelper.spatialReference),c(this.extent[0].origin,P[0],P[1],i),c(this.extent[1].origin,P[2],P[1],i),c(this.extent[2].origin,P[2],P[3],i),c(this.extent[3].origin,P[0],P[3],i)}_toRenderBoundingExtent(e,i,r){switch(this.renderCoordsHelper.viewingMode){case G.Global:this._toRenderBoundingExtentGlobal(e,i,r);break;case G.Local:this._toRenderBoundingExtentLocal(e,i,r);break;default:t(this.renderCoordsHelper.viewingMode)}}_isVisibleInFrustumGlobal(t){if(w(t.planes[j.NEAR],this.center.origin)<0&&p(this.center.direction,t.direction)<0)return!0;for(let e=0;e<4;e++){const i=this.extent[e];if(w(t.planes[j.NEAR],i.origin)<0&&p(i.direction,t.direction)<0)return!0}return!1}}const k=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],v=l(),I=r(),U=r(),L=u(),P=R(),V=A();export{_ as FrustumExtentIntersection};\n"],
  "mappings": "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",
  "names": ["h", "r", "n", "k", "j", "u", "o", "s", "v", "e", "e", "p", "r", "a", "n", "t", "P", "l", "i", "h", "o", "v", "L", "s", "k", "u"]
}
