{
  "version": 3,
  "sources": ["../../@arcgis/core/views/3d/layers/VoxelLayerView3D.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import s from\"../../../core/Error.js\";import t from\"../../../core/Handles.js\";import r from\"../../../core/Logger.js\";import{isSome as i,destroyMaybe as a,isNone as o}from\"../../../core/maybe.js\";import{watch as l,initial as n}from\"../../../core/reactiveUtils.js\";import{property as h}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/arrayUtils.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import{subclass as d}from\"../../../core/accessorSupport/decorators/subclass.js\";import{equals as m}from\"../../../geometry/support/spatialReferenceUtils.js\";import{LayerView3D as c}from\"./LayerView3D.js\";import u from\"../../layers/LayerView.js\";import{ContextType as p}from\"../../webgl/context-util.js\";var y;!function(e){e[e.API=1]=\"API\",e[e.VerboseAPI=2]=\"VerboseAPI\",e[e.Error=3]=\"Error\"}(y||(y={}));const g=r.getLogger(\" esri.views.3d.layers.VoxelLayerView3D\");let V=class extends(c(u)){constructor(){super(...arguments),this._usedMemory=0,this._futureMemory=0,this.type=\"voxel-3d\",this._wasmLayerId=-1,this._handles=new t,this._dbgFlags=new Set}get wasmLayerId(){return this._wasmLayerId}initialize(){if(\"local\"!==this.view.viewingMode)throw new s(\"voxel:unsupported-viewingMode\",\"Voxel layers support local viewingMode only.\",{});if(this.view._stage.renderView.renderingContext.type!==p.WEBGL2)throw new s(\"voxel:unsupported-context\",\"Voxel layers are supported in WebGL2 rendering contexts only.\",{});if(!!!this.view._stage.renderView.renderingContext.capabilities.colorBufferFloat?.textureFloat)throw new s(\"voxel:missing-color-buffer-float\",\"Voxel layers require the WebGL2 extension EXT_color_buffer_float\",{});const e=this.layer.spatialReference;if(!m(e,this.view.spatialReference))throw new s(\"layerview:spatial-reference-incompatible\",\"The spatial reference of this scene layer is incompatible with the spatial reference of the view\",{});const t=this.layer.currentVariableId,r=this.layer.getVolume(t),a=this.layer.getVariable(t);if(i(r)&&i(a)){const e=r.dimensions[0],s=r.dimensions[1],t=r.getZDimension();if(t>1){const i=r.dimensions[t],o=e.size*s.size*i.size;let l=1;switch(a.renderingFormat.type){case\"Int16\":case\"UInt16\":l=2;break;case\"Int32\":case\"UInt32\":case\"Float32\":l=4}this._futureMemory=l*o}}const o=this.view.addVoxelLayerViewToWasm(this).then((e=>{this._wasmLayerId=e,this._suspendedHandle=l((()=>this.suspended),(e=>{const s=this.view.voxelWasm;i(s)&&s.setEnabled(this,!e)}),n),this._handles.add([l((()=>this.layer.renderMode),(e=>this._pushRenderModeToWasm(e))),l((()=>this.layer.currentVariableId),(e=>this._pushCurrentVariableIdToWasm(e))),l((()=>this.layer.getDynamicSections()),(e=>this._pushDynamicSectionsToWasm(e))),l((()=>this.layer.getSlices()),(e=>this._pushSlicesToWasm(e))),l((()=>this.layer.getSections()),(e=>this._pushSectionsToWasm(e))),l((()=>this.layer.getVerticalExaggeration()),(e=>this._pushVerticalExaggerationToWasm(e))),l((()=>this.layer.getVerticalOffset()),(e=>this._pushVerticalOffsetToWasm(e)))])})).catch((e=>{if(this.view.removeVoxelLayerViewFromWasm(this),this._wasmLayerId=-1,-1===e)throw new s(\"voxel:addLayer-failure\",\"The voxel layer description was invalid.\",{});if(-2===e)throw new s(\"voxel:addLayer-failure\",\"The voxel layer web assembly module failed to download.\",{})}));this.addResolvingPromise(o)}destroy(){this.view.removeVoxelLayerViewFromWasm(this),this._suspendedHandle&&(this._suspendedHandle.remove(),this._suspendedHandle=null),this._handles=a(this._handles)}isUpdating(){const e=this.view.voxelWasm;return!(this._wasmLayerId<0||!i(e))&&e.isUpdating(this._wasmLayerId)}updatingFlagChanged(){this.notifyChange(\"updating\")}getUsedMemory(){return this._usedMemory}getUnloadedMemory(){return this._futureMemory}ignoresMemoryFactor(){return!0}get performanceInfo(){return{nodes:0,displayedNumberOfFeatures:0,maximumNumberOfFeatures:0,totalNumberOfFeatures:0,core:null}}setUsedMemory(e){this._usedMemory=e,this._futureMemory=0}captureFrustum(){const e=this.view.voxelWasm;i(e)&&e.captureFrustum()}toggleFullVolumeExtentDraw(){const e=this.view.voxelWasm;i(e)&&e.toggleFullVolumeExtentDraw(this)}_pushRenderModeToWasm(e){const s=this.view.voxelWasm;this._dbg(y.VerboseAPI,\"VoxelLayerView3D._pushRenderModeToWasm() called, \"+(i(s)?\"have WASM\":\"don't have WASM!!!\"));!!i(s)&&s.setRenderMode(this,e)||this._dbg(y.Error,\"VoxelLayerView3D._pushRenderModeToWasm() failed!\")}_pushSlicesToWasm(e){const s=this.view.voxelWasm;this._dbg(y.VerboseAPI,\"VoxelLayerView3D._pushSlicesToWasm() called, \"+(i(s)?\"have WASM\":\"don't have WASM!!!\"));!!i(s)&&s.setSlices(this,e)||this._dbg(y.Error,\"VoxelLayerView3D._pushSlicesToWasm() failed!\")}_pushSectionsToWasm(e){const s=this.view.voxelWasm;this._dbg(y.VerboseAPI,\"VoxelLayerView3D._pushSectionsToWasm() called, \"+(i(s)?\"have WASM\":\"don't have WASM!!!\"));!!i(s)&&s.setStaticSections(this,e)||this._dbg(y.Error,\"VoxelLayerView3D._pushSectionsToWasm() failed!\")}_pushDynamicSectionsToWasm(e){const s=this.view.voxelWasm;this._dbg(y.VerboseAPI,\"VoxelLayerView3D._pushDynamicSectionsToWasm() called, \"+(i(s)?\"have WASM\":\"don't have WASM!!!\"));!!i(s)&&s.setDynamicSections(this,e)||this._dbg(y.Error,\"VoxelLayer._updateDynamicSections() failed!\")}_pushCurrentVariableIdToWasm(e){const s=this.view.voxelWasm;this._dbg(y.VerboseAPI,\"VoxelLayerView3D._pushCurrentVariableIdToWasm() called!, \"+(i(s)?\"have WASM\":\"don't have WASM!!!\"));!!i(s)&&s.setCurrentVariable(this,e)||this._dbg(y.Error,\"VoxelLayerView3D._pushCurrentVariableIdToWasm() failed!\")}_pushVerticalExaggerationToWasm(e){const s=this.layer.getVolumeStyle(null),t=this.view.voxelWasm;if(this._dbg(y.VerboseAPI,`VoxelLayerView3D._pushVerticalExaggerationToWasm() called, ${i(t)?\"have WASM\":\"don't have WASM!!!\"}, ${i(s)?\"have style\":\"don't have style!!!\"}`),o(s))return;!!i(t)&&t.setVerticalExaggerationAndOffset(this,s.volumeId,e,s.verticalOffset)||this._dbg(y.Error,\"VoxelLayerView3D._pushVerticalExaggerationToWasm() failed!\")}_pushVerticalOffsetToWasm(e){const s=this.layer.getVolumeStyle(null),t=this.view.voxelWasm;if(this._dbg(y.VerboseAPI,`VoxelLayerView3D._pushVerticalOffsetToWasm() called, ${i(t)?\"have WASM\":\"don't have WASM!!!\"}, ${i(s)?\"have style\":\"don't have style!!!\"}`),o(s))return;!!i(t)&&t.setVerticalExaggerationAndOffset(this,s.volumeId,s.verticalExaggeration,e)||this._dbg(y.Error,\"VoxelLayerView3D._pushVerticalOffsetToWasm() failed!\")}_dbg(e,s){this._dbgFlags.has(e)&&(e===y.Error?g.error(s):g.warn(s))}};e([h()],V.prototype,\"layer\",void 0),e([h({readOnly:!0,aliasOf:\"layer.parsedUrl.path\"})],V.prototype,\"baseUrl\",void 0),V=e([d(\"esri.views.3d.layers.VoxelLayerView3D\")],V);const f=V;export{f as default};\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAI2yB,IAAI;AAAE,CAAC,SAASA,IAAE;AAAC,EAAAA,GAAEA,GAAE,MAAI,CAAC,IAAE,OAAMA,GAAEA,GAAE,aAAW,CAAC,IAAE,cAAaA,GAAEA,GAAE,QAAM,CAAC,IAAE;AAAO,EAAE,MAAI,IAAE,CAAC,EAAE;AAAE,IAAM,IAAE,EAAE,UAAU,wCAAwC;AAAE,IAAI,IAAE,cAAcC,GAAEC,EAAC,EAAE;AAAA,EAAC,cAAa;AAAC,UAAM,GAAG,SAAS,GAAE,KAAK,cAAY,GAAE,KAAK,gBAAc,GAAE,KAAK,OAAK,YAAW,KAAK,eAAa,IAAG,KAAK,WAAS,IAAI,KAAE,KAAK,YAAU,oBAAI;AAAA,EAAG;AAAA,EAAC,IAAI,cAAa;AAAC,WAAO,KAAK;AAAA,EAAY;AAAA,EAAC,aAAY;AAJ7rC;AAI8rC,QAAG,YAAU,KAAK,KAAK;AAAY,YAAM,IAAIC,GAAE,iCAAgC,gDAA+C,CAAC,CAAC;AAAE,QAAG,KAAK,KAAK,OAAO,WAAW,iBAAiB,SAAO,EAAE;AAAO,YAAM,IAAIA,GAAE,6BAA4B,iEAAgE,CAAC,CAAC;AAAE,QAAG,CAAC,CAAC,GAAC,UAAK,KAAK,OAAO,WAAW,iBAAiB,aAAa,qBAA1D,mBAA4E;AAAa,YAAM,IAAIA,GAAE,oCAAmC,oEAAmE,CAAC,CAAC;AAAE,UAAMH,KAAE,KAAK,MAAM;AAAiB,QAAG,CAAC,EAAEA,IAAE,KAAK,KAAK,gBAAgB;AAAE,YAAM,IAAIG,GAAE,4CAA2C,oGAAmG,CAAC,CAAC;AAAE,UAAMC,KAAE,KAAK,MAAM,mBAAkBC,KAAE,KAAK,MAAM,UAAUD,EAAC,GAAE,IAAE,KAAK,MAAM,YAAYA,EAAC;AAAE,QAAG,EAAEC,EAAC,KAAG,EAAE,CAAC,GAAE;AAAC,YAAML,KAAEK,GAAE,WAAW,CAAC,GAAEF,KAAEE,GAAE,WAAW,CAAC,GAAED,KAAEC,GAAE,cAAc;AAAE,UAAGD,KAAE,GAAE;AAAC,cAAM,IAAEC,GAAE,WAAWD,EAAC,GAAEE,KAAEN,GAAE,OAAKG,GAAE,OAAK,EAAE;AAAK,YAAII,KAAE;AAAE,gBAAO,EAAE,gBAAgB,MAAK;AAAA,UAAC,KAAI;AAAA,UAAQ,KAAI;AAAS,YAAAA,KAAE;AAAE;AAAA,UAAM,KAAI;AAAA,UAAQ,KAAI;AAAA,UAAS,KAAI;AAAU,YAAAA,KAAE;AAAA,QAAC;AAAC,aAAK,gBAAcA,KAAED;AAAA,MAAC;AAAA,IAAC;AAAC,UAAMA,KAAE,KAAK,KAAK,wBAAwB,IAAI,EAAE,KAAM,CAAAN,OAAG;AAAC,WAAK,eAAaA,IAAE,KAAK,mBAAiBO,GAAG,MAAI,KAAK,WAAY,CAAAP,OAAG;AAAC,cAAMG,KAAE,KAAK,KAAK;AAAU,UAAEA,EAAC,KAAGA,GAAE,WAAW,MAAK,CAACH,EAAC;AAAA,MAAC,GAAG,CAAC,GAAE,KAAK,SAAS,IAAI,CAACO,GAAG,MAAI,KAAK,MAAM,YAAa,CAAAP,OAAG,KAAK,sBAAsBA,EAAC,CAAE,GAAEO,GAAG,MAAI,KAAK,MAAM,mBAAoB,CAAAP,OAAG,KAAK,6BAA6BA,EAAC,CAAE,GAAEO,GAAG,MAAI,KAAK,MAAM,mBAAmB,GAAI,CAAAP,OAAG,KAAK,2BAA2BA,EAAC,CAAE,GAAEO,GAAG,MAAI,KAAK,MAAM,UAAU,GAAI,CAAAP,OAAG,KAAK,kBAAkBA,EAAC,CAAE,GAAEO,GAAG,MAAI,KAAK,MAAM,YAAY,GAAI,CAAAP,OAAG,KAAK,oBAAoBA,EAAC,CAAE,GAAEO,GAAG,MAAI,KAAK,MAAM,wBAAwB,GAAI,CAAAP,OAAG,KAAK,gCAAgCA,EAAC,CAAE,GAAEO,GAAG,MAAI,KAAK,MAAM,kBAAkB,GAAI,CAAAP,OAAG,KAAK,0BAA0BA,EAAC,CAAE,CAAC,CAAC;AAAA,IAAC,CAAE,EAAE,MAAO,CAAAA,OAAG;AAAC,UAAG,KAAK,KAAK,6BAA6B,IAAI,GAAE,KAAK,eAAa,IAAG,OAAKA;AAAE,cAAM,IAAIG,GAAE,0BAAyB,4CAA2C,CAAC,CAAC;AAAE,UAAG,OAAKH;AAAE,cAAM,IAAIG,GAAE,0BAAyB,2DAA0D,CAAC,CAAC;AAAA,IAAC,CAAE;AAAE,SAAK,oBAAoBG,EAAC;AAAA,EAAC;AAAA,EAAC,UAAS;AAAC,SAAK,KAAK,6BAA6B,IAAI,GAAE,KAAK,qBAAmB,KAAK,iBAAiB,OAAO,GAAE,KAAK,mBAAiB,OAAM,KAAK,WAAS,EAAE,KAAK,QAAQ;AAAA,EAAC;AAAA,EAAC,aAAY;AAAC,UAAMN,KAAE,KAAK,KAAK;AAAU,WAAM,EAAE,KAAK,eAAa,KAAG,CAAC,EAAEA,EAAC,MAAIA,GAAE,WAAW,KAAK,YAAY;AAAA,EAAC;AAAA,EAAC,sBAAqB;AAAC,SAAK,aAAa,UAAU;AAAA,EAAC;AAAA,EAAC,gBAAe;AAAC,WAAO,KAAK;AAAA,EAAW;AAAA,EAAC,oBAAmB;AAAC,WAAO,KAAK;AAAA,EAAa;AAAA,EAAC,sBAAqB;AAAC,WAAM;AAAA,EAAE;AAAA,EAAC,IAAI,kBAAiB;AAAC,WAAM,EAAC,OAAM,GAAE,2BAA0B,GAAE,yBAAwB,GAAE,uBAAsB,GAAE,MAAK,KAAI;AAAA,EAAC;AAAA,EAAC,cAAcA,IAAE;AAAC,SAAK,cAAYA,IAAE,KAAK,gBAAc;AAAA,EAAC;AAAA,EAAC,iBAAgB;AAAC,UAAMA,KAAE,KAAK,KAAK;AAAU,MAAEA,EAAC,KAAGA,GAAE,eAAe;AAAA,EAAC;AAAA,EAAC,6BAA4B;AAAC,UAAMA,KAAE,KAAK,KAAK;AAAU,MAAEA,EAAC,KAAGA,GAAE,2BAA2B,IAAI;AAAA,EAAC;AAAA,EAAC,sBAAsBA,IAAE;AAAC,UAAMG,KAAE,KAAK,KAAK;AAAU,SAAK,KAAK,EAAE,YAAW,uDAAqD,EAAEA,EAAC,IAAE,cAAY,qBAAqB;AAAE,KAAC,CAAC,EAAEA,EAAC,KAAGA,GAAE,cAAc,MAAKH,EAAC,KAAG,KAAK,KAAK,EAAE,OAAM,kDAAkD;AAAA,EAAC;AAAA,EAAC,kBAAkBA,IAAE;AAAC,UAAMG,KAAE,KAAK,KAAK;AAAU,SAAK,KAAK,EAAE,YAAW,mDAAiD,EAAEA,EAAC,IAAE,cAAY,qBAAqB;AAAE,KAAC,CAAC,EAAEA,EAAC,KAAGA,GAAE,UAAU,MAAKH,EAAC,KAAG,KAAK,KAAK,EAAE,OAAM,8CAA8C;AAAA,EAAC;AAAA,EAAC,oBAAoBA,IAAE;AAAC,UAAMG,KAAE,KAAK,KAAK;AAAU,SAAK,KAAK,EAAE,YAAW,qDAAmD,EAAEA,EAAC,IAAE,cAAY,qBAAqB;AAAE,KAAC,CAAC,EAAEA,EAAC,KAAGA,GAAE,kBAAkB,MAAKH,EAAC,KAAG,KAAK,KAAK,EAAE,OAAM,gDAAgD;AAAA,EAAC;AAAA,EAAC,2BAA2BA,IAAE;AAAC,UAAMG,KAAE,KAAK,KAAK;AAAU,SAAK,KAAK,EAAE,YAAW,4DAA0D,EAAEA,EAAC,IAAE,cAAY,qBAAqB;AAAE,KAAC,CAAC,EAAEA,EAAC,KAAGA,GAAE,mBAAmB,MAAKH,EAAC,KAAG,KAAK,KAAK,EAAE,OAAM,6CAA6C;AAAA,EAAC;AAAA,EAAC,6BAA6BA,IAAE;AAAC,UAAMG,KAAE,KAAK,KAAK;AAAU,SAAK,KAAK,EAAE,YAAW,+DAA6D,EAAEA,EAAC,IAAE,cAAY,qBAAqB;AAAE,KAAC,CAAC,EAAEA,EAAC,KAAGA,GAAE,mBAAmB,MAAKH,EAAC,KAAG,KAAK,KAAK,EAAE,OAAM,yDAAyD;AAAA,EAAC;AAAA,EAAC,gCAAgCA,IAAE;AAAC,UAAMG,KAAE,KAAK,MAAM,eAAe,IAAI,GAAEC,KAAE,KAAK,KAAK;AAAU,QAAG,KAAK,KAAK,EAAE,YAAW,8DAA8D,EAAEA,EAAC,IAAE,cAAY,yBAAyB,EAAED,EAAC,IAAE,eAAa,uBAAuB,GAAE,EAAEA,EAAC;AAAE;AAAO,KAAC,CAAC,EAAEC,EAAC,KAAGA,GAAE,iCAAiC,MAAKD,GAAE,UAASH,IAAEG,GAAE,cAAc,KAAG,KAAK,KAAK,EAAE,OAAM,4DAA4D;AAAA,EAAC;AAAA,EAAC,0BAA0BH,IAAE;AAAC,UAAMG,KAAE,KAAK,MAAM,eAAe,IAAI,GAAEC,KAAE,KAAK,KAAK;AAAU,QAAG,KAAK,KAAK,EAAE,YAAW,wDAAwD,EAAEA,EAAC,IAAE,cAAY,yBAAyB,EAAED,EAAC,IAAE,eAAa,uBAAuB,GAAE,EAAEA,EAAC;AAAE;AAAO,KAAC,CAAC,EAAEC,EAAC,KAAGA,GAAE,iCAAiC,MAAKD,GAAE,UAASA,GAAE,sBAAqBH,EAAC,KAAG,KAAK,KAAK,EAAE,OAAM,sDAAsD;AAAA,EAAC;AAAA,EAAC,KAAKA,IAAEG,IAAE;AAAC,SAAK,UAAU,IAAIH,EAAC,MAAIA,OAAI,EAAE,QAAM,EAAE,MAAMG,EAAC,IAAE,EAAE,KAAKA,EAAC;AAAA,EAAE;AAAC;AAAE,EAAE,CAAC,EAAE,CAAC,GAAE,EAAE,WAAU,SAAQ,MAAM,GAAE,EAAE,CAAC,EAAE,EAAC,UAAS,MAAG,SAAQ,uBAAsB,CAAC,CAAC,GAAE,EAAE,WAAU,WAAU,MAAM,GAAE,IAAE,EAAE,CAAC,EAAE,uCAAuC,CAAC,GAAE,CAAC;AAAE,IAAM,IAAE;",
  "names": ["e", "n", "u", "s", "t", "r", "o", "l"]
}
