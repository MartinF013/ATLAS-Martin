import {
  A as A20,
  x as x11
} from "./chunk-GHUFWF6Z.js";
import {
  d as d9
} from "./chunk-OW2AZDS5.js";
import {
  d as d10,
  l as l21
} from "./chunk-LDT3IFVT.js";
import {
  c as c28
} from "./chunk-2KOBJHQT.js";
import {
  a as a29,
  l as l22
} from "./chunk-44U4H3M2.js";
import {
  m as m17,
  s as s35
} from "./chunk-SWMYWAIX.js";
import {
  g as g14,
  r as r37,
  t as t36
} from "./chunk-6IWDNBR6.js";
import {
  u as u20,
  w as w10,
  x as x10
} from "./chunk-GR7E5OAR.js";
import {
  C as C7
} from "./chunk-NQLNYYVG.js";
import {
  c as c29,
  r as r38,
  u as u21
} from "./chunk-7RJTV66X.js";
import {
  f as f17,
  n as n36,
  t as t33,
  v as v9
} from "./chunk-Z34XFHPX.js";
import {
  c as c27,
  i as i30,
  t as t34
} from "./chunk-MSOACRMY.js";
import {
  v as v10
} from "./chunk-SXIKZQTG.js";
import {
  A as A19,
  N as N5
} from "./chunk-TBMOOGON.js";
import {
  I as I8,
  T as T12,
  U as U13,
  a as a28,
  k as k8,
  m as m16
} from "./chunk-SOPSFYTX.js";
import {
  m as m15,
  s as s34
} from "./chunk-KP6RIJS6.js";
import {
  a as a27,
  h as h19,
  l as l20,
  n as n37,
  o as o34,
  p as p21
} from "./chunk-SHAETJSZ.js";
import "./chunk-A3D26CKY.js";
import {
  D as D7,
  F as F5,
  H as H4,
  x as x8
} from "./chunk-ZGXOGFCR.js";
import {
  x as x9
} from "./chunk-R3UOMU5U.js";
import {
  f as f16
} from "./chunk-JAEWWGW3.js";
import {
  h as h18,
  p as p20,
  r as r36,
  t as t31
} from "./chunk-MODQZNQH.js";
import {
  c as c26,
  s as s33,
  t as t32
} from "./chunk-S6WPIGPM.js";
import {
  s as s32
} from "./chunk-5CX4KJU5.js";
import {
  u as u19
} from "./chunk-KIR72CUC.js";
import {
  s as s31,
  t as t30
} from "./chunk-FLBHQA56.js";
import {
  n as n35
} from "./chunk-RLOG5P3F.js";
import {
  _ as _8
} from "./chunk-UPTIBS6K.js";
import {
  e as e30,
  k as k7,
  t as t29
} from "./chunk-FK4VVO2E.js";
import {
  c as c25,
  e as e31,
  g as g13,
  i as i28,
  i2 as i29,
  o as o32,
  u as u18
} from "./chunk-WRIKJ4W5.js";
import {
  o as o33
} from "./chunk-7WSRILGC.js";
import "./chunk-GZ6H7JK2.js";
import {
  g as g12,
  m as m13,
  s as s30
} from "./chunk-WGMCNMOI.js";
import "./chunk-UV5UBITC.js";
import {
  o as o31,
  s as s29,
  t as t28
} from "./chunk-UVXRU6XP.js";
import {
  t as t26
} from "./chunk-PMQUXI6L.js";
import {
  A as A16,
  E2 as E15,
  F as F6,
  I as I7,
  J as J3,
  Pe,
  U as U11,
  W as W5
} from "./chunk-RHH23PAT.js";
import {
  a as a26,
  c as c24,
  f as f15,
  h as h16,
  i as i27,
  m as m12,
  r as r34,
  u as u17
} from "./chunk-SNHXPRNZ.js";
import {
  _ as _7,
  j as j13
} from "./chunk-HU4BCST4.js";
import {
  C as C6,
  E as E16,
  a as a24,
  a3 as a25,
  c as c23,
  d as d8,
  e3 as e25,
  e4 as e29,
  n2 as n34,
  r as r30,
  s2 as s27,
  s3 as s28
} from "./chunk-PUR7HIYZ.js";
import "./chunk-O2JKFSHC.js";
import "./chunk-76A4CWFG.js";
import "./chunk-KYD2B4O6.js";
import {
  J as J5
} from "./chunk-Y7MFFYJY.js";
import "./chunk-KW6WHTET.js";
import "./chunk-PUU4QXN5.js";
import "./chunk-EHWEX2VK.js";
import {
  c as c17,
  i as i21
} from "./chunk-HPO2NV7P.js";
import "./chunk-22O7HU3A.js";
import {
  A2 as A18,
  c as c19,
  c2 as c20,
  c3 as c22,
  e as e26,
  e2 as e27,
  g as g11,
  ge,
  h as h14,
  h2 as h15,
  he,
  i as i22,
  i2 as i24,
  i3 as i25,
  j as j12,
  l as l18,
  m as m11,
  r as r31,
  r2 as r32,
  r3 as r33,
  s as s22,
  s2 as s23,
  x as x7,
  y as y9
} from "./chunk-Y75V5CF3.js";
import {
  O as O9,
  l as l19,
  o as o27,
  y as y8
} from "./chunk-PQM6RARY.js";
import {
  i as i26,
  n as n33,
  o as o30
} from "./chunk-2Y5KPYOJ.js";
import {
  J as J4,
  Q as Q5
} from "./chunk-BBUIX72C.js";
import {
  K as K3,
  et
} from "./chunk-5ZS6RUSM.js";
import {
  A as A15,
  e as e24
} from "./chunk-HTS3HEEU.js";
import "./chunk-CYT6A5IX.js";
import "./chunk-R3PFJUIG.js";
import "./chunk-QWEWSWF7.js";
import "./chunk-7LH2XNVI.js";
import "./chunk-PXOPYXIX.js";
import "./chunk-WSQIVEW5.js";
import {
  e as e28,
  o as o28,
  s as s25
} from "./chunk-ZTFWVZTL.js";
import "./chunk-ELZC3DZT.js";
import "./chunk-TGUQXVQU.js";
import "./chunk-4LQ6NAOX.js";
import "./chunk-K37I5IIG.js";
import "./chunk-GKYJJGE3.js";
import "./chunk-AWIG2DGF.js";
import {
  o as o29
} from "./chunk-3236UEJN.js";
import "./chunk-KSOWE6GO.js";
import "./chunk-TCYVDK2B.js";
import "./chunk-PGSJOMCO.js";
import "./chunk-ZLORWBMB.js";
import "./chunk-LJAT5UYW.js";
import "./chunk-OZAI2STL.js";
import "./chunk-CNL2CHF7.js";
import "./chunk-HRAEK6P4.js";
import {
  s as s24
} from "./chunk-K6UIDSFF.js";
import {
  m as m9,
  p as p19
} from "./chunk-5CPRHNFX.js";
import {
  t as t24
} from "./chunk-LAHCYKZK.js";
import {
  T as T10
} from "./chunk-52W4YMC2.js";
import {
  T as T11
} from "./chunk-MHEQOIKQ.js";
import {
  E as E14,
  t2 as t25
} from "./chunk-AIONJO5O.js";
import "./chunk-YLSPLHY5.js";
import "./chunk-4GGQTXXY.js";
import "./chunk-MCSRSOMA.js";
import {
  c as c18
} from "./chunk-2DP653N7.js";
import "./chunk-QZCFKQOH.js";
import "./chunk-QMP4VG7M.js";
import {
  n as n28
} from "./chunk-TRGP26VY.js";
import {
  a as a21,
  h as h12,
  s as s17,
  s2 as s18,
  t2 as t19,
  t3 as t20,
  y as y5
} from "./chunk-QYVYSUKX.js";
import "./chunk-IUU35NDY.js";
import "./chunk-5RP42VZJ.js";
import "./chunk-567AWHAB.js";
import "./chunk-TZD2AXJG.js";
import "./chunk-FZCDFXBT.js";
import {
  n as n30,
  r as r28
} from "./chunk-KD6KBT2L.js";
import "./chunk-RVR2DEVB.js";
import "./chunk-AS3OSZXK.js";
import "./chunk-7CXXTQLM.js";
import {
  G as G6
} from "./chunk-XEWFCJLT.js";
import {
  H as H3,
  P as P5,
  U as U8,
  g as g6,
  i as i15,
  j as j10,
  k as k6,
  v2 as v7
} from "./chunk-ZEDAE7EU.js";
import "./chunk-IYLBVJ6T.js";
import "./chunk-ZEIWFXXO.js";
import {
  o as o13,
  r as r15
} from "./chunk-YXFNNKMT.js";
import {
  p as p16
} from "./chunk-AW7GDFPQ.js";
import "./chunk-YSQDB5AA.js";
import {
  w as w7
} from "./chunk-X7CKOX5Z.js";
import {
  a as a14
} from "./chunk-7OZR6JFF.js";
import {
  e as e18,
  e2 as e19,
  f as f14,
  o as o20,
  t as t15,
  t2 as t16,
  u as u13
} from "./chunk-NXOQBIK7.js";
import {
  A as A12,
  E as E9
} from "./chunk-ERNXFM5T.js";
import {
  i as i13
} from "./chunk-6ITXWFMK.js";
import {
  e as e20,
  t as t17
} from "./chunk-SV4VP57N.js";
import {
  L as L5
} from "./chunk-5LWMNFCG.js";
import {
  A as A9,
  A2 as A10,
  g as g4,
  p as p15,
  t as t13,
  u as u12,
  w as w5
} from "./chunk-PWYPPSAW.js";
import {
  E as E8,
  c as c12,
  f as f13,
  l as l16
} from "./chunk-5EXPMKQP.js";
import {
  W,
  a as a17,
  c as c11,
  h as h11,
  l as l15,
  r as r22,
  s as s14
} from "./chunk-B7F3T673.js";
import {
  t as t11
} from "./chunk-QXYW5CVF.js";
import {
  D as D6,
  r as r19
} from "./chunk-Z7AZMEL6.js";
import {
  f as f11
} from "./chunk-FUKESVWQ.js";
import {
  E as E6,
  R as R5,
  c as c10,
  n as n20,
  u as u11
} from "./chunk-T3KDRLPE.js";
import {
  u as u10
} from "./chunk-EJ7RFMRW.js";
import "./chunk-SQ4XLXZO.js";
import "./chunk-6YT7XVZA.js";
import "./chunk-444THZYK.js";
import {
  i as i9
} from "./chunk-E3V32BOJ.js";
import "./chunk-VQLKKADV.js";
import "./chunk-D764DGF2.js";
import "./chunk-XEIRRA3E.js";
import "./chunk-PZHH54V6.js";
import "./chunk-PZFKIJU3.js";
import "./chunk-2A3F5J6D.js";
import {
  i as i8
} from "./chunk-B3IXFXV6.js";
import {
  o as o21,
  r as r24
} from "./chunk-EPNT7GPS.js";
import "./chunk-MQLLOFWM.js";
import {
  c as c14,
  i as i11,
  n as n24
} from "./chunk-XNOIZLCR.js";
import "./chunk-PMOPLTRU.js";
import "./chunk-I22L7HNU.js";
import {
  W as W2,
  c as c13
} from "./chunk-44UD36FH.js";
import {
  r as r23
} from "./chunk-ODYLXHP4.js";
import {
  n as n25
} from "./chunk-Y5AGUEHG.js";
import {
  l as l14
} from "./chunk-DVE4HUBR.js";
import "./chunk-RC6OMMF6.js";
import "./chunk-AWPZQDE5.js";
import "./chunk-OYNEZ5VG.js";
import "./chunk-R67CDTDF.js";
import {
  s as s15
} from "./chunk-UCWSHVC4.js";
import "./chunk-DHZ2TSD5.js";
import "./chunk-ZV3LDRB3.js";
import "./chunk-FAF3GP2W.js";
import "./chunk-YSWURJZW.js";
import "./chunk-5JKCNCL2.js";
import "./chunk-2YDCEMEJ.js";
import "./chunk-O7YSDCZE.js";
import "./chunk-767LZ6IM.js";
import "./chunk-TTKSAULB.js";
import "./chunk-WJDUBZ7S.js";
import "./chunk-DNPZNIDB.js";
import "./chunk-WW7VYUQW.js";
import "./chunk-FCDEMPPS.js";
import {
  o as o18
} from "./chunk-TEJEYVH4.js";
import {
  o as o19
} from "./chunk-HEZ2ATGC.js";
import "./chunk-ECNFP4CF.js";
import "./chunk-AALA53RH.js";
import "./chunk-BOVIIQLB.js";
import "./chunk-IJHFAZOW.js";
import "./chunk-DMGVDNFD.js";
import "./chunk-YAQGRU5B.js";
import "./chunk-M3GMIUQS.js";
import "./chunk-BMA2CXVS.js";
import "./chunk-46N7XS5M.js";
import "./chunk-4MKQUQD4.js";
import "./chunk-A3QLZKCF.js";
import "./chunk-OYAHQ564.js";
import "./chunk-LGILR4HN.js";
import {
  i2 as i12
} from "./chunk-I5UNY2WQ.js";
import {
  n as n18
} from "./chunk-4SVQENAK.js";
import "./chunk-KETNREBT.js";
import {
  c as c8,
  n3 as n16
} from "./chunk-GKICNYWA.js";
import {
  l as l11
} from "./chunk-EYJ2F5XB.js";
import "./chunk-5EPJG7SL.js";
import "./chunk-XXEJXJP4.js";
import "./chunk-MFOJFHT7.js";
import {
  A as A7,
  T as T4,
  d as d4,
  e as e10,
  o as o8,
  u as u8,
  w as w4,
  y as y3
} from "./chunk-QUUJFQ73.js";
import {
  o as o7
} from "./chunk-TR3U55RZ.js";
import {
  T as T2
} from "./chunk-3DCTMZI6.js";
import "./chunk-33INAWJA.js";
import "./chunk-5WOO2FX6.js";
import {
  B as B2,
  C as C2,
  D as D4,
  E as E5,
  F as F4,
  G as G4,
  I as I4,
  L as L4,
  M as M6,
  P as P3,
  R as R4,
  T as T3,
  U as U5,
  V as V2,
  Y,
  _ as _2
} from "./chunk-FPMD6IB4.js";
import "./chunk-J73IXFNW.js";
import "./chunk-FFHGE66H.js";
import {
  e2 as e14,
  r as r14
} from "./chunk-MOZ4GR2L.js";
import {
  i as i4,
  x as x3
} from "./chunk-MQBVOUKB.js";
import "./chunk-S5PZEGLP.js";
import {
  i as i14
} from "./chunk-TUZ3FLXS.js";
import {
  a as a20,
  n as n27
} from "./chunk-TMLBWFXL.js";
import {
  r as r35
} from "./chunk-EOJGYH5X.js";
import {
  A as A14,
  B as B4,
  C as C4,
  C2 as C5,
  E as E11,
  E2 as E13,
  H as H5,
  H2 as H7,
  I as I5,
  I2 as I6,
  J as J2,
  K as K2,
  L as L8,
  O as O6,
  O2 as O8,
  P as P6,
  Q as Q4,
  R as R6,
  T as T7,
  T2 as T9,
  U as U10,
  W as W4,
  X as X3,
  Y as Y2,
  Z as Z2,
  _ as _6,
  a as a23,
  b as b5,
  e as e23,
  g as g10,
  h as h13,
  j as j11,
  m as m10,
  n as n32,
  q as q3,
  s as s21,
  t as t23,
  u as u16,
  v as v8,
  w as w9,
  x as x5,
  y as y6,
  y2 as y7,
  z as z5
} from "./chunk-4CRT3CQZ.js";
import {
  M as M7
} from "./chunk-EJ4V43KX.js";
import {
  A as A13,
  E as E12,
  H as H6,
  O as O7,
  S as S6,
  T as T8
} from "./chunk-PLLZPG4O.js";
import {
  t as t35
} from "./chunk-YJCOSBLY.js";
import {
  h as h17,
  m as m14
} from "./chunk-3LEH5KDJ.js";
import {
  A as A17,
  U as U12,
  c as c21,
  i as i23,
  s as s26,
  t as t27,
  x as x6
} from "./chunk-WQLER7IU.js";
import {
  G as G8,
  X as X2,
  cs,
  fs,
  ls,
  z as z4
} from "./chunk-7GTYHKA3.js";
import {
  L as L6,
  V as V4,
  j as j8
} from "./chunk-MOXYEJRV.js";
import {
  A as A11,
  N as N4,
  O as O5,
  V as V3,
  e as e17,
  f as f12,
  h as h10,
  n as n23,
  r2 as r21,
  v as v6
} from "./chunk-EEJIELE6.js";
import {
  E as E7
} from "./chunk-Y55TYMBP.js";
import {
  n as n21,
  t as t14
} from "./chunk-NAB3NF54.js";
import "./chunk-MHB3L22D.js";
import {
  A as A8,
  C as C3,
  D as D5,
  O as O4,
  a as a13,
  e as e15,
  i as i6,
  l as l12,
  n as n19,
  o as o16,
  t as t12
} from "./chunk-MDCKEJ7B.js";
import {
  a as a16,
  n as n22,
  r as r20
} from "./chunk-MLAOYRDT.js";
import {
  h as h9
} from "./chunk-T4FVDPUN.js";
import {
  O as O3
} from "./chunk-VMF4NMEB.js";
import {
  n as n38
} from "./chunk-UTJPTN6P.js";
import {
  e as e16,
  i as i7
} from "./chunk-NAIF4GWX.js";
import {
  S as S5
} from "./chunk-72PB636Q.js";
import "./chunk-RIOXX6J2.js";
import "./chunk-SOZCO2CU.js";
import {
  L as L7,
  P as P4,
  Q as Q3,
  T as T6,
  U as U7,
  W as W3,
  Z,
  _ as _4,
  g as g5,
  j as j9,
  k as k5,
  l as l17,
  p2 as p17,
  q2,
  x as x4
} from "./chunk-53KI6WDE.js";
import {
  $,
  B as B3,
  E as E10,
  G as G5,
  T as T5,
  U as U6,
  _ as _3,
  a as a18,
  d as d6,
  i as i10,
  j as j7,
  k2 as k4,
  w as w6
} from "./chunk-W2HLA6I3.js";
import "./chunk-Q6AASANP.js";
import {
  c as c9,
  f as f10,
  r as r18
} from "./chunk-ZYIEYKCD.js";
import {
  S as S3
} from "./chunk-DLM6NKXW.js";
import {
  e as e13
} from "./chunk-TQLSOIYV.js";
import {
  e as e12,
  o as o9,
  t as t8
} from "./chunk-YFBAFAZ2.js";
import {
  e as e11
} from "./chunk-LUU3J646.js";
import "./chunk-Z7BSDVJ3.js";
import {
  G as G7,
  U as U9,
  _ as _5,
  a2 as a22,
  e as e22,
  i as i18,
  i2 as i19,
  i3 as i20,
  n as n26,
  n2 as n29,
  n3 as n31,
  o as o25,
  o2 as o26,
  p as p18,
  r as r29,
  s as s19,
  s3 as s20,
  t as t21,
  t2 as t22,
  u as u15,
  w as w8
} from "./chunk-IG67ATRS.js";
import "./chunk-WTYOB7O7.js";
import "./chunk-EDJZEIRN.js";
import "./chunk-KDNPPW3Z.js";
import "./chunk-2EPPX4WN.js";
import "./chunk-4ZEOAETN.js";
import {
  e as e21,
  r as r27
} from "./chunk-MEW2XKT2.js";
import {
  t as t9
} from "./chunk-RB3LJE4I.js";
import "./chunk-6EODZIDR.js";
import {
  n as n14,
  o as o12
} from "./chunk-MV2XZ5BA.js";
import {
  a as a12,
  l as l10,
  m as m8,
  p as p14,
  r as r17,
  y as y4
} from "./chunk-MZ4JF5C6.js";
import "./chunk-PQO66WZ2.js";
import "./chunk-6S5B4VLQ.js";
import "./chunk-24OMPNTT.js";
import "./chunk-DLW46BXD.js";
import {
  a as a10,
  f as f8,
  o as o10,
  p as p10,
  u as u9
} from "./chunk-3NPGGTI6.js";
import "./chunk-KBILTFOD.js";
import {
  d as d7,
  u as u14
} from "./chunk-QNKOXOOY.js";
import "./chunk-G4ERZR5M.js";
import "./chunk-AMGAY4O5.js";
import {
  g as g9
} from "./chunk-GRW2GUB3.js";
import {
  o as o24,
  r as r26
} from "./chunk-RBVTRJPJ.js";
import {
  a as a9,
  m as m7,
  o as o6,
  r as r13
} from "./chunk-YZNDHJDJ.js";
import "./chunk-ZZCCRN4U.js";
import "./chunk-TWQ374WD.js";
import "./chunk-GT2OBOXC.js";
import {
  c as c16,
  g as g8,
  i as i17
} from "./chunk-Z3S5X75I.js";
import "./chunk-YK4ZKK2Q.js";
import {
  o as o23
} from "./chunk-NMRWU44S.js";
import "./chunk-LBBA3SFR.js";
import "./chunk-2KZBVPWA.js";
import "./chunk-CXIMLSDF.js";
import "./chunk-ZDSMRGKC.js";
import "./chunk-I6H66HCE.js";
import "./chunk-4P4OV7G6.js";
import "./chunk-ZUDEVIXR.js";
import "./chunk-RRFFPL7N.js";
import "./chunk-JYR7GBAU.js";
import "./chunk-IG4CY4XM.js";
import "./chunk-HB4HVKJV.js";
import "./chunk-CC32E45Q.js";
import {
  t as t18
} from "./chunk-V7M26XZ7.js";
import {
  a as a15,
  l as l13,
  o as o17
} from "./chunk-ZN2MGN4S.js";
import {
  A as A6,
  L as L3,
  N as N3,
  Q as Q2,
  w as w3
} from "./chunk-JZY7CGEI.js";
import "./chunk-2LGANX7J.js";
import {
  f as f9,
  n as n17
} from "./chunk-RTHP2LNT.js";
import "./chunk-XZTXACPW.js";
import "./chunk-EHYYP2L2.js";
import "./chunk-ZUEYZA7M.js";
import "./chunk-74GUBHRJ.js";
import "./chunk-E447OCKN.js";
import "./chunk-LPU5TMA4.js";
import {
  e as e8
} from "./chunk-25QHXOZB.js";
import "./chunk-AA7FGPNP.js";
import "./chunk-UHJVTABQ.js";
import "./chunk-W66LN57L.js";
import "./chunk-PNUWGOXY.js";
import {
  i as i16,
  o as o22,
  r as r25,
  s as s16
} from "./chunk-FUQI3AAI.js";
import "./chunk-22YODLVL.js";
import "./chunk-TB42IUV7.js";
import "./chunk-ZWMYDR2G.js";
import "./chunk-ZZY5IDKU.js";
import "./chunk-6SWQ7R36.js";
import "./chunk-Z4FD36CT.js";
import "./chunk-OZT6RDST.js";
import "./chunk-4I3W4KD5.js";
import "./chunk-JNXH4TTS.js";
import "./chunk-6FKG7JUE.js";
import {
  An,
  Bn,
  Ce,
  Hn,
  In,
  Re,
  Sn,
  Un,
  jn,
  qn,
  rn,
  zn
} from "./chunk-PZWU5EHT.js";
import {
  a as a19
} from "./chunk-37ZVELW7.js";
import "./chunk-45UEUCUL.js";
import "./chunk-4AZE5OWC.js";
import {
  i as i5,
  n as n15,
  r as r16,
  s as s13,
  t as t10
} from "./chunk-CQSGZXR7.js";
import "./chunk-POPR7XUB.js";
import "./chunk-7LOJJ46D.js";
import "./chunk-VNR743PA.js";
import {
  v as v5
} from "./chunk-JJ7VMWJT.js";
import "./chunk-SWCA522B.js";
import "./chunk-YPIBZ3CH.js";
import "./chunk-XLCZFN6R.js";
import "./chunk-OMNBM2E4.js";
import "./chunk-WKHS6QIX.js";
import "./chunk-6O7ZZEV7.js";
import {
  c as c15
} from "./chunk-M2WA2LMI.js";
import "./chunk-UQDLDM54.js";
import "./chunk-YL26MZEL.js";
import "./chunk-OBCAVCXI.js";
import "./chunk-RFOZTYJH.js";
import "./chunk-J6DXGG2A.js";
import "./chunk-L2YBXQTH.js";
import "./chunk-S4ZKPFDU.js";
import "./chunk-YG6VFATO.js";
import "./chunk-WBX2MY5R.js";
import "./chunk-3DZ4BNVJ.js";
import "./chunk-4XBERLPX.js";
import "./chunk-D7AOY7GH.js";
import "./chunk-HR2OX32D.js";
import {
  o as o11
} from "./chunk-7ZPDA3EC.js";
import "./chunk-SZPDY7KN.js";
import "./chunk-Y6YGVGFR.js";
import "./chunk-GKRQ3NBT.js";
import "./chunk-OXEYQYNR.js";
import "./chunk-OXRBYKVX.js";
import "./chunk-6O2ARNGD.js";
import "./chunk-YLU2PLJS.js";
import "./chunk-MZX3HN4G.js";
import "./chunk-T47JAOQZ.js";
import "./chunk-6GPADSSO.js";
import "./chunk-CQ47VEUP.js";
import "./chunk-FU5UMT3R.js";
import "./chunk-ODX6X222.js";
import "./chunk-GSFXXEAM.js";
import "./chunk-QZTJM4HG.js";
import {
  p as p11
} from "./chunk-TMSBC6BS.js";
import {
  p as p12
} from "./chunk-RIWDMEW4.js";
import "./chunk-C7S44TP4.js";
import "./chunk-KUWW4YJ7.js";
import "./chunk-P6I5J7W6.js";
import "./chunk-ORGMKDYR.js";
import "./chunk-F2DXUUYL.js";
import "./chunk-EGR3VVZG.js";
import {
  h as h7,
  r as r12
} from "./chunk-F5A4XAOJ.js";
import "./chunk-4TDLPK3D.js";
import {
  e as e9,
  l as l7,
  n as n10,
  r as r10,
  t as t7
} from "./chunk-U7B2WKBH.js";
import {
  o as o15
} from "./chunk-T7SYNS2R.js";
import "./chunk-WODSLTZT.js";
import "./chunk-JMZLJZMP.js";
import "./chunk-OG6CQEZJ.js";
import "./chunk-X5Z3DJQ4.js";
import "./chunk-BUWXVMJU.js";
import "./chunk-JT3LXQ47.js";
import "./chunk-P3QN5DXX.js";
import {
  a as a11,
  n as n12
} from "./chunk-QKRZMDWG.js";
import "./chunk-TBT57L4K.js";
import "./chunk-D3XXPCBB.js";
import "./chunk-OWBMOIIV.js";
import "./chunk-SIH2IMSA.js";
import "./chunk-2AGPHSDM.js";
import "./chunk-JGSSQ5FR.js";
import "./chunk-5OEHY3VV.js";
import "./chunk-LJLQIETB.js";
import "./chunk-WKRVG5MO.js";
import "./chunk-GRILTTJT.js";
import {
  d as d5
} from "./chunk-JJRJ6TV3.js";
import {
  c as c7
} from "./chunk-K2FQEYBG.js";
import {
  u as u4
} from "./chunk-G4IZ2HTT.js";
import {
  U as U3,
  a as a5,
  f as f4,
  h as h3,
  j as j5,
  l as l6,
  w as w2
} from "./chunk-T7BEWVV3.js";
import {
  C,
  F as F3,
  Q,
  R as R2,
  b as b3,
  c as c5,
  f as f5,
  h as h4,
  l as l8,
  m as m5,
  n as n11,
  p as p7,
  r as r11,
  u as u5
} from "./chunk-ASC3X65B.js";
import {
  a as a6,
  n as n9
} from "./chunk-KVF4M6PZ.js";
import "./chunk-IZCP5QP4.js";
import "./chunk-QFTOW2ST.js";
import "./chunk-I4USSDLI.js";
import "./chunk-VI3TTBSC.js";
import "./chunk-B42HXLDM.js";
import "./chunk-TVXPO7T5.js";
import "./chunk-2EZYA7VW.js";
import "./chunk-OEQ3EDRD.js";
import "./chunk-Z6EP2GTZ.js";
import {
  n as n13
} from "./chunk-P6G64ARX.js";
import "./chunk-GD6ALUPQ.js";
import "./chunk-CLGCKZUR.js";
import {
  p as p3,
  z
} from "./chunk-RN2KRYDN.js";
import {
  g as g7
} from "./chunk-BLINZ65M.js";
import {
  S as S4,
  h as h8,
  j2 as j6,
  o as o14,
  p as p13
} from "./chunk-TADZYUVR.js";
import "./chunk-C5ULLWJ7.js";
import "./chunk-HFDYAQZS.js";
import "./chunk-HJHWUUQQ.js";
import {
  A as A5,
  B,
  G as G3,
  I as I3,
  N as N2,
  S as S2,
  a as a8,
  f as f7,
  h as h6,
  p as p9,
  u as u7,
  v as v4,
  y as y2
} from "./chunk-TMBOFNWA.js";
import "./chunk-ZNEGSJWK.js";
import "./chunk-EI4MOLML.js";
import "./chunk-4SBWV5M2.js";
import "./chunk-CF56UYH2.js";
import "./chunk-5TRUGQDM.js";
import "./chunk-PZG7CR4Y.js";
import {
  r as r9
} from "./chunk-2HDG7SIE.js";
import {
  D as D3,
  E as E4,
  H as H2,
  I as I2,
  K,
  M as M5,
  R as R3,
  U as U4,
  a as a7,
  b as b4,
  c as c6,
  d as d3,
  f as f6,
  g as g3,
  h as h5,
  k as k3,
  l as l9,
  m as m6,
  o as o5,
  p as p8,
  s as s12,
  u as u6,
  z as z3
} from "./chunk-56RHM4A6.js";
import "./chunk-ACJD5XFJ.js";
import "./chunk-OO2JXX7L.js";
import "./chunk-6DWU2ZQF.js";
import "./chunk-Q3R7XFM5.js";
import "./chunk-JCPK2OXG.js";
import "./chunk-HVM5D6S5.js";
import "./chunk-JYHTO6QC.js";
import "./chunk-FTLBKDGL.js";
import "./chunk-5Z5455ZY.js";
import "./chunk-D7DLEBS2.js";
import "./chunk-H7JF6Q7A.js";
import {
  E as E3,
  j as j4
} from "./chunk-TT2HIXWQ.js";
import {
  n as n8
} from "./chunk-OIPX3EDD.js";
import {
  c as c4,
  d as d2,
  i as i3,
  p as p6,
  s as s11,
  x as x2
} from "./chunk-NWRK6QLX.js";
import "./chunk-HPH3FMVB.js";
import "./chunk-OOZMA7DN.js";
import "./chunk-Y7FSCP47.js";
import "./chunk-65A2N4LL.js";
import "./chunk-GVELBHGI.js";
import {
  It
} from "./chunk-5N3FSR63.js";
import "./chunk-C4LU7RDX.js";
import "./chunk-EPCCNF3D.js";
import "./chunk-4PRVTUEZ.js";
import "./chunk-DMJWTK32.js";
import {
  l as l5
} from "./chunk-FVPTCNCX.js";
import {
  I,
  M as M4,
  a as a4,
  b as b2,
  l as l4,
  m as m4,
  o as o4,
  s as s10
} from "./chunk-BPZGJQOB.js";
import {
  D as D2,
  G as G2,
  a as a3,
  j as j3,
  l as l3,
  r as r8,
  s as s9,
  w
} from "./chunk-ZOKX6UGH.js";
import {
  A as A4,
  F as F2,
  G,
  H,
  J,
  L as L2,
  O as O2,
  P as P2,
  S,
  U as U2,
  V,
  X,
  _,
  e as e7,
  j as j2,
  o as o3,
  p as p5,
  q,
  r as r7,
  s as s8,
  u as u3,
  v as v3,
  x,
  z as z2
} from "./chunk-PKZEO23A.js";
import "./chunk-43S7PUMG.js";
import {
  e as e6,
  f as f3,
  i as i2,
  n as n7,
  r as r6,
  t as t5
} from "./chunk-AIRC226G.js";
import {
  t as t6
} from "./chunk-BNPOKP6A.js";
import "./chunk-CHNDTVQJ.js";
import "./chunk-VLCG72SW.js";
import {
  M as M3,
  f as f2
} from "./chunk-Q72YFZUL.js";
import {
  M as M2,
  R,
  c as c3,
  g as g2,
  j2 as j,
  p as p4
} from "./chunk-YPZEGNLG.js";
import {
  A as A3,
  P,
  T,
  k2,
  s as s5
} from "./chunk-3NMRL5CR.js";
import {
  s as s6
} from "./chunk-SN4RUQ4N.js";
import {
  s as s7
} from "./chunk-XRL56EGK.js";
import {
  r as r5
} from "./chunk-ZIHDQYKE.js";
import {
  o as o2
} from "./chunk-GSRNZQFV.js";
import {
  l as l2
} from "./chunk-ICD7AJSY.js";
import {
  A as A2,
  F,
  U,
  d,
  e2 as e4,
  e3 as e5,
  h as h2,
  n2 as n,
  n4 as n2,
  n5 as n3,
  n7 as n4,
  n8 as n6,
  r as r2,
  r3 as r4,
  t as t3,
  t5 as t4,
  u,
  u3 as u2,
  v as v2,
  y3 as y
} from "./chunk-2QOWZFCU.js";
import {
  e
} from "./chunk-IVBXK6OP.js";
import "./chunk-YAAIZ67O.js";
import {
  e as e3
} from "./chunk-5EQKHR4M.js";
import {
  D,
  E as E2,
  L,
  O,
  f,
  g,
  k,
  m as m3,
  p as p2,
  r2 as r3,
  v
} from "./chunk-U3PSONS6.js";
import {
  s2 as s4
} from "./chunk-HFTNOKM2.js";
import {
  N,
  b,
  n as n5
} from "./chunk-23NWA6WL.js";
import {
  s as s3
} from "./chunk-CVWDM4C7.js";
import {
  m as m2
} from "./chunk-G5JBUC5N.js";
import {
  A2 as A,
  E,
  M,
  a,
  a2,
  c,
  c2,
  e as e2,
  h,
  i2 as i,
  l,
  m,
  o,
  p,
  r,
  s,
  s2,
  t,
  t3 as t2
} from "./chunk-CBQWMOBK.js";
import "./chunk-AC2VUBZ6.js";

// node_modules/@arcgis/core/views/support/GroundViewElevationSampler.js
var u22 = s3.getLogger("esri.views.support.GroundViewElevationSampler");
var d11 = class extends n8.EventedAccessor {
  constructor(e59) {
    super(e59), this.demResolution = { min: -1, max: -1 }, this.noDataValue = C4;
  }
  initialize() {
    this.view.basemapTerrain.on("elevation-change", () => this.emit("changed", {}));
  }
  get extent() {
    const e59 = this.view.basemapTerrain;
    if (t(e59.extent) || !e59.spatialReference)
      return null;
    const t60 = f6(e59.extent, e59.spatialReference);
    return t60.zmin = e59.elevationBounds.min, t60.zmax = e59.elevationBounds.max, t60;
  }
  elevationAt(e59, t60) {
    if (t(this.extent) || !f2(this.extent, e59, t60)) {
      const o61 = r(this.extent) ? `${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}` : null;
      return u22.warn("#elevationAt()", `Point used to sample elevation (${e59}, ${t60}) is outside of the sampler extent (${o61})`), this.noDataValue;
    }
    return c(this.view.elevationProvider.getElevation(e59, t60, 0, this.spatialReference, "ground"), this.noDataValue);
  }
  queryElevation(e59) {
    return h9(e59.clone(), this);
  }
};
e([d({ readOnly: true })], d11.prototype, "demResolution", void 0), e([d({ readOnly: true })], d11.prototype, "extent", null), e([d({ readOnly: true })], d11.prototype, "noDataValue", void 0), e([d({ readOnly: true, aliasOf: "view.basemapTerrain.spatialReference" })], d11.prototype, "spatialReference", void 0), e([d({ constructOnly: true })], d11.prototype, "view", void 0), d11 = e([n6("esri.views.support.GroundViewElevationSampler")], d11);
var v11 = d11;

// node_modules/@arcgis/core/views/GroundView.js
var d12 = class extends y {
  constructor(e59) {
    super(e59), this.handles = new u4(), this.view = null, this.layerViews = new j4();
  }
  initialize() {
    this.handles.add(f4(() => {
      var _a, _b;
      return (_b = (_a = this.view) == null ? void 0 : _a.map) == null ? void 0 : _b.ground;
    }, (e59) => e59.load())), this.handles.add(this.layerViews.on("after-changes", () => this._layerViewsAfterChangesHandler()));
  }
  destroy() {
    this._set("view", null), this.handles && (this.handles.destroy(), this.handles = null);
  }
  get elevationSampler() {
    return this.view ? "2d" === this.view.type ? null : this.view.ready && this.view.basemapTerrain && this.view.basemapTerrain.ready ? new v11({ view: this.view }) : null : null;
  }
  get updating() {
    return !this.suspended && this.layerViews.some((e59) => e59.updating);
  }
  get suspended() {
    return !this.view || this.view.suspended;
  }
  _layerViewsAfterChangesHandler() {
    this.handles.remove("updating"), this.handles.add(this.layerViews.map((e59) => l6(() => e59.updating, () => this._updateUpdating(), U3)).toArray(), "updating"), this._updateUpdating();
  }
  _updateUpdating() {
    this.notifyChange("updating");
  }
};
e([d({ readOnly: true })], d12.prototype, "elevationSampler", null), e([d({ type: Boolean, readOnly: true })], d12.prototype, "updating", null), e([d({ constructOnly: true })], d12.prototype, "view", void 0), e([d({ type: j4, readOnly: true })], d12.prototype, "layerViews", void 0), e([d({ readOnly: true })], d12.prototype, "suspended", null), d12 = e([n6("esri.views.GroundView")], d12);
var h20 = d12;

// node_modules/@arcgis/core/views/3d/layerViewModuleImportUtils.js
var i31 = () => import("./TileLayerView3D-AGZHVLZF.js");
var s36 = () => import("./ElevationLayerView3D-PWJ63QOF.js");
var t37 = { "base-dynamic": () => import("./BaseDynamicLayerView3D-R6DKINEP.js"), "base-elevation": s36, "base-tile": i31, "bing-maps": i31, "building-scene": () => import("./BuildingSceneLayerView3D-ANWUOZJ5.js"), csv: () => import("./CSVLayerView3D-NMZH5DOC.js"), elevation: s36, feature: () => import("./FeatureLayerView3D-3BCHNSQX.js"), geojson: () => import("./GeoJSONLayerView3D-XP7MBGOY.js"), graphics: () => import("./GraphicsLayerView3D-P4B3GJUP.js"), group: () => import("./GroupLayerView-5VFQ37BD.js"), imagery: () => import("./ImageryLayerView3D-HALLC72D.js"), "integrated-mesh": () => import("./IntegratedMeshLayerView3D-BAYJZAS5.js"), "line-of-sight": () => import("./LineOfSightLayerView3D-C6REZ4YE.js"), "map-image": () => import("./MapImageLayerView3D-GJJZ56EZ.js"), media: () => import("./MediaLayerView3D-L4DFCKEF.js"), "ogc-feature": () => import("./OGCFeatureLayerView3D-PSJQFJLT.js"), "open-street-map": i31, "point-cloud": () => import("./PointCloudLayerView3D-N3S5BJ6W.js"), voxel: () => import("./VoxelLayerView3D-N3JLSWFJ.js"), route: () => import("./RouteLayerView3D-3TNHN2ZE.js"), scene: (e59) => null == e59.profile || "mesh-pyramids" === e59.profile ? import("./SceneLayerView3D-S2QELQUV.js") : import("./SceneLayerGraphicsView3D-NNUFCLDN.js"), stream: () => import("./StreamLayerView3D-4XXL2EXD.js"), tile: i31, "imagery-tile": () => import("./ImageryTileLayerView3D-D4AYAJU7.js"), "vector-tile": () => import("./VectorTileLayerView3D-2VR6G5Q4.js"), wcs: () => import("./ImageryTileLayerView3D-D4AYAJU7.js"), "web-tile": i31, wfs: () => import("./WFSLayerView3D-O746IKS4.js"), wms: () => import("./WMSLayerView3D-XGAVNARX.js"), wmts: () => import("./WMTSLayerView3D-YRMERK26.js"), "geo-rss": null, kml: null, "map-notes": null, "subtype-group": null, unknown: null, unsupported: null };
function o35(r59) {
  const a58 = r59.declaredClass ? r59.declaredClass.slice(r59.declaredClass.lastIndexOf(".") + 1) : "Unknown", i66 = a58.replace(/([a-z])([A-Z])/g, "$1-$2").toLowerCase();
  return new s4(`${i66}:view-not-supported`, `${a58} is not supported in 3D`);
}
var l23 = { hasLayerViewModule: (e59) => r(t37[e59.type]), importLayerView: (e59) => {
  const r59 = t37[e59.type];
  if (t(r59))
    throw o35(e59);
  return r59(e59);
} };

// node_modules/@arcgis/core/views/3d/analysis/AnalysisViewManager3D.js
var p22 = s3.getLogger("esri.views.3d.analysis.AnalysisViewManager3D");
var V5 = "analyses-owner-handles";
var A21;
var v12;
!function(e59) {
  e59[e59.PENDING = 0] = "PENDING", e59[e59.CREATED = 1] = "CREATED";
}(A21 || (A21 = {})), function(e59) {
  e59[e59.ADDED = 0] = "ADDED", e59[e59.REMOVED = 1] = "REMOVED";
}(v12 || (v12 = {}));
var g15 = class extends d5 {
  constructor(e59) {
    super(e59), this._allAnalysisViews = new j4(), this._creatingViewCount = 0, this._items = /* @__PURE__ */ new Map(), this._scheduledUpdateHandle = null, this._attachedToViewResolver = D(), this._analysisModules = { "area-measurement": { module: null }, dimensioning: { module: null }, "direct-line-measurement": { module: null }, "line-of-sight": { module: null }, slice: { module: null } };
  }
  destroy() {
    this._disconnectOwners(), this._attachedToViewResolver.reject(m3("AnalysisViewManager was destroyed"));
  }
  attach() {
    this._connectOwners(), this._attachedToViewResolver.resolve();
  }
  detach() {
    this._disconnectOwners(), this._attachedToViewResolver.reject(m3()), this._attachedToViewResolver = D(), this._attachedToViewResolver.promise.catch(() => {
    });
  }
  get updating() {
    return !this.view.ready || 0 !== this._creatingViewCount || this._allAnalysisViews.some((e59) => e59.updating);
  }
  get testInfo() {
    return { allAnalysisViews: this._allAnalysisViews };
  }
  async whenAnalysisView(e59) {
    await this._attachedToViewResolver.promise;
    const s63 = this._items.get(e59);
    if (t(s63) || s63.state.list === v12.REMOVED) {
      throw new s4("AnalysisViewManager:no-analysisview-for-analysis", "The analysis has not been added to view.analyses", { analysis: e59 });
    }
    return s63.createAnalysisViewTask.promise;
  }
  _connectOwners() {
    this.handles.add(this._connectAnalysesCollection(this.view.analyses), V5);
  }
  _disconnectOwners() {
    this.handles.remove(V5), this._update(), this._creatingViewCount = 0;
  }
  _connectAnalysesCollection(e59) {
    for (const t60 of e59)
      this._addAnalysis(t60);
    const s63 = e59.on("after-add", (e60) => this._addAnalysis(e60.item)), i66 = e59.on("after-remove", (e60) => this._removeAnalysis(e60.item));
    return { remove: () => {
      s63.remove(), i66.remove();
      for (const s64 of e59)
        this._removeAnalysis(s64);
    } };
  }
  _addAnalysis(e59) {
    const s63 = this._items.get(e59);
    if (null == s63) {
      const s64 = { state: { view: A21.PENDING, list: v12.ADDED }, analysis: e59, view: null, createAnalysisViewTask: null };
      this._items.set(e59, s64), s64.createAnalysisViewTask = O((e60) => this._createAnalysisViewPromise(s64, e60));
    } else
      s63.state.list = v12.ADDED;
  }
  _removeAnalysis(e59) {
    const s63 = this._items.get(e59);
    null != s63 ? (s63.state.list = v12.REMOVED, this._scheduleUpdate()) : p22.error("Trying to remove analysis which was not added");
  }
  _scheduleUpdate() {
    r(this._scheduledUpdateHandle) || (this._scheduledUpdateHandle = v2(() => this._update()));
  }
  _update() {
    this._scheduledUpdateHandle = a2(this._scheduledUpdateHandle), this._items.forEach((e59) => {
      if (e59.state.list === v12.REMOVED)
        switch (this._items.delete(e59.analysis), e59.state.view) {
          case A21.PENDING:
            e59.createAnalysisViewTask = h(e59.createAnalysisViewTask);
            break;
          case A21.CREATED:
            r(e59.view) && (this._allAnalysisViews.remove(e59.view), e59.view = l(e59.view), e59.createAnalysisViewTask = null);
        }
    });
  }
  async _createAnalysisViewPromise(e59, s63) {
    const i66 = e59.analysis, t60 = i66.type, a58 = this._analysisModules[t60];
    if (this._creatingViewCount += 1, t(a58.module))
      try {
        a58.module = await this._loadAnalysisModule(t60);
      } catch (r59) {
        throw this._creatingViewCount -= 1, r59;
      }
    if (p2(s63))
      throw this._creatingViewCount -= 1, m3("AnalysisView creation aborted");
    const o61 = new a58.module.default({ analysis: i66, view: this.view });
    try {
      await o61.when();
    } catch (r59) {
      throw this._creatingViewCount -= 1, r59;
    }
    if (p2(s63))
      throw this._creatingViewCount -= 1, o61.destroy(), m3("AnalysisView creation aborted");
    return e59.view = o61, e59.state.view = A21.CREATED, this._allAnalysisViews.add(o61), this._creatingViewCount -= 1, o61;
  }
  _loadAnalysisModule(e59) {
    switch (e59) {
      case "area-measurement":
        return import("./AreaMeasurementAnalysisView3D-WRMKCZPQ.js");
      case "dimensioning":
        return import("./DimensioningAnalysisView3D-SXCEQ7YB.js");
      case "direct-line-measurement":
        return import("./DirectLineMeasurementAnalysisView3D-TMT5VVYK.js");
      case "line-of-sight":
        return import("./LineOfSightAnalysisView3D-VU6QBM5F.js");
      case "slice":
        return import("./SliceAnalysisView3D-46YLGRMS.js");
    }
  }
};
e([d()], g15.prototype, "updating", null), e([d({ constructOnly: true })], g15.prototype, "view", void 0), e([d()], g15.prototype, "_allAnalysisViews", void 0), e([d()], g15.prototype, "_creatingViewCount", void 0), g15 = e([n6("esri.views.3d.analysis.AnalysisViewManager3D")], g15);
var D8 = g15;

// node_modules/@arcgis/core/views/3d/state/Constraints.js
var c30 = s3.getLogger("esri.views.3d.state.Constraints");
var p23 = class extends y {
  constructor(t60) {
    super(t60), this.collision = new f18(), this.distance = 1 / 0, this.minimumPoiDistance = 4;
  }
  get altitude() {
    return this.mode === l13.Local ? null : this._get("altitude") || null;
  }
  set altitude(t60) {
    this.mode !== l13.Local ? this._set("altitude", t60) : c30.warn("Altitude constraint is ignored in local scenes");
  }
  clampAltitude(t60) {
    return this.altitude ? o4(t60, this.altitude.min, this.altitude.max) : t60;
  }
  clampTilt(t60, e59) {
    if (!this.tilt)
      return e59;
    const i66 = this.tilt(t60);
    return o4(e59, i66.min, i66.max);
  }
  clampDistance(t60) {
    return Math.min(t60, this.distance);
  }
  createDefaultTilt() {
    return this.mode === l13.Local ? this._createDefaultTiltLocal() : this._createDefaultTiltGlobal();
  }
  createConstantMaxTilt(t60) {
    return (e59, i66 = y10) => (i66.min = h21.min, i66.max = t60, i66);
  }
  _createDefaultTiltLocal() {
    const t60 = this.collision.enabled ? U7([[4e3, h21.max], [1e4, M4(88)], [6e6, M4(88)]]) : () => h21.max;
    return (e59, i66 = y10) => (i66.min = h21.min, i66.max = t60(e59), i66);
  }
  _createDefaultTiltGlobal() {
    const t60 = this.collision.enabled ? U7([[4e3, h21.max], [5e4, M4(88)], [6e6, M4(88)], [2e7, h21.min]]) : U7([[3e5, h21.max], [3e6, M4(88)], [6e6, M4(88)], [2e7, h21.min]]);
    return (e59, i66 = y10) => (i66.min = h21.min, i66.max = t60(e59), i66);
  }
};
function u23(t60) {
  return { min: -2e5, max: 4 * t60.radius };
}
e([d()], p23.prototype, "altitude", null), e([d({ readOnly: true })], p23.prototype, "collision", void 0), e([d()], p23.prototype, "distance", void 0), e([d({ readOnly: true })], p23.prototype, "minimumPoiDistance", void 0), e([d()], p23.prototype, "tilt", void 0), e([d({ constructOnly: true })], p23.prototype, "mode", void 0), p23 = e([n6("esri.views.3d.state.Constraints")], p23);
var d13 = u23(s6);
var h21 = { min: M4(0.5), max: M4(179.5) };
var y10 = { min: 0, max: 0 };
var f18 = class extends y {
  constructor() {
    super(...arguments), this.enabled = true, this.elevationMargin = 5;
  }
};
e([d({ type: Boolean })], f18.prototype, "enabled", void 0), e([d({ type: Number })], f18.prototype, "elevationMargin", void 0), f18 = e([n6("esri.views.3d.state.Constraints.CollisionConstraint")], f18);

// node_modules/@arcgis/core/views/3d/constraints/AltitudeConstraint.js
var p24 = class extends y {
  constructor() {
    super(...arguments), this.min = d13.min, this.max = d13.max;
  }
};
e([d({ type: Number })], p24.prototype, "min", void 0), e([d({ type: Number })], p24.prototype, "max", void 0), p24 = e([n6("esri.views.3d.constraints.AltitudeConstraint")], p24);

// node_modules/@arcgis/core/views/3d/constraints/ClipDistanceConstraint.js
var o36 = class extends y {
  constructor() {
    super(...arguments), this.mode = "auto";
  }
  get near() {
    return this._get("near");
  }
  set near(t60) {
    this._set("near", t60), t60 >= this._get("far") && (this.far = t60 + 1e-9), this.mode = "manual";
  }
  castNear(t60) {
    return Math.max(1e-8, t60);
  }
  get far() {
    return this._get("far");
  }
  set far(t60) {
    this._set("far", t60), t60 <= this._get("near") && (this.near = t60 - 1e-9), this.mode = "manual";
  }
  castFar(t60) {
    return Math.max(1e-8, t60);
  }
  autoUpdate(t60, r59) {
    "auto" === this.mode && (this._get("near") !== t60 && this._set("near", t60), this._get("far") !== r59 && this._set("far", r59));
  }
};
e([d({ type: Number, value: 1e-8 })], o36.prototype, "near", null), e([s7("near")], o36.prototype, "castNear", null), e([d({ type: Number, value: 1e-8 })], o36.prototype, "far", null), e([s7("far")], o36.prototype, "castFar", null), e([d({ type: ["auto", "manual"] })], o36.prototype, "mode", void 0), o36 = e([n6("esri.views.3d.constraints.ClipDistanceConstraint")], o36);

// node_modules/@arcgis/core/views/3d/constraints/TiltConstraint.js
var c31 = { min: m4(h21.min), max: m4(h21.max) };
var p25 = class extends y {
  constructor() {
    super(...arguments), this.mode = "auto";
  }
  get max() {
    return this._get("max");
  }
  set max(t60) {
    this._set("max", t60), this.mode = "manual";
  }
  castMax(t60) {
    return o4(t60, c31.min, c31.max);
  }
  autoUpdate(t60) {
    "auto" === this.mode && this._get("max") !== t60 && this._set("max", t60);
  }
};
e([d({ type: ["auto", "manual"] })], p25.prototype, "mode", void 0), e([d({ type: Number, value: c31.max })], p25.prototype, "max", null), e([s7("max")], p25.prototype, "castMax", null), p25 = e([n6("esri.views.3d.constraints.TiltConstraint")], p25);

// node_modules/@arcgis/core/views/3d/constraints/Constraints.js
var c32 = class extends y {
  constructor() {
    super(...arguments), this.tilt = new p25(), this.altitude = new p24(), this.clipDistance = new o36();
  }
};
e([d({ type: p25 })], c32.prototype, "tilt", void 0), e([d({ type: p24 })], c32.prototype, "altitude", void 0), e([d({ type: o36 })], c32.prototype, "clipDistance", void 0), c32 = e([n6("esri.views.3d.constraints.Constraints")], c32);

// node_modules/@arcgis/core/webscene/SunLighting.js
var d14;
var i32 = d14 = class extends l2 {
  constructor(e59) {
    super(e59), this.type = "sun", this.date = null, this.directShadowsEnabled = false, this.displayUTCOffset = null;
  }
  readDate(e59, t60) {
    return null != t60.datetime && new Date(t60.datetime) || null;
  }
  writeDate(e59, t60, r59) {
    t60[r59] = e59.getTime();
  }
  readDirectShadowsEnabled(e59, t60) {
    return !!t60.directShadows;
  }
  writedirectShadowsEnabled(e59, t60, r59) {
    e59 && (t60[r59] = e59);
  }
  writeDisplayUTCOffset(e59, t60) {
    null != e59 && (t60.displayUTCOffset = e59);
  }
  clone() {
    return new d14(this.cloneConstructProperties());
  }
  cloneConstructProperties() {
    const e59 = { directShadowsEnabled: this.directShadowsEnabled, displayUTCOffset: null != this.displayUTCOffset ? this.displayUTCOffset : null };
    return null != this.date && (e59.date = new Date(this.date.getTime())), e59;
  }
};
e([d({ readOnly: true, type: ["sun"], json: { write: true } })], i32.prototype, "type", void 0), e([d({ type: Date, json: { type: Number, write: { target: "datetime" } } })], i32.prototype, "date", void 0), e([o2("date", ["datetime"])], i32.prototype, "readDate", null), e([r5("date")], i32.prototype, "writeDate", null), e([d({ type: Boolean, json: { default: false, write: { target: "directShadows" } } })], i32.prototype, "directShadowsEnabled", void 0), e([o2("directShadowsEnabled", ["directShadows"])], i32.prototype, "readDirectShadowsEnabled", null), e([r5("directShadowsEnabled")], i32.prototype, "writedirectShadowsEnabled", null), e([d({ type: Number, json: { write: true } })], i32.prototype, "displayUTCOffset", void 0), e([r5("displayUTCOffset")], i32.prototype, "writeDisplayUTCOffset", null), i32 = d14 = e([n6("esri.webscene.SunLighting")], i32);
var p26 = i32;

// node_modules/@arcgis/core/views/3d/environment/SunLighting.js
var s37;
var a30 = s37 = class extends n8.EventedMixin(p26) {
  constructor(e59) {
    super(e59), this.cameraTrackingEnabled = true, this.ambientOcclusionEnabled = false, this.waterReflectionEnabled = false, this.positionTimezoneInfo = { hours: 0, minutes: 0, seconds: 0, autoUpdated: true };
    const t60 = (/* @__PURE__ */ new Date()).getFullYear(), o61 = /* @__PURE__ */ new Date("March 15, " + t60 + " 12:00:00 UTC");
    this._set("defaultDate", o61), this._set("date", o61);
  }
  get defaultDate() {
    return new Date(this._get("defaultDate").getTime());
  }
  static fromWebsceneLighting(e59) {
    return new s37(e59.cloneConstructProperties());
  }
  set defaultDate(e59) {
    const t60 = this._get("date") === this._get("defaultDate");
    e59 = new Date(e59.getTime()), this._set("defaultDate", e59), t60 && this._set("date", e59);
  }
  set date(e59) {
    null != e59 && (this.positionTimezoneInfo.autoUpdated = false, this._set("date", new Date(e59.getTime())));
  }
  autoUpdate(e59, t60) {
    const o61 = s37.calculateTimezoneOffset(this.positionTimezoneInfo);
    this.positionTimezoneInfo.hours = t60.hours, this.positionTimezoneInfo.minutes = t60.minutes, this.positionTimezoneInfo.seconds = t60.seconds;
    let n73 = null;
    null != e59 && (this.positionTimezoneInfo.autoUpdated = true, n73 = this.date && this.date.getTime(), this._set("date", new Date(e59.getTime())));
    const i66 = s37.calculateTimezoneOffset(this.positionTimezoneInfo);
    if (o61 !== i66 && (r39.target = this, r39.timezoneOffset = i66, this.emit("timezone-will-change", r39)), null != e59)
      return n73 !== e59.getTime();
  }
  clone() {
    const e59 = this._get("date") === this._get("defaultDate"), t60 = new s37({ ...this.cloneConstructProperties(), defaultDate: this.defaultDate, cameraTrackingEnabled: this.cameraTrackingEnabled, ambientOcclusionEnabled: this.ambientOcclusionEnabled, waterReflectionEnabled: this.waterReflectionEnabled });
    return e59 && t60._set("date", t60._get("defaultDate")), t60.positionTimezoneInfo.autoUpdated = this.positionTimezoneInfo.autoUpdated, t60.positionTimezoneInfo.hours = this.positionTimezoneInfo.hours, t60.positionTimezoneInfo.minutes = this.positionTimezoneInfo.minutes, t60.positionTimezoneInfo.seconds = this.positionTimezoneInfo.seconds, t60;
  }
  cloneWithWebsceneLighting(e59) {
    const t60 = this.clone();
    return null != e59.date && (t60.date = e59.date), t60.directShadowsEnabled = e59.directShadowsEnabled, t60.displayUTCOffset = e59.displayUTCOffset, t60;
  }
};
e([d({ type: Boolean })], a30.prototype, "cameraTrackingEnabled", void 0), e([d({ type: Boolean })], a30.prototype, "ambientOcclusionEnabled", void 0), e([d({ type: Boolean })], a30.prototype, "waterReflectionEnabled", void 0), e([d({ type: Date })], a30.prototype, "defaultDate", null), e([d({ type: Date })], a30.prototype, "date", null), a30 = s37 = e([n6("esri.views.3d.environment.SunLighting")], a30), function(e59) {
  function t60({ hours: e60, minutes: t61, seconds: o61 }) {
    return Math.round(e60 + t61 / 60 + o61 / 3600);
  }
  e59.calculateTimezoneOffset = t60;
}(a30 || (a30 = {}));
var r39 = { target: null, timezoneOffset: 0 };
var l24 = a30;

// node_modules/@arcgis/core/webscene/VirtualLighting.js
var s38;
var c33 = s38 = class extends l2 {
  constructor(r59) {
    super(r59), this.type = "virtual", this.directShadowsEnabled = false;
  }
  clone() {
    return new s38(this.cloneConstructProperties());
  }
  cloneConstructProperties() {
    return { directShadowsEnabled: this.directShadowsEnabled };
  }
};
e([d({ readOnly: true, type: ["virtual"], json: { write: true } })], c33.prototype, "type", void 0), e([d({ type: Boolean, json: { default: false, name: "directShadows", write: true } })], c33.prototype, "directShadowsEnabled", void 0), c33 = s38 = e([n6("esri.webscene.VirtualLighting")], c33);
var a31 = c33;

// node_modules/@arcgis/core/views/3d/environment/VirtualLighting.js
var n39;
var i33 = n39 = class extends n8.EventedMixin(a31) {
  constructor(e59) {
    super(e59), this.ambientOcclusionEnabled = false, this.waterReflectionEnabled = false;
  }
  clone() {
    return new n39({ ...this.cloneConstructProperties(), ambientOcclusionEnabled: this.ambientOcclusionEnabled, waterReflectionEnabled: this.waterReflectionEnabled });
  }
  static fromWebsceneLighting(e59) {
    return new n39(e59.cloneConstructProperties());
  }
  cloneWithWebsceneLighting(e59) {
    const t60 = this.clone();
    return t60.directShadowsEnabled = e59.directShadowsEnabled, t60;
  }
};
e([d({ type: Boolean })], i33.prototype, "ambientOcclusionEnabled", void 0), e([d({ type: Boolean })], i33.prototype, "waterReflectionEnabled", void 0), i33 = n39 = e([n6("esri.views.3d.environment.VirtualLighting")], i33);
var c34 = i33;

// node_modules/@arcgis/core/views/3d/environment/lightingUtils.js
var i34 = { key: "type", defaultKeyValue: "sun", base: null, typeMap: { sun: l24, virtual: c34 } };

// node_modules/@arcgis/core/views/3d/environment/SceneViewAtmosphere.js
var t38;
var i35 = t38 = class extends y {
  set quality(r59) {
    ["low", "high"].includes(r59) && this._set("quality", r59);
  }
  clone() {
    return new t38({ quality: this.quality });
  }
};
e([d({ type: ["low", "high"], value: "low" })], i35.prototype, "quality", null), i35 = t38 = e([n6("esri.views.3d.environment.SceneViewAtmosphere")], i35);

// node_modules/@arcgis/core/views/3d/environment/SunnyWeather.js
var p27;
var c35 = p27 = class extends l2 {
  constructor(r59) {
    super(r59), this.type = "sunny", this.cloudCover = 0.5;
  }
  clone() {
    return new p27({ cloudCover: this.cloudCover });
  }
};
e([r9({ sunny: "sunny" })], c35.prototype, "type", void 0), e([d({ type: Number, nonNullable: true, range: { min: 0, max: 1 }, json: { write: true } })], c35.prototype, "cloudCover", void 0), c35 = p27 = e([n6("esri.views.3d.environment.SunnyWeather")], c35);
var n40 = c35;

// node_modules/@arcgis/core/views/3d/environment/CloudyWeather.js
var c36;
var p28 = c36 = class extends l2 {
  constructor(o61) {
    super(o61), this.type = "cloudy", this.cloudCover = 0.5;
  }
  clone() {
    return new c36({ cloudCover: this.cloudCover });
  }
};
e([r9({ cloudy: "cloudy" })], p28.prototype, "type", void 0), e([d({ type: Number, nonNullable: true, range: { min: 0, max: 1 }, json: { write: true } })], p28.prototype, "cloudCover", void 0), p28 = c36 = e([n6("esri.views.3d.environment.CloudyWeather")], p28);
var u24 = p28;

// node_modules/@arcgis/core/views/3d/environment/FoggyWeather.js
var p29;
var c37 = p29 = class extends l2 {
  constructor(r59) {
    super(r59), this.type = "foggy", this.fogStrength = 0.5;
  }
  clone() {
    return new p29({ fogStrength: this.fogStrength });
  }
};
e([r9({ foggy: "foggy" })], c37.prototype, "type", void 0), e([d({ type: Number, nonNullable: true, range: { min: 0, max: 1 }, json: { write: true } })], c37.prototype, "fogStrength", void 0), c37 = p29 = e([n6("esri.views.3d.environment.FoggyWeather")], c37);
var n41 = c37;

// node_modules/@arcgis/core/views/3d/environment/RainyWeather.js
var i36;
var p30 = i36 = class extends l2 {
  constructor(r59) {
    super(r59), this.type = "rainy", this.cloudCover = 0.5, this.precipitation = 0.5;
  }
  clone() {
    return new i36({ cloudCover: this.cloudCover, precipitation: this.precipitation });
  }
};
e([r9({ rainy: "rainy" })], p30.prototype, "type", void 0), e([d({ type: Number, nonNullable: true, range: { min: 0, max: 1 }, json: { write: true } })], p30.prototype, "cloudCover", void 0), e([d({ type: Number, nonNullable: true, range: { min: 0, max: 1 }, json: { write: true } })], p30.prototype, "precipitation", void 0), p30 = i36 = e([n6("esri.views.3d.environment.RainyWeather")], p30);
var c38 = p30;

// node_modules/@arcgis/core/views/3d/environment/SnowyWeather.js
var i37;
var p31 = i37 = class extends l2 {
  constructor(o61) {
    super(o61), this.type = "snowy", this.cloudCover = 0.5, this.precipitation = 0.5, this.snowCover = "disabled";
  }
  clone() {
    return new i37({ cloudCover: this.cloudCover, precipitation: this.precipitation, snowCover: this.snowCover });
  }
};
e([r9({ snowy: "snowy" })], p31.prototype, "type", void 0), e([d({ type: Number, nonNullable: true, range: { min: 0, max: 1 }, json: { write: true } })], p31.prototype, "cloudCover", void 0), e([d({ type: Number, nonNullable: true, range: { min: 0, max: 1 }, json: { write: true } })], p31.prototype, "precipitation", void 0), e([d({ type: ["enabled", "disabled"], nonNullable: true, json: { write: true } })], p31.prototype, "snowCover", void 0), p31 = i37 = e([n6("esri.views.3d.environment.SnowyWeather")], p31);
var n42 = p31;

// node_modules/@arcgis/core/views/3d/environment/weather.js
var i38 = { key: "type", base: n40, typeMap: { sunny: n40, cloudy: u24, rainy: c38, snowy: n42, foggy: n41 } };
var c39 = Object.keys(i38.typeMap);
function y11(e59, o61) {
  return !!c39.includes(e59) || (o61.error(`"${e59}" is not a valid weather type`), false);
}
var a32 = 1e4;

// node_modules/@arcgis/core/webscene/lightingTypes.js
var i39 = { key: "type", defaultKeyValue: "sun", base: null, typeMap: { sun: p26, virtual: a31 } };

// node_modules/@arcgis/core/webscene/background/Background.js
var t39 = class extends l2 {
  constructor(r59) {
    super(r59);
  }
  clone() {
  }
};
e([d({ readOnly: true, json: { read: false } })], t39.prototype, "type", void 0), t39 = e([n6("esri.webscene.background.Background")], t39);
var c40 = t39;

// node_modules/@arcgis/core/webscene/background/ColorBackground.js
var l25;
var a33 = { ...p13, nonNullable: true };
var i40 = l25 = class extends c40 {
  constructor(o61) {
    super(o61), this.type = "color", this.color = new l5([0, 0, 0, 1]);
  }
  clone() {
    return new l25(this.cloneProperties());
  }
  cloneProperties() {
    return { color: this.color.clone() };
  }
};
e([r9({ color: "color" }, { readOnly: true })], i40.prototype, "type", void 0), e([d(a33)], i40.prototype, "color", void 0), i40 = l25 = e([n6("esri.webscene.background.ColorBackground")], i40);
var n43 = i40;

// node_modules/@arcgis/core/webscene/background/utils.js
var o37 = { base: c40, key: "type", typeMap: { color: n43 } };
function t40(e59) {
  return (r59, o61, t60) => {
    if (!r59)
      return r59;
    for (const n73 in e59.typeMap)
      if (r59.type === n73) {
        const o62 = new e59.typeMap[n73]();
        return o62.read(r59, t60), o62;
      }
  };
}
var n44 = { types: o37, json: { read: t40(o37), write: { overridePolicy: (e59, r59, o61) => ({ enabled: !o61 || !o61.isPresentation }) } } };

// node_modules/@arcgis/core/webscene/Environment.js
var g16;
var u25 = s3.getLogger("esri.webscene.Environment");
var d15 = (e59, t60, o61) => ({ enabled: !o61 || !o61.isPresentation });
var b6 = g16 = class extends l2 {
  constructor(e59) {
    super(e59), this.lighting = new p26(), this.background = null, this.atmosphereEnabled = true, this.starsEnabled = true;
  }
  set weather(e59) {
    y11(e59 == null ? void 0 : e59.type, u25) && this._set("weather", e59);
  }
  clone() {
    return new g16(this.cloneConstructProperties());
  }
  cloneConstructProperties() {
    return { lighting: this.lighting && "virtual" === this.lighting.type ? a31.prototype.clone.call(this.lighting) : p26.prototype.clone.call(this.lighting), background: m2(this.background), atmosphereEnabled: this.atmosphereEnabled, starsEnabled: this.starsEnabled, weather: this.weather.clone() };
  }
};
e([d({ types: i39, nonNullable: true, json: { write: true } })], b6.prototype, "lighting", void 0), e([d(n44)], b6.prototype, "background", void 0), e([d({ type: Boolean, nonNullable: true, json: { write: { overridePolicy: d15 } } })], b6.prototype, "atmosphereEnabled", void 0), e([d({ type: Boolean, nonNullable: true, json: { write: { overridePolicy: d15 } } })], b6.prototype, "starsEnabled", void 0), e([d({ types: i38, nonNullable: true, json: { write: true }, value: new n40() })], b6.prototype, "weather", null), b6 = g16 = e([n6("esri.webscene.Environment")], b6);
var y12 = b6;

// node_modules/@arcgis/core/views/3d/environment/SceneViewEnvironment.js
var m18;
var u26 = m18 = class extends y12 {
  constructor(t60) {
    super(t60), this.atmosphere = new i35(), this.lighting = new l24();
  }
  static fromWebsceneEnvironment(t60) {
    const i66 = t60.cloneConstructProperties();
    return new m18({ ...i66, lighting: "virtual" === i66.lighting.type ? c34.fromWebsceneLighting(i66.lighting) : l24.fromWebsceneLighting(i66.lighting) });
  }
  castLighting(t60) {
    return this._convertLighting(t60);
  }
  applyLighting(t60) {
    this.lighting = this._convertLighting(t60);
  }
  _convertLighting(t60) {
    return t60 ? t60 instanceof l24 || t60 instanceof c34 ? t60 : t60 instanceof p26 ? this.lighting && "sun" === this.lighting.type ? this.lighting.cloneWithWebsceneLighting(t60) : new l24(t60.cloneConstructProperties()) : t60 instanceof a31 ? this.lighting && "virtual" === this.lighting.type ? this.lighting.cloneWithWebsceneLighting(t60) : new c34(t60.cloneConstructProperties()) : N(i34, t60) : new l24();
  }
  clone() {
    return new m18({ lighting: this.lighting.clone(), atmosphere: this.atmosphere.clone(), weather: this.weather.clone(), atmosphereEnabled: this.atmosphereEnabled, starsEnabled: this.starsEnabled, background: m2(this.background) });
  }
  cloneWithWebsceneEnvironment(t60) {
    return new m18({ atmosphere: this.atmosphere.clone(), weather: this.weather.clone(), atmosphereEnabled: this.atmosphereEnabled, starsEnabled: this.starsEnabled, background: m2(this.background), ...t60.cloneConstructProperties(), lighting: this._getLighting(t60) });
  }
  _getLighting(t60) {
    return "sun" === t60.lighting.type ? this.lighting && "sun" === this.lighting.type ? this.lighting.cloneWithWebsceneLighting(t60.lighting) : l24.fromWebsceneLighting(t60.lighting) : "virtual" === t60.lighting.type ? this.lighting && "virtual" === this.lighting.type ? this.lighting.cloneWithWebsceneLighting(t60.lighting) : c34.fromWebsceneLighting(t60.lighting) : l24.fromWebsceneLighting(t60.lighting);
  }
};
e([d({ type: i35, json: { read: false }, nonNullable: true })], u26.prototype, "atmosphere", void 0), e([d({ nonNullable: true })], u26.prototype, "lighting", void 0), e([s7("lighting")], u26.prototype, "castLighting", null), u26 = m18 = e([n6("esri.views.3d.environment.SceneViewEnvironment")], u26);
var b7 = u26;

// node_modules/@arcgis/core/views/3d/environment/atmosphereUtils.js
function t41(e59) {
  const t60 = 1e5, n73 = 1e6;
  return Math.min(1, Math.max(0, (e59 - t60) / (n73 - t60)));
}
var n45 = 1e4;
var o38 = r6(5802e-9, 13558e-9, 331e-7);
var c41 = 3;
var r40 = r6(65e-8 * c41, 1881e-9 * c41, 85e-9 * c41);
var s39 = 3996e-9;
var a34 = 0.085;
var f19 = 1e5;

// node_modules/@arcgis/core/views/3d/environment/ChapmanAtmosphereTechnique.js
var g17 = class extends e18 {
  initializeProgram(e59) {
    const r59 = g17.shader.get().build(this.configuration);
    return new o20(e59.rctx, r59, E7);
  }
  initializePipeline() {
    return this.configuration.haze ? W({ blending: l15(R4.ONE, R4.ZERO, R4.ONE_MINUS_SRC_COLOR, R4.ONE), colorWrite: c11 }) : W({ blending: l15(R4.SRC_ALPHA, R4.ONE, R4.ONE_MINUS_SRC_ALPHA, R4.ONE_MINUS_SRC_ALPHA), depthTest: { func: I4.LEQUAL }, colorWrite: c11 });
  }
};
g17.shader = new t15(x9, () => import("./ChapmanAtmosphere.glsl-TYGAISOV.js"));

// node_modules/@arcgis/core/views/3d/environment/ChapmanAtmosphereTechniqueConfiguration.js
var s40 = class extends t17 {
  constructor() {
    super(...arguments), this.haze = false;
  }
};
e([e20()], s40.prototype, "haze", void 0);

// node_modules/@arcgis/core/views/3d/environment/ChapmanAtmosphere.js
var C8 = class {
  constructor(e59) {
    this._view = e59, this.type = "realistic", this.canRender = true, this._cameraPosition = n7(), this._heightParameters = n10(), this._betasRayleigh = n7(), this._betasCombined = n7(), this._scaleHeight = 0, this._radii = n17(), this._cameraHeight = 0, this._cameraHeightSq = 0, this._cAtmosphere = 0, this._innerFadeDistance = 0, this._altitudeFade = 0, this._lowerElevationBoundRadius = 0, this._lowerBoundEarthRadius = s6.radius, this._hazeStrength = 1, this._darkenHaze = false, this._updateRadius(s6.radius);
  }
  destroy() {
    this._atmosphereTechnique = p(this._atmosphereTechnique), this._atmosphereHazeTechnique = p(this._atmosphereHazeTechnique), this._vao = s(this._vao), this._handles = l(this._handles);
  }
  when() {
    return Promise.resolve();
  }
  initializeRenderContext(t60) {
    const i66 = t60.renderContext.rctx, s63 = this._handles = new u4(), a58 = this._view.basemapTerrain;
    r(a58.rootTiles) && this._updateElevation({ spatialReference: a58.spatialReference, tile: a58.rootTiles[0], extent: a58.rootTiles[0].extent, context: "ground" }), s63.add(a5(() => this._view.basemapTerrain, "elevation-change", (e59) => this._updateElevation(e59), { onListenerAdd: () => this._updateElevation() })), s63.add(a5(() => this._view.basemapTerrain, "elevation-bounds-change", () => this._updateVisibleElevationBounds()));
    const r59 = new s40();
    r59.haze = false, this._atmosphereTechnique = t60.shaderTechniqueRepository.acquire(g17, r59), r59.haze = true, this._atmosphereHazeTechnique = t60.shaderTechniqueRepository.acquire(g17, r59), this._vao = u12(i66, A9), this._scaleHeight = a34 * f19, o3(this._betasRayleigh, o38[0], o38[1], o38[2]), o3(this._betasCombined, o38[0] + r40[0], o38[1] + r40[1], o38[2] + r40[2]);
  }
  render(e59) {
    this._render(e59, this._atmosphereTechnique, e59.offscreenRenderingHelper.depthTexture);
  }
  renderHaze(e59, t60) {
    this._darkenHaze = t60, this._render(e59, this._atmosphereHazeTechnique, e59.offscreenRenderingHelper.linearDepthTexture);
  }
  _render(e59, t60, i66) {
    this._update(e59.bindParameters.camera);
    const s63 = e59.rctx.bindTechnique(t60, P7, e59.bindParameters);
    e59.offscreenRenderingHelper.renderDepthDetached(() => {
      s63.bindTexture("depthTex", i66), this._renderCommon(t60.program, e59);
    });
  }
  _renderCommon(e59, t60) {
    if (t(this._vao))
      return;
    const i66 = t60.rctx;
    e59.setUniform4fv("heightParameters", this._heightParameters), e59.setUniform3fv("cameraPosition", this._cameraPosition), e59.setUniform2fv("radii", this._radii), e59.setUniform1f("scaleHeight", this._scaleHeight), e59.setUniform1f("betaMie", s39), e59.setUniform3fv("betaRayleigh", this._betasRayleigh), e59.setUniform3fv("betaCombined", this._betasCombined), e59.setUniform1f("innerFadeDistance", this._innerFadeDistance), e59.setUniform1f("altitudeFade", this._altitudeFade), e59.setUniform1f("hazeStrength", this._hazeStrength), i66.bindVAO(this._vao), e59.assertCompatibleVertexAttributeLocations(this._vao), i66.drawArrays(E5.TRIANGLE_STRIP, 0, 4);
  }
  _adjustRadiusForTesselation(e59) {
    return e59 * Math.cos(Math.PI / 16 / 16);
  }
  _updateElevation(e59) {
    const t60 = e59 ? e59.tile : c(this._view.basemapTerrain.rootTiles, [null])[0];
    if (t(t60) || 0 !== t60.level)
      return;
    const i66 = this._adjustRadiusForTesselation(s6.radius + t60.elevationBounds[0]);
    i66 !== this._lowerElevationBoundRadius && (this._lowerElevationBoundRadius = i66, this._lowerBoundEarthRadius = -1, this._updateVisibleElevationBounds());
  }
  _updateVisibleElevationBounds() {
    const e59 = this._adjustRadiusForTesselation(s6.radius + this._view.basemapTerrain.elevationBounds.min);
    (this._lowerBoundEarthRadius < 0 || e59 < this._lowerBoundEarthRadius) && this._updateRadius(e59);
  }
  _updateRadius(e59) {
    this._lowerBoundEarthRadius = e59, r13(this._radii, e59, e59 + f19), this._innerFadeDistance = 2 * Math.sqrt((2 * e59 - n45) * n45);
  }
  _update(e59) {
    if (t(e59))
      return;
    this._cameraHeight = s8(e59.eye), this._cameraHeightSq = this._cameraHeight * this._cameraHeight, this._cAtmosphere = this._cameraHeightSq - this._radii[1] * this._radii[1];
    const s63 = Math.min(1, Math.max(0, (this._cameraHeight - this._radii[0]) / f19));
    this._heightParameters = r10(this._cameraHeight, this._cameraHeightSq, this._cAtmosphere, s63), r7(this._cameraPosition, e59.eye), this._altitudeFade = t41(this._cameraHeight - this._lowerBoundEarthRadius), this._hazeStrength = this._darkenHaze ? s10(0.6, 1, I(9500, 10500, this._cameraHeight - s6.radius)) : 1;
  }
  static isSupported(e59) {
    return e59.renderContext.rctx.capabilities.depthTexture;
  }
};
var P7 = new t14();

// node_modules/@arcgis/core/geometry/support/axisAngle.js
function i41(n73 = x13) {
  return [n73[0], n73[1], n73[2], n73[3]];
}
function m19(n73, t60) {
  return j14(n73[0], n73[1], n73[2], t60, r18.get());
}
function j14(n73, t60, r59, u51, o61 = i41()) {
  return o61[0] = n73, o61[1] = t60, o61[2] = r59, o61[3] = u51, o61;
}
function k9(n73, t60, r59 = i41()) {
  return _(r59, n73, t60), z2(r59, r59), r59[3] = a18(n73, t60), r59;
}
function v14(n73) {
  return n73;
}
var x13 = [0, 0, 1, 0];
var S7 = e13();
var b8 = e13();

// node_modules/@arcgis/core/views/3d/environment/CloudsCompositionTechnique.js
var u27 = class extends e18 {
  constructor(e59) {
    super(e59, null, () => this.destroy());
  }
  initializeProgram(e59) {
    const r59 = u27.shader.get().build();
    return new o20(e59.rctx, r59, E7);
  }
  initializePipeline() {
    return W({ blending: s14(R4.ONE, R4.SRC_ALPHA), depthTest: { func: I4.LEQUAL }, colorWrite: c11 });
  }
};
u27.shader = new t15(f16, () => import("./CloudsComposition.glsl-T2YXLQQC.js"));

// node_modules/@arcgis/core/views/3d/environment/CloudsData.js
function n46(n73) {
  return r(n73) && r(n73.cubeMap) && n73.coverage > 0;
}
function e32(n73) {
  return r(n73) && !n73.running;
}

// node_modules/@arcgis/core/views/3d/environment/CloudsComposition.js
var j15 = class extends y {
  constructor(t60) {
    super(t60), this._technique = new u27(t60), this._vao = u12(t60.rctx);
  }
  destroy() {
    this._technique = p(this._technique), this._vao = s(this._vao);
  }
  render(t60, a58) {
    const e59 = t60.bindParameters.clouds;
    if (t(this._vao) || t(e59.data))
      return;
    if (!this._technique.compiled)
      return void this.requestRender();
    this._setParallaxParameters(e59, t60.bindParameters.camera.eye, a58);
    const s63 = t60.rctx.bindTechnique(this._technique, L9, t60.bindParameters);
    t60.rctx.bindVAO(this._vao), s63.assertCompatibleVertexAttributeLocations(this._vao), t60.rctx.drawArrays(E5.TRIANGLE_STRIP, 0, 4), k10(e59) && this.requestRender();
  }
  _setFadeInStage(t60, a58) {
    const e59 = performance.now(), s63 = t60.parallax.anchorPointClouds;
    t60.fadeIn.stage === s25.FINISHED && (t60.fadeIn.factor = 1, r7(s63, v15), t60.fadeIn.stage = s25.CHANGE_ANCHOR, t60.crossFade.enabled = false, t60.fadeInOut.stage = o28.FINISHED);
    const o61 = G9(t60, a58);
    t60.fadeIn.stage === s25.CHANGE_ANCHOR && o61 && e32(t60.data) && (r7(s63, v15), t60.fadeIn.stage = s25.FADE_IN, t60.startTime = e59), t60.fadeIn.factor > 0 && t60.fadeIn.stage === s25.FADE_IN && (t60.fadeIn.factor = 1 - (e59 - t60.startTime) / y14), t60.fadeIn.factor <= 0 && t60.fadeIn.stage === s25.FADE_IN && (t60.fadeIn.stage = s25.FINISHED, t60.fadeIn.factor = 0);
  }
  _setCrossFadingStage(t60) {
    const a58 = performance.now(), { crossFade: e59 } = t60, s63 = t60.parallax.anchorPointClouds;
    t60.crossFade.enabled || (r7(t60.parallaxNew.anchorPointClouds, v15), t60.startTime = a58, e59.factor = 0, t60.crossFade.enabled = true), e59.factor < 1 && t60.crossFade.enabled && (e59.factor = (a58 - t60.startTime) / q4), e59.factor >= 1 && t60.crossFade.enabled && (t60.crossFade.enabled = false, e59.factor = 1, r7(s63, t60.parallaxNew.anchorPointClouds));
  }
  _setFadeInOutStage(t60, a58) {
    const e59 = performance.now(), { fadeInOut: s63, crossFade: o61 } = t60;
    s63.stage === o28.FINISHED && (t60.startTime = e59, s63.factor = 0, s63.stage = o28.FADE_OUT), s63.factor < 1 && s63.stage === o28.FADE_OUT && (s63.factor = (e59 - t60.startTime) / R7), s63.factor >= 1 && s63.stage === o28.FADE_OUT && (s63.factor = 1, r7(t60.parallax.anchorPointClouds, v15)), s63.factor >= 1 && s63.stage === o28.FADE_OUT && G9(t60, a58) && (s63.factor = 1, s63.stage = o28.SWITCH, t60.crossFade.enabled = false, o61.factor = 1), e32(t60.data) && s63.stage === o28.SWITCH && (t60.startTime = e59, s63.factor = 1, s63.stage = o28.FADE_IN, r7(t60.parallax.anchorPointClouds, v15), t60.crossFade.enabled = false, o61.factor = 1), s63.factor > 0 && s63.stage === o28.FADE_IN && (s63.factor = 1 - (e59 - t60.startTime) / y14), s63.factor <= 0 && s63.stage === o28.FADE_IN && (s63.stage = o28.FINISHED, s63.factor = 0);
  }
  _setFadeInOutHeight(t60, a58) {
    const s63 = performance.now(), o61 = t60.fadeInOutHeight, r59 = (s63 - (o61.stage === e28.FINISHED ? s63 : t60.startTimeHeightFade)) / U14;
    o61.factor += a58 ? -r59 : r59, t60.startTimeHeightFade = s63, o61.factor = o4(o61.factor, 0, 1), o61.stage = e28.HEIGHT_FADE;
  }
  _setParallaxParameters(t60, a58, e59) {
    const { parallax: s63 } = t60;
    t60.fadeInOutHeight.factor < 0 && (t60.fadeInOutHeight.factor = s8(a58) - this.planetRadius > a32 ? 1 : 0), z2(v15, a58), q(v15, v15, this.planetRadius), 0 === s63.anchorPointClouds[0] && 0 === s63.anchorPointClouds[1] && 0 === s63.anchorPointClouds[2] && r7(s63.anchorPointClouds, v15);
    const o61 = s8(e7(w11, s63.anchorPointClouds, v15));
    let r59 = true;
    o61 > t60.fadeIn.distanceThresholdFactor * s63.cloudsHeight || t60.fadeIn.stage !== s25.FINISHED ? this._setFadeInStage(t60, a58) : o61 > t60.fadeInOut.distanceThresholdFactor * s63.cloudsHeight || t60.fadeInOut.stage !== o28.FINISHED ? this._setFadeInOutStage(t60, a58) : o61 > t60.crossFade.distanceThresholdFactor * s63.cloudsHeight && !e59 || t60.crossFade.enabled ? this._setCrossFadingStage(t60) : r59 = false;
    const n73 = s8(a58), c67 = n73 - this.planetRadius;
    if ((c67 > 1.7 * a32 || c67 < -a32) && t60.fadeInOutHeight.factor < 1 ? t60.fadeInOutHeight.factor = 1 : (c67 > a32 || c67 < -0.35 * a32) && t60.fadeInOutHeight.factor < 1 ? this._setFadeInOutHeight(t60, false) : c67 < a32 && c67 > -0.35 * a32 && t60.fadeInOutHeight.factor > 0 ? this._setFadeInOutHeight(t60, true) : t60.fadeInOutHeight.stage = e28.FINISHED, s63.radiusCurvatureCorrectionFactor = 0.84 * Math.sqrt(Math.max(n73 * n73 - this.planetRadius * this.planetRadius, 0)) / n73, k9(A22, s63.anchorPointClouds, x14), s63.transform = e12(), f5(s63.transform, s63.transform, x14[3], v14(x14)), r59) {
      const { parallaxNew: a59 } = t60;
      k9(A22, a59.anchorPointClouds, x14), a59.transform = e12(), f5(a59.transform, a59.transform, x14[3], v14(x14));
    }
    r7(t60.cameraPositionLastFrame, a58);
  }
};
e([d({ constructOnly: true })], j15.prototype, "rctx", void 0), e([d({ constructOnly: true })], j15.prototype, "viewingMode", void 0), e([d({ constructOnly: true })], j15.prototype, "planetRadius", void 0), e([d({ constructOnly: true })], j15.prototype, "requestRender", void 0), j15 = e([n6("esri.views.3d.environment.CloudsComposition")], j15);
var A22 = r6(0, 0, 1);
var x14 = i41();
var v15 = n7();
var w11 = n7();
var y14 = 500;
var R7 = 250;
var q4 = 500;
var U14 = 500;
function k10(t60) {
  return t60.crossFade.enabled || t60.fadeInOut.stage !== o28.FINISHED || t60.fadeIn.stage !== s25.FINISHED || t60.fadeInOutHeight.stage !== e28.FINISHED;
}
function G9(t60, a58) {
  return G(t60.cameraPositionLastFrame, a58);
}
var L9 = new t14();

// node_modules/@arcgis/core/views/3d/environment/CloudsPresets.js
var s41 = class {
  constructor(i66, s63, t60, e59, n73, o61, h44, r59, c67 = 0.5) {
    this.coverage = i66, this.density = s63, this.absorption = t60, this.cloudSize = e59, this.detailSize = n73, this.smoothness = o61, this.cloudHeight = h44, this.raymarchingStepType = r59, this.median = c67;
  }
};
var t42 = { sunny: new s41([0, 0.6], [0.03, 0.03], [0, 0], [0.9, 0.9], [0.8, 0.8], [0.7, 0.7], [0.05, 0.05], t31.SIXTEEN), cloudy: new s41([0.3, 0.65], [0.2, 0.4], [0, 0], [0.85, 0.85], [0.75, 0.75], [0.3, 0.4], [1, 1], t31.TWOHUNDRED, 0.6), rainy: new s41([0.6, 0.8], [0.5, 0.8], [0.1, 0.5], [0.9, 0.9], [0.75, 0.75], [0.5, 0.5], [1, 1], t31.TWOHUNDRED, 0.4), snowy: new s41([0.25, 0.75], [0.3, 0.3], [0, 0], [0.95, 0.95], [0.7, 0.7], [0.69, 0.75], [0.3, 1], t31.HUNDRED, 0.65), foggy: new s41([0.8, 0.8], [0.5, 0.5], [0, 0], [0.95, 0.95], [0.9, 0.9], [0.55, 0.55], [0.3, 0.3], t31.SIXTEEN) };

// node_modules/@arcgis/core/views/3d/environment/CloudsTechnique.js
var g18 = class extends e18 {
  constructor(e59, r59) {
    super(e59, r59, () => this.destroy());
  }
  initializeProgram(e59) {
    const r59 = g18.shader.get().build(this.configuration);
    return new o20(e59.rctx, r59, E7);
  }
  initializePipeline() {
    return W({ blending: l15(R4.ONE, R4.ONE, R4.ZERO, R4.ZERO), depthTest: { func: I4.LEQUAL }, colorWrite: c11 });
  }
};
g18.shader = new t15(h18, () => import("./Clouds.glsl-SD6WTWGE.js"));

// node_modules/@arcgis/core/views/3d/environment/NoiseTextureAtlasTechnique.js
var c42 = class extends e18 {
  initializeProgram(e59) {
    const r59 = c42.shader.get().build(this.configuration);
    return new o20(e59.rctx, r59, E7);
  }
  initializePipeline() {
    return W({ blending: this.configuration.mode === t32.Full ? s14(R4.ONE, R4.ZERO) : l15(R4.ZERO, R4.ONE, R4.ONE, R4.ZERO), depthTest: { func: I4.ALWAYS }, colorWrite: c11 });
  }
};
c42.shader = new t15(c26, () => import("./NoiseTextureAtlas.glsl-OIV5ULFR.js"));

// node_modules/@arcgis/core/views/3d/environment/NoiseTextureAtlas.js
var x15 = class extends y {
  constructor(e59) {
    let t60;
    super(e59), this._weatherTile = t9(0, 0), this._needsRender = true, this._frameBuffer = new D6(e59.context.renderContext.rctx, { colorTarget: Y.TEXTURE, width: s32, height: s32 }, { target: M6.TEXTURE_2D, pixelFormat: P3.RGBA, dataType: G4.UNSIGNED_BYTE, wrapMode: D4.CLAMP_TO_EDGE, samplingMode: L4.LINEAR, hasMipmap: false, width: s32, height: s32 }), this._vao = u12(e59.context.renderContext.rctx), this._shaderTechniqueRepository = e59.context.shaderTechniqueRepository, this._ensureRendered = () => (r(t60) ? r(this.weatherMapTechnique) && this.weatherMapTechnique.compiled && this._needsRender && (t60 = this._render(e59.context.renderContext.rctx, t32.WeatherMap)) : r(this.fullTechnique) && this.fullTechnique.compiled && (t60 = this._render(e59.context.renderContext.rctx, t32.Full)), t60);
  }
  get textureAtlas() {
    return this._ensureRendered();
  }
  _setDirty() {
    this._needsRender = true;
  }
  updateWeatherMap(e59) {
    this._weatherTile[0] === e59[0] && this._weatherTile[1] === e59[1] || (this._weatherTile = e59, this._setDirty());
  }
  destroy() {
    this._fullTechnique = p(this._fullTechnique), this._weatherMapTechnique = p(this._weatherMapTechnique), this._frameBuffer = s(this._frameBuffer), this._vao = s(this._vao);
  }
  get fullTechnique() {
    if (t(this._fullTechnique)) {
      const e59 = new s33();
      e59.mode = t32.Full, this._fullTechnique = this._shaderTechniqueRepository.acquire(c42, e59);
    }
    return this._fullTechnique;
  }
  get weatherMapTechnique() {
    if (t(this._weatherMapTechnique)) {
      const e59 = new s33();
      e59.mode = t32.WeatherMap, this._weatherMapTechnique = this._shaderTechniqueRepository.acquire(c42, e59);
    }
    return this._weatherMapTechnique;
  }
  _render(e59, t60) {
    if (t(this._vao) || t(this._frameBuffer))
      return null;
    const r59 = t60 === t32.Full ? this.fullTechnique : this.weatherMapTechnique;
    if (t(r59))
      return null;
    const i66 = e59.getViewport();
    e59.setViewport(0, 0, s32, s32), e59.bindFramebuffer(this._frameBuffer);
    const s63 = e59.bindTechnique(r59);
    return s63.setUniform2f("weatherTile", this._weatherTile[0], this._weatherTile[1]), e59.bindVAO(this._vao), s63.assertCompatibleVertexAttributeLocations(this._vao), e59.gl.drawArrays(e59.gl.TRIANGLE_STRIP, 0, 4), e59.setViewport(i66.x, i66.y, i66.width, i66.height), this._needsRender = false, this._frameBuffer.colorTexture;
  }
};
e([d({ constructOnly: true })], x15.prototype, "context", void 0);

// node_modules/@arcgis/core/views/3d/environment/CloudsGenerator.js
var I9 = class extends y {
  constructor(e59) {
    super(e59), this._frameTask = null, this._handles = new u4(), this._cubeMapSize = a("esri-mobile") ? 1024 : 2048, this._techniques = [], this._techniqueConfiguration = new r36(), this._bindParameters = new h15(null, null, null), this._drawParameters = new p20(), this._weatherTile = t9(0, 0), this._weatherTileCount = 128, this.coverage = s10(G10.coverage[0], G10.coverage[1], 0.5), this.density = s10(G10.density[0], G10.density[1], 0.5), this.absorption = s10(G10.absorption[0], G10.absorption[1], 0.5), this.cloudSize = s10(G10.cloudSize[0], G10.cloudSize[1], 0.5), this.detailSize = s10(G10.detailSize[0], G10.detailSize[1], 0.5), this.smoothness = s10(G10.smoothness[0], G10.smoothness[1], 0.5), this.cloudHeight = s10(G10.cloudHeight[0], G10.cloudHeight[1], 0.5), this.raymarchingStepType = G10.raymarchingStepType, this._cloudRadius = 0, this._viewMatrix = e12(), this._cameraPositionLastFrame = n7(), this.running = false;
  }
  _getTechnique(e59) {
    const t60 = this._techniques[e59];
    return t60 || (this._techniqueConfiguration.steps = e59, this._techniques[e59] = new g18({ rctx: this.context.renderContext.rctx, viewingMode: this.view.state.viewingMode }, this._techniqueConfiguration), this._techniques[e59]);
  }
  _getWeatherTile() {
    const e59 = this.view.camera.position.latitude, t60 = this.view.camera.position.longitude;
    let i66 = t9((e59 + 90) / 180, (t60 + 180) / 360);
    const s63 = Math.floor(this._weatherTileCount * Math.abs(2 * i66[0] - 1));
    i66 = t9(Math.floor(2 * this._weatherTileCount * i66[0]), Math.floor(4 * (this._weatherTileCount - s63) * i66[1]));
    let r59 = 0, n73 = 0;
    if (r(this.view.environment) && "sun" === this.view.environment.lighting.type && r(this.view.environment.lighting.date)) {
      const e60 = new Date(this.view.environment.lighting.date);
      e60.setUTCHours(this.view.environment.lighting.date.getUTCHours() + this.view.environment.lighting.displayUTCOffset), r59 = 31 * e60.getUTCMonth() + e60.getUTCDate(), n73 = e60.getUTCFullYear();
    }
    return i66[0] = (i66[0] + r59) % (2 * this._weatherTileCount), i66[1] = (i66[1] + n73 % 100) % (4 * this._weatherTileCount), i66;
  }
  initialize() {
    this._vao = u12(this.context.renderContext.rctx);
    const e59 = p3(this.view.spatialReference);
    this._cloudRadius = 0.5 * e59.radius, this.setDirty(), this._weatherTile = this._getWeatherTile(), this._frameTask = this.view.resourceController.scheduler.registerTask(L3.CLOUDS_GENERATOR, this), this._handles.add(this._frameTask), this._handles.add(l6(() => [this.coverage, this.density, this.absorption, this.cloudSize, this.detailSize, this.smoothness, this.cloudHeight, this.raymarchingStepType], () => this.setDirty(), h3));
  }
  destroy() {
    this._handles.destroy(), this._techniques.forEach((e59) => p(e59)), this._techniques = null, this._frameBufferCube = s(this._frameBufferCube), this._vao = s(this._vao), this._noiseTexture = l(this._noiseTexture);
  }
  _ensureNoiseTexture() {
    if (t(this._noiseTexture)) {
      const e59 = this.context;
      this._noiseTexture = new x15({ context: e59 }), this._noiseTexture.updateWeatherMap(this._weatherTile);
    }
    return this._noiseTexture.textureAtlas;
  }
  ensureWeatherTile() {
    const e59 = this._getWeatherTile();
    r(this._noiseTexture) && r(this.context) && this._noiseTexture.updateWeatherMap(e59), e59[0] === this._weatherTile[0] && e59[1] === this._weatherTile[1] || (this._weatherTile = e59, this.setDirty());
  }
  get frameBufferCube() {
    if (t(this._frameBufferCube)) {
      const e59 = { target: M6.TEXTURE_CUBE_MAP, pixelFormat: P3.RGBA, dataType: G4.UNSIGNED_BYTE, wrapMode: D4.CLAMP_TO_EDGE, samplingMode: L4.LINEAR, hasMipmap: false, width: this._cubeMapSize, height: this._cubeMapSize };
      this._frameBufferCube = new D6(this.context.renderContext.rctx, { colorTarget: Y.CUBEMAP, width: this._cubeMapSize, height: this._cubeMapSize }, e59);
    }
    return this._frameBufferCube;
  }
  get cubeMap() {
    return this._frameBufferCube;
  }
  isFading(e59) {
    return e59.crossFade.enabled || e59.fadeInOut.stage === o28.FADE_OUT || e59.fadeInOutHeight.stage !== e28.FINISHED;
  }
  applyPreset(e59, t60) {
    const i66 = e59.median, s63 = (e60) => {
      const s64 = s10(e60[0], e60[1], i66);
      return t60 < 0.5 ? s10(e60[0], s64, 2 * t60) : s10(s64, e60[1], 2 * (t60 - 0.5));
    };
    this.coverage = s63(e59.coverage), this.density = s63(e59.density), this.absorption = s63(e59.absorption), this.cloudSize = s63(e59.cloudSize), this.detailSize = s63(e59.detailSize), this.smoothness = s63(e59.smoothness), this.cloudHeight = s63(e59.cloudHeight), this.raymarchingStepType = e59.raymarchingStepType;
  }
  setDirty() {
    this.running = true;
  }
  runTask(e59) {
    if (0 === this.coverage || t(this._vao))
      return void (this.running = false);
    const t60 = this._getTechnique(this.raymarchingStepType);
    if (!t60.compiled)
      return;
    if (!G(this._cameraPositionLastFrame, this.context.renderContext.bindParameters.camera.eye) || this.isFading(this.context.renderContext.bindParameters.clouds))
      return void r7(this._cameraPositionLastFrame, this.context.renderContext.bindParameters.camera.eye);
    this.ensureWeatherTile();
    const i66 = this._ensureNoiseTexture();
    if (t(i66))
      return;
    const s63 = this.context.renderContext.rctx, o61 = s63.bindTechnique(t60), n73 = 1 + this.absorption, a58 = s10(35, 120, this.absorption);
    o61.bindTexture("cloudShapeTexture", i66), o61.setUniform1f("cloudRadius", this._cloudRadius), o61.setUniform1f("halfCubeMapSize", 0.5 * this._cubeMapSize), o61.setUniform1f("power", a58), o61.setUniform1f("sigmaE", n73), o61.setUniform1f("density", s10(0, 0.3, this.density)), o61.setUniform1f("cloudSize", s10(0, 0.02, Math.max(0.01, 1 - this.cloudSize))), o61.setUniform1f("detailSize", s10(0, 0.2, Math.max(0.01, 1 - this.detailSize))), o61.setUniform1f("smoothness", s10(0, 0.5, 1 - this.smoothness)), o61.setUniform1f("cloudHeight", s10(0, 1500, this.cloudHeight)), o61.setUniform1f("coverage", this.coverage), s63.bindVAO(this._vao), o61.assertCompatibleVertexAttributeLocations(this._vao);
    const h44 = s63.getViewport();
    s63.setViewport(0, 0, this._cubeMapSize, this._cubeMapSize), s63.bindFramebuffer(this.frameBufferCube);
    for (let r59 = 0; r59 < 5; r59++) {
      const e60 = N6[r59], t61 = L10[r59];
      Q(this._viewMatrix, W6, e60, t61), a10(this._drawParameters.viewMatrix, this._viewMatrix);
      const i67 = M6.TEXTURE_CUBE_MAP_POSITIVE_X + r59;
      this.frameBufferCube.setColorTextureTarget(i67), o61.bindDraw(this._drawParameters, this._bindParameters), s63.gl.drawArrays(s63.gl.TRIANGLE_STRIP, 0, 4), s63.gl.flush();
    }
    this.running = false, s63.setViewport(h44.x, h44.y, h44.width, h44.height), this.requestRender(), e59.madeProgress();
  }
};
e([d({ constructOnly: true })], I9.prototype, "context", void 0), e([d({ constructOnly: true })], I9.prototype, "view", void 0), e([d({ constructOnly: true })], I9.prototype, "requestRender", void 0), e([d()], I9.prototype, "_frameTask", void 0), e([d()], I9.prototype, "coverage", void 0), e([d()], I9.prototype, "density", void 0), e([d()], I9.prototype, "absorption", void 0), e([d()], I9.prototype, "cloudSize", void 0), e([d()], I9.prototype, "detailSize", void 0), e([d()], I9.prototype, "smoothness", void 0), e([d()], I9.prototype, "cloudHeight", void 0), e([d()], I9.prototype, "raymarchingStepType", void 0), e([d()], I9.prototype, "running", void 0), I9 = e([n6("esri.views.3d.environment.CloudsGenerator")], I9);
var N6 = [r20(1, 0, 0), r20(-1, 0, 0), r20(0, 1, 0), r20(0, -1, 0), r20(0, 0, 1)];
var L10 = [r20(0, 1, 0), r20(0, 1, 0), r20(0, 0, -1), r20(0, 0, 1), r20(0, 1, 0)];
var W6 = a16();
var G10 = t42.sunny;

// node_modules/@arcgis/core/views/3d/environment/FogTechnique.js
var h22 = class extends e18 {
  initializeProgram(e59) {
    const r59 = h22.shader.get().build(this.configuration);
    return new o20(e59.rctx, r59, E7);
  }
  initializePipeline() {
    return this.configuration.haze ? W({ blending: l15(R4.ONE, R4.ZERO, R4.ONE_MINUS_SRC_COLOR, R4.ONE), colorWrite: c11 }) : W({ blending: l15(R4.SRC_ALPHA, R4.ZERO, R4.ONE_MINUS_SRC_ALPHA, R4.ONE), colorWrite: c11 });
  }
};
h22.shader = new t15(u19, () => import("./Fog.glsl-XMPMQ7ZH.js"));
var u28 = class extends t17 {
  constructor() {
    super(...arguments), this.haze = false;
  }
};
e([e20()], u28.prototype, "haze", void 0);

// node_modules/@arcgis/core/views/3d/environment/Fog.js
var v16 = class extends y {
  constructor(e59) {
    super(e59), this._fogColor = n22(), this._fogColorAtNight = n22(), this._cameraDirection = n22(), this._foggyFadeStart = 0.95, this._foggyFadeEnd = 1, this._hazeFadeStart = 0.7, this._hazeFadeEnd = 1, this._strength = 4e-6;
    const t60 = e59.context.renderContext.rctx;
    this._vao = u12(t60, A9);
    const o61 = p3(e59.view.spatialReference);
    this._planetRadius = o61.radius, this._atmosphereRadius = o61.radius + f19;
  }
  destroy() {
    this._hazeFogTechnique = p(this._hazeFogTechnique), this._thickFogTechnique = p(this._thickFogTechnique), this._vao = s(this._vao);
  }
  get _shaderTechniqueRepository() {
    return this.context.shaderTechniqueRepository;
  }
  set strength(e59) {
    this._strength = e59;
  }
  get strength() {
    return this._strength;
  }
  get thickFogTechnique() {
    if (t(this._thickFogTechnique)) {
      const e59 = new u28();
      e59.haze = false, this._thickFogTechnique = this._shaderTechniqueRepository.acquire(h22, e59);
    }
    return this._thickFogTechnique;
  }
  get hazeFogTechnique() {
    if (t(this._hazeFogTechnique)) {
      const e59 = new u28();
      e59.haze = true, this._hazeFogTechnique = this._shaderTechniqueRepository.acquire(h22, e59);
    }
    return this._hazeFogTechnique;
  }
  when() {
    return Promise.resolve();
  }
  render(e59, t60, o61) {
    if (0 === this.view.basemapTerrain.baseOpacity && !t60)
      return;
    if (this._update(e59, t60, o61), this._fogAmount <= 0)
      return;
    const r59 = t60 ? this.thickFogTechnique : this.hazeFogTechnique;
    if (!r59.compiled)
      return void this.context.requestRender();
    const s63 = e59.offscreenRenderingHelper, i66 = e59.rctx.bindTechnique(r59, x16, e59.bindParameters);
    s63.renderDepthDetached(() => {
      i66.bindTexture("depthTex", s63.depthTexture), this._renderFog(r59.program, e59);
    });
  }
  _renderFog(e59, t60) {
    if (t(this._vao))
      return false;
    const o61 = t60.rctx, r59 = t60.bindParameters.camera;
    return e59.setUniform3fv("cameraPosition", r59.eye), e59.setUniform1f("atmosphereC", this._atmosphereC), e59.setUniform1f("fogStrength", this._strength), e59.setUniform1f("fogAmount", this._fogAmount), e59.setUniform3fv("fogColor", this._fogColor), o61.bindVAO(this._vao), e59.assertCompatibleVertexAttributeLocations(this._vao), o61.drawArrays(E5.TRIANGLE_STRIP, 0, 4), true;
  }
  _update(e59, t60, r59) {
    const s63 = e59.bindParameters.camera, i66 = t60 ? 0.1 : 0;
    r59 ? o3(this._fogColor, 0.5, 0.5, 0.5) : t60 ? o3(this._fogColor, 1.5, 1.5, 1.5) : o3(this._fogColor, 0.24, 0.44, 0.8), q(this._fogColorAtNight, this._fogColor, i66), z2(this._cameraDirection, s63.eye);
    const h44 = Math.max(0, P2(this._cameraDirection, e59.bindParameters.lighting.lightingMainDirection));
    A4(this._fogColor, this._fogColorAtNight, this._fogColor, h44);
    const a58 = s8(s63.eye), _30 = a58 * a58;
    this._atmosphereC = _30 - this._atmosphereRadius * this._atmosphereRadius, this._fogAmount = t60 ? 1 - I(this._foggyFadeStart * a32, this._foggyFadeEnd * a32, Math.abs(a58 - this._planetRadius)) : 1 - I(this._hazeFadeStart * a32, this._hazeFadeEnd * a32, Math.abs(a58 - this._planetRadius));
  }
  static isSupported(e59) {
    return e59.capabilities.depthTexture;
  }
};
e([d({ constructOnly: true })], v16.prototype, "context", void 0), e([d({ constructOnly: true })], v16.prototype, "view", void 0), v16 = e([n6("esri.views.3d.environment.Fog")], v16);
var x16 = new t14();

// node_modules/@arcgis/core/views/3d/environment/SimpleAtmosphereTechnique.js
var c43 = class extends e18 {
  initializeProgram(e59) {
    const r59 = c43.shader.get().build(this.configuration);
    return new o20(e59.rctx, r59, E7);
  }
  initializePipeline() {
    return this.configuration.geometry === n36.Cylinder ? W({ blending: l15(R4.SRC_ALPHA, R4.ONE, R4.ONE_MINUS_SRC_ALPHA, R4.ONE_MINUS_SRC_ALPHA), culling: r22, depthTest: { func: I4.LEQUAL }, colorWrite: c11 }) : W({ blending: l15(R4.SRC_ALPHA, R4.ONE, R4.ONE_MINUS_SRC_ALPHA, R4.ONE_MINUS_SRC_ALPHA), depthTest: { func: I4.LEQUAL }, colorWrite: c11 });
  }
};
c43.shader = new t15(v9, () => import("./SimpleAtmosphere.glsl-QUUM7YI7.js"));

// node_modules/@arcgis/core/views/3d/environment/resources/SimpleAtmosphereTexture.js
var A23 = "data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAABD1gYFAAAACXBIWXMAAC4jAAAuIwF4pT92AAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAXVJREFUeNq0k9GWhDAIQ3PjzP9/cuehFqhW19mz++IhkCZAq1prsqT+kSQS9g8Vnqp6VGVWkYVktR6tj3Gr968nLnfwlHzHYyHapkKS73bPd/39eI38AYWj24OGvqdwWjZ3l8IDgacXyl1Dj9tdLOzZiicj+P1YcGk0H2O2vN/VQpTveEHmPHQxZxYlqsQdhUeuCWREuDEvAjqlCqDIMYwIo2ijR1HdYUS58dQrKpgQ0EGeMocsTNXrxzyOhS9kfzlWjn82YuWLqwAnvfNEWJFjYXkJCT0s7AmS0NG4x7Lt6Cpy2MiVPBZmS668QT5AR1cevp7b6CpzQ/ZSNH0vmhy5CsNtdax0MBpXDBiFsrDiMSLKMc8b6hH93bNbEpRsIyHDUhNcfTyeKF16PC7c/2QdczvUnvOB1ylZHVFSMtd5s8C2IW/7w6hwM5GLavLCd1zkiFjB+BwH1DSgctQ7mPOimBLJrw35beSXkd8BM/cCqbXWPgMA+GQQ5sIgkfAAAAAASUVORK5CYII=";

// node_modules/@arcgis/core/views/3d/environment/PanoramicAtmosphere.js
var q5 = s3.getLogger("esri.views.3d.environment.PanoramicAtmosphere");
var R8 = class {
  constructor() {
    this.type = "panoramic", this._techniqueConfig = new t33(), this._passParameters = new f17(), this._readyResolver = D(), this._readyController = new AbortController();
  }
  destroy() {
    this._readyResolver.reject(), this._passParameters.texture = s(this._passParameters.texture), this._vao = s(this._vao), this._readyController = h(this._readyController);
  }
  when() {
    return this._readyResolver.promise;
  }
  initializeRenderContext(e59) {
    this._techniqueConfig.geometry = n36.Cylinder, this._technique = e59.shaderTechniqueRepository.acquire(c43, this._techniqueConfig);
    const r59 = e59.renderContext.rctx;
    this._vao = this._createVertexArrayObject(r59), this._vaoCount = n20(this._vao, "geometry"), t11(A23, { signal: this._readyController.signal }).then((t60) => {
      this._passParameters.texture = new u10(r59, { pixelFormat: P3.RGBA, dataType: G4.UNSIGNED_BYTE, wrapMode: D4.CLAMP_TO_EDGE, samplingMode: L4.LINEAR, flipped: true }, t60), e59.requestRender(), this._readyController = null, this._readyResolver.resolve();
    }).catch((e60) => {
      g(e60) || q5.error("Unable to initialize atmosphere: image request failed", e60), this._readyResolver.reject();
    });
  }
  get canRender() {
    return null != this._passParameters.texture;
  }
  render(e59) {
    const r59 = e59.rctx, t60 = r59.bindTechnique(this._technique, this._passParameters, e59.bindParameters);
    I10(O10, e59.bindParameters.camera.viewMatrix), t60.setUniformMatrix4fv("view", O10), r59.bindVAO(this._vao), t60.assertCompatibleVertexAttributeLocations(this._vao), r59.drawArrays(E5.TRIANGLES, 0, this._vaoCount);
  }
  renderHaze() {
    return false;
  }
  _createVertexArrayObject(e59) {
    const r59 = T10.createPolySphereGeometry(1, 2, false), t60 = r59.indices.get(O3.POSITION);
    for (let a58 = 0; a58 < t60.length; a58 += 3) {
      const e60 = t60[a58];
      t60[a58] = t60[a58 + 2], t60[a58 + 2] = e60;
    }
    const o61 = r59.vertexAttributes.get(O3.POSITION).data, s63 = S8.createBuffer(t60.length), i66 = s63.position;
    for (let a58 = 0; a58 < t60.length; ++a58) {
      const e60 = 3 * t60[a58];
      i66.set(a58, 0, o61[e60]), i66.set(a58, 1, o61[e60 + 1]), i66.set(a58, 2, o61[e60 + 2]);
    }
    return new f11(e59, E7, { geometry: o7(S8) }, { geometry: c10.createVertex(e59, F4.STATIC_DRAW, s63.buffer) });
  }
};
function I10(e59, r59) {
  n11(e59, r59), e59[12] = 0, e59[13] = 0, e59[14] = 0, e59[15] = 1;
}
var O10 = e12();
var S8 = T2().vec3f(O3.POSITION);

// node_modules/@arcgis/core/views/3d/environment/PrecipitationTechnique.js
var g19 = class extends t14 {
  constructor() {
    super(...arguments), this.time = 0, this.radius = 1;
  }
};
var u29 = class extends e18 {
  initializeProgram(e59) {
    const r59 = u29.shader.get().build(this.configuration);
    return new o20(e59.rctx, r59, u29.attributeLocation);
  }
  initializePipeline() {
    return W({ blending: l15(R4.ONE, R4.ONE, R4.ONE_MINUS_SRC_ALPHA, R4.ONE_MINUS_SRC_ALPHA), depthTest: { func: I4.LEQUAL }, colorWrite: c11 });
  }
};
u29.shader = new t15(c27, () => import("./Precipitation.glsl-A3F4E6BK.js")), u29.attributeLocation = /* @__PURE__ */ new Map([[O3.POSITION, 0], [O3.INSTANCEFEATUREATTRIBUTE, 1]]);

// node_modules/@arcgis/core/views/3d/environment/Precipitation.js
var O11 = class extends y {
  constructor(t60) {
    super(t60), this._numParticles = 25e4, this._rainSpeed = 0.1, this._snowSpeed = 0.01, this._opacity = 1, this._width = 500, this._offset = n7(), this._tile = n7(), this._particleColor = n22(), this._particleColorAtNight = n22(), this._nightMultiplier = 0.7, this._cameraDirection = n22(), this._renderParameters = new g19(), this._animation = new i25(), this._updatingTracking = new c7(), this._renderParameters.time = 0, this._renderParameters.radius = p3(t60.view.spatialReference).radius, this._shaderTechniqueRepository = t60.context.shaderTechniqueRepository;
  }
  destroy() {
    this._updatingTracking.destroy(), this._numParticles = 0, this._snowTechnique = p(this._snowTechnique), this._rainTechnique = p(this._rainTechnique), this._vao = s(this._vao), this._instanceIdBuffer = s(this._instanceIdBuffer);
  }
  get updating() {
    return this._updatingTracking.updating;
  }
  get rainTechnique() {
    if (t(this._rainTechnique)) {
      const t60 = new i30();
      t60.type = t34.Rain, this._rainTechnique = this._shaderTechniqueRepository.acquire(u29, t60);
    }
    return this._rainTechnique;
  }
  get snowTechnique() {
    if (t(this._snowTechnique)) {
      const t60 = new i30();
      t60.type = t34.Snow, this._snowTechnique = this._shaderTechniqueRepository.acquire(u29, t60);
    }
    return this._snowTechnique;
  }
  update(t60) {
    return this._animation.advance(t60);
  }
  render(t60, e59, r59) {
    const s63 = "rainy" === r59, h44 = s63 ? this.rainTechnique : this.snowTechnique;
    if (!h44.compiled)
      return void this.context.requestRender();
    const c67 = t60.rctx;
    if (this._ensureResources(c67), t(h44) || t(this._vao) || t(this._instanceIdBuffer))
      return;
    if (r(t60.bindParameters.clouds.data) && (this._opacity = 1 - t60.bindParameters.clouds.fadeInOutHeight.factor), this._opacity <= 0)
      return;
    const _30 = 0.35;
    e59 = e59 < 0.5 ? s10(0, _30, 2 * e59) : s10(_30, 1, 2 * (e59 - 0.5));
    const m40 = c67.bindTechnique(h44);
    this._renderParameters.camera = t60.bindParameters.camera, this._renderParameters.time = (s63 ? this._rainSpeed : this._snowSpeed) * u2(this._animation.time), this._renderParameters.time = this._renderParameters.time % 1e5, this._update(m40, r59, t60), c67.bindVAO(this._vao);
    const p52 = u29.attributeLocation;
    m40.assertCompatibleVertexAttributeLocations(this._vao), R5(c67, p52, this._instanceIdBuffer, B5, 0), c67.capabilities.instancing.drawArraysInstanced(E5.TRIANGLES, 0, 3, this._numParticles * e59), E6(c67, p52, this._instanceIdBuffer, B5);
  }
  _update(t60, e59, i66) {
    const r59 = i66.bindParameters.camera, s63 = r59.eye;
    this._tile[0] = Math.floor((s63[0] + 0.5 * this._width) / this._width), this._tile[1] = Math.floor((s63[1] + 0.5 * this._width) / this._width), this._tile[2] = Math.floor((s63[2] + 0.5 * this._width) / this._width), this._offset[0] = s63[0] - this._tile[0] * this._width, this._offset[1] = s63[1] - this._tile[1] * this._width, this._offset[2] = s63[2] - this._tile[2] * this._width, t60.setUniform1f("width", this._width), t60.setUniform3fv("offset", this._offset), t60.setUniformMatrix4fv("view", r59.viewMatrix), t60.setUniform3fv("cameraPosition", s63), t60.bindPass(null, i66.bindParameters), t60.setUniform1f("time", this._renderParameters.time), "rainy" === e59 ? o3(this._particleColor, 0.85, 0.85, 0.85) : o3(this._particleColor, 1, 1, 1), q(this._particleColorAtNight, this._particleColor, this._nightMultiplier), z2(this._cameraDirection, s63);
    const o61 = Math.max(0, P2(this._cameraDirection, i66.bindParameters.lighting.lightingMainDirection));
    A4(this._particleColor, this._particleColorAtNight, this._particleColor, o61), t60.setUniform3fv("particleColor", this._particleColor), t60.setUniform1f("opacity", this._opacity);
  }
  _ensureResources(t60) {
    t(this._vao) && (this._vao = this._createVertexArrayObject(t60)), t(this._instanceIdBuffer) && (this._instanceIdBuffer = this._createInstanceIndices(t60));
  }
  _createInstanceIndices(t60) {
    const e59 = [];
    for (let i66 = 0; i66 < this._numParticles; i66++)
      e59.push(i66);
    return c10.createVertex(t60, F4.STATIC_DRAW, new Float32Array(e59));
  }
  _createVertexArrayObject(t60) {
    const e59 = new Float32Array([-1, 0, 1, 1, 0, -1, 1, 0, 1]);
    return new f11(t60, u29.attributeLocation, { geometry: o7(k11) }, { geometry: c10.createVertex(t60, F4.STATIC_DRAW, e59) });
  }
};
e([d({ constructOnly: true })], O11.prototype, "context", void 0), e([d({ constructOnly: true })], O11.prototype, "view", void 0), e([d({ readOnly: true })], O11.prototype, "updating", null), e([d()], O11.prototype, "_updatingTracking", void 0), O11 = e([n6("esri.views.3d.environment.Precipitation")], O11);
var k11 = T2().vec3f(O3.POSITION);
var B5 = o7(T2().f32(O3.INSTANCEFEATUREATTRIBUTE), 1);

// node_modules/@arcgis/core/views/3d/environment/resources/MarsAtmosphereTexture.js
var A24 = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAAE00TaTAAAACXBIWXMAAA7AAAAOwAFq1okJAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAp1JREFUSMd9lcmSEzEQRCtflnqxYZgIThBDAP//kXDQ0pJtuDhqycxWZ5fKERFCERARIAVEyCjCtSFFEjWVa9q7OdJE0oiidIhKhRBROlhloiGVhaYERQHJWFEwMpYKrjUlibI2cqSJIJEpKNmM2c3GkRTOJDnThTMpnMWu0VFszs3Jfbe5bza3w+a229yOIs6zmP3czfn1K2w/for8+EVU15pNmmyqkeJyclinXNJRu1xrUaJmjmdzJiejVNt7zZVBRAIq1RwrsrrWnez+SR7WmQQP/1itKz2q/pmzuJtYnNy2bth9x9z2NLfDcB7FHOcGx6ebOb9/iPzxG/ztg4iorglFiKjzF9HSNphCoRb1OY3RZQJrYgRdT68bmgXGDdBzrTG8qNS7QP/m19ef7tGlcoH7vESYkK70uoPuOLEetz0IqeGoWQW6MlB/j36EnipYGKPWwDRg/RkNhXCNJIzAhMk6PrDePJNII6JHqM5VWqYApCtNFPe0GFFGtOWopWCrEVBSoiQi06KkRRaD08IlxXa/ifz8Jvz2LvjyLnh7F/r8Rei8a8xfjNkIrpmMOQ1C02COrkTEHxGhh+6DQJfXc/eZprXxcIyVIf1LJVgWvKaHvwI/1aQxtv851SQ/nqGXL6MHFVY3nmhLyqKsWO/+qzWif+yS1TpNKq8NezjGPCV69ciZoQj1PwfN6QRpWyCGVMe1D/AAHt3/gefu1Ign3AVpjOiNXkN90JlpL6TUnzFEUU+Jvks0tkp/dY3Fy1TzI24BWwsYJPyg11Q0FqDwK72xIz2kLojbeuxS1FpgtfNWyMX1gFw0j3W7RNeSHTVEe3VaV7SdCzVywFaEt02w7QH7Eeg4AvZDNdJ+Cu1HENsutO+Byi6ilEBZ9BeCNBJceJIjHgAAAABJRU5ErkJggg==";

// node_modules/@arcgis/core/views/3d/environment/SimpleAtmosphere.js
var X4 = s3.getLogger("esri.views.3d.environment.SimpleAtmosphere");
var Z3 = 128;
var $2 = -n45;
var ee = 0;
var te = 50;
var re = () => 1 - 511 / 512;
var ie = U7([[50, 0.1015625], [500, 0.21875], [5e3, 1 - 250 / 512], [5e4, 0.4140625]]);
var se = class {
  constructor(e59) {
    this.view = e59, this.type = "simple", this._renderData = { texV: n17(), silCircleCenter: n7(), silCircleV1: n7(), silCircleV2: n7(), altitudeFade: 0, innerScale: 0, undergroundFadeAlpha: 0 }, this._passParameters = new f17(), this._fadeVaoCount = 0, this._readyResolver = D(), this._readyController = new AbortController(), this.texV1 = 1, this.canRender = true, this.isOnMars = P(e59.spatialReference);
    const t60 = p3(e59.spatialReference);
    this.planetRadius = t60.radius, this.outerRimWidth = t60.outerAtmosphereRimWidth, this.innerRimFactor = (this.planetRadius + $2) / this.planetRadius, this.middleRimFactor = (this.planetRadius + ee) / this.planetRadius, this.outerRimFactor = (this.planetRadius + this.outerRimWidth) / this.planetRadius, this.texV0 = ee / this.outerRimWidth, this.texVScale = this.texV1 - this.texV0;
  }
  destroy() {
    this._readyResolver.reject(), this._cameraChangeHandle = a2(this._cameraChangeHandle), this._passParameters.texture = s(this._passParameters.texture), this._fadeVao = s(this._fadeVao), this._vao = s(this._vao), this._readyController = h(this._readyController);
  }
  when() {
    return this._readyResolver.promise;
  }
  async initializeRenderContext(e59) {
    this._shaderTechniqueRepository = e59.shaderTechniqueRepository;
    const t60 = e59.renderContext.rctx;
    this._cameraChangeHandle = l6(() => {
      var _a;
      return (_a = this.view.state) == null ? void 0 : _a.camera;
    }, () => e59.requestRender(), w2), this._vao = this._createRibbon(t60), this._vaoCount = n20(this._vao, "geometry"), this._fadeVao = u12(t60), this._fadeVaoCount = n20(this._fadeVao, "geometry");
    const r59 = this.isOnMars ? A24 : A23, i66 = this._readyController.signal;
    try {
      const s63 = await t11(r59, { signal: i66 });
      f(i66), this._passParameters.texture = new u10(t60, { pixelFormat: P3.RGBA, dataType: G4.UNSIGNED_BYTE, wrapMode: D4.CLAMP_TO_EDGE, samplingMode: L4.LINEAR, flipped: true }, s63), e59.requestRender(), this._readyController = null, this._readyResolver.resolve();
    } catch (s63) {
      g(s63) || X4.error("Unable to initialize simple atmosphere: image request failed", s63), this._readyResolver.reject(s63);
    }
  }
  get coneTechnique() {
    if (t(this._coneTechnique)) {
      const e59 = new t33();
      e59.geometry = n36.Cone, this._coneTechnique = this._shaderTechniqueRepository.acquire(c43, e59);
    }
    return this._coneTechnique;
  }
  get undergroundTechnique() {
    if (t(this._undergroundTechnique)) {
      const e59 = new t33();
      e59.geometry = n36.Underground, this._undergroundTechnique = this._shaderTechniqueRepository.acquire(c43, e59);
    }
    return this._undergroundTechnique;
  }
  render(e59) {
    const t60 = e59.bindParameters.camera;
    this._update(t60);
    const r59 = e59.rctx;
    if (this._renderData.undergroundFadeAlpha < 1) {
      const i66 = r59.bindTechnique(this.coneTechnique, this._passParameters, e59.bindParameters);
      i66.setUniformMatrix4fv("proj", t60.projectionMatrix), i66.setUniformMatrix4fv("view", t60.viewMatrix), i66.setUniform3fv("silCircleCenter", this._renderData.silCircleCenter), i66.setUniform3fv("silCircleV1", this._renderData.silCircleV1), i66.setUniform3fv("silCircleV2", this._renderData.silCircleV2), i66.setUniform2fv("texV", this._renderData.texV), i66.setUniform1f("altitudeFade", this._renderData.altitudeFade), i66.setUniform1f("innerScale", this._renderData.innerScale), r59.bindVAO(this._vao), r59.drawArrays(E5.TRIANGLES, 0, this._vaoCount);
    }
    if (this._renderData.undergroundFadeAlpha > 0) {
      const i66 = r59.bindTechnique(this.undergroundTechnique, this._passParameters, e59.bindParameters);
      i66.setUniform1f("undergroundFadeAlpha", this._renderData.undergroundFadeAlpha), i66.setUniform3fv("cameraPosition", t60.eye), r59.bindVAO(this._fadeVao), r59.drawArrays(E5.TRIANGLE_STRIP, 0, this._fadeVaoCount);
    }
  }
  renderHaze() {
    return false;
  }
  _update(e59) {
    const i66 = n7(), s63 = this.planetRadius, a58 = s8(e59.eye), o61 = a58 - s63;
    if (o61 < 0) {
      const e60 = Math.min(-o61 / 5e3, 1);
      this._renderData.undergroundFadeAlpha = e60;
    } else
      this._renderData.undergroundFadeAlpha = 0;
    const n73 = Math.max(te, o61), h44 = s63 + $2;
    this._renderData.innerScale = me(s63 + n73, s63, h44) - 1, this._renderData.altitudeFade = t41(o61), q(i66, e59.eye, (s63 + te) / a58), ae(i66, e59.center, e59.up, s63, this._renderData);
    const m40 = this._computeScreenRimWidth(e59, i66, e59.up, this._renderData), c67 = re(), l48 = ie(o61);
    let d32 = this.texV0 + c67 * this.texVScale, u51 = this.texV0 + m40 * l48 * this.texVScale;
    if (o61 > te) {
      ae(e59.eye, e59.center, e59.up, s63, this._renderData);
      const i67 = this._computeScreenRimWidth(e59, e59.eye, e59.up, this._renderData), a59 = o4((i67 - 1.5) / (m40 - 1.5), 0, 1);
      d32 = this.texV0 + a59 * c67 * this.texVScale, u51 = this.texV0 + s10(this.texV1, m40 * l48, a59) * this.texVScale;
    }
    r13(this._renderData.texV, d32, u51);
  }
  _createRibbon(e59) {
    const t60 = new Float32Array(3 + 3 * Z3 * 3), r59 = new Uint32Array(3 * Z3 * 5);
    t60[0] = 0, t60[1] = 0, t60[2] = -1;
    for (let a58 = 0; a58 < Z3; a58++) {
      const e60 = 9 * a58 + 3;
      t60[e60 + 0] = a58, t60[e60 + 1] = this.innerRimFactor, t60[e60 + 2] = -1, t60[e60 + 3] = a58, t60[e60 + 4] = this.middleRimFactor, t60[e60 + 5] = 0, t60[e60 + 6] = a58, t60[e60 + 7] = this.outerRimFactor, t60[e60 + 8] = 1;
      const i67 = 3 * a58 + 1, s64 = a58 === Z3 - 1 ? 1 : i67 + 3, o61 = 15 * a58;
      r59[o61 + 0] = i67, r59[o61 + 1] = i67 + 1, r59[o61 + 2] = s64 + 1, r59[o61 + 3] = s64 + 1, r59[o61 + 4] = s64, r59[o61 + 5] = i67, r59[o61 + 6] = i67 + 1, r59[o61 + 7] = i67 + 2, r59[o61 + 8] = s64 + 2, r59[o61 + 9] = s64 + 2, r59[o61 + 10] = s64 + 1, r59[o61 + 11] = i67 + 1, r59[o61 + 12] = i67, r59[o61 + 13] = s64, r59[o61 + 14] = 0;
    }
    const i66 = ce.createBuffer(r59.length), s63 = i66.position;
    for (let a58 = 0; a58 < r59.length; ++a58) {
      const e60 = 3 * r59[a58];
      s63.set(a58, 0, t60[e60]), s63.set(a58, 1, t60[e60 + 1]), s63.set(a58, 2, t60[e60 + 2]);
    }
    return new f11(e59, E7, { geometry: o7(ce) }, { geometry: c10.createVertex(e59, F4.STATIC_DRAW, i66.buffer) });
  }
  _computeScreenRimWidth(e59, t60, r59, i66) {
    return u3(ne, i66.silCircleCenter, i66.silCircleV2), q(he2, ne, this.outerRimFactor), F3(oe, t60, ne, r59), i7(ne, oe, e59.projectionMatrix, e59.viewport), i7(he2, oe, e59.projectionMatrix, e59.viewport), x(ne, he2) / e59.height;
  }
};
function ae(e59, t60, r59, i66, s63) {
  const a58 = s8(e59), o61 = i66 * Math.sqrt(a58 * a58 - i66 * i66) / a58, n73 = Math.sqrt(i66 * i66 - o61 * o61), h44 = s63.silCircleV1, m40 = s63.silCircleV2;
  return q(s63.silCircleCenter, e59, n73 / a58), _(h44, e59, t60), v3(h44) < 1 && _(h44, e59, r59), q(h44, h44, o61 / s8(h44)), _(m40, h44, e59), q(m40, m40, o61 / s8(m40)), o61;
}
var oe = e12();
var ne = n7();
var he2 = n7();
function me(e59, t60, r59) {
  return e59 * e59 / (Math.sqrt(e59 * e59 - t60 * t60) * Math.sqrt(e59 * e59 - r59 * r59) + t60 * r59);
}
var ce = T2().vec3f(O3.POSITION);

// node_modules/@arcgis/core/views/3d/environment/StarsTechnique.js
var d16 = class extends t14 {
  constructor() {
    super(...arguments), this.modelMatrix = e12();
  }
};
var g20 = class extends e18 {
  constructor(e59) {
    super(e59, null, () => this.destroy());
  }
  initializeProgram(e59) {
    const r59 = g20.shader.get().build();
    return new o20(e59.rctx, r59, E7);
  }
  initializePipeline() {
    return W({ blending: l15(R4.SRC_ALPHA, R4.ONE, R4.ONE_MINUS_SRC_ALPHA, R4.ONE_MINUS_SRC_ALPHA), depthTest: { func: I4.LEQUAL }, colorWrite: c11 });
  }
};
g20.shader = new t15(v10, () => import("./Stars.glsl-G75Y52EJ.js"));

// node_modules/@arcgis/core/views/3d/environment/Stars.js
var O12 = s3.getLogger("esri.views.3d.environment.Stars");
var S9 = class extends y {
  constructor(t60) {
    super(t60), this._loadDataTask = null, this._numPoints = 0, this._renderParameter = new d16(), this._updatingTracking = new c7();
  }
  get updating() {
    return this._updatingTracking.updating || this.loading;
  }
  get loading() {
    return r(this._loadDataTask) && !this._loadDataTask.finished;
  }
  initialize() {
    this._loadDataTask = this._createLoadDataTask();
  }
  destroy() {
    this._loadDataTask = h(this._loadDataTask), this._updatingTracking.destroy(), this._numPoints = 0, this._technique = p(this._technique), this._vao = s(this._vao);
  }
  render(t60) {
    const { rctx: e59 } = t60;
    if (this._ensureResources(e59), t(this._technique) || t(this._vao))
      return;
    if (!this._technique.compiled)
      return void this.requestRender();
    const r59 = e59.bindTechnique(this._technique, this._renderParameter, t60.bindParameters);
    e59.bindVAO(this._vao), r59.assertCompatibleVertexAttributeLocations(this._vao), e59.drawArrays(E5.POINTS, 0, this._numPoints);
  }
  _ensureResources(t60) {
    if (r(this._technique) || t(V6))
      return;
    this._technique = new g20({ rctx: t60, viewingMode: this.view.state.viewingMode }), this._numPoints = V6.byteLength / R9;
    const e59 = new Float32Array(V6, 0, 2 * this._numPoints), r59 = new Uint8Array(V6, 2 * this._numPoints * 4, this._numPoints);
    this._vao = this._createVertexArrayObject(t60, e59, r59, this._numPoints), this._updatingTracking.add(() => "sun" === this.view.environment.lighting.type ? this.view.environment.lighting.date : null, (t61) => this._update(t61), h3);
  }
  _computeDayDuration(t60) {
    const e59 = t60, r59 = new Date(t60.getFullYear(), 0, 1, 11, 58, 56);
    return (+e59 - +r59) / (+new Date(t60.getFullYear() + 1, 0, 1, 11, 58, 55) - +r59);
  }
  _update(t60) {
    if (!t60)
      return;
    const e59 = (t60.getHours() / 12 + t60.getMinutes() / 60 * (2 / 24) + t60.getSeconds() / 60 * (2 / 1440) - 0.9972222) % 2, r59 = 2 * this._computeDayDuration(t60), s63 = n11(this._renderParameter.modelMatrix, L11);
    m5(s63, s63, -r59 * Math.PI), u5(s63, M8, s63), m5(s63, s63, -e59 * Math.PI), this.requestRender();
  }
  _hexToRGB(t60) {
    return [parseInt(t60.substring(0, 2), 16), parseInt(t60.substring(2, 4), 16), parseInt(t60.substring(4, 6), 16)];
  }
  _unpackUint8Attributes(t60) {
    return t60 >= 192 ? [2.9, t60 - 192] : t60 >= 160 ? [2.5, t60 - 160] : t60 >= 128 ? [2, t60 - 128] : t60 >= 96 ? [1.5, t60 - 96] : t60 >= 64 ? [1, t60 - 64] : t60 >= 32 ? [0.7, t60 - 32] : [0.4, t60];
  }
  _createVertexArrayObject(t60, e59, r59, s63) {
    const i66 = U15.createBuffer(s63), a58 = i66.position, o61 = i66.color, n73 = i66.size;
    for (let c67 = 0; c67 < s63; c67++) {
      const t61 = e59[2 * c67 + 0], s64 = e59[2 * c67 + 1];
      a58.set(c67, 0, -Math.cos(t61) * Math.sin(s64)), a58.set(c67, 1, -Math.sin(t61) * Math.sin(s64)), a58.set(c67, 2, -Math.cos(s64));
      const i67 = this._unpackUint8Attributes(r59[c67]), f37 = this._hexToRGB(I11[i67[1]]);
      o61.set(c67, 0, 255 * f37[0]), o61.set(c67, 1, 255 * f37[1]), o61.set(c67, 2, 255 * f37[2]), o61.set(c67, 3, 255), n73.set(c67, i67[0]);
    }
    return new f11(t60, E7, { geometry: o7(U15) }, { geometry: c10.createVertex(t60, F4.STATIC_DRAW, i66.buffer) });
  }
  _createLoadDataTask() {
    if (r(V6))
      return null;
    const t60 = O(async (t61) => {
      const { data: r59 } = await n9("esri/views/3d/environment/resources/stars.wsv", { responseType: "array-buffer", signal: t61 });
      this._verifyStarData(r59), V6 = r59;
    });
    return t60.promise.catch((t61) => {
      g(t61) || O12.error(t61);
    }).then(() => {
      this.destroyed || (this.requestRender(), this.notifyChange("updating"));
    }), t60;
  }
  _verifyStarData(t60) {
    if (!t60)
      throw new s4("stars:no-data-received", "Failed to create stars because star catalogue is missing");
    const e59 = t60.byteLength / R9;
    if (e59 % 1 != 0 || e59 > 5e4 || e59 < 5e3)
      throw new s4("stars:invalid-data", "Failed to create stars because star catalogue data is invalid");
  }
};
e([d({ constructOnly: true })], S9.prototype, "view", void 0), e([d({ constructOnly: true })], S9.prototype, "requestRender", void 0), e([d({ readOnly: true })], S9.prototype, "updating", null), e([d()], S9.prototype, "_loadDataTask", void 0), e([d()], S9.prototype, "_updatingTracking", void 0), S9 = e([n6("esri.views.3d.environment.Stars")], S9);
var I11 = ["9bb2ff", "9eb5ff", "aabfff", "bbccff", "ccd8ff ", "dae2ff", "e4e9ff", "eeefff", "f8f6ff", "fff9fb", "fff5ef", "fff1e5", "ffeddb", "ffe9d2", "ffe6ca", "ffe3c3", "ffe0bb", "ffddb4", "ffdaad", "ffd6a5", "ffd29c", "ffcc8f", "ffc178", "ffa94b", "ff7b00"];
var M8 = t8(1, 0, 0, 0, 0, 0.9174771405229186, 0.39778850739794974, 0, 0, -0.39778850739794974, 0.9174771405229186, 0, 0, 0, 0, 1);
var L11 = t8(1, 0, 0, 0, 0, 0.9174771405229186, -0.39778850739794974, 0, 0, 0.39778850739794974, 0.9174771405229186, 0, 0, 0, 0, 1);
var R9 = 9;
var U15 = T2().vec3f(O3.POSITION).vec4u8(O3.COLOR).f32(O3.SIZE);
var V6 = null;

// node_modules/@arcgis/core/views/3d/environment/EnvironmentRenderer.js
var P8;
var O13 = [E9.POSTPROCESSING_ENVIRONMENT_OPAQUE, E9.POSTPROCESSING_ENVIRONMENT_TRANSPARENT];
var S10;
var M9 = P8 = class extends y {
  constructor(e59) {
    super(e59), this._handles = new u4(), this._context = null, this._pendingAtmosphere = null, this._atmosphere = null;
  }
  initialize() {
    this.view._stage.addRenderPlugin(O13, this);
  }
  destroy() {
    var _a;
    this._pendingAtmosphere = l(this._pendingAtmosphere), null != ((_a = this.view) == null ? void 0 : _a._stage) && this.view._stage.removeRenderPlugin(this), this._handles = l(this._handles), this._set("view", null);
  }
  get atmosphereType() {
    return r(this._pendingAtmosphere) ? this._pendingAtmosphere.type : r(this._atmosphere) ? this._atmosphere.type : "none";
  }
  get canRender() {
    var _a;
    return !!((_a = this.view.basemapTerrain) == null ? void 0 : _a.renderer.canRender) || "global" !== this.view.viewingMode;
  }
  get needsLinearDepth() {
    return "realistic" === this._selectAtmosphereType();
  }
  updateAnimation(e59) {
    return !!r(this._precipitation) && this._precipitation.update(e59);
  }
  get updating() {
    return r(this._pendingAtmosphere) || r(this._stars) && this._stars.updating || r(this._clouds) && this._clouds.running;
  }
  get weatherVisible() {
    return s8(this.view.state.camera.eye) - p3(this.view.spatialReference).radius <= a32;
  }
  get _stars() {
    var _a;
    const e59 = this.view, t60 = ((_a = e59.environment) == null ? void 0 : _a.starsEnabled) ?? false, s63 = this._get("_stars");
    return !t60 || t(this._context) ? (l(s63), null) : r(s63) ? s63 : new S9({ view: e59, requestRender: () => this._setNeedsRender() });
  }
  get _precipitation() {
    const e59 = this._get("_precipitation");
    if (!this._precipitationEnabled || t(this._context))
      return l(e59), null;
    const t60 = this.view, s63 = this._context;
    return r(e59) && e59.context === s63 ? e59 : (l(e59), new O11({ context: s63, view: t60 }));
  }
  get _clouds() {
    const e59 = this._get("_clouds");
    if (!this.weatherEnabled || t(this._context))
      return l(e59), null;
    if (r(e59))
      return e59;
    const t60 = this.view, s63 = this._context;
    return l(e59), new I9({ context: s63, view: t60, requestRender: () => this._setNeedsRender() });
  }
  get _cloudsComposition() {
    const e59 = this._get("_cloudsComposition");
    if (!this.weatherEnabled || t(this._context))
      return l(e59), null;
    const t60 = this.view.state.viewingMode, s63 = this._context.renderContext.rctx, i66 = p3(this.view.spatialReference).radius;
    return r(e59) && e59.viewingMode === t60 && e59.planetRadius === i66 ? e59 : (l(e59), new j15({ rctx: s63, viewingMode: t60, planetRadius: i66, requestRender: () => this._setNeedsRender() }));
  }
  get _fog() {
    const e59 = this._get("_fog");
    if (!this.weatherEnabled || t(this._context))
      return l(e59), null;
    if (r(e59))
      return e59;
    const t60 = this.view, s63 = this._context;
    return l(e59), new v16({ context: s63, view: t60 });
  }
  get weatherEnabled() {
    var _a, _b;
    return !!((_b = (_a = this.view) == null ? void 0 : _a.environmentManager) == null ? void 0 : _b.weatherEnabled);
  }
  get _precipitationEnabled() {
    return this.weatherEnabled && ("rainy" === this.view.environment.weather.type || "snowy" === this.view.environment.weather.type);
  }
  initializeRenderContext(e59 = null) {
    this._context = e59, this._handles.add([f4(() => {
      var _a;
      return (_a = this.view) == null ? void 0 : _a.basemapTerrain;
    }, () => this._updateBasemapTerrain(), w2), l6(() => ({ viewingMode: this.view.viewingMode, atmosphereEnabled: this.view.environment.atmosphereEnabled, atmosphereQuality: this.view.environment.atmosphere.quality }), () => this._updateAtmosphere(), w2), l6(() => this._stars, () => this._setNeedsRender()), l6(() => this._clouds, () => this._updateWeather(this._weatherUpdateParameters), h3), l6(() => this._precipitation, () => this._setNeedsRender()), l6(() => this._fog, () => this._updateFog(this._weatherUpdateParameters), h3), l6(() => this._weatherUpdateParameters, (e60) => {
      this._updateWeather(e60), this._updateFog(e60);
    }, w2)]);
  }
  uninitializeRenderContext() {
    this._context = null, this._atmosphere = l(this._atmosphere), this._set("_stars", l(this._stars)), this._set("_precipitation", l(this._precipitation)), this._set("_clouds", l(this._clouds)), this._set("_cloudsComposition", l(this._cloudsComposition)), this._set("_fog", l(this._fog));
  }
  prepareRender(e59) {
    e59.bindParameters.clouds.data = n46(this._clouds) ? this._clouds : null;
  }
  render(e59) {
    if (e59.pass === A12.MATERIAL)
      switch (e59.bindParameters.slot) {
        case E9.POSTPROCESSING_ENVIRONMENT_OPAQUE:
          r(this._stars) && this._stars.render(e59), r(this._atmosphere) && this._atmosphere.canRender && (this._atmosphere.render(e59), r(this._cloudsComposition) && r(e59.bindParameters.clouds.data) && (this.weatherVisible && r(this._clouds) && this._clouds.ensureWeatherTile(), this._cloudsComposition.render(e59, r(this.view.animation))));
          break;
        case E9.POSTPROCESSING_ENVIRONMENT_TRANSPARENT:
          if (r(this._atmosphere) && this._atmosphere.canRender) {
            const t60 = this.weatherEnabled ? this.view.environment.weather.type : "disabled";
            if (this._atmosphere.renderHaze(e59, "rainy" === t60), r(this._fog)) {
              const s63 = "foggy" === t60 || "rainy" === t60 || "snowy" === t60;
              (s63 || "realistic" !== this._selectAtmosphereType()) && this._fog.render(e59, s63, "rainy" === t60);
            }
            if (r(this._precipitation)) {
              const t61 = this.view.environment.weather;
              "rainy" !== t61.type && "snowy" !== t61.type || this._precipitation.render(e59, t61.precipitation, t61.type);
            }
          }
      }
  }
  get _weatherUpdateParameters() {
    const e59 = this.weatherEnabled ? this.view.environment.weather : null;
    return t(e59) ? null : "rainy" === e59.type || "snowy" === e59.type ? { type: e59.type, weatherAdjustment: e59.cloudCover, effect: e59.precipitation } : { type: e59.type, weatherAdjustment: "foggy" === e59.type ? e59.fogStrength : e59.cloudCover };
  }
  _updateWeather(e59) {
    t(e59) || t(this._clouds) || (this._clouds.applyPreset(t42[e59.type], e59.weatherAdjustment), this._setNeedsRender());
  }
  _setNeedsRender() {
    r(this._context) && this._context.requestRender();
  }
  _updateFog(e59) {
    if (!t(this._fog) && !t(e59))
      switch (e59.type) {
        case "foggy":
          this._fog.strength = s10(3e-5, 5e-3, e59.weatherAdjustment ** 3), this._setNeedsRender();
          break;
        case "rainy":
        case "snowy":
          this._fog.strength = s10(4e-6, 2e-4, e59.effect ** 3), this._setNeedsRender();
          break;
        default:
          this._fog.strength = 4e-6, this._setNeedsRender();
      }
  }
  _updateAtmosphere() {
    const e59 = this._selectAtmosphereType();
    if (this.atmosphereType === e59)
      return;
    r(this._pendingAtmosphere) && (this._pendingAtmosphere !== this._atmosphere && this._pendingAtmosphere.destroy(), this._pendingAtmosphere = null);
    const t60 = this._getAtmosphereClass();
    if (!t60)
      return r(this._atmosphere) && (this._atmosphere.destroy(), this._atmosphere = null, this._setNeedsRender()), void this._updateBasemapTerrain();
    const s63 = new t60(this.view);
    r(this._context) && s63.initializeRenderContext(this._context), t(this._atmosphere) && (this._atmosphere = s63, this._setNeedsRender()), this._pendingAtmosphere = s63, s63.when().then(() => {
      r(this._atmosphere) && this._pendingAtmosphere && this._pendingAtmosphere !== this._atmosphere && (this._atmosphere.destroy(), this._atmosphere = this._pendingAtmosphere), this._pendingAtmosphere = null, this._setNeedsRender(), this._updateBasemapTerrain();
    }).catch(() => {
      this._pendingAtmosphere === s63 && (this._pendingAtmosphere = null);
    });
  }
  _getAtmosphereClass() {
    switch (this._selectAtmosphereType()) {
      case "none":
        return null;
      case "realistic":
        return C8;
      case "panoramic":
        return R8;
      case "simple":
        return se;
      default:
        return;
    }
  }
  _selectAtmosphereType() {
    const e59 = this.view.get("environment.atmosphereEnabled"), t60 = this.view.get("environment.atmosphere.quality"), s63 = this.view.viewingMode;
    return !e59 || null == t60 || s5(this.view.spatialReference) ? "none" : "local" === s63 ? "panoramic" : "high" === t60 && r(this._context) && C8.isSupported(this._context) && A3(this.view.spatialReference) ? "realistic" : "simple";
  }
  _updateBasemapTerrain() {
    this.view.basemapTerrain && (this.view.basemapTerrain.velvetOverground = r(this._atmosphere) && "simple" === this.atmosphereType);
  }
  get test() {
    return { atmosphere: this._atmosphere, clouds: this._clouds, selectAtmosphereType: () => this._selectAtmosphereType(), stubGetAtmosphereClass: (e59) => {
      S10 = P8.prototype._getAtmosphereClass, P8.prototype._getAtmosphereClass = e59;
    }, restoreGetAtmosphereClass: () => {
      P8.prototype._getAtmosphereClass = S10;
    } };
  }
};
e([d({ constructOnly: true })], M9.prototype, "view", void 0), e([d({ type: Boolean, readOnly: true })], M9.prototype, "updating", null), e([d({ readOnly: true })], M9.prototype, "weatherVisible", null), e([d()], M9.prototype, "_context", void 0), e([d()], M9.prototype, "_pendingAtmosphere", void 0), e([d({ readOnly: true })], M9.prototype, "_stars", null), e([d({ readOnly: true })], M9.prototype, "_precipitation", null), e([d({ readOnly: true })], M9.prototype, "_clouds", null), e([d({ readOnly: true })], M9.prototype, "_cloudsComposition", null), e([d({ readOnly: true })], M9.prototype, "_fog", null), e([d({ readOnly: true })], M9.prototype, "weatherEnabled", null), e([d({ readOnly: true })], M9.prototype, "_precipitationEnabled", null), e([d({ readOnly: true })], M9.prototype, "_weatherUpdateParameters", null), M9 = P8 = e([n6("esri.views.3d.environment.EnvironmentRenderer")], M9);

// node_modules/@arcgis/core/views/3d/support/earthUtils.js
function s42(t60, n73, o61) {
  return u30(t60, n73.longitude, n73.latitude, o61.longitude, o61.latitude);
}
function u30(t60, r59, e59, s63, u51) {
  const i66 = M4(e59), c67 = M4(u51), a58 = i66 - c67, h44 = M4(r59) - M4(s63), d32 = Math.sin(a58 / 2), f37 = Math.sin(h44 / 2), m40 = 2 * b2(Math.sqrt(d32 * d32 + Math.cos(i66) * Math.cos(c67) * f37 * f37)) * t60;
  return Math.round(1e4 * m40) / 1e4;
}
function i42(t60, n73, o61) {
  const u51 = n73.spatialReference, i66 = p3(u51), c67 = new j(n73.x, t60.y, u51), a58 = new j(o61.x, t60.y, u51), h44 = new j(t60.x, n73.y, u51), d32 = new j(t60.x, o61.y, u51);
  return { lon: s42(i66.radius, c67, a58), lat: s42(i66.radius, h44, d32) };
}
function c44(r59, e59, s63) {
  const u51 = e59 / s63, i66 = M4(r59), c67 = Math.sin(u51 / 2), a58 = Math.cos(i66), h44 = 2 * b2(Math.sqrt(c67 * c67 / (a58 * a58)));
  return m4(h44);
}
function d17(t60, n73) {
  let o61 = t60 / 15;
  return n73 || (o61 = Math.round(o61)), o61;
}
function m20(t60, n73) {
  n73 || (n73 = { hours: 0, minutes: 0, seconds: 0 }), n73.hours = d17(t60[0], true);
  const o61 = n73.hours % 1;
  n73.hours -= o61, n73.minutes = 60 * o61;
  const r59 = n73.minutes % 1;
  return n73.minutes -= r59, n73.seconds = Math.round(60 * r59), n73;
}

// node_modules/@arcgis/core/chunks/SunCalc.js
var n47;
var t43;
var r41;
var e33 = { exports: {} };
n47 = e33, t43 = function() {
  var n73 = Math.PI, t60 = Math.sin, r59 = Math.cos, e59 = Math.tan, o61 = Math.asin, u51 = Math.atan2, a58 = Math.acos, i66 = n73 / 180, c67 = 864e5, f37 = 2440588, d32 = 2451545, s63 = { dec: 0, ra: 0 };
  function v36(n74) {
    return n74.valueOf() / c67 - 0.5 + f37;
  }
  function M22(n74) {
    return new Date((n74 + 0.5 - f37) * c67);
  }
  function p52(n74) {
    return v36(n74) - d32;
  }
  var h44 = 23.4397 * i66;
  function l48(n74, o62) {
    return u51(t60(n74) * r59(h44) - e59(o62) * t60(h44), r59(n74));
  }
  function x30(n74, e60) {
    return o61(t60(e60) * r59(h44) + r59(e60) * t60(h44) * t60(n74));
  }
  function N23(n74, o62, a59) {
    return u51(t60(n74), r59(n74) * t60(o62) - e59(a59) * r59(o62));
  }
  function P22(n74, e60, u52) {
    return o61(t60(e60) * t60(u52) + r59(e60) * r59(u52) * r59(n74));
  }
  function E39(n74, t61) {
    return i66 * (280.16 + 360.9856235 * n74) - t61;
  }
  function I27(n74) {
    return i66 * (357.5291 + 0.98560028 * n74);
  }
  function O33(n74) {
    return i66 * (1.9148 * t60(n74) + 0.02 * t60(2 * n74) + 3e-4 * t60(3 * n74));
  }
  function T29(t61, r60) {
    return t61 + r60 + 102.9372 * i66 + n73;
  }
  function g45(n74, t61) {
    var r60 = I27(n74), e60 = T29(r60, O33(r60));
    return t61 || (t61 = { dec: 0, ra: 0 }), t61.dec = x30(e60, 0), t61.ra = l48(e60, 0), t61;
  }
  var m40 = { PolarException: { NORMAL: 0, MIDNIGHT_SUN: 1, POLAR_NIGHT: 2 }, getPosition: function(n74, t61, r60, e60) {
    var o62 = i66 * -r60, u52 = i66 * t61, a59 = p52(n74), c68 = g45(a59, s63), f38 = E39(a59, o62) - c68.ra;
    return e60 || (e60 = { azimuth: 0, altitude: 0 }), e60.azimuth = N23(f38, u52, c68.dec), e60.altitude = P22(f38, u52, c68.dec), e60;
  } }, A39 = [[-0.83, "sunrise", "sunset"]];
  m40.addTime = function(n74, t61, r60) {
    A39.push([n74, t61, r60]);
  };
  var L31 = 9e-4;
  function R21(t61, r60) {
    return Math.round(t61 - L31 - r60 / (2 * n73));
  }
  function G21(t61, r60, e60) {
    return L31 + (t61 + r60) / (2 * n73) + e60;
  }
  function H20(n74, r60, e60) {
    return d32 + n74 + 53e-4 * t60(r60) - 69e-4 * t60(2 * e60);
  }
  function _30(n74, e60, o62) {
    return a58((t60(n74) - t60(e60) * t60(o62)) / (r59(e60) * r59(o62)));
  }
  function z20(n74) {
    var e60 = i66 * (134.963 + 13.064993 * n74), o62 = i66 * (93.272 + 13.22935 * n74), u52 = i66 * (218.316 + 13.176396 * n74) + 6.289 * i66 * t60(e60), a59 = 5.128 * i66 * t60(o62), c68 = 385001 - 20905 * r59(e60);
    return { ra: l48(u52, a59), dec: x30(u52, a59), dist: c68 };
  }
  return m40.getTimes = function(n74, e60, o62) {
    var u52 = i66 * -o62, a59 = i66 * e60, c68 = R21(p52(n74), u52), f38 = G21(0, u52, c68), d33 = I27(f38), s64 = O33(d33), v37 = T29(d33, s64), h45 = x30(v37, 0), l49 = H20(f38, d33, v37);
    function N24(n75) {
      return H20(G21(_30(n75, a59, h45), u52, c68), d33, v37);
    }
    function P23(n75) {
      var e61 = (t60(n75) - t60(a59) * t60(h45)) / (r59(a59) * r59(h45));
      return e61 < -1 ? m40.PolarException.MIDNIGHT_SUN : e61 > 1 ? m40.PolarException.POLAR_NIGHT : m40.PolarException.NORMAL;
    }
    var E40, g46, L32, z21, D21, S25 = { solarNoon: M22(l49), nadir: M22(l49 - 0.5), polarException: m40.PolarException.NORMAL };
    for (E40 = 0, g46 = A39.length; E40 < g46; E40 += 1)
      D21 = l49 - ((z21 = N24((L32 = A39[E40])[0] * i66)) - l49), S25[L32[1]] = M22(D21), S25[L32[2]] = M22(z21);
    return S25.polarException = P23(A39[0][0] * i66), S25;
  }, m40.getMoonPosition = function(n74, t61, r60) {
    var o62 = i66 * -r60, u52 = i66 * t61, a59 = p52(n74), c68 = z20(a59), f38 = E39(a59, o62) - c68.ra, d33 = P22(f38, u52, c68.dec);
    return d33 += 0.017 * i66 / e59(d33 + 10.26 * i66 / (d33 + 5.1 * i66)), { azimuth: N23(f38, u52, c68.dec), altitude: d33, distance: c68.dist };
  }, m40.getMoonFraction = function(n74) {
    var e60 = p52(n74), o62 = g45(e60), i67 = z20(e60), c68 = 149598e3, f38 = a58(t60(o62.dec) * t60(i67.dec) + r59(o62.dec) * r59(i67.dec) * r59(o62.ra - i67.ra)), d33 = u51(c68 * t60(f38), i67.dist - c68 * r59(f38));
    return (1 + r59(d33)) / 2;
  }, m40;
}, void 0 !== (r41 = t43()) && (n47.exports = r41);
var o39 = e33.exports;

// node_modules/@arcgis/core/views/3d/support/sunUtils.js
var w12 = { local: { altitude: 1500, ambientAtNight: 0.1, ambientAtNoon: 0.45, ambientAtTwilight: 0.2, directAtNoon: 0.65, directAtTwilight: 0.7 }, global: { altitude: 8e5, ambient: 0.015, direct: 0.75 }, planarDirection: { localAltitude: 1e4, globalAltitude: 1e6, globalAngles: { azimuth: 1.3 * Math.PI, altitude: 0.6 * Math.PI } } };
function N7(i66, n73, o61, a58, r59, l48, u51) {
  o3(u51.ambient.color, 1, 1, 1), u51.ambient.intensity = w12.global.ambient, o3(u51.direct.color, 1, 1, 1), u51.direct.intensity = w12.global.direct;
  const m40 = n73[2], d32 = o4((Math.abs(m40) - w12.local.altitude) / (w12.global.altitude - w12.local.altitude), 0, 1);
  let g45;
  if (u51.globalFactor = d32, "sun" === l48 && (g45 = o39.getTimes(i66, n73[1], n73[0])), d32 < 1) {
    let e59;
    if ("sun" === l48)
      e59 = I12(i66, g45, a58);
    else {
      const t60 = D9(a58);
      e59 = { direct: { intensity: w12.local.directAtNoon * t60.direct, color: r6(1, 1, 1) }, ambient: { intensity: w12.local.ambientAtNoon * t60.ambient, color: r6(1, 1, 1) }, timeOfDay: "early afternoon" };
    }
    A4(u51.ambient.color, e59.ambient.color, u51.ambient.color, d32), u51.ambient.intensity = s10(e59.ambient.intensity, u51.ambient.intensity, d32), A4(u51.direct.color, e59.direct.color, u51.direct.color, d32), u51.direct.intensity = s10(e59.direct.intensity, u51.direct.intensity, d32), u51.specularStrength = "rainy" === a58 || "snowy" === a58 || "foggy" === a58 ? 0 : 1, u51.environmentStrength = "rainy" === a58 ? 0.7 : "snowy" === a58 || "foggy" === a58 ? 0.75 : 1;
  }
  u51.noonFactor = "sun" === l48 ? j16(i66, g45) : 1, "sun" === l48 ? M10(i66, n73, o61, u51.direct.directionToLightSource) : T13(r59, o61, u51.direct.directionToLightSource);
}
function T13(t60, e59, n73) {
  e59 === l13.Global ? z2(F7, t60.eye) : o3(F7, 0, 0, 1), q(L12, t60.viewForward, -1);
  const o61 = x4(L12, F7), a58 = Math.max(o61 - 2 * U16, 0), r59 = 0.85 * a58 / (a58 + 1), l48 = Math.max(U16, o61 - U16 - r59);
  p7(k12, -l48, t60.viewRight), L2(n73, L12, k12), u3(n73, n73, q(R10, t60.viewRight, _9)), z2(n73, n73);
}
function M10(t60, i66, l48, s63) {
  const u51 = z6, m40 = r11(P9);
  if (l48 === l13.Global)
    o39.getPosition(t60, 0, 0, u51), o3(s63, 0, 0, -1), b3(m40, m40, -u51.azimuth), l8(m40, m40, -u51.altitude), L2(s63, s63, m40);
  else {
    const n73 = w12.planarDirection, a58 = n73.globalAngles, l49 = i66[2];
    let g45 = (Math.abs(l49) - n73.localAltitude) / (n73.globalAltitude - n73.localAltitude);
    g45 = o4(g45, 0, 1), g45 < 1 ? (o39.getPosition(t60, i66[1], i66[0], u51), u51.azimuth = (1 - g45) * u51.azimuth + g45 * a58.azimuth, u51.altitude = (1 - g45) * u51.altitude + g45 * a58.altitude) : (u51.azimuth = a58.azimuth, u51.altitude = a58.altitude), o3(s63, 0, -1, 0), m5(m40, m40, -u51.azimuth), b3(m40, m40, -u51.altitude), L2(s63, s63, m40);
  }
}
function v17(t60, e59) {
  if (e59 === l13.Global)
    return true;
  const i66 = w12.planarDirection;
  return Math.abs(t60) < i66.localAltitude;
}
var S11 = r6(0.5773502691896258, -0.5773502691896258, 0.5773502691896258);
var O14 = class {
  constructor() {
    this.ambient = { color: r6(1, 1, 1), intensity: 0.55 }, this.direct = { color: r6(1, 1, 1), intensity: 0.55, directionToLightSource: t5(S11) }, this.noonFactor = 0.5, this.globalFactor = 0, this.specularStrength = 1, this.environmentStrength = 1;
  }
};
var P9 = e12();
var z6 = { azimuth: 0, altitude: 0 };
function j16(t60, i66) {
  const n73 = t60.valueOf();
  let o61, a58;
  i66.polarException === o39.PolarException.MIDNIGHT_SUN ? (o61 = n73 - 60 * (t60.getHours() + 48) * 60 * 1e3 - 60 * t60.getMinutes() * 1e3, a58 = o61 + 432e6) : i66.polarException === o39.PolarException.POLAR_NIGHT ? (o61 = n73 - 2, a58 = n73 - 1) : (o61 = i66.sunrise.valueOf(), a58 = i66.sunset.valueOf());
  const r59 = o61 + (a58 - o61) / 2;
  return 1 - o4(Math.abs(n73 - r59) / 432e5, 0, 1);
}
function D9(t60) {
  switch (t60) {
    case "disabled":
    case "sunny":
    case "cloudy":
      return { direct: 1, ambient: 1 };
    case "rainy":
      return { direct: 0.4, ambient: 1.2 };
    case "snowy":
      return { direct: 0.5, ambient: 1.3 };
    case "foggy":
      return { direct: 0.2, ambient: 1.6 };
  }
}
function E17(t60, e59) {
  const i66 = (t60[0] + t60[1] + t60[2]) / 3;
  for (let n73 = 0; n73 < 3; n73++)
    t60[n73] = t60[n73] + (i66 - t60[n73]) * e59;
  return t60;
}
function I12(t60, e59, i66) {
  const n73 = t60.valueOf();
  let o61, a58;
  e59.polarException === o39.PolarException.MIDNIGHT_SUN ? (o61 = n73 - 60 * (t60.getHours() + 48) * 60 * 1e3 - 60 * t60.getMinutes() * 1e3, a58 = o61 + 432e6) : e59.polarException === o39.PolarException.POLAR_NIGHT ? (o61 = n73 - 2, a58 = n73 - 1) : (o61 = e59.sunrise.valueOf(), a58 = e59.sunset.valueOf());
  const r59 = a58 - o61, l48 = o61 + r59 / 2, c67 = r59 / 4, s63 = l48 - c67, u51 = l48 + c67, m40 = 0.06 * r59, d32 = o61 - m40 / 2, g45 = o61 + m40 / 2, b23 = a58 - m40 / 2, f37 = a58 + m40 / 2, y33 = w12.local, A39 = [0.01, y33.ambientAtNight], N23 = [0.8, 0.8, 1], T29 = [0.01, 0.01, 0.01], M22 = [y33.directAtTwilight, y33.ambientAtTwilight], v36 = [1, 0.6, 0.5], x30 = [0.8, 0.8, 1], S25 = [0.9 * y33.directAtNoon, y33.ambientAtNoon], O33 = [1, 0.98, 0.98], P22 = [0.98, 0.98, 1], z20 = [y33.directAtNoon, y33.ambientAtNoon], j36 = [1, 1, 1], I27 = [1, 1, 1], H20 = S25, k32 = O33, F21 = P22, L31 = M22, R21 = v36, U26 = x30;
  let _30, C25, V17 = [0, 0], q18 = [0, 0, 0], B18 = [0, 0, 0];
  n73 < d32 || n73 > f37 ? (V17 = A39, q18 = T29, B18 = N23, C25 = "night") : n73 < g45 ? (_30 = g45 - d32, V17 = G11(n73 - d32, _30, A39, M22), q18 = G11(n73 - d32, _30, T29, v36), B18 = G11(n73 - d32, _30, N23, x30), C25 = "sun rising") : n73 < s63 ? (_30 = s63 - g45, V17 = G11(n73 - g45, _30, M22, S25), q18 = G11(n73 - g45, _30, v36, O33), B18 = G11(n73 - g45, _30, x30, P22), C25 = "early morning") : n73 < l48 ? (_30 = l48 - s63, V17 = G11(n73 - s63, _30, S25, z20), q18 = G11(n73 - s63, _30, O33, j36), B18 = G11(n73 - s63, _30, P22, I27), C25 = "late morning") : n73 < u51 ? (_30 = u51 - l48, V17 = G11(n73 - l48, _30, z20, H20), q18 = G11(n73 - l48, _30, j36, k32), B18 = G11(n73 - l48, _30, I27, F21), C25 = "early afternoon") : n73 < b23 ? (_30 = b23 - u51, V17 = G11(n73 - u51, _30, H20, L31), q18 = G11(n73 - u51, _30, k32, R21), B18 = G11(n73 - u51, _30, F21, U26), C25 = "late afternoon") : n73 < f37 && (_30 = f37 - b23, V17 = G11(n73 - b23, _30, L31, A39), q18 = G11(n73 - b23, _30, R21, T29), B18 = G11(n73 - b23, _30, U26, N23), C25 = "sun setting");
  let J13 = 0;
  switch (i66) {
    case "rainy":
    case "foggy":
      J13 = 0.9;
    case "snowy":
      J13 = 0.5;
  }
  J13 > 0 && (q18 = E17(q18, J13), B18 = E17(B18, J13));
  const K13 = r6(q18[0], q18[1], q18[2]), Q15 = r6(B18[0], B18[1], B18[2]), W16 = D9(i66);
  return { direct: { intensity: V17[0] * W16.direct, color: K13 }, ambient: { intensity: V17[1] * W16.ambient, color: Q15 }, timeOfDay: C25 };
}
function G11(t60, e59, i66, n73) {
  const o61 = [];
  for (let a58 = 0; a58 < i66.length; a58++)
    o61[a58] = (n73[a58] - i66[a58]) * t60 / e59 + i66[a58];
  return o61;
}
var k12 = e12();
var F7 = n7();
var L12 = n7();
var R10 = n7();
var U16 = 0.25;
var _9 = 0.2;

// node_modules/@arcgis/core/views/3d/environment/SceneViewEnvironmentManager.js
var L13 = class extends n8.EventedAccessor {
  constructor() {
    super(), this._referencePointUpdateDelay = 200, this._referencePointUpdateInterval = 3e3, this._referencePointUpdateDistThreshold = 1e6, this._referencePosUpdateQuery = null, this._referencePosMapCoordsRequested = null, this._viewHandles = new u4(), this._preserveAbsoluteDateTime = false, this._trackingEnabled = false, this._referencePosResetPreserveAbsoluteTime = false, this._referencePosUpdateTimer = null, this._referencePosMapCoords = null, this._mainLight = new n24(), this._ambientLight = new i11(), this._moonLight = new c14(), this.disableQueries = false, this._disableWeather = false, this._renderer = null, this._referencePosWGS84Comparable = null, this._resetReferencePosition();
  }
  destroy() {
    this.disconnectView(), this._viewHandles.destroy();
  }
  get _view() {
    var _a;
    return (_a = this._renderer) == null ? void 0 : _a.view;
  }
  get updating() {
    var _a;
    return !((this.disableQueries || !this._referencePosUpdateQuery && !this._referencePosMapCoordsRequested) && !((_a = this._renderer) == null ? void 0 : _a.updating));
  }
  get weatherEnabled() {
    var _a, _b, _c;
    return ((_a = this._view) == null ? void 0 : _a.environment.atmosphereEnabled) && !this._disableWeather && ((_c = (_b = this._view) == null ? void 0 : _b.state) == null ? void 0 : _c.viewingMode) === l13.Global && A3(this._view.spatialReference);
  }
  get weatherVisible() {
    var _a;
    return this.weatherEnabled && ((_a = this._renderer) == null ? void 0 : _a.weatherVisible);
  }
  get referencePositionWGS84Comparable() {
    return this._referencePosWGS84Comparable;
  }
  connectView(e59) {
    if (this._renderer)
      return;
    this._renderer = new M9({ view: e59 });
    const t60 = () => this._updateRenderParameters(), r59 = () => this._cameraHandler(), i66 = () => this._updateLighting();
    this._viewHandles.add([l6(() => e59.environment.lighting, (e60) => this._updateLightingHandler(e60), U3), l6(() => "sun" === e59.environment.lighting.type ? e59.environment.lighting.date : null, (e60) => this._lightingDateHandler(e60), U3), l6(() => e59.stationary, () => this._interactingStationaryHandler()), l6(() => e59.environment.lighting.directShadowsEnabled, t60, U3), l6(() => e59.environment.lighting.ambientOcclusionEnabled, t60, U3), l6(() => e59.environment.lighting.waterReflectionEnabled, t60, U3), l6(() => {
      var _a;
      return (_a = e59.environment.background) == null ? void 0 : _a.color;
    }, t60, U3), l6(() => e59.spatialReference, () => this._resetReferencePosition(true), U3), l6(() => e59.environment.weather.type, i66, U3), l6(() => this.weatherEnabled, i66, U3), l6(() => e59.viewingMode, () => this._resetReferencePosition(true), w2), l6(() => "sun" === e59.environment.lighting.type && e59.environment.lighting.cameraTrackingEnabled, (e60) => this._updateCameraTracking(e60), w2), l6(() => e59.state.camera, r59, w2), l6(() => this.disableQueries, r59)]), this._updateRenderParameters(), this._updateLighting(), this._cameraHandler(), this.notifyChange("updating");
  }
  disconnectView() {
    this._viewHandles.removeAll(), this._resetReferencePosition(), this._renderer = l(this._renderer);
  }
  _updateLightingHandler(e59) {
    this._updateCameraTracking("sun" === e59.type && e59.cameraTrackingEnabled), this._lightingDateHandler("sun" === e59.type ? e59.date : null), this._updateRenderParameters();
  }
  _updateCameraTracking(e59) {
    if (this._trackingEnabled = e59, e59)
      this._cameraHandler();
    else {
      const e60 = this._view.environment.lighting;
      "sun" === (e60 == null ? void 0 : e60.type) && (e60.positionTimezoneInfo.autoUpdated = false);
    }
  }
  _lightingDateHandler(e59) {
    const t60 = this._view.environment.lighting;
    if ("virtual" !== (t60 == null ? void 0 : t60.type)) {
      if (e59) {
        if (!t60.positionTimezoneInfo.autoUpdated) {
          this._preserveAbsoluteDateTime = true;
          const r59 = this._view.spatialReference;
          if (!Ce(r59)) {
            const e60 = this._view.camera.position;
            if (!this._referencePosMapCoords || !this._referencePosMapCoords.equals(e60))
              return void this._requestReferencePositionUpdate(e60);
          }
          if (this._preupdateTracking(e59), r(this._referencePosWGS84Comparable)) {
            const e60 = m20(this._referencePosWGS84Comparable, A25);
            r(e60) && (t60.autoUpdate(null, e60), this._trackingEnabled && (t60.positionTimezoneInfo.autoUpdated = true));
          }
        }
        this._updateLighting(e59);
      }
    } else
      this._updateLighting();
  }
  _preupdateTracking(e59) {
    !this._trackingEnabled && "sun" === this._view.environment.lighting.type && this._view.environment.lighting.cameraTrackingEnabled && this._cameraHandler(e59);
  }
  _cameraHandler(e59 = null) {
    const t60 = this._view;
    if (!t60.ready)
      return;
    const r59 = t60.stateManager.camera;
    r59 && (this._cameraHandlerClientSide(r59, e59) || this._cameraHandlerServerSide(r59));
  }
  _cameraHandlerClientSide(e59, t60) {
    const r59 = A3(this._view.spatialReference);
    if (r59 && !Ce(this._view.spatialReference))
      return false;
    const i66 = e59.position;
    return t(this._referencePosWGS84Comparable) && (this._referencePosWGS84Comparable = n7()), r59 ? jn(i66, this._referencePosWGS84Comparable) : o3(this._referencePosWGS84Comparable, i66.longitude, i66.latitude, i66.z), this.notifyChange("referencePositionWGS84Comparable"), this._autoUpdateTimezone(this._referencePosWGS84Comparable, t60) || this._updateLighting(t60), true;
  }
  _cameraHandlerServerSide(e59) {
    const t60 = e59.position;
    (!this._referencePosMapCoords || this._referencePosMapCoordsRequested || this._exceedsReferencePosDistThreshold(t60)) && this._requestReferencePositionUpdate(t60, true), this._view.mapCoordsHelper && this._referencePosWGS84Comparable && (this._referencePosWGS84Comparable[2] = t60.z * this._view.mapCoordsHelper.unitInMeters, this._referencePosChanged());
  }
  _interactingStationaryHandler() {
    this._view.stationary && this._executePendingReferencePositionUpdate();
  }
  _updateLighting(e59) {
    const t60 = this._view, r59 = e59 || ("sun" === t60.environment.lighting.type ? t60.environment.lighting.date : null), i66 = this._referencePosWGS84Comparable, s63 = r(i66) ? Q6 : D10;
    if (r(i66)) {
      const e60 = this.weatherVisible ? t60.environment.weather.type : "disabled";
      N7(r59, i66, t60.state.viewingMode, e60, t60.state.camera, t60.environment.lighting.type, s63);
    }
    const o61 = this._mainLight, a58 = s63.direct;
    q(o61.intensity, a58.color, a58.intensity * Math.PI), r7(o61.direction, a58.directionToLightSource), o61.specularStrength = s63.specularStrength, o61.environmentStrength = s63.environmentStrength;
    const h44 = this._ambientLight;
    q(h44.intensity, s63.ambient.color, s63.ambient.intensity);
    const c67 = this._moonLight;
    A4(c67.intensity, V7, I13, s63.globalFactor);
    const d32 = (1 - 0.5 * s63.globalFactor) * (1 - 0.4 * s63.noonFactor * (1 - s63.globalFactor));
    q(c67.intensity, c67.intensity, d32), r7(c67.direction, a58.directionToLightSource), t60._stage.renderView.updateLightSources([o61, h44, c67], 1 - s63.noonFactor, s63.globalFactor), this._updateRenderParameters();
  }
  _autoUpdateTimezone(e59, t60 = null) {
    if ("virtual" === this._view.environment.lighting.type || !this._view.environment.lighting.cameraTrackingEnabled || t(e59))
      return false;
    const r59 = q6;
    r59.setTime((t60 || this._view.environment.lighting.date).getTime());
    const i66 = m20(e59, A25);
    if (t(i66))
      return false;
    let s63 = this._view.environment.lighting.positionTimezoneInfo;
    if (s63.autoUpdated) {
      if (s63.hours === i66.hours && s63.minutes === i66.minutes && s63.seconds === i66.seconds)
        return false;
    } else
      s63 = i66;
    const n73 = r59.getUTCHours() - (i66.hours - s63.hours), a58 = r59.getUTCMinutes() - (i66.minutes - s63.minutes), h44 = r59.getUTCSeconds() - (i66.seconds - s63.seconds);
    return r59.setUTCHours(n73), r59.setUTCMinutes(a58), r59.setUTCSeconds(h44), !t60 && this._view.environment.lighting.autoUpdate(r59, i66);
  }
  _updateRenderParameters() {
    const e59 = this._view._stage;
    if (!e59)
      return;
    const r59 = E(this._referencePosWGS84Comparable, true, (e60) => v17(e60[2], this._view.state.viewingMode)), i66 = this._view.environment.background, s63 = i66 instanceof n43 ? { type: "color", color: e9(l5.toUnitRGBA(i66.color)) } : { type: "color", color: r10(0, 0, 0, 1) };
    e59.renderView.setRenderParameters({ shadowMap: this._view.environment.lighting.directShadowsEnabled && r59, background: s63, environment: this._view.environment, weatherVisible: this._view.environmentManager.weatherVisible });
  }
  _resetReferencePosition(e59 = false) {
    this._cancelReferencePosUpdates(), this._referencePosMapCoords = null, this._referencePosMapCoordsRequested = null, this._referencePosResetPreserveAbsoluteTime = null, this._referencePosWGS84Comparable = null, this.notifyChange("updating"), e59 && this._cameraHandler();
  }
  _requestReferencePositionUpdate(e59, t60 = false) {
    if (!this.disableQueries && (this._referencePosMapCoordsRequested ? this._referencePosMapCoordsRequested.copy(e59) : this._referencePosMapCoordsRequested = e59.clone(), this._referencePosResetPreserveAbsoluteTime = !!t60, !this._referencePosUpdateQuery && !this._referencePosUpdateTimer && this._view.stationary)) {
      const e60 = this._referencePosUpdateQuery = L(this._referencePointUpdateDelay).then(() => {
        if (this._referencePosUpdateQuery === e60) {
          const t62 = () => this._referencePosUpdateQuery !== e60;
          return this._doReferencePositionUpdateQuery(t62);
        }
      }).catch((e61) => {
        "mapcoordshelper:missing-geometry-service" === e61.name && (this.disableQueries = true);
      }).then(() => {
        this._referencePosUpdateQuery === e60 && (this._referencePosUpdateQuery = null, this._referencePosUpdateTimer || this._executePendingReferencePositionUpdate(), this.notifyChange("updating"));
      }), t61 = this._referencePosUpdateTimer = L(this._referencePointUpdateInterval).then(() => {
        this._referencePosUpdateTimer === t61 && (this._referencePosUpdateTimer = null, this._referencePosUpdateQuery || this._executePendingReferencePositionUpdate());
      });
      this.notifyChange("updating");
    }
  }
  async _doReferencePositionUpdateQuery(e59) {
    this._referencePosResetPreserveAbsoluteTime && (this._preserveAbsoluteDateTime = false), this._referencePosMapCoords ? this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested) : this._referencePosMapCoords = this._referencePosMapCoordsRequested.clone(), this._referencePosResetPreserveAbsoluteTime = null, this._referencePosMapCoordsRequested = null;
    const t60 = await this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);
    if (!e59() && !isNaN(t60[0]) && !isNaN(t60[1])) {
      const e60 = this._referencePosMapCoords.z * this._view.mapCoordsHelper.unitInMeters;
      this._referencePosWGS84Comparable ? (this._referencePosWGS84Comparable[0] = t60[0], this._referencePosWGS84Comparable[1] = t60[1], this._referencePosWGS84Comparable[2] = e60) : this._referencePosWGS84Comparable = [t60[0], t60[1], e60], this._referencePosChanged();
    }
  }
  _executePendingReferencePositionUpdate() {
    const e59 = this._referencePosMapCoordsRequested;
    e59 && this._requestReferencePositionUpdate(e59, this._referencePosResetPreserveAbsoluteTime);
  }
  _referencePosChanged() {
    this._preserveAbsoluteDateTime ? this._updateLighting() : this._autoUpdateTimezone(this._referencePosWGS84Comparable) || this._updateLighting(), this.notifyChange("referencePositionWGS84Comparable");
  }
  _exceedsReferencePosDistThreshold(e59) {
    if (this._referencePosMapCoords) {
      let t60 = this._referencePosMapCoords.distance(e59);
      return this._view.mapCoordsHelper && (t60 *= this._view.mapCoordsHelper.unitInMeters), t60 > this._referencePointUpdateDistThreshold;
    }
    return true;
  }
  _cancelReferencePosUpdates() {
    const e59 = !!this._referencePosUpdateQuery;
    return this._referencePosUpdateQuery = null, this._referencePosUpdateTimer = null, e59;
  }
  get test() {
    const e59 = this;
    return { get renderer() {
      return e59._renderer;
    }, set referencePointUpdateInterval(t60) {
      e59._referencePointUpdateInterval = t60;
    }, set referencePointUpdateDistThreshold(t60) {
      e59._referencePointUpdateDistThreshold = t60;
    }, set referencePosUpdateTimer(t60) {
      e59._referencePosUpdateTimer = t60;
    }, set referencePointUpdateDelay(t60) {
      e59._referencePointUpdateDelay = t60;
    }, set disableWeather(t60) {
      e59._disableWeather = t60;
    } };
  }
};
e([d({ type: Boolean, readOnly: true })], L13.prototype, "updating", null), e([d()], L13.prototype, "disableQueries", void 0), e([d()], L13.prototype, "_disableWeather", void 0), e([d()], L13.prototype, "weatherEnabled", null), e([d()], L13.prototype, "weatherVisible", null), e([d()], L13.prototype, "referencePositionWGS84Comparable", null), e([d()], L13.prototype, "_renderer", void 0), e([d()], L13.prototype, "_referencePosWGS84Comparable", void 0), L13 = e([n6("esri.views.3d.environment.SceneViewEnvironmentManager")], L13);
var Q6 = new O14();
var D10 = new O14();
var q6 = /* @__PURE__ */ new Date();
var A25 = { hours: 0, minutes: 0, seconds: 0 };
var V7 = r6(0.22, 0.22, 0.33);
var I13 = r6(0.22, 0.22, 0.22);

// node_modules/@arcgis/core/views/3d/camera/constraintUtils/common.js
function O15(n73, t60) {
  return 0 != (n73 & t60);
}
function L14(n73, t60, a58, O33, L31, i66) {
  0 !== n73 && (a58 ? (i66.min = Math.min(i66.min, t60), i66.max = Math.max(i66.max, t60)) : null != O33 ? (i66.min -= Math.max(0, (t60 - i66.min) * (1 - O33)), i66.max += Math.max(0, (t60 - i66.max) * (1 - O33))) : L31 && (i66.min -= Math.max(0, t60 - i66.min - L31), i66.max += Math.max(0, t60 - i66.max - L31)));
}
var i43;
var N8;
var m21;
!function(n73) {
  n73[n73.NONE = 0] = "NONE", n73[n73.ZOOM = 1] = "ZOOM", n73[n73.TUMBLE = 2] = "TUMBLE", n73[n73.LOOK_AROUND = 3] = "LOOK_AROUND", n73[n73.PAN = 4] = "PAN", n73[n73.ASCEND = 5] = "ASCEND";
}(i43 || (i43 = {})), function(n73) {
  n73[n73.NONE = 0] = "NONE", n73[n73.TILT = 1] = "TILT", n73[n73.ALTITUDE = 2] = "ALTITUDE", n73[n73.DISTANCE = 4] = "DISTANCE", n73[n73.COLLISION = 8] = "COLLISION", n73[n73.ALL = 15] = "ALL", n73[n73.ALL_EXCEPT_COLLISION = 7] = "ALL_EXCEPT_COLLISION";
}(N8 || (N8 = {})), function(n73) {
  n73[n73.TUMBLE = 0] = "TUMBLE", n73[n73.LOOK_AROUND = 1] = "LOOK_AROUND";
}(m21 || (m21 = {}));
var E18 = { selection: N8.NONE, interactionType: i43.NONE, interactionFactor: 0, interactionStartCamera: null, interactionDirection: null, tiltMode: m21.TUMBLE };
function o40(O33, L31, i66, N23) {
  return L31 = L31 || O33.viewForward, r7(N23, L31), q(N23, N23, Math.sign(P2(L31, i66))), N23;
}

// node_modules/@arcgis/core/views/3d/camera/constraintUtils/altitude.js
function d18(t60, n73, o61 = E18) {
  const a58 = l26(t60, n73, o61);
  if (0 === a58)
    return false;
  const m40 = t60.renderCoordsHelper, u51 = m40.getAltitude(n73.eye) + a58, f37 = o40(n73, o61.interactionDirection, x17(t60, n73, Math.sign(a58), h23), T14), d32 = r7(A26, n73.viewForward), y33 = m40.intersectInfiniteManifold(j7(n73.eye, f37), u51, C9);
  return n73.eye = r(y33) ? y33 : m40.setAltitude(C9, u51, n73.eye), n73.center = j13(C9, n73.eye, d32, n73.center), true;
}
function l26(e59, r59, n73 = E18) {
  if (!y15(e59, n73))
    return 0;
  const o61 = g21(e59.state.constraints.altitude, M11);
  j17(e59, n73, o61);
  const i66 = e59.renderCoordsHelper.getAltitude(r59.eye), s63 = o4(i66, o61.min, o61.max) - i66;
  return Math.abs(s63) <= 1e-6 ? 0 : s63;
}
function y15(t60, e59) {
  const r59 = t60.state.constraints.altitude;
  return !(!t60.state.isGlobal || !r59) && (e59.interactionType !== i43.TUMBLE || !O15(e59.selection, N8.TILT));
}
function j17(t60, e59, r59) {
  const n73 = e59.interactionType;
  if (n73 === i43.NONE)
    return;
  const { min: o61, max: i66 } = r59, { interactionStartCamera: s63, interactionFactor: c67 } = e59, m40 = n73 === i43.TUMBLE || n73 === i43.ZOOM, u51 = l26(t60, s63), p52 = 0 === u51 ? 0 : t60.renderCoordsHelper.getAltitude(s63.eye);
  r59.min = o61, r59.max = i66;
  L14(u51, p52, m40, c67, 0.05 * p52, r59);
}
function x17(t60, e59, r59, o61) {
  return t60.renderCoordsHelper.worldUpAtPosition(e59.eye, o61), q(o61, o61, r59), o61;
}
function g21(t60, e59) {
  return e59.min = t60.min, e59.max = t60.max, e59;
}
var M11 = { min: 0, max: 0 };
var T14 = n7();
var h23 = n7();
var A26 = n7();
var C9 = n7();

// node_modules/@arcgis/core/views/3d/camera/constraintUtils/distance.js
function y16(e59, n73, r59 = E18) {
  if (!e59.state.isLocal)
    return 0;
  const t60 = e59.state.constraints.distance;
  if (!e59.pointsOfInterest.surfaceOrigin.renderLocation || t60 === 1 / 0)
    return 0;
  x18.min = 0, x18.max = t60, g22(e59, r59, x18);
  const o61 = j18(e59, n73), i66 = x18.max - o61;
  return i66 >= -1e-6 ? 0 : i66;
}
function O16(n73, t60, s63 = E18) {
  const p52 = y16(n73, t60, s63);
  if (0 === p52)
    return false;
  const d32 = n73.pointsOfInterest.surfaceOrigin, O33 = j18(n73, t60) + p52, g45 = r7(h24, t60.eye), x30 = o40(t60, s63.interactionDirection, l27(n73, t60, k13), L15);
  if (!U6(w6(d32.renderLocation, O33), j7(t60.eye, x30), C10))
    return false;
  t60.eye = C10;
  const N23 = e7(I14, t60.eye, g45);
  t60.center = u3(C10, t60.center, N23);
  const b23 = n73.renderCoordsHelper.getAltitude(t60.center), v36 = n73.renderCoordsHelper.intersectInfiniteManifold(t60.ray, b23, C10);
  return r(v36) && (t60.center = v36), true;
}
function g22(e59, n73, r59) {
  const t60 = n73.interactionType;
  if (t60 === i43.NONE)
    return;
  const { min: o61, max: i66 } = r59, { interactionStartCamera: s63, interactionFactor: c67 } = n73, a58 = t60 === i43.ZOOM || t60 === i43.PAN, f37 = y16(e59, s63), m40 = 0 === f37 ? 0 : j18(e59, s63);
  r59.min = o61, r59.max = i66;
  L14(f37, m40, a58, c67, 0.05 * m40, r59);
}
function j18(e59, r59) {
  const t60 = e59.pointsOfInterest.surfaceOrigin;
  return x(r59.eye, t60.renderLocation);
}
function l27(e59, n73, r59) {
  const o61 = e59.pointsOfInterest.surfaceOrigin;
  return H(r59, n73.eye, o61.renderLocation);
}
var x18 = { min: 0, max: 0 };
var h24 = n7();
var I14 = n7();
var L15 = n7();
var k13 = n7();
var C10 = n7();

// node_modules/@arcgis/core/views/3d/camera/intersectionUtils.js
function p32(r59, n73, t60, o61) {
  return r(r59.renderCoordsHelper.fromRenderCoords(n73.eye, j19, o61)) && b4(t60, j19);
}
function m22(e59, n73) {
  return e59.elevationProvider ? c(e59.elevationProvider.getElevation(n73[0], n73[1], n73[2], e59.renderCoordsHelper.spatialReference, "ground"), 0) : 0;
}
function g23(e59, r59, a58, c67) {
  const l48 = e59.state.camera.clone();
  r59 && (l48.eye = r59, l48.center = a58, l48.up = c67), v18(e59, l48.ray, w13) || r7(w13, l48.center);
  const d32 = e59.state.constraints, u51 = d32.minimumPoiDistance;
  if (p5(l48.eye, w13) < u51) {
    const r60 = d32.collision.enabled;
    r7(H8, l48.viewForward), q(H8, H8, u51), r60 ? l48.eye = e7(j19, w13, H8) : u3(w13, l48.eye, H8);
    const t60 = e59.renderCoordsHelper, a59 = t60.getAltitude(l48.eye), c68 = d32.collision.elevationMargin;
    r60 && a59 < c68 && (e7(H8, w13, l48.eye), l48.eye = t60.setAltitude(j19, c68, l48.eye), u3(w13, l48.eye, H8));
  }
  return l48.center = w13, l48;
}
function y17(e59, r59, n73) {
  if (!e59.state.isGlobal)
    return false;
  const o61 = m22(e59, r59), i66 = e59.stateManager.constraintsManager.nearFarHeuristic, { far: s63 } = i66.compute(r59, n73, e59.renderDataExtent, o61, C11), a58 = s63 * s63;
  return p5(r59, n73) > a58;
}
function v18(e59, r59, n73) {
  let t60 = M12[e59.viewingMode];
  t60 || (t60 = x6(e59.state.viewingMode), t60.options.backfacesTerrain = !e59.state.isGlobal, t60.options.invisibleTerrain = true, M12[e59.viewingMode] = t60);
  const { isGlobal: o61 } = e59.state;
  return !(!e59.sceneIntersectionHelper.intersectRay(r59, t60, n73) || y17(e59, r59.origin, n73)) || (!(!e59.renderCoordsHelper.intersectManifold(r59, 0, n73) || y17(e59, r59.origin, n73)) || !!o61 && b9(r59, n73, p3(e59.spatialReference).radius));
}
function b9(e59, r59, n73) {
  const t60 = P2(e59.origin, e59.origin) - n73 * n73, i66 = t60 > 0 ? Math.sqrt(t60) / 3 : 1;
  return q(r59, e59.direction, i66 / s8(e59.direction)), u3(r59, r59, e59.origin), true;
}
var M12 = {};
var j19 = n7();
var w13 = n7();
var H8 = n7();
var C11 = { near: 0, far: 0 };

// node_modules/@arcgis/core/views/3d/camera/constraintUtils/surfaceCollision.js
function o41(r59, o61, l48 = i44.EYE) {
  const a58 = r59.state.constraints;
  if (!a58.collision.enabled)
    return false;
  const N23 = m22(r59, o61.eye), A39 = r59.renderCoordsHelper.getAltitude(o61.eye), C25 = N23 + a58.collision.elevationMargin;
  if (A39 >= C25)
    return false;
  const f37 = s8(o61.eye);
  if (e7(c45, o61.center, o61.eye), o61.eye = r59.renderCoordsHelper.setAltitude(_10, C25, o61.eye), l48 === i44.EYE_AND_CENTER)
    o61.center = u3(c45, o61.eye, c45);
  else if (l48 === i44.EYE_AND_CENTER_SCALE) {
    const e59 = (f37 - A39 + C25) / f37;
    o61.center = q(c45, o61.center, e59);
  }
  return true;
}
var i44;
!function(e59) {
  e59[e59.EYE = 0] = "EYE", e59[e59.EYE_AND_CENTER = 1] = "EYE_AND_CENTER", e59[e59.EYE_AND_CENTER_SCALE = 2] = "EYE_AND_CENTER_SCALE";
}(i44 || (i44 = {}));
var c45 = n7();
var _10 = n7();

// node_modules/@arcgis/core/views/3d/state/utils/viewUtils.js
function n48(c67, n73, e59) {
  c67.worldUpAtPosition(n73, i45), e7(m23, e59, n73);
  const a58 = s8(m23);
  return 0 === a58 ? 0 : l4(P2(m23, i45) / a58);
}
var i45 = n7();
var m23 = n7();

// node_modules/@arcgis/core/views/3d/camera/constraintUtils/tilt.js
function P10(t60, r59, n73 = E18, i66 = true) {
  W7.eyeCenterDistance = 0, W7.requiresTwoSteps = false;
  const s63 = U17(t60, r59, n73, void 0, W7);
  if (0 === s63)
    return false;
  switch (p7(z7, -s63, r59.viewRight), n73.tiltMode) {
    case m21.LOOK_AROUND:
      L2(_11, r59.viewForward, z7), q(_11, _11, W7.eyeCenterDistance), r59.center = u3(G12, r59.eye, _11);
      break;
    case m21.TUMBLE:
      e7(_11, r59.center, r59.eye), L2(_11, _11, z7), r59.eye = e7(G12, r59.center, _11);
      break;
    default:
      n13(n73.tiltMode);
  }
  return r59.up = L2(G12, r59.up, z7), !W7.requiresTwoSteps || !i66 || P10(t60, r59, n73, false);
}
function U17(e59, t60, r59 = E18, n73 = E18, i66) {
  if (!e59.state.constraints.tilt)
    return 0;
  const s63 = t60.distance, a58 = e59.state.constraints.tilt(s63, Q7);
  return B6(e59, r59, a58), n73.interactionType === i43.TUMBLE && O15(n73.selection, N8.ALTITUDE) && K4(e59, n73.interactionStartCamera, a58), r59.tiltMode === m21.LOOK_AROUND || n73.tiltMode === m21.LOOK_AROUND ? L16(e59, t60, a58, i66) : v19(e59, t60, a58);
}
function v19(e59, r59, n73) {
  const i66 = n48(e59.renderCoordsHelper, r59.center, r59.eye), s63 = i66 - o4(i66, n73.min, n73.max);
  return g24(s63) ? s63 : 0;
}
function L16(t60, r59, n73, i66) {
  switch (i66 && (i66.requiresTwoSteps = false), t60.viewingMode) {
    case "global":
      return q7(t60, r59, n73, i66);
    case "local":
      return k14(t60, r59, n73, i66);
    default:
      return void n13(t60.viewingMode);
  }
}
function k14(e59, r59, n73, i66) {
  const s63 = n48(e59.renderCoordsHelper, r59.center, r59.eye), a58 = o4(s63, n73.min, n73.max), c67 = s63 - a58;
  if (!g24(c67))
    return 0;
  if (i66) {
    const t60 = e59.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude, n74 = e59.renderCoordsHelper.getAltitude(r59.eye) - t60, s64 = Math.cos(a58);
    Math.abs(s64) > 1e-4 ? i66.eyeCenterDistance = n74 / s64 : i66.eyeCenterDistance = r59.distance;
  }
  return c67;
}
function q7(e59, r59, n73, i66) {
  const s63 = b10(e59, r59, V8), a58 = o4(s63.tiltAtCenter, n73.min, n73.max);
  if (!g24(s63.tiltAtCenter - a58))
    return 0;
  let c67, o61;
  return s63.centerIsOnSurface ? (c67 = E19(s63), o61 = F8(s63, c67)) : (c67 = s63.constraints.clampTilt(s63.eyeCenterDistance, s63.tiltAtCenter), i66 && c67 < Math.PI / 2 && (i66.requiresTwoSteps = true, c67 = Math.PI / 2 - 1e-5), o61 = N9(s63, c67)), i66 && (i66.eyeCenterDistance = H9(s63, c67)), o61;
}
function b10(e59, t60, n73) {
  const i66 = e59.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude, a58 = i66 + p3(e59.spatialReference).radius, c67 = e59.renderCoordsHelper.intersectManifold(t60.ray, i66, G12);
  return n73.eyeCenterDistance = t60.distance, n73.centerIsOnSurface = false, r(c67) ? (n73.eyeCenterDistance = x(t60.eye, c67), n73.tiltAtCenter = n48(e59.renderCoordsHelper, c67, t60.eye), n73.centerIsOnSurface = true) : e59.state.isLocal ? n73.tiltAtCenter = n48(e59.renderCoordsHelper, t60.center, t60.eye) : (B3(T5($, a58), t60.ray, G12), n73.eyeCenterDistance = x(t60.eye, G12), n73.tiltAtCenter = l4(-P2(t60.viewForward, z2(G12, G12)))), n73.radius = a58, n73.eyeRadius = s8(t60.eye), n73.constraints = e59.state.constraints, n73;
}
function g24(e59) {
  return Math.abs(e59) > 1e-9;
}
function E19(e59) {
  const { constraints: t60, eyeCenterDistance: r59, tiltAtCenter: n73 } = e59;
  let i66 = n73, s63 = t60.clampTilt(r59, n73);
  const a58 = H9(e59, s63);
  if (t60.clampTilt(a58, n73) === s63)
    return s63;
  let c67 = 0;
  for (; c67 < 10 && g24(s63 - i66); ) {
    const r60 = (i66 + s63) / 2, n74 = H9(e59, r60);
    g24(t60.clampTilt(n74, r60) - r60) ? i66 = r60 : s63 = r60, c67++;
  }
  return s63;
}
function H9(e59, r59) {
  if (!e59.centerIsOnSurface)
    return e59.eyeCenterDistance;
  const i66 = Math.PI - o4(r59, 0, Math.PI), s63 = b2(e59.radius / e59.eyeRadius * Math.sin(i66)), a58 = Math.PI - i66 - s63, c67 = Math.sin(a58) / Math.sin(i66);
  if (e59.eyeRadius < e59.radius && c67 > 1) {
    const t60 = Math.PI - s63, r60 = Math.PI - i66 - t60;
    return Math.sin(r60) / Math.sin(i66) * e59.eyeRadius;
  }
  return c67 * e59.eyeRadius;
}
function F8(e59, t60) {
  const r59 = b2(e59.radius / e59.eyeRadius * Math.sin(e59.tiltAtCenter)), i66 = b2(e59.radius / e59.eyeRadius * Math.sin(t60));
  return e59.eyeRadius > e59.radius ? r59 - i66 : i66 - r59;
}
function N9(e59, t60) {
  return e59.tiltAtCenter - Math.PI / 2 - (t60 - Math.PI / 2);
}
function B6(e59, t60, r59) {
  if (t60.interactionType === i43.NONE)
    return;
  const { interactionStartCamera: n73, interactionFactor: i66 } = t60, { min: s63, max: a58 } = r59, c67 = U17(e59, n73, E18, t60), o61 = 0 === c67 ? 0 : n48(e59.renderCoordsHelper, n73.center, n73.eye);
  r59.min = s63, r59.max = a58, t60.interactionType === i43.TUMBLE ? (O15(t60.selection, N8.ALTITUDE) && K4(e59, n73, r59), L14(c67, o61, true, i66, J6, r59)) : L14(c67, o61, false, i66, J6, r59);
}
function K4(e59, t60, n73) {
  if (e59.state.isLocal)
    return;
  const i66 = e59.state.constraints;
  if (!i66.altitude)
    return;
  const s63 = v3(t60.center), a58 = Math.sqrt(s63), c67 = t60.distance, o61 = p3(e59.spatialReference).radius, u51 = i66.altitude.min + o61, l48 = i66.altitude.max + o61, m40 = (u51 * u51 - c67 * c67 - s63) / (-2 * a58 * c67), d32 = (l48 * l48 - c67 * c67 - s63) / (-2 * a58 * c67);
  n73.min = Math.max(n73.min, Math.min(Math.PI - l4(d32), n73.max)), n73.max = Math.min(n73.max, Math.PI - l4(m40));
}
var _11 = n7();
var z7 = e12();
var G12 = n7();
var J6 = M4(5);
var Q7 = { min: 0, max: 0 };
var V8 = { constraints: null, radius: 0, eyeRadius: 0, centerIsOnSurface: true, eyeCenterDistance: 0, tiltAtCenter: 0 };
var W7 = { eyeCenterDistance: 0, requiresTwoSteps: false };

// node_modules/@arcgis/core/views/animation/easing.js
function t44(t60) {
  return t60;
}
var u31 = (t60) => t60 * t60;
var o42 = (t60) => 1 - u31(1 - t60);
var i46 = (t60) => t60 < 0.5 ? u31(2 * t60) / 2 : (o42(2 * (t60 - 0.5)) + 1) / 2;
var n49 = (t60) => t60 * t60 * t60;
var c46 = (t60) => 1 - n49(1 - t60);
var a35 = (t60) => t60 < 0.5 ? n49(2 * t60) / 2 : (c46(2 * (t60 - 0.5)) + 1) / 2;
var s43 = (t60) => t60 * t60 * t60 * t60;
var q8 = (t60) => 1 - s43(1 - t60);
var r42 = (t60) => t60 < 0.5 ? s43(2 * t60) / 2 : (q8(2 * (t60 - 0.5)) + 1) / 2;
var e34 = (t60) => t60 * t60 * t60 * t60 * t60;
var b11 = (t60) => 1 - e34(1 - t60);
var d19 = (t60) => t60 < 0.5 ? e34(2 * t60) / 2 : (b11(2 * (t60 - 0.5)) + 1) / 2;
var h25 = (t60) => 1 - Math.cos(t60 * Math.PI / 2);
var p33 = (t60) => 1 - h25(1 - t60);
var x19 = (t60) => t60 < 0.5 ? h25(2 * t60) / 2 : (p33(2 * (t60 - 0.5)) + 1) / 2;
var M13 = (t60) => 2 ** (10 * (t60 - 1));
var f20 = (t60) => 1 - M13(1 - t60);
var l28 = (t60) => t60 < 0.5 ? M13(2 * t60) / 2 : (f20(2 * (t60 - 0.5)) + 1) / 2;
var I15 = (t60) => -(Math.sqrt(1 - t60 * t60) - 1);
var P11 = (t60) => 1 - I15(1 - t60);
var g25 = (t60) => t60 < 0.5 ? I15(2 * t60) / 2 : (P11(2 * (t60 - 0.5)) + 1) / 2;
function j20(t60) {
  const u51 = 2 * (t60 - Math.sqrt((t60 - 1) * t60)), o61 = u51 / 2 / t60;
  return (i66) => i66 < o61 ? t60 * i66 * i66 : u51 * i66 - u51 + 1;
}
function k15(t60, u51) {
  return (o61, i66) => o61 < u51 ? u51 * t60(o61 / u51, i66) : 1 - t60((1 - o61) / (1 - u51), i66) * (1 - u51);
}
var m24 = k15(j20(1), 1);
var v20 = k15(j20(1), 0);
var w14 = k15(j20(1), 0.5);
var y18 = k15(j20(2), 1);
var z8 = k15(j20(2), 0);
var A27 = k15(j20(2), 0.5);
var B7 = k15(j20(3), 1);
var C12 = k15(j20(3), 0);
var D11 = k15(j20(3), 0.5);
var E20 = k15(j20(4), 1);
var F9 = k15(j20(4), 0);
var G13 = k15(j20(4), 0.5);
var H10 = { linear: t44, "in-quad": u31, "out-quad": o42, "in-out-quad": i46, "in-coast-quad": m24, "out-coast-quad": v20, "in-out-coast-quad": w14, "in-cubic": n49, "out-cubic": c46, "in-out-cubic": a35, "in-coast-cubic": y18, "out-coast-cubic": z8, "in-out-coast-cubic": A27, "in-quart": s43, "out-quart": q8, "in-out-quart": r42, "in-coast-quart": B7, "out-coast-quart": C12, "in-out-coast-quart": D11, "in-quint": e34, "out-quint": b11, "in-out-quint": d19, "in-coast-quint": E20, "out-coast-quint": F9, "in-out-coast-quint": G13, "in-sine": h25, "out-sine": p33, "in-out-sine": x19, "in-expo": M13, "out-expo": f20, "in-out-expo": l28, "in-circ": I15, "out-circ": P11, "in-out-circ": g25 };

// node_modules/@arcgis/core/views/3d/camera/constraintUtils.js
function E21(t60, o61, r59 = d20, i66 = o61) {
  let e59 = false;
  i66 !== o61 && i66.copyFrom(o61), i66.computeUp(t60.state.viewingMode);
  for (let n73 = 0; n73 < j21; n73++) {
    let o62 = 0;
    for (const n74 of U18)
      if (O15(r59.selection, n74.type)) {
        const s63 = Math.abs(n74.error(t60, i66, r59));
        n74.apply(t60, i66, r59) && (e59 = true, o62 += s63);
      }
    if (0 === o62)
      break;
  }
  const a58 = O15(r59.selection, N8.COLLISION), l48 = C13(r59.interactionType, t60);
  return a58 && o41(t60, i66, l48) && (e59 = true), e59 && i66.computeUp(t60.state.viewingMode), e59;
}
function C13(t60, o61) {
  switch (t60) {
    case i43.PAN:
      return i44.EYE_AND_CENTER;
    case i43.ASCEND:
      return o61.state.isGlobal ? i44.EYE_AND_CENTER_SCALE : i44.EYE_AND_CENTER;
    default:
      return i44.EYE;
  }
}
function y19(o61, r59) {
  const n73 = "number" == typeof o61 ? o61 : m7(o61, r59), i66 = Math.min(1, n73 / 150);
  return a35(i66);
}
function T15(t60, o61, r59) {
  return U17(t60, o61, r59) * o61.distance;
}
var U18 = [{ type: N8.TILT, error: T15, apply: P10 }, { type: N8.ALTITUDE, error: l26, apply: d18 }, { type: N8.DISTANCE, error: y16, apply: O16 }];
var d20 = { selection: N8.ALL, interactionType: i43.NONE, interactionFactor: 0, interactionStartCamera: null, interactionDirection: null, tiltMode: m21.TUMBLE };
var j21 = 5;

// node_modules/@arcgis/core/views/3d/animation/pointToPoint/Camera.js
var P12 = n7();
var g26 = n7();
var _12 = n7();
var k16 = n7();
var v21 = n7();
var x20 = n7();
var z9 = { upward: r6(0, 0, 1), forward: r6(0, 1, 0), sideway: r6(1, 0, 0) };
var b12 = e11();
var T16 = class {
  constructor(t60 = l13.Global) {
    this.viewingMode = t60, this.center = n7(), this.pitch = 0, this.yaw = 0, this.distance = 0, this.lookAtDirection = t5(z9.forward);
  }
  pixelsPerPanAtZoom(t60) {
    return this.size / 2 / (this._zoomToPanScale * t60);
  }
  zoomAtPixelsPerPan(t60) {
    return this.size / 2 / (this._zoomToPanScale * t60);
  }
  pixelsPerRotateAtZoom() {
    const t60 = Math.max(Math.cos(Math.abs(this.pitch)), 0.5);
    return this.size / 2 / t60;
  }
  compareTo(t60, e59) {
    if (e59 || (e59 = { pan: 0, rotate: 0, sourceZoom: 0, targetZoom: 0 }), this.viewingMode === l13.Global) {
      const i67 = (s8(this.center) + s8(t60.center)) / 2;
      e59.pan = x4(this.center, t60.center) * i67;
    } else
      e59.pan = x(this.center, t60.center);
    let i66 = Math.abs(t60.yaw - this.yaw);
    i66 >= Math.PI && (i66 = 2 * Math.PI - i66);
    const o61 = Math.abs(t60.pitch - this.pitch);
    return e59.rotate = Math.max(i66, o61), e59.sourceZoom = this.distance, e59.targetZoom = t60.distance, e59;
  }
  interpolate(e59, i66, s63) {
    this.viewingMode === l13.Global ? k5(e59.center, i66.center, s63.pan, this.center) : A4(this.center, e59.center, i66.center, s63.pan), this.distance = s10(e59.distance, i66.distance, s63.zoom), this.pitch = s10(e59.pitch, i66.pitch, s63.rotate);
    let a58 = e59.yaw;
    const h44 = i66.yaw;
    Math.abs(h44 - a58) >= Math.PI && (a58 += 2 * (a58 < h44 ? 1 : -1) * Math.PI), this.yaw = s10(a58, h44, s63.rotate);
  }
  copyFrom(t60) {
    r7(this.center, t60.center), this.pitch = t60.pitch, this.yaw = t60.yaw, this.distance = t60.distance, r7(this.lookAtDirection, t60.lookAtDirection), this.size = t60.size, this.copyFromCommon(t60), this.viewingMode = t60.viewingMode;
  }
  copyFromRenderCamera(t60) {
    const e59 = this._lookAtOrientation(t60.center, b12);
    r7(this.center, t60.center), e7(k16, t60.center, t60.eye), O2(k16, k16, e59), O2(v21, t60.up, e59), this.distance = s8(k16), k16[0] /= this.distance, k16[1] /= this.distance, k16[2] /= this.distance, this.pitch = this._eyeUpToPitch(k16), this.yaw = this._eyeUpToYaw(k16, v21), this.size = Math.sqrt(t60.width * t60.width + t60.height * t60.height), this.copyFromCommon(t60);
  }
  copyFromCommon(t60) {
    this.fov = t60.fov, this._zoomToPanScale = Math.atan(0.5 * this.fov);
  }
  copyToRenderCamera(t60) {
    const i66 = this._lookAtOrientation(this.center, b12);
    o10(i66, i66), this._axisAngleVec3(z9.sideway, this.pitch - Math.PI / 2, z9.forward, k16), this._axisAngleVec3(z9.upward, this.yaw, k16), this._axisAngleVec3(z9.sideway, this.pitch - Math.PI / 2, z9.upward, v21), this._axisAngleVec3(z9.upward, this.yaw, v21), q(k16, k16, this.distance), O2(k16, k16, i66), O2(v21, v21, i66), t60.center = this.center, t60.eye = e7(k16, this.center, k16), t60.up = v21;
  }
  _axisAngleVec3(t60, e59, i66, s63 = i66) {
    const a58 = Math.cos(e59), o61 = Math.sin(e59);
    return q(P12, i66, a58), _(g26, t60, i66), q(g26, g26, o61), q(_12, t60, (1 - a58) * P2(t60, i66)), u3(s63, u3(s63, P12, g26), _12);
  }
  _lookAtOrientation(t60, e59 = e11()) {
    return this._upAtLookAt(t60, _12), _(P12, this.lookAtDirection, _12), z2(P12, P12), 0 === P12[0] && 0 === P12[1] && 0 === P12[2] && r7(P12, z9.sideway), _(g26, _12, P12), z2(g26, g26), e59[0] = P12[0], e59[1] = g26[0], e59[2] = _12[0], e59[3] = P12[1], e59[4] = g26[1], e59[5] = _12[1], e59[6] = P12[2], e59[7] = g26[2], e59[8] = _12[2], e59;
  }
  _upAtLookAt(t60, e59) {
    return this.viewingMode === l13.Local ? r7(e59, z9.upward) : z2(e59, t60);
  }
  _eyeUpToPitch(t60) {
    return Math.PI - x4(z9.upward, t60);
  }
  _eyeUpToYaw(t60, e59) {
    const i66 = x20;
    return Math.abs(e59[2]) < 0.5 ? (r7(i66, e59), t60[2] > 0 && q(i66, i66, -1)) : r7(i66, t60), _(g26, i66, z9.upward), z2(g26, g26), x4(z9.sideway, g26, z9.upward);
  }
};

// node_modules/@arcgis/core/views/animation/pointToPoint/Settings.js
var o43 = { desiredScreenFlow: 2, minDuration: n3(500), maxDuration: n3(8e3) };

// node_modules/@arcgis/core/views/animation/pointToPoint/Definition.js
var t45 = class {
  constructor(t60) {
    this.createCamera = t60, this.compared = { sourceZoom: 0, targetZoom: 0, pan: 0, rotate: 0 }, this.settings = { desiredScreenFlow: o43.desiredScreenFlow }, this.source = t60(), this.target = t60();
  }
  clone() {
    const e59 = new t45(this.createCamera);
    return e59.copyFrom(this), e59;
  }
  copyFrom(e59) {
    this.update(e59.source, e59.target, e59.settings);
  }
  update(t60, r59, s63) {
    this.source !== t60 && this.source.copyFrom(t60), this.target !== r59 && this.target.copyFrom(r59), this.compared = this.source.compareTo(this.target, this.compared), this.settings.desiredScreenFlow = null != s63.desiredScreenFlow ? s63.desiredScreenFlow : o43.desiredScreenFlow, this.desiredPixelFlow = this.settings.desiredScreenFlow * this.target.size, this.halfWindowSize = this.target.size / 2;
  }
  halfWindowPanAtZoom(e59) {
    const t60 = this.target.pixelsPerPanAtZoom(e59);
    return this.halfWindowSize / t60;
  }
  get hasZoom() {
    return Math.abs(this.compared.sourceZoom - this.compared.targetZoom) > 1e-5;
  }
  get hasPan() {
    return this.compared.pan > 1e-9;
  }
  get hasRotate() {
    return this.compared.rotate > 1e-9;
  }
};

// node_modules/@arcgis/core/views/animation/pointToPoint/Path.js
var e35 = class {
  constructor() {
    this.segments = [];
  }
  get time() {
    return this.segments.reduce((e59, o61) => t4(e59 + o61.time), t4(0));
  }
  interpolateComponentsAt(t60, e59) {
    t60 = Math.min(Math.max(t60, 0), 1), t60 *= this.time;
    let o61 = 0, n73 = 0;
    const s63 = this.definition;
    for (let m40 = 0; m40 < this.segments.length; m40++) {
      const r59 = this.segments[m40], a58 = r59.definition;
      if (t60 <= r59.time || m40 === this.segments.length - 1) {
        e59 = this.segmentInterpolateComponentsAt(r59, t60 / r59.time, e59), s63.hasPan ? e59.pan = (o61 + a58.compared.pan * e59.pan) / s63.compared.pan : e59.pan = 1, s63.hasRotate ? e59.rotate = (n73 + a58.compared.rotate * e59.rotate) / s63.compared.rotate : e59.rotate = 1;
        const m41 = e59.zoom * (a58.compared.targetZoom - a58.compared.sourceZoom) + a58.compared.sourceZoom, i66 = this.segments[0].definition.compared.sourceZoom, p52 = this.segments[this.segments.length - 1].definition.compared.targetZoom;
        return s63.hasZoom ? e59.zoom = (m41 - i66) / (p52 - i66) : e59.zoom = 1, e59;
      }
      t60 -= r59.time, o61 += a58.compared.pan, n73 += a58.compared.rotate;
    }
  }
  segmentInterpolateComponentsAt(t60, e59, o61) {
    return t60.interpolateComponentsAt(e59, o61);
  }
};

// node_modules/@arcgis/core/views/animation/pointToPoint/Segment.js
var i47 = class {
  constructor(t60) {
    t60 && this.update(t60);
  }
  get time() {
    return this._time;
  }
  update(t60) {
    t60 && (this.definition ? this.definition.copyFrom(t60) : this.definition = t60.clone()), this._updatePrecomputedVariables(), this._updatePixelFlow();
  }
  _updatePrecomputedVariables() {
    const t60 = this.definition, i66 = t60.compared, o61 = i66.sourceZoom, e59 = i66.targetZoom;
    this._zoomSign = o61 > e59 ? 1 : -1, this._panPixelsAtSource = i66.pan * t60.source.pixelsPerPanAtZoom(o61);
    const n73 = (t60.source.pixelsPerRotateAtZoom(o61) + t60.target.pixelsPerRotateAtZoom(e59)) / 2;
    this._rotatePixels = i66.rotate * n73;
  }
  _updatePixelFlow() {
    const i66 = this.definition.compared.sourceZoom, o61 = this.definition.compared.targetZoom, { hasZoom: e59, hasPan: n73, hasRotate: s63 } = this.definition;
    let a58 = 0, h44 = 0;
    e59 && (n73 && (a58 = (o61 / i66 - 1) / (-1 / (this._zoomSign * this.definition.halfWindowSize) * Math.LN2 * this._panPixelsAtSource)), s63 && (h44 = this._zoomSign * (Math.log(i66 / o61) / Math.LN2) * this.definition.halfWindowSize / this._rotatePixels)), this._zoomPixelFlow = 0, this._panPixelFlow = 0, this._rotatePixelFlow = 0;
    const l48 = this.definition.desiredPixelFlow;
    if (e59 && n73 && s63) {
      const t60 = a58 + h44 + a58 * h44;
      this._zoomPixelFlow = a58 * h44 / t60 * l48, this._panPixelFlow = h44 / t60 * l48, this._rotatePixelFlow = a58 / t60 * l48;
    } else if (e59 && n73) {
      const t60 = 1 + a58;
      this._zoomPixelFlow = a58 / t60 * l48, this._panPixelFlow = 1 / t60 * l48;
    } else if (e59 && s63) {
      const t60 = 1 + h44;
      this._zoomPixelFlow = h44 / t60 * l48, this._rotatePixelFlow = 1 / t60 * l48;
    } else if (n73 && s63) {
      const t60 = this._panPixelsAtSource / this._rotatePixels, i67 = 1 + t60;
      this._panPixelFlow = t60 / i67 * l48, this._rotatePixelFlow = 1 / i67 * l48;
    } else
      n73 ? this._panPixelFlow = l48 : e59 ? this._zoomPixelFlow = l48 : s63 && (this._rotatePixelFlow = l48);
    this._time = s63 ? this.rotateTime : e59 ? this.zoomTime : n73 ? this.panTime : t4(0);
  }
  get rotateTime() {
    return this.definition.hasRotate ? t4(this._rotatePixels / this._rotatePixelFlow) : t4(0);
  }
  get zoomTime() {
    return this.definition.hasZoom ? t4(this._zoomSign * (Math.log(this.definition.compared.sourceZoom / this.definition.compared.targetZoom) / Math.LN2) * this.definition.halfWindowSize / this._zoomPixelFlow) : t4(0);
  }
  get panTime() {
    if (this.definition.hasPan) {
      if (this.definition.hasZoom) {
        const i66 = -1 / (this._zoomSign * this.definition.halfWindowSize) * Math.LN2, o61 = i66 * this._panPixelsAtSource;
        return t4(Math.log(o61 * (this._zoomPixelFlow / this._panPixelFlow) + 1) / (i66 * this._zoomPixelFlow));
      }
      return t4(this._panPixelsAtSource / this._panPixelFlow);
    }
    return t4(0);
  }
  _interpolateComponentsZoom(t60) {
    if (0 === t60 || 1 === t60)
      return t60;
    if (this.definition.hasZoom) {
      const i66 = this.definition.compared.sourceZoom, o61 = this.definition.compared.targetZoom;
      return (i66 * (i66 / o61) ** -t60 - i66) / (o61 - i66);
    }
    return t60;
  }
  _interpolateComponentsPan(t60) {
    if (0 === t60 || 1 === t60)
      return t60;
    if (this.definition.hasPan && this.definition.hasZoom) {
      const i66 = -1 / (this._zoomSign * this.definition.halfWindowSize) * this._zoomPixelFlow;
      return 1 / this._panPixelsAtSource * (this._panPixelFlow * (2 ** (i66 * t60 * this._time) - 1)) / (i66 * Math.LN2);
    }
    return t60;
  }
  _interpolateComponentsRotate(t60) {
    return t60;
  }
  interpolateComponentsAt(t60, i66) {
    t60 = Math.min(Math.max(t60, 0), 1);
    const o61 = this._interpolateComponentsZoom(t60), e59 = this._interpolateComponentsPan(t60), n73 = this._interpolateComponentsRotate(t60);
    return i66 ? (i66.zoom = o61, i66.pan = e59, i66.rotate = n73) : i66 = { zoom: o61, pan: e59, rotate: n73 }, i66;
  }
};

// node_modules/@arcgis/core/views/animation/pointToPoint/apex/functions.js
function o44(o61, a58, e59) {
  const n73 = a58 - o61.compared.sourceZoom, t60 = o61.halfWindowPanAtZoom(n73);
  return -o61.halfWindowSize * (e59.ascensionFactor * Math.LN2 * o61.compared.pan + t60) * Math.log(o61.compared.sourceZoom / a58) / (o61.desiredPixelFlow * Math.LN2 * t60);
}
function a36(o61, a58, e59) {
  const n73 = 1 / a58, t60 = Math.log(o61.compared.sourceZoom * n73), i66 = 1 / o61.desiredPixelFlow, r59 = 1 / Math.LN2, d32 = a58 - o61.compared.sourceZoom, c67 = 1 / d32, l48 = (e59.ascensionFactor * Math.LN2 * o61.compared.pan + o61.halfWindowPanAtZoom(d32)) / o61.halfWindowPanAtZoom(1);
  return o61.halfWindowSize * n73 * i66 * r59 * c67 * l48 - o61.halfWindowSize * t60 * i66 * r59 * c67 + o61.halfWindowSize * t60 * i66 * r59 * l48 / (d32 * d32);
}
function e36(o61, a58, e59) {
  const n73 = a58 - o61.compared.sourceZoom, t60 = 1 / n73, i66 = 1 / a58, r59 = Math.log(o61.compared.sourceZoom * i66), d32 = (e59.ascensionFactor * Math.LN2 * o61.compared.pan + o61.halfWindowPanAtZoom(n73)) / o61.halfWindowPanAtZoom(1);
  return o61.halfWindowSize * t60 * (-2 * t60 * i66 * d32 + 2 * t60 * r59 + 2 * i66 - 2 * r59 * d32 / (n73 * n73) - d32 / (a58 * a58)) / (o61.desiredPixelFlow * Math.LN2);
}
function n50(o61, a58) {
  return -o61.halfWindowSize * Math.log(o61.compared.sourceZoom / a58) / (o61.desiredPixelFlow * Math.LN2);
}
function t46(o61, a58) {
  return o61.halfWindowSize / (a58 * o61.desiredPixelFlow * Math.LN2);
}
function i48(o61, a58) {
  return -o61.halfWindowSize / (a58 * a58 * o61.desiredPixelFlow * Math.LN2);
}
function r43(o61, a58, e59) {
  return -o61.compared.pan * o61.halfWindowSize * (e59.ascensionFactor + e59.descensionFactor - 1) / (o61.desiredPixelFlow * o61.halfWindowPanAtZoom(a58));
}
function d21(o61, a58, e59) {
  return o61.compared.pan * o61.halfWindowSize * (e59.ascensionFactor + e59.descensionFactor - 1) / (o61.desiredPixelFlow * o61.halfWindowPanAtZoom(a58 * a58));
}
function c47(o61, a58, e59) {
  return -2 * o61.compared.pan * o61.halfWindowSize * (e59.ascensionFactor + e59.descensionFactor - 1) / (o61.desiredPixelFlow * o61.halfWindowPanAtZoom(a58 * a58 * a58));
}
function l29(o61, a58, e59) {
  return o61.halfWindowSize * (-o61.halfWindowPanAtZoom(a58) - e59.descensionFactor * Math.LN2 * o61.compared.pan + o61.halfWindowPanAtZoom(o61.compared.targetZoom)) * Math.log(a58 / o61.compared.targetZoom) / (o61.desiredPixelFlow * Math.LN2 * o61.halfWindowPanAtZoom(-a58 + o61.compared.targetZoom));
}
function m25(o61, a58, e59) {
  const n73 = Math.log(a58 / o61.compared.targetZoom), t60 = 1 / o61.desiredPixelFlow, i66 = 1 / Math.LN2, r59 = -a58 + o61.compared.targetZoom, d32 = 1 / r59, c67 = (-o61.halfWindowPanAtZoom(a58) - e59.descensionFactor * Math.LN2 * o61.compared.pan + o61.halfWindowPanAtZoom(o61.compared.targetZoom)) / o61.halfWindowPanAtZoom(1);
  return -o61.halfWindowSize * n73 * t60 * i66 * d32 + o61.halfWindowSize * n73 * t60 * i66 * c67 / (r59 * r59) + o61.halfWindowSize * t60 * i66 * d32 * c67 / a58;
}
function h26(o61, a58, e59) {
  const n73 = a58 - o61.compared.targetZoom, t60 = 1 / n73, i66 = 1 / a58, r59 = Math.log(a58 / o61.compared.targetZoom), d32 = (o61.halfWindowPanAtZoom(a58) + e59.descensionFactor * Math.LN2 * o61.compared.pan - o61.halfWindowPanAtZoom(o61.compared.targetZoom)) / o61.halfWindowPanAtZoom(1);
  return o61.halfWindowSize * t60 * (-2 * t60 * i66 * d32 - 2 * t60 * r59 + 2 * i66 + 2 * r59 * d32 / (n73 * n73) - d32 / (a58 * a58)) / (o61.desiredPixelFlow * Math.LN2);
}
function s44(o61, a58) {
  return o61.halfWindowSize * Math.log(a58 / o61.compared.targetZoom) / (o61.desiredPixelFlow * Math.LN2);
}
function f21(o61, a58) {
  return o61.halfWindowSize / (a58 * o61.desiredPixelFlow * Math.LN2);
}
function w15(o61, a58) {
  return -o61.halfWindowSize / (a58 * a58 * o61.desiredPixelFlow * Math.LN2);
}
function p34(o61) {
  const a58 = Math.LN2 * o61.compared.pan, e59 = o61.compared.sourceZoom - o61.compared.targetZoom, n73 = o61.halfWindowPanAtZoom(e59), t60 = o61.halfWindowSize * Math.log(o61.compared.sourceZoom / o61.compared.targetZoom) / (o61.desiredPixelFlow * Math.LN2 * n73);
  return o61.compared.sourceZoom <= o61.compared.targetZoom ? t60 * (a58 - n73) : t60 * (a58 + n73);
}

// node_modules/@arcgis/core/views/animation/pointToPoint/apex/planning.js
function f22(f37, Z11) {
  let P22 = D12(f37, Z11);
  const b23 = { ascensionFactor: null != Z11.ascensionFactor ? Z11.ascensionFactor : 0.5, descensionFactor: null != Z11.descensionFactor ? Z11.descensionFactor : 0.5 }, g45 = 0 === b23.ascensionFactor, h44 = 0 === b23.descensionFactor, M22 = g45 ? n50 : o44, k32 = g45 ? t46 : a36, N23 = g45 ? i48 : e36, j36 = h44 ? s44 : l29, w25 = h44 ? f21 : m25, z20 = h44 ? w15 : h26, A39 = (e59) => M22(f37, e59, b23) + r43(f37, e59, b23) + j36(f37, e59, b23), I27 = (o61) => k32(f37, o61, b23) + d21(f37, o61, b23) + w25(f37, o61, b23), q18 = (o61) => N23(f37, o61, b23) + c47(f37, o61, b23) + z20(f37, o61, b23);
  let v36 = A39(P22);
  const y33 = p34(f37);
  let B18;
  const C25 = Z11.maximumIterations || 20, E39 = null != Z11.maximumDistance ? Z11.maximumDistance : 1 / 0;
  for (B18 = 0; B18 < C25; B18++) {
    const o61 = 1e-6, e59 = (I27(P22) + o61) / q18(P22);
    if (isNaN(e59) || P22 >= E39 && e59 < 0) {
      if (!isFinite(E39))
        return null;
      P22 = E39, v36 = A39(P22);
      break;
    }
    if (P22 -= e59, P22 < f37.compared.sourceZoom || P22 < f37.compared.targetZoom)
      return null;
    const n73 = A39(P22);
    if (Math.abs(n73 - v36) / v36 <= 5e-3)
      break;
    v36 = n73;
  }
  return v36 > y33 * (1 - 0.3) || P22 < f37.compared.sourceZoom || P22 < f37.compared.targetZoom ? null : P22;
}
function D12(o61, e59) {
  const n73 = Math.max(o61.compared.sourceZoom, o61.compared.targetZoom), a58 = o61.source.zoomAtPixelsPerPan(o61.desiredPixelFlow / o61.compared.pan) / 2;
  return a58 < n73 ? null != e59.maximumDistance ? n73 + (e59.maximumDistance - n73) / 2 : 1.5 * n73 : e59.maximumDistance ? Math.min(e59.maximumDistance, a58) : a58;
}

// node_modules/@arcgis/core/views/animation/pointToPoint/apex/Path.js
var s45 = class extends e35 {
  constructor(i66, e59) {
    super(), this._preallocSegments = [new i47(), new i47(), new i47()], this.update(i66, e59);
  }
  update(i66, e59) {
    if (!i66)
      return;
    this.definition ? this.definition.copyFrom(i66) : this.definition = i66.clone();
    let t60 = null;
    e59 && e59.apex && (t60 = f22(i66, e59.apex)), this.segments.length = 0, this._ascensionSegment = null, this._descensionSegment = null, null == t60 ? this._updateWithoutApex() : this._updateWithApex(t60, e59.apex);
  }
  segmentInterpolateComponentsAt(t60, n73, o61) {
    return o61 = t60.interpolateComponentsAt(n73, o61), t60 === this._ascensionSegment ? o61.zoom = o42(o61.zoom) : t60 === this._descensionSegment && (o61.zoom = u31(o61.zoom)), o61;
  }
  _updateWithApex(i66, e59) {
    const [t60, n73, o61] = this._preallocSegments, s63 = null != e59.ascensionFactor ? e59.ascensionFactor : 0.5, d32 = Math.min(1 - s63, null != e59.ascensionFactor ? e59.descensionFactor : 0.5), a58 = 1 - s63 - d32;
    t60.definition ? t60.definition.copyFrom(this.definition) : t60.definition = this.definition.clone(), t60.definition.compared.targetZoom = i66, t60.definition.compared.pan = this.definition.compared.pan * s63, t60.definition.compared.rotate = this.definition.compared.rotate * s63, t60.update(), this._ascensionSegment = t60, this.segments.push(t60), a58 > 0 && (n73.definition ? n73.definition.copyFrom(this.definition) : n73.definition = this.definition.clone(), n73.definition.copyFrom(this.definition), n73.definition.compared.sourceZoom = i66, n73.definition.compared.targetZoom = i66, n73.definition.compared.pan = this.definition.compared.pan * a58, n73.definition.compared.rotate = this.definition.compared.rotate * a58, n73.update(), this.segments.push(n73)), o61.definition ? o61.definition.copyFrom(this.definition) : o61.definition = this.definition.clone(), o61.definition.compared.sourceZoom = i66, o61.definition.compared.pan = this.definition.compared.pan * d32, o61.definition.compared.rotate = this.definition.compared.rotate * d32, o61.update(), this._descensionSegment = o61, this.segments.push(o61);
  }
  _updateWithoutApex() {
    const [i66] = this._preallocSegments;
    i66.update(this.definition), this.segments.push(i66);
  }
};

// node_modules/@arcgis/core/views/animation/pointToPoint/Animation.js
var r44 = { zoom: 0, pan: 0, rotate: 0 };
var m26 = class {
  constructor(i66) {
    this.createCamera = i66, this._time = n3(0), this.definition = new t45(i66), this.path = new s45();
  }
  get time() {
    return this._time;
  }
  update(t60, a58, s63) {
    this.definition.update(t60, a58, s63), this.path.update(this.definition, s63), this._time = this._applyTimeSettings(r4(this.path.time), s63), this._easing = s63.easing ? s63.easing : this._time >= 1e3 ? w14 : f20;
  }
  cameraAt(t60, i66) {
    i66 = i66 || this.createCamera(), t60 = Math.min(Math.max(0, t60), 1), t60 = this._normalizedEasing(t60);
    const e59 = this.path.interpolateComponentsAt(t60, r44);
    return i66.interpolate(this.definition.source, this.definition.target, e59), i66;
  }
  _normalizedEasing(t60) {
    const i66 = this._easing(0, this._time), e59 = this._easing(1, this._time);
    return (this._easing(t60, this._time) - i66) / (e59 - i66);
  }
  _applyTimeSettings(i66, e59) {
    const n73 = null != e59.speedFactor ? e59.speedFactor : 1;
    null != e59.duration ? i66 = e59.duration : null != e59.speedFactor && (i66 = n3(i66 / n73));
    const a58 = null != e59.minDuration ? e59.minDuration : o43.minDuration / n73, o61 = null != e59.maxDuration ? e59.maxDuration : o43.maxDuration / n73;
    return n3(Math.min(Math.max(a58, i66), o61));
  }
};

// node_modules/@arcgis/core/views/3d/animation/pointToPoint/Animation.js
var c48 = n7();
var h27 = class {
  constructor(i66) {
    this.currentTime = n3(0), this._animation = new m26(() => new T16(i66)), this._current = new T16(i66);
  }
  get finished() {
    return this.currentTime >= this._animation.time;
  }
  get time() {
    return this._animation.time;
  }
  update(i66, m40, s63) {
    const a58 = this._animation.definition.source, o61 = this._animation.definition.target, h44 = e7(c48, m40.center, i66.center), u51 = s8(h44);
    u51 >= 1e-5 ? (h44[0] /= u51, h44[1] /= u51, h44[2] /= u51) : (h44[0] = 0, h44[1] = 1, h44[0] = 0), r7(a58.lookAtDirection, h44), r7(o61.lookAtDirection, h44), a58.copyFromRenderCamera(i66), o61.copyFromRenderCamera(m40), this._current.copyFrom(a58), this._animation.update(a58, o61, s63), this.currentTime = n3(0), i66.almostEquals(m40) && (this.currentTime = this._animation.time);
  }
  cameraAt(t60, i66) {
    return this._animation.cameraAt(t60, this._current), i66 = i66 || new K3(), this._current.copyToRenderCamera(i66), i66;
  }
  step(e59, r59) {
    return this.finished || (this.currentTime = n3(this.currentTime + r4(e59)), this.currentTime >= this.time && (this.currentTime = this.time)), this.cameraAt(this.currentTime / this.time, r59);
  }
};

// node_modules/@arcgis/core/views/3d/state/controllers/CameraController.js
var o45;
!function(e59) {
  e59.Ready = "ready", e59.Rejected = "rejected", e59.Running = "running", e59.Stopped = "stopped", e59.Finished = "finished";
}(o45 || (o45 = {}));
var i49 = class extends y {
  constructor() {
    super(...arguments), this.state = o45.Ready;
  }
  get active() {
    return this.state === o45.Running;
  }
  get isInteractive() {
    return false;
  }
  get canStop() {
    return false;
  }
  stopController() {
    return !!this.canStop && (this.state = o45.Stopped, true);
  }
  finishController() {
    this.state = o45.Finished;
  }
  get steppingFinished() {
    return false;
  }
};
e([d({ readOnly: true })], i49.prototype, "active", null), e([d()], i49.prototype, "state", void 0), i49 = e([n6("esri.views.3d.state.controllers.CameraController")], i49);

// node_modules/@arcgis/core/views/3d/state/controllers/AnimationController.js
var a37 = class extends i49 {
  get canStop() {
    return true;
  }
  set asyncResult(t60) {
    this._asyncResult && (this._asyncResult.reject(m3()), this._asyncResult = null), this.state === o45.Finished || this.state === o45.Stopped ? this.state === o45.Finished ? t60.resolve() : t60.reject(m3()) : this._asyncResult = t60;
  }
  get asyncResult() {
    return this._asyncResult;
  }
  onControllerStart() {
    this.state = o45.Running, r(this.viewAnimation) && this.viewAnimation.when(() => this.updateStateFromViewAnimation(), () => this.updateStateFromViewAnimation());
  }
  updateStateFromViewAnimation() {
    !r(this.viewAnimation) || this.state !== o45.Ready && this.state !== o45.Running || (this.viewAnimation.state === n29.State.FINISHED ? this.finish() : this.viewAnimation.state === n29.State.STOPPED && (this.state = o45.Stopped));
  }
  onControllerEnd() {
    r(this.viewAnimation) && !this.viewAnimation.done && (this.state === o45.Finished ? this.viewAnimation.finish() : this.state === o45.Stopped && this.viewAnimation.stop()), this._asyncResult && (this.state === o45.Finished ? this._asyncResult.resolve() : this._asyncResult.reject(m3()));
  }
  finish() {
    this.finishController();
  }
};
a37 = e([n6("esri.views.3d.state.controllers.AnimationController")], a37);

// node_modules/@arcgis/core/views/3d/state/controllers/PointToPointAnimationController.js
var h28 = class extends a37 {
  constructor(i66) {
    super(i66), this.view = null, this.mode = "interaction", this.hasTarget = false;
  }
  get intersectionHelper() {
    return this.view.sceneIntersectionHelper;
  }
  initialize() {
    this.animation = new h27(this.view.state.viewingMode), this.viewAnimation = "interaction" === this.mode ? null : new n29();
  }
  get isInteractive() {
    return "interaction" === this.mode;
  }
  begin(i66, t60) {
    this.hasTarget = true;
    const e59 = this.animationSettings(t60);
    p35.copyFrom(this.view.state.camera);
    const n73 = x6(this.view.state.viewingMode);
    this.intersectionHelper.intersectRay(p35.ray, n73, l30) && (p35.center = l30), this.animation.update(p35, i66, e59), this.animation.finished && this.finish();
  }
  finish() {
    this.animation.currentTime = this.animation.time, super.finish();
  }
  get steppingFinished() {
    return this.hasTarget && this.animation.finished;
  }
  stepController(i66, t60) {
    this.hasTarget && this.animation.step(i66, t60);
  }
  onControllerEnd(i66) {
    this.hasTarget && (this.animation.cameraAt(this.animation.currentTime / this.animation.time, i66), this.animation.currentTime = this.animation.time), super.onControllerEnd(i66);
  }
  animationSettings(i66 = {}) {
    return { apex: { maximumDistance: this.view.state.constraints.clampAltitude(1 / 0) / 6, ascensionFactor: void 0, descensionFactor: void 0 }, ...i66, easing: "string" == typeof i66.easing ? H10[i66.easing] : i66.easing };
  }
};
e([d({ constructOnly: true })], h28.prototype, "view", void 0), e([d({ constructOnly: true })], h28.prototype, "mode", void 0), h28 = e([n6("esri.views.3d.state.controllers.PointToPointAnimationController")], h28);
var p35 = new K3();
var l30 = n7();

// node_modules/@arcgis/core/views/3d/support/geometryUtils/sphere.js
function s46(r59, s63, p52, e59) {
  const n73 = m13(s63, p52, m27);
  return U6(r59, n73, e59);
}
var m27 = d6();

// node_modules/@arcgis/core/views/3d/state/utils/navigationUtils.js
var K5;
!function(t60) {
  t60[t60.Ellipsoid = 0] = "Ellipsoid", t60[t60.Silhouette = 1] = "Silhouette";
}(K5 || (K5 = {}));
var L17 = 30;
var N10 = [1, 3e8];
var O17 = 70;
function Q8(t60, e59, n73) {
  return n73[0] = e59[0] / (t60.fullWidth / t60.pixelRatio), n73[1] = e59[1] / (t60.fullHeight / t60.pixelRatio), n73;
}
function Y3(t60) {
  for (; t60 > Math.PI; )
    t60 -= 2 * Math.PI;
  for (; t60 < -Math.PI; )
    t60 += 2 * Math.PI;
  return t60;
}
function Z4(t60, e59, n73) {
  const o61 = p7(f10.get(), n73[3], v14(n73));
  e7(Ot, t60.eye, e59), L2(Ot, Ot, o61), t60.eye = u3(Ot, Ot, e59), e7(Ot, t60.center, e59), L2(Ot, Ot, o61), t60.center = u3(Ot, Ot, e59), t60.up = L2(Ot, t60.up, o61);
}
function $3(t60, e59, n73, o61) {
  return q2(t60, s30(e59, n73, $t), o61);
}
function _13(t60, e59, n73, o61) {
  return q2(t60, m13(e59, n73, $t), o61);
}
function tt(t60, e59, n73, o61) {
  const r59 = c9.get();
  let a58 = 1 - n73;
  e7(r59, e59, t60.eye);
  const i66 = s8(r59);
  let s63 = i66 * (1 - a58);
  a58 >= 0 && s63 < o61 && (s63 = o61, a58 = -(s63 - i66) / i66), Math.abs(i66 - s63) < 1e-6 || (q(r59, r59, a58), t60.eye = u3(Ot, t60.eye, r59), t60.center = A4(Ot, t60.center, e59, a58));
}
function et2(t60, e59, n73) {
  e59.getScreenCenter(nt), s46(t60, e59, nt, Ot) && (e59.center = Ot);
  const o61 = e59.distance, r59 = o61 * n73;
  if (Math.abs(o61 - r59) < 1e-6)
    return;
  const a58 = q(c9.get(), e59.viewForward, r59);
  e59.eye = e7(Ot, e59.center, a58);
}
var nt = i3();
function rt(t60, e59) {
  o3(e59, 0, 0, 0);
  for (const n73 of t60)
    u3(e59, e59, n73);
  q(e59, e59, 1 / t60.length);
}
function at(t60, e59, n73, o61) {
  return Math.sin(t60 / s8(e59)) * (n73 + o61.radius);
}
function it(t60, e59, n73, o61) {
  return at(Math.PI / 2, e59, n73, o61) + (t60 - Math.PI / 2);
}
var st;
!function(t60) {
  t60[t60.Vertical = 0] = "Vertical", t60[t60.Horizontal = 1] = "Horizontal";
}(st || (st = {}));
var ct = { Elevation: 3e4, Angle: M4(6) };
var mt = { Pole: 0.95, Angle: M4(18), Tilt: 45 };
var ut = M4(80);
function lt(t60, e59, n73, o61, r59, a58) {
  const i66 = n7(), s63 = _3();
  let c67 = true, m40 = true;
  return t60.intersectScreen(n73, i66, a58) ? s63[3] = s8(i66) : (m40 = false, e59.aboveGround && r59 !== K5.Ellipsoid ? s63[3] = Math.max(s8(e59.center), 0.9 * o61.radius) : s63[3] = s8(e59.eye) - e59.relativeElevation, r59 === K5.Silhouette ? Mt(s63, e59, n73, i66) : c67 = s46(s63, e59, n73, i66)), { sphere: s63, scenePickPoint: c67 ? i66 : null, hasGeometryIntersection: m40 };
}
function pt(t60, e59, n73, o61) {
  if (s8(t60.eye) - o61.radius > ct.Elevation)
    return st.Horizontal;
  if (!n73)
    return st.Vertical;
  m13(t60, e59, _t);
  return -Math.sign(t60.relativeElevation) * (0.5 * Math.PI + a18(t60.eye, _t.direction)) < ct.Angle ? st.Vertical : st.Horizontal;
}
function ft(t60, e59, n73) {
  e7(ht, n73, e59), t60.eye = e7(Ot, t60.eye, ht), t60.center = e7(Ot, t60.center, ht);
}
var ht = n7();
function Mt(t60, e59, n73, o61) {
  const a58 = m13(e59, n73, $t);
  return !t(a58) && (B3(t60, a58, yt), U6(t60, a58, o61) ? !(p5(yt, a58.origin) < p5(o61, a58.origin)) || (r7(o61, yt), false) : (e7(gt, e59.eye, e59.center), z2(gt, gt), T6(gt, -P2(z2(gt, gt), yt), dt), q2(dt, a58, o61), false));
}
var yt = n7();
var gt = n7();
var dt = p17();
function bt(r59, a58, i66, s63, c67, m40) {
  let u51;
  if (_(Yt, r59, a58), e7(Qt, r59, a58), s8(r59) <= c67 || !s63.aboveGround) {
    _(i66, Qt, s63.eye);
    const l48 = P2(r59, a58) / (s8(r59) * s8(a58)), p52 = Math.cos(o4(r25.normalize(M4(m40)), 0, ut));
    u51 = -l4(l48) - Math.max(0, s8(a58) - c67) / (p52 * c67);
  } else
    e7(jt, s63.eye, s63.center), _(i66, Qt, jt), u51 = -s8(Qt) / c67;
  return z2(i66, i66), q(i66, i66, s8(Yt)), u51;
}
var jt = n7();
function vt(r59, a58, i66, s63) {
  let c67, m40;
  const u51 = Math.cos(o4(r25.normalize(M4(s63)), 0, ut));
  return c67 = a58 > i66 ? -(a58 - i66) / (u51 * i66) : a58 < -i66 ? Math.PI - (a58 + i66) / (u51 * i66) : l4(a58 / i66), m40 = r59 > i66 ? -(r59 - i66) / (u51 * i66) : r59 < -i66 ? Math.PI - (r59 + i66) / (u51 * i66) : l4(r59 / i66), (m40 - c67) * i66;
}
function zt(t60, e59, n73, o61, r59, a58, i66, s63, c67, m40) {
  const l48 = vt(t60[2], e59[2], i66[3], c67), p52 = m40 ? vt(t60[0], e59[0], i66[3], 180) : e59[0] - t60[0], h44 = Math.sin(s63) * p52 - Math.cos(s63) * l48, M22 = Math.cos(s63) * p52 + Math.sin(s63) * l48;
  z2(Ot, r59);
  const g45 = m40 ? h44 / Math.sqrt(Math.abs(i66[3] ** 2 - P2(n73, Ot) ** 2)) : h44 / i66[3], d32 = M22 / Math.sqrt(Math.abs(i66[3] ** 2 - P2(n73, o61) ** 2));
  r13(a58, g45, d32);
}
function xt(t60, e59, n73, o61, r59, a58, i66, s63, c67, m40) {
  _(Yt, t60, e59), F5(a58.up, a58.eye, Ct, Ft, Rt), F5([0, 0, 1], a58.eye, Ut, Vt, qt), r7(n73, Vt), r7(o61, Ut), z2(n73, n73), q(n73, n73, s8(Yt)), D7(t60, z2(Ft, Ft), z2(Rt, Rt), z2(Ct, Ct), Tt), D7(e59, Ft, Rt, Ct, Wt), zt(Tt, Wt, t60, Ut, Vt, r59, i66, s63, c67, m40);
}
function Pt(t60, e59, n73, o61, r59, a58, c67) {
  p7(Jt, r59, o61), p7(Kt, c67, a58), u5(Lt, Jt, Kt), e7(e59, t60, n73), L2(e59, e59, Lt), u3(e59, e59, n73);
}
function kt(t60, e59, n73, o61, r59, a58) {
  p7(Jt, o61, n73), p7(Kt, a58, r59), u5(Lt, Jt, Kt), e7(Ot, t60.eye, e59), L2(Ot, Ot, Lt), t60.eye = u3(Ot, Ot, e59), e7(Ot, t60.center, e59), L2(Ot, Ot, Lt), t60.center = u3(Ot, Ot, e59), e7(Ot, t60.up, e59), L2(Ot, Ot, Lt), t60.up = u3(Ot, Ot, e59);
}
function It2(t60, e59, n73, o61, r59, a58, i66 = mt.Pole, s63 = mt.Angle) {
  const c67 = Math.abs(o61) > Math.PI - s63 || Math.abs(o61) < s63, m40 = Math.abs(t60[2]) < n73 * i66 || Math.abs(e59) > n73;
  return !!(c67 && m40 && a58.aboveGround && r59 < mt.Tilt);
}
function wt(t60, e59, n73, o61, r59, a58) {
  if (a58)
    k9(n73, o61, Dt), Z4(e59, t60, Dt);
  else {
    const a59 = bt(n73, o61, Zt, e59, t60[3], r59);
    Z4(e59, t60, m19(Zt, a59));
  }
}
function Et(t60, e59, n73, o61, r59, a58, i66) {
  const s63 = i66 ? 20 : 1, c67 = 1e-12;
  let m40, u51;
  r7(Nt, o61), Xt.copyFrom(e59);
  for (let l48 = 0; l48 < s63 && p5(n73, Nt) > c67 && (m40 = p5(n73, Nt), xt(n73, Nt, Vt, Ut, Bt, Xt, t60, r59, a58, i66), kt(Xt, t60, Ut, Bt[1], Vt, Bt[0]), Pt(Nt, Nt, t60, Ut, Bt[1], Vt, Bt[0]), u51 = p5(n73, Nt), u51 < m40 || 0 === l48); l48++)
    e59.copyFrom(Xt);
}
function St(n73, o61, r59, a58, i66, s63, c67) {
  It2(r59, P2(o61.up, r59), n73[3], -r25.normalize(M4(i66)), s63, o61, mt.Pole, mt.Angle) ? Et(n73, o61, r59, a58, -r25.normalize(M4(i66)), s63, c67) : wt(n73, o61, r59, a58, s63, c67);
}
function At(t60, e59, n73, o61, r59, a58) {
  const { eye: i66 } = t60;
  F5([0, 0, 1], i66, Ut, Vt, qt);
  const s63 = e59.translation[0] * n73.pan, m40 = "zoom" === r59.mode ? 0 : e59.translation[1] * n73.pan, u51 = Math.max(Math.sqrt(Math.abs(1 - P2(t60.center, Ut) ** 2 / s8(t60.center) ** 2)), 0.5), l48 = (Math.sin(a58) * m40 + Math.cos(a58) * s63) / u51, p52 = -Math.cos(a58) * m40 + Math.sin(a58) * s63;
  switch (f5(o61.pan.matrix, o61.pan.matrix, l48, Ut), o61.pan.enabled = true, r59.mode) {
    case "pan":
      f5(o61.pan.matrix, o61.pan.matrix, p52, Vt), o61.pan.enabled = true;
      break;
    case "zoom":
      o61.zoom = -e59.translation[1] * n73.zoom;
  }
}
function Ht(t60, e59, n73, o61, r59) {
  const { eye: a58, viewRight: i66 } = t60, s63 = _(c9.get(), i66, a58), m40 = e59.translation[0] * n73.pan;
  switch (0 !== m40 && (f5(o61.pan.matrix, o61.pan.matrix, -m40, s63), o61.pan.enabled = true), r59.mode) {
    case "pan": {
      const t61 = e59.translation[1] * n73.pan;
      0 !== t61 && (f5(o61.pan.matrix, o61.pan.matrix, t61, i66), o61.pan.enabled = true);
      break;
    }
    case "zoom":
      o61.zoom = -e59.translation[1] * n73.zoom;
  }
}
function Gt(n73, o61, r59, a58, i66, s63, c67, m40, u51) {
  It2(n73.center, P2(n73.up, n73.center), s8(n73.center), -r25.normalize(M4(s63)), c67, o61) ? At(o61, r59, a58, m40, u51, -r25.normalize(M4(i66))) : Ht(o61, r59, a58, m40, u51);
}
var Ut = n7();
var Vt = n7();
var qt = n7();
var Ct = n7();
var Ft = n7();
var Rt = n7();
var Tt = n7();
var Wt = n7();
var Bt = n17();
var Dt = i41();
var Jt = e12();
var Kt = e12();
var Lt = e12();
var Nt = n7();
var Ot = n7();
var Qt = n7();
var Xt = new K3();
var Yt = n7();
var Zt = n7();
var $t = { origin: n7(), direction: n7() };
var _t = { origin: n7(), direction: n7() };

// node_modules/@arcgis/core/views/3d/state/controllers/global/ZoomStepController.js
var z10 = 0.6;
var U19 = 4;
var V9 = 12;
var x21 = 60;
var _14 = 200;
var F10 = class extends h28 {
  constructor() {
    super(...arguments), this.zoomLocation = n7(), this.tmpCamera = new K3(), this.tmpViewDir = n7(), this.tmpRayDir = { origin: n7(), direction: n7() }, this.targetOnSphere = n7(), this.tmpCenter = n7(), this.constraintOptions = { selection: N8.ALL_EXCEPT_COLLISION, interactionType: i43.ZOOM, interactionFactor: null, interactionStartCamera: new K3(), interactionDirection: null, tiltMode: m21.TUMBLE }, this.sphere = _3();
  }
  initialize() {
    this.intersector = x6(this.view.state.viewingMode);
  }
  zoomStep(t60, i66) {
    if (!this.active)
      return;
    const e59 = this.view.state, { interactionStartCamera: s63 } = this.constraintOptions;
    this.animation.finished ? s63.copyFrom(e59.camera) : this.animation.cameraAt(1, s63);
    let o61 = false, a58 = false;
    this.intersectionHelper.intersectScreen(i66, this.zoomLocation, 0 === this.view.map.ground.opacity ? A28 : {}) && (o61 = t60 > 0, a58 = true), this.tmpCamera.copyFrom(e59.camera), o61 ? this.intersectionHelper.intersectRay(this.tmpCamera.ray, this.intersector, this.tmpCenter) && (this.tmpCamera.center = this.tmpCenter) : this.intersectionHelper.intersectRay(this.tmpCamera.ray, this.intersector, this.zoomLocation) ? this.tmpCamera.center = this.zoomLocation : r7(this.zoomLocation, this.tmpCamera.center), this._updateCamera(this.tmpCamera, t60, this.zoomLocation, i66, a58), this.begin(this.tmpCamera);
  }
  animationSettings() {
    return { apex: null, duration: n3(600), easing: f20 };
  }
  _updateCamera(t60, i66, e59, r59, p52) {
    const y33 = p3(this.view.spatialReference), w25 = pt(t60, r59, p52, y33);
    let g45;
    this.view.camera.position.hasZ && (g45 = Math.abs(this.view.camera.position.z)), z2(k17, t60.eye), q(k17, k17, -1), m13(t60, r59, this.tmpRayDir), z2(this.tmpRayDir.direction, this.tmpRayDir.direction);
    const u51 = Math.max(Math.min(V9, 1 / Math.abs(P2(k17, this.tmpRayDir.direction))) * g45, _14);
    if (w25 === st.Horizontal) {
      let s63 = z10 ** i66;
      this.sphere[3] = s8(e59), e7(this.tmpViewDir, t60.center, t60.eye);
      const a58 = Math.min(s8(this.tmpViewDir), u51);
      let p53 = a58 * s63;
      if (s63 <= 1 && p53 < U19 && (p53 = U19, s63 = p53 / a58), Math.abs(a58 - p53) < 1e-6)
        return;
      const l48 = s8(t60.center);
      if (this.sphere[3] !== l48) {
        const i67 = this.sphere[3] + s63 * (l48 - this.sphere[3]);
        t60.center = q(T17, t60.center, i67 / l48);
      }
      q(this.tmpViewDir, this.tmpViewDir, -s63), t60.eye = u3(T17, t60.center, this.tmpViewDir), E21(this.view, t60, this.constraintOptions), p5(e59, t60.center) > 1e-12 && s46(this.sphere, t60, r59, this.targetOnSphere) && St(this.sphere, t60, e59, this.targetOnSphere, this.view.camera.heading, this.view.camera.tilt, true);
    } else {
      let s63 = z10 ** Math.abs(i66);
      const a58 = i66 > 0 ? 1 : -1;
      e7(this.tmpViewDir, e59, t60.eye);
      const h44 = s8(this.tmpViewDir), l48 = this.view._stage.renderView.getMinimalDepthForArea(null, r59[0], r59[1], this.view.state.camera, x21);
      let y34 = l48 ? Math.min(u51, l48) : u51;
      y34 = p52 ? Math.min(y34, h44) : y34, q(this.tmpRayDir.direction, this.tmpRayDir.direction, y34), u3(e59, this.tmpRayDir.origin, this.tmpRayDir.direction);
      let f37 = y34 * s63;
      const w26 = Math.max(U19, 1.01 * t60.nearFar[0]);
      if (i66 > 0 && f37 < w26 && (f37 = w26, s63 = f37 / y34), Math.abs(y34 - f37) < 1e-6)
        return;
      q(this.tmpRayDir.direction, this.tmpRayDir.direction, a58 * (1 - s63)), t60.eye = u3(T17, t60.eye, this.tmpRayDir.direction), t60.center = u3(T17, t60.center, this.tmpRayDir.direction);
    }
    o41(this.view, t60);
  }
};
F10 = e([n6("esri.views.3d.state.controllers.global.ZoomStepController")], F10);
var T17 = n7();
var k17 = n7();
var A28 = { exclude: /* @__PURE__ */ new Set([j8]) };

// node_modules/@arcgis/core/views/3d/state/controllers/local/ZoomStepController.js
var L18 = 0.6;
var d22 = 4;
var z11 = 60;
var M14 = 14;
var S12 = 200;
var F11 = class extends h28 {
  constructor() {
    super(...arguments), this.zoomLocation = n7(), this.tmpCamera = new K3(), this.tmpRayDir = n7(), this.tmpCenter = n7(), this.constraintOptions = { selection: N8.ALL, interactionType: i43.ZOOM, interactionFactor: null, interactionStartCamera: new K3(), interactionDirection: null, tiltMode: m21.TUMBLE };
  }
  zoomStep(t60, e59) {
    if (!this.active)
      return;
    const i66 = this.view.state, { interactionStartCamera: p52 } = this.constraintOptions;
    this.animation.finished ? p52.copyFrom(i66.camera) : this.animation.cameraAt(1, p52), this.tmpCamera.copyFrom(i66.camera);
    const l48 = x6(this.view.state.viewingMode);
    t60 > 0 ? (0 === this.view.map.ground.opacity ? this.intersectionHelper.intersectScreenFreePointFallback(e59, this.zoomLocation, O18) : this.intersectionHelper.intersectScreenFreePointFallback(e59, this.zoomLocation), this.intersectionHelper.intersectRay(this.tmpCamera.ray, l48, this.tmpCenter) && (this.tmpCamera.center = this.tmpCenter)) : this.intersectionHelper.intersectRay(this.tmpCamera.ray, l48, this.zoomLocation) ? this.tmpCamera.center = this.zoomLocation : r7(this.zoomLocation, this.tmpCamera.center);
    const C25 = L18 ** t60;
    let y33 = this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm, e59[0], e59[1], this.view.state.camera, z11);
    e7(x22, this.tmpCamera.eye, this.zoomLocation), z2(x22, x22);
    const u51 = Math.max(Math.min(M14, 1 / Math.abs(P2(R11, x22))) * Math.abs(this.view.camera.position.z), S12);
    if (y33 = y33 ? Math.min(y33, u51) : u51, y33) {
      const t61 = n7();
      e7(t61, this.zoomLocation, this.tmpCamera.eye), y33 < s8(t61) && (z2(t61, t61), u3(this.zoomLocation, this.tmpCamera.eye, q(t61, t61, y33)));
    }
    this._updateCamera(this.tmpCamera, C25, this.zoomLocation), this.begin(this.tmpCamera);
  }
  animationSettings() {
    return { apex: null, duration: n3(600), easing: f20 };
  }
  _updateCamera(t60, e59, i66) {
    e7(this.tmpRayDir, i66, t60.eye);
    const o61 = s8(this.tmpRayDir);
    let a58 = o61 * e59;
    const r59 = e59 <= 1, m40 = Math.max(d22, 1.01 * t60.nearFar[0]);
    r59 && a58 < m40 && (a58 = m40, e59 = a58 / o61), Math.abs(o61 - a58) < 1e-6 || (q(this.tmpRayDir, this.tmpRayDir, e59), t60.eye = e7(D13, i66, this.tmpRayDir), t60.center = A4(D13, t60.center, i66, 1 - e59), E21(this.view, t60, this.constraintOptions));
  }
};
F11 = e([n6("esri.views.3d.state.controllers.local.ZoomStepController")], F11);
var D13 = n7();
var R11 = r6(0, 0, 1);
var x22 = n7();
var O18 = { exclude: /* @__PURE__ */ new Set([j8]) };

// node_modules/@arcgis/core/views/3d/input/handlers/DoubleClickZoom.js
var s47 = class extends i17 {
  constructor(o61, t60) {
    super(true), this.view = o61, this.registerIncoming("double-click", t60, (o62) => this._handleDoubleClick(o62));
  }
  _handleDoubleClick(r59) {
    const s63 = r59.data;
    if (t21(s63, "primary")) {
      const i66 = this.view.state.isGlobal ? new F10({ view: this.view, mode: "animation" }) : new F11({ view: this.view, mode: "animation" });
      this.view.state.switchCameraController(i66), i66.zoomStep(Math.log(0.5) / Math.log(0.6), i3(s63.x, s63.y)), r59.stopPropagation();
    }
  }
};

// node_modules/@arcgis/core/views/3d/state/controllers/InteractiveController.js
var a38 = class extends i49 {
  constructor() {
    super(...arguments), this.startCamera = new K3(), this.currentCamera = new K3();
  }
  get isInteractive() {
    return true;
  }
  stepController(r59, e59) {
    e59.copyViewFrom(this.currentCamera), this.currentCamera.copyFrom(e59);
  }
  onControllerStart(r59) {
    this.state = o45.Running, this.startCamera.copyFrom(r59), this.currentCamera.copyFrom(r59);
  }
  onControllerEnd(r59) {
    r59.copyViewFrom(this.currentCamera);
  }
};
a38 = e([n6("esri.views.3d.state.controllers.InteractiveController")], a38);

// node_modules/@arcgis/core/views/3d/state/controllers/RotateController.js
var g27;
!function(t60) {
  t60[t60.CENTER = 0] = "CENTER", t60[t60.EYE = 1] = "EYE";
}(g27 || (g27 = {}));
var k18 = 7;
var A29 = 90;
var L19 = class extends a38 {
  constructor(t60) {
    super(t60), this.view = null, this.pivot = g27.CENTER, this.lastPoint = n17(), this.tmpWorldUp = n7(), this.tmpViewDir = n7(), this.tmpRotCurPoint = n17(), this.tmpTransf = e12(), this.tmpAxis = n7(), this.tmpPivotPoint = n7(), this.pivotPos = n7(), this.constraintOptions = { selection: N8.ALL, interactionType: i43.TUMBLE, interactionFactor: 0, interactionStartCamera: null, interactionDirection: null, tiltMode: m21.TUMBLE };
  }
  get intersectionHelper() {
    return this.view.sceneIntersectionHelper;
  }
  initialize() {
    this.rotScale = this.pivot === g27.CENTER ? 3 : 1.5;
  }
  begin(t60) {
    if (this.active) {
      switch (this.pivot) {
        case g27.EYE:
          r7(this.pivotPos, this.startCamera.eye), this.constraintOptions.interactionType = i43.LOOK_AROUND, this.constraintOptions.tiltMode = m21.LOOK_AROUND, this.constraintOptions.selection = N8.NONE;
          break;
        case g27.CENTER: {
          const i66 = this.intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray, this.pivotPos);
          i66 || r7(this.pivotPos, this.startCamera.center), this._constrainPivotPoint(t60, i66), this.startCamera.center = this.pivotPos, this.constraintOptions.interactionType = i43.TUMBLE, this.constraintOptions.tiltMode = m21.TUMBLE, this.constraintOptions.selection = N8.ALL & ~N8.DISTANCE;
          break;
        }
      }
      this.constraintOptions.interactionStartCamera = this.startCamera, Q8(this.startCamera, t60, this.lastPoint);
    }
  }
  _constrainPivotPoint(t60, i66) {
    const s63 = this.startCamera, r59 = n7();
    e7(r59, this.pivotPos, s63.eye);
    const e59 = s8(r59);
    let a58 = Math.min(e59, k18 * Math.abs(this.view.camera.position.z));
    const n73 = p3(this.view.spatialReference), h44 = i3(s63.width / s63.pixelRatio * 0.5, s63.height / s63.pixelRatio * 0.5), p52 = pt(this.startCamera, h44, true, n73);
    let c67 = this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm, s63.fullWidth / s63.pixelRatio * 0.5, s63.fullHeight / s63.pixelRatio * 0.5, s63, 2.5 * A29, A29), P22 = this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm, t60[0], t60[1], s63, A29);
    void 0 === c67 && void 0 === P22 || (c67 = void 0 === c67 ? P22 : c67, P22 = void 0 === P22 || p52 === st.Horizontal ? c67 : P22, a58 = c67 > P22 ? P22 : c67, a58 = i66 ? Math.min(a58, e59) : a58), z2(r59, r59), r7(this.pivotPos, u3(this.tmpPivotPoint, s63.eye, q(this.tmpPivotPoint, r59, a58)));
  }
  update(t60) {
    if (this.active) {
      switch (this.pivot) {
        case g27.EYE:
          this.currentCamera.center = this._applyRotation(this.currentCamera, t60, this.currentCamera.center, this.pivotPos);
          break;
        case g27.CENTER:
          this.currentCamera.center = this.pivotPos, this.currentCamera.eye = this._applyRotation(this.currentCamera, t60, this.currentCamera.eye, this.pivotPos);
      }
      E21(this.view, this.currentCamera, this.constraintOptions);
    }
  }
  end() {
    this.active && this.finishController();
  }
  _applyRotation(t60, o61, r59, e59) {
    this.view.renderCoordsHelper.worldUpAtPosition(e59, this.tmpWorldUp), Q8(t60, o61, this.tmpRotCurPoint);
    let h44 = (this.lastPoint[1] - this.tmpRotCurPoint[1]) * this.rotScale, c67 = (this.tmpRotCurPoint[0] - this.lastPoint[0]) * this.rotScale;
    e7(this.tmpViewDir, r59, e59);
    const m40 = s8(this.tmpViewDir), u51 = l4(P2(this.tmpViewDir, this.tmpWorldUp) / m40);
    if (this.pivot === g27.EYE) {
      h44 *= -0.5;
      const t61 = 0.5 * Math.PI - u51, i66 = 0.5 * Math.PI * 0.99;
      h44 = t61 - Math.max(-i66, Math.min(i66, t61 + h44));
    }
    return h44 = o4(h44 + u51, h21.min, h21.max) - u51, _(this.tmpAxis, t60.up, this.tmpViewDir), this.pivot === g27.CENTER && (c67 = -c67), p7(this.tmpTransf, c67, this.tmpWorldUp), f5(this.tmpTransf, this.tmpTransf, h44, this.tmpAxis), L2(this.tmpViewDir, this.tmpViewDir, this.tmpTransf), t60.up = L2(V10, t60.up, this.tmpTransf), u3(V10, e59, this.tmpViewDir), a9(this.lastPoint, this.tmpRotCurPoint), V10;
  }
};
e([d({ constructOnly: true })], L19.prototype, "view", void 0), e([d()], L19.prototype, "pivot", void 0), L19 = e([n6("esri.views.3d.state.controllers.RotateController")], L19);
var V10 = n7();

// node_modules/@arcgis/core/views/3d/input/handlers/DragRotate.js
var a39 = class extends i17 {
  constructor(t60, r59, e59, o61) {
    super(true), this.view = t60, this.pointerAction = r59, this.pivot = e59, this.registerIncoming("drag", o61, (t61) => this._handleDrag(t61));
  }
  _handleDrag(e59) {
    const a58 = e59.data;
    if (a58.pointers.size > 1)
      return;
    if (!r29(e59.data, this.pointerAction))
      return;
    const i66 = i3(a58.center.x, a58.center.y);
    switch (a58.action) {
      case "start":
        this.cameraController && (this.cameraController.end(), this.cameraController = null), this.cameraController = new L19({ view: this.view, pivot: this.pivot }), this.view.state.switchCameraController(this.cameraController), this.cameraController.begin(i66);
        break;
      case "update":
        this.cameraController && this.cameraController.update(i66);
        break;
      case "end":
        this.cameraController && (this.cameraController.end(), this.cameraController = null);
    }
    e59.stopPropagation();
  }
};

// node_modules/@arcgis/core/views/3d/state/controllers/global/ZoomController.js
var H11 = class extends a38 {
  constructor(t60) {
    super(t60), this.view = null, this.pickPoint = n7(), this.tmpP0 = n17(), this.panAxisAngle = i41(), this.tmpRayDir = n7(), this.tmpRayDirPick = n7(), this.targetOnSphere = n7(), this.tmpRay = { origin: n7(), direction: n7() }, this.dragBeginPoint = i3(), this.normalizedAnchorPoint = n17(), this.constraintOptions = { selection: N8.ALL_EXCEPT_COLLISION, interactionType: i43.ZOOM, interactionFactor: 0, interactionStartCamera: null, interactionDirection: null, tiltMode: m21.TUMBLE }, this.sphere = _3(), this.hasPickPoint = false;
  }
  get intersectionHelper() {
    return this.view.sceneIntersectionHelper;
  }
  begin(t60) {
    if (!this.active)
      return;
    a9(this.dragBeginPoint, t60), Q8(this.startCamera, t60, this.normalizedAnchorPoint);
    const e59 = p3(this.view.spatialReference), r59 = lt(this.intersectionHelper, this.startCamera, t60, e59, K5.Ellipsoid, 0 === this.view.map.ground.opacity ? L20 : {});
    if (this.navMode = pt(this.startCamera, t60, r59.hasGeometryIntersection, e59), this.navMode === st.Horizontal)
      this.hasPickPoint = !!r59.scenePickPoint, this.pickPoint = r59.scenePickPoint, this.sphere = r59.sphere;
    else {
      let e60, s63;
      m13(this.startCamera, t60, this.tmpRay), z2(this.tmpRay.direction, this.tmpRay.direction), r59.scenePickPoint && (e7(this.tmpRayDirPick, this.startCamera.eye, r59.scenePickPoint), s63 = s8(this.tmpRayDirPick)), this.view.camera.position.hasZ && (e60 = Math.abs(this.view.camera.position.z));
      let a58 = o4(L17 * e60, N10[0], N10[1]);
      const n73 = this.view._stage.renderView.getMinimalDepthForArea(null, t60[0], t60[1], this.view.state.camera, O17);
      a58 = n73 ? Math.min(a58, n73) : a58, a58 = r59.scenePickPoint ? Math.min(a58, s63) : a58, this.hasPickPoint = true, q(this.tmpRay.direction, this.tmpRay.direction, a58), u3(this.pickPoint, this.tmpRay.origin, this.tmpRay.direction);
    }
    this.constraintOptions.interactionStartCamera = this.startCamera;
  }
  update(t60) {
    if (this.active) {
      if (this.currentCamera.eye = this.startCamera.eye, this.currentCamera.center = this.startCamera.center, this.currentCamera.up = this.startCamera.up, this.navMode === st.Horizontal) {
        e7(this.tmpRayDir, this.currentCamera.center, this.currentCamera.eye);
        const i66 = s8(this.tmpRayDir);
        Q8(this.currentCamera, t60, this.tmpP0);
        const e59 = 12 * (this.normalizedAnchorPoint[1] - this.tmpP0[1]);
        let r59 = i66 * 2 ** e59;
        const s63 = this.view.state.constraints.minimumPoiDistance;
        if (e59 < 0 && r59 < s63 && (r59 = s63), Math.abs(i66 - r59) < 1e-6)
          return;
        if (this.hasPickPoint && r59 < i66) {
          const t61 = 1 - (1 - r59 / i66) * (1 - this.sphere[3] / s8(this.currentCamera.center));
          this.currentCamera.center = q(I16, this.currentCamera.center, t61);
        }
        q(this.tmpRayDir, this.tmpRayDir, -r59 / i66), this.currentCamera.eye = u3(I16, this.currentCamera.center, this.tmpRayDir), this.constraintOptions.interactionFactor = y19(this.dragBeginPoint, t60), E21(this.view, this.currentCamera, this.constraintOptions), this.hasPickPoint && (Mt(this.sphere, this.currentCamera, this.dragBeginPoint, this.targetOnSphere), k9(this.pickPoint, this.targetOnSphere, this.panAxisAngle), Z4(this.currentCamera, this.sphere, this.panAxisAngle));
      } else {
        const i66 = s8(this.tmpRay.direction);
        Q8(this.currentCamera, t60, this.tmpP0);
        const e59 = 12 * (this.normalizedAnchorPoint[1] - this.tmpP0[1]);
        let r59 = i66 * 2 ** e59;
        const s63 = this.view.state.constraints.minimumPoiDistance;
        if (e59 < 0 && r59 < s63 && (r59 = s63), Math.abs(i66 - r59) < 1e-6)
          return;
        q(this.tmpRayDir, this.tmpRay.direction, 1 - r59 / i66), this.currentCamera.eye = u3(I16, this.currentCamera.eye, this.tmpRayDir), this.currentCamera.center = u3(I16, this.currentCamera.center, this.tmpRayDir);
      }
      o41(this.view, this.currentCamera);
    }
  }
  end() {
    this.active && this.finishController();
  }
};
e([d({ constructOnly: true })], H11.prototype, "view", void 0), H11 = e([n6("esri.views.3d.state.controllers.global.ZoomController")], H11);
var I16 = n7();
var L20 = { exclude: /* @__PURE__ */ new Set([j8]) };

// node_modules/@arcgis/core/views/3d/state/controllers/local/ZoomController.js
var S13 = class extends a38 {
  constructor(t60) {
    super(t60), this.view = null, this.tmpP = n7(), this.tmpDir = n7(), this.tmpN = n7(), this.tmpP0 = n17(), this.tmpPoi = n7(), this.tmpRayDir = n7(), this.dragBeginPoint = i3(), this.normalizedAnchorPoint = n17(), this.constraintOptions = { selection: N8.ALL, interactionType: i43.ZOOM, interactionFactor: 0, interactionStartCamera: null, interactionDirection: n7(), tiltMode: m21.TUMBLE }, this.plane = p17();
  }
  get intersectionHelper() {
    return this.view.sceneIntersectionHelper;
  }
  begin(t60) {
    if (!this.active)
      return;
    a9(this.dragBeginPoint, t60), Q8(this.startCamera, t60, this.normalizedAnchorPoint);
    const s63 = this.intersectionHelper.intersectScreenFreePointFallback(t60, this.tmpP, 0 === this.view.map.ground.opacity ? A30 : {});
    e7(this.tmpDir, this.tmpP, this.startCamera.eye);
    const r59 = s8(this.tmpDir);
    let e59;
    z2(this.tmpDir, this.tmpDir), this.view.camera.position.hasZ && (e59 = Math.abs(this.view.camera.position.z));
    let o61 = o4(L17 * e59, N10[0], N10[1]);
    const u51 = this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm, t60[0], t60[1], this.view.state.camera, O17);
    o61 = u51 ? Math.min(o61, u51) : o61, o61 = s63 ? Math.min(o61, r59) : o61, q(this.tmpDir, this.tmpDir, o61), u3(this.tmpP, this.startCamera.eye, this.tmpDir), e7(this.tmpN, this.startCamera.eye, this.startCamera.center), z2(this.tmpN, this.tmpN), this.tmpN[1] < 0 && j2(this.tmpN, this.tmpN), _4(this.tmpP, this.tmpN, this.plane), this.constraintOptions.interactionStartCamera = this.startCamera;
  }
  update(t60) {
    if (!this.active)
      return;
    $3(this.plane, this.currentCamera, this.dragBeginPoint, this.tmpPoi) || r7(this.tmpPoi, this.currentCamera.center), Q8(this.currentCamera, t60, this.tmpP0);
    let i66 = 4 * (this.tmpP0[1] - this.normalizedAnchorPoint[1]);
    a9(this.normalizedAnchorPoint, this.tmpP0), e7(this.tmpRayDir, this.tmpPoi, this.currentCamera.eye);
    const s63 = s8(this.tmpRayDir);
    let r59 = s63 * (1 - i66);
    r7(this.constraintOptions.interactionDirection, this.tmpRayDir), q(this.constraintOptions.interactionDirection, this.constraintOptions.interactionDirection, Math.sign(i66) / s63);
    const e59 = this.view.state.constraints.minimumPoiDistance;
    i66 >= 0 && r59 < e59 && (r59 = e59, i66 = -(r59 - s63) / s63), Math.abs(s63 - r59) < 1e-6 || (q(this.tmpRayDir, this.tmpRayDir, i66), this.currentCamera.eye = u3(k19, this.currentCamera.eye, this.tmpRayDir), A4(k19, this.currentCamera.center, this.tmpPoi, i66), this.tmpPoi[2] > this.startCamera.center[2] ? k19[2] = Math.max(this.startCamera.center[2], k19[2]) : k19[2] = Math.min(this.startCamera.center[2], k19[2]), this.currentCamera.center = k19, this.constraintOptions.interactionFactor = y19(this.dragBeginPoint, t60), E21(this.view, this.currentCamera, this.constraintOptions));
  }
  end() {
    this.active && this.finishController();
  }
};
e([d({ constructOnly: true })], S13.prototype, "view", void 0), S13 = e([n6("esri.views.3d.state.controllers.local.ZoomController")], S13);
var k19 = n7();
var A30 = { exclude: /* @__PURE__ */ new Set([j8]) };

// node_modules/@arcgis/core/views/3d/input/handlers/DragZoom.js
var s48 = class extends i17 {
  constructor(r59, t60, e59) {
    super(true), this.view = r59, this.pointerAction = t60, this.registerIncoming("drag", e59, (r60) => this._handleDrag(r60));
  }
  _handleDrag(o61) {
    const s63 = o61.data;
    if (s63.pointers.size > 1)
      return;
    if (!r29(o61.data, this.pointerAction))
      return;
    const i66 = i3(s63.center.x, s63.center.y);
    switch (s63.action) {
      case "start":
        this.cameraController && (this.cameraController.end(), this.cameraController = null), this.view.state.isGlobal ? this.cameraController = new H11({ view: this.view }) : this.cameraController = new S13({ view: this.view }), this.view.state.switchCameraController(this.cameraController), this.cameraController.begin(i66);
        break;
      case "update":
        this.cameraController && this.cameraController.update(i66);
        break;
      case "end":
        this.cameraController && (this.cameraController.end(), this.cameraController = null);
    }
    o61.stopPropagation();
  }
};

// node_modules/@arcgis/core/views/3d/support/cameraUtilsInternal.js
var l31 = n7();
var u32 = n7();
function h29() {
  return { direction: n7(), up: n7() };
}
function m28(f37, h44, m40, p52, b23) {
  let d32 = z2(l31, f37), g45 = P2(d32, p52);
  const j36 = g45 > 0;
  g45 = Math.abs(g45), g45 > 0.99 && (g45 = Math.abs(P2(h44, p52)), g45 < 0.99 ? (r7(d32, h44), j36 && q(d32, d32, -1)) : d32 = null);
  let k32 = 0;
  if (d32) {
    q(u32, p52, P2(p52, d32)), e7(d32, d32, u32);
    const n73 = P2(d32, b23) / (s8(d32) * s8(b23));
    _(u32, d32, b23);
    k32 = (P2(u32, p52) > 0 ? 1 : -1) * m4(l4(n73));
  }
  const v36 = m4(l4(-P2(p52, f37) / s8(f37)));
  return m40 ? (m40.heading = k32, m40.tilt = v36, m40) : { heading: k32, tilt: v36 };
}

// node_modules/@arcgis/core/chunks/cameraUtilsPlanar.js
var T18 = r6(0, 1, 0);
var j22 = r6(0, 0, 1);
var g28 = e12();
var y20 = n7();
var x23 = n7();
function h30(t60, i66, s63, c67 = h29()) {
  const { direction: m40, up: f37 } = c67;
  return R2(g28, -M4(i66)), b3(g28, g28, M4(s63)), L2(m40, j22, g28), q(m40, m40, -1), L2(f37, T18, g28), c67;
}
function b13(t60, e59, o61, r59) {
  return m28(e59, o61, r59, j22, T18);
}
function v22(t60, e59, o61, r59) {
  const i66 = h30(t60, o61, r59), n73 = n7();
  return q(n73, i66.direction, -e59), u3(n73, n73, t60), { up: i66.up, eye: n73, heading: o61, tilt: r59 };
}
function R12(e59) {
  return m4(e59);
}
function _15(t60) {
  return M4(t60);
}
function E22(t60, e59, o61, r59, i66) {
  const n73 = t60.renderSpatialReference, a58 = t60.map && t60.spatialReference || e59.spatialReference;
  return Hn(e59, y20, n73), Hn(e59, x23, n73), y20[0] -= o61 / 2, x23[0] += o61 / 2, y20[1] -= r59 / 2, x23[1] += r59 / 2, Bn(y20, n73, y20, a58), Bn(x23, n73, x23, a58), i66 ? (i66.xmin = y20[0], i66.ymin = y20[1], i66.xmax = x23[0], i66.ymax = x23[1], i66.spatialReference = a58) : i66 = new M3(y20[0], y20[1], x23[0], x23[1], a58), i66;
}
var H12 = Object.freeze(Object.defineProperty({ __proto__: null, headingTiltToDirectionUp: h30, directionToHeadingTilt: b13, eyeForCenterWithHeadingTilt: v22, lookAtTiltToEyeTilt: R12, eyeTiltToLookAtTilt: _15, toExtent: E22 }, Symbol.toStringTag, { value: "Module" }));

// node_modules/@arcgis/core/chunks/cameraUtilsSpherical.js
var I17 = r6(0, 0, 1);
var P13 = z2(n7(), r6(1, 1, 1));
var v23 = new i16(-180, 180);
var w16 = e12();
var U20 = n7();
var q9 = n7();
function E23(t60, e59, n73, a58 = h29()) {
  _(U20, t60, I17), 0 === P2(U20, U20) && _(U20, t60, P13), p7(w16, -M4(e59), t60), f5(w16, w16, -M4(n73), U20);
  const { up: r59, direction: h44 } = a58;
  return _(r59, U20, t60), z2(r59, r59), L2(r59, r59, w16), z2(h44, t60), j2(h44, h44), L2(h44, h44, w16), a58;
}
function S14(t60, e59, o61, n73) {
  const a58 = U20, i66 = q9;
  return z2(a58, t60), _(q9, a58, I17), 0 === P2(q9, q9) && _(q9, a58, P13), _(i66, q9, a58), m28(e59, o61, n73, a58, i66);
}
function _16(t60, e59, n73, i66) {
  const s63 = { eye: n7(), up: null, tilt: i66, heading: n73 }, r59 = U20;
  r59[0] = t60[0], r59[1] = t60[2], r59[2] = -t60[1];
  const c67 = e59, l48 = M4(n73), m40 = M4(i66), f37 = Math.sin(l48), p52 = Math.cos(l48), y33 = Math.sin(m40), d32 = Math.cos(m40), g45 = s8(r59);
  let j36;
  if (Math.abs(m40) < 1e-8)
    j36 = c67 + g45;
  else {
    const t61 = g45 / y33, e60 = b2(c67 / t61), o61 = Math.PI - m40 - e60;
    j36 = t61 * Math.sin(o61);
  }
  const T29 = d32 * c67, b23 = c67 * c67 * (y33 * y33), x30 = p52 * p52 * b23, R21 = j36 - T29, I27 = R21 * R21, P22 = x30 * (x30 + I27 - r59[1] * r59[1]);
  if (P22 < 0)
    return q(s63.eye, r59, j36 / g45), s63.tilt = 0, s63;
  const v36 = Math.sqrt(P22), w25 = r59[1] * R21, q18 = x30 + I27;
  let E39;
  if (E39 = p52 > 0 ? -v36 + w25 : v36 + w25, Math.abs(q18) < 1e-8)
    return g45 < 1e-8 ? (s63.eye[0] = 0, s63.eye[1] = 0, s63.eye[2] = c67) : q(s63.eye, r59, j36 / g45), s63.tilt = 0, H13(s63.eye), W8(s63, t60);
  s63.eye[1] = E39 / q18;
  const S25 = f37 * f37 * b23, _30 = y33 * c67, k32 = p52 * _30 * s63.eye[1], z20 = s63.eye[1] * s63.eye[1], A39 = 1 - z20, C25 = Math.sqrt(A39), G21 = x30 * z20 + S25 - 2 * k32 * C25 * R21 + A39 * I27;
  return Math.abs(G21) < 1e-8 ? (q(s63.eye, r59, j36 / g45), s63.tilt = 0, H13(s63.eye), W8(s63, t60)) : (s63.eye[0] = (A39 * (j36 * r59[0] - T29 * r59[0]) - _30 * C25 * (r59[0] * s63.eye[1] * p52 + r59[2] * f37)) / G21, s63.eye[2] = (A39 * (j36 * r59[2] - T29 * r59[2]) - _30 * C25 * (r59[2] * s63.eye[1] * p52 - r59[0] * f37)) / G21, q(s63.eye, s63.eye, j36), H13(s63.eye), W8(s63, t60));
}
function H13(t60) {
  const e59 = t60[1];
  t60[1] = -t60[2], t60[2] = e59;
}
function W8(t60, e59) {
  const o61 = E23(e59, t60.heading, t60.tilt);
  return t60.up = o61.up, t60;
}
function k20(t60, e59, o61) {
  const i66 = s8(e59), s63 = Math.sqrt(o61 * o61 + i66 * i66 - 2 * o61 * i66 * Math.cos(Math.PI - t60)), r59 = b2(o61 / (s63 / Math.sin(t60)));
  return m4(t60 - r59);
}
function z12(t60, e59, n73) {
  const i66 = M4(t60), s63 = s8(e59);
  return b2(n73 / (s63 / Math.sin(i66))) + i66;
}
function A31(t60, a58, i66, s63, r59) {
  let c67, l48, m40, f37;
  const p52 = a58.latitude, h44 = p3(t60.spatialReference).radius, u51 = a58.longitude, y33 = c44(p52, i66, h44) / 2;
  c67 = u51 - y33, l48 = u51 + y33;
  const M22 = M4(p52), b23 = (1 + Math.sin(M22)) / (1 - Math.sin(M22)), x30 = (b23 + 1) * Math.tan(s63 / h44 / 2), I27 = x30 * x30;
  function P22(t61) {
    const o61 = Math.PI / 2;
    return (t61 = o22.normalize(t61, -o61)) > o61 && (t61 = Math.PI - t61), t61;
  }
  if (m40 = 1.5 * Math.PI - 2 * Math.atan(0.5 * (x30 + Math.sqrt(4 * b23 + I27))), f37 = m40 + s63 / h44, m40 = P22(m40), f37 = P22(f37), f37 < m40) {
    const t61 = f37;
    f37 = m40, m40 = t61;
  }
  if (m40 = Math.max(m4(m40), -90), f37 = Math.min(m4(f37), 90), l48 = v23.monotonic(c67, l48), l48 - c67 > 180) {
    const t61 = (l48 - c67 - 180) / 2;
    c67 += t61, l48 -= t61;
  }
  const w25 = t60.spatialReference && t60.spatialReference.isGeographic ? t60.spatialReference : k2.WGS84;
  return r59 ? (r59.xmin = c67, r59.ymin = m40, r59.xmax = l48, r59.ymax = f37, r59.spatialReference = w25) : r59 = new M3(c67, m40, l48, f37, w25), t60.spatialReference && t60.spatialReference.isWebMercator && R(r59, false, r59), r59;
}
var C14 = Object.freeze(Object.defineProperty({ __proto__: null, headingTiltToDirectionUp: E23, directionToHeadingTilt: S14, eyeForCenterWithHeadingTilt: _16, lookAtTiltToEyeTilt: k20, eyeTiltToLookAtTilt: z12, toExtent: A31 }, Symbol.toStringTag, { value: "Module" }));

// node_modules/@arcgis/core/views/3d/support/cameraUtils.js
var P14 = s3.getLogger("esri.views.3d.support.cameraUtils");
var L21 = 39.37;
var E24 = 96;
var G14 = 1;
var O19 = 8;
var k21 = 5;
var I18 = 1;
var q10 = n7();
var J7 = n7();
var F12 = { heading: 0, tilt: 0 };
var W9 = new j();
var X5 = new i16(-20037508342788905e-9, 20037508342788905e-9);
var K6 = new i16(-180, 180);
var Y4;
function N11(e59) {
  return e59.spatialReference || k2.WGS84;
}
function V11(e59) {
  return "global" === e59.viewingMode ? C14 : H12;
}
function Z5(e59, t60, n73, r59, i66) {
  return V11(e59).headingTiltToDirectionUp(t60, n73, r59, i66);
}
function B8(e59, t60) {
  if (t(t60))
    return null;
  const n73 = e59.renderSpatialReference, i66 = V11(e59).headingTiltToDirectionUp, a58 = n7();
  if (!Hn(t60.position, a58, n73))
    return null;
  const s63 = i66(a58, t60.heading, t60.tilt);
  q(s63.direction, s63.direction, e59.state.camera.distance), u3(s63.direction, s63.direction, a58);
  const c67 = g23(e59, a58, s63.direction, s63.up);
  return c67.fov = M4(t60.fov), c67;
}
!function(e59) {
  e59[e59.LOCKED = 0] = "LOCKED", e59[e59.ADJUST = 1] = "ADJUST";
}(Y4 || (Y4 = {}));
var Q9 = n7();
function $4(t60, n73, r59) {
  const a58 = t60.renderSpatialReference, s63 = re2(t60, n73.eye, n73.viewForward, n73.up, F12);
  let c67 = N11(t60);
  return Bn(n73.eye, a58, Q9, c67) || (c67 = k2.WGS84, Bn(n73.eye, a58, Q9, c67)), t(r59) ? new d7(new j(Q9, c67), s63.heading, s63.tilt, m4(n73.fov)) : (r59.position.x = Q9[0], r59.position.y = Q9[1], r59.position.z = Q9[2], r59.position.spatialReference = c67, r59.heading = s63.heading, r59.tilt = s63.tilt, r59.fov = m4(n73.fov), r59);
}
function _17(e59, t60, n73) {
  const i66 = e59.state.camera, o61 = i66.width / 2 / i66.pixelRatio;
  e59.renderCoordsHelper.viewingMode === l13.Global && null != n73 && (t60 *= Math.cos(M4(n73))), t60 /= e59.renderCoordsHelper.unitInMeters;
  return o61 / (E24 * L21 / t60) / Math.tan(i66.fovX / 2);
}
function ee2(e59, t60, n73) {
  const i66 = e59.state.camera, o61 = t60 * Math.tan(i66.fovX / 2), a58 = i66.width / 2 / i66.pixelRatio;
  let s63 = E24 * L21 / (a58 / o61);
  return e59.renderCoordsHelper.viewingMode === l13.Global && (s63 /= Math.cos(M4(n73))), s63 *= e59.renderCoordsHelper.unitInMeters, s63;
}
function te2(e59, t60, n73, r59, i66, o61) {
  return ne2(e59, t60, _17(e59, n73, t60.latitude), r59, i66, o61);
}
function ne2(e59, t60, n73, r59, i66, a58) {
  if (Te(a58)) {
    const s64 = new Se(a58.signal);
    return ce2(e59, r59.heading, r59.tilt, t60, n73, i66, s64), void s64.resolver.promise.then((t61) => {
      const n74 = Re2(e59, t61, r59.fov);
      if (!t(n74))
        return a58.resolver.resolve(n74);
      a58.resolver.reject();
    }, (e60) => a58.resolver.reject(e60));
  }
  const s63 = ce2(e59, r59.heading, r59.tilt, t60, n73, i66);
  return Re2(e59, s63, r59.fov, a58);
}
function re2(e59, t60, n73, r59, i66) {
  return V11(e59).directionToHeadingTilt(t60, n73, r59, i66);
}
function ie2(e59, t60) {
  return !!(e59.basemapTerrain && e59.renderCoordsHelper.fromRenderCoords(t60, W9, e59.spatialReference) && c(i21(e59.elevationProvider, W9), 0) > W9.z - I18);
}
async function oe2(e59, t60, n73) {
  if (!e59.renderCoordsHelper.fromRenderCoords(t60, W9, e59.spatialReference))
    return false;
  const r59 = await e59.elevationProvider.queryElevation(W9.x, W9.y, W9.z, W9.spatialReference, "ground", n73);
  return c(r59, 0) > W9.z - I18;
}
async function ae2(e59, t60, n73) {
  const r59 = n7();
  if (t60)
    if (t60 instanceof j) {
      if (Hn(t60, r59, e59.renderSpatialReference), null == t60.z && null != e59.basemapTerrain) {
        const i66 = await e59.elevationProvider.queryElevation(t60.x, t60.y, t60.z, t60.spatialReference, "ground", n73);
        return r(i66) && e59.renderCoordsHelper.setAltitude(r59, i66), r59;
      }
    } else
      r7(r59, t60);
  else
    r7(r59, e59.state.camera.center);
  return r59;
}
function se2(e59, t60) {
  const n73 = n7();
  if (t60 && t60 instanceof j) {
    if (Hn(t60, n73, e59.renderSpatialReference), null == t60.z && null != e59.basemapTerrain) {
      const r59 = i21(e59.elevationProvider, t60);
      r(r59) && e59.renderCoordsHelper.setAltitude(n73, r59);
    }
  } else
    r7(n73, t60 || e59.state.camera.center);
  return n73;
}
function ce2(e59, t60, n73, r59, i66, o61, a58) {
  const s63 = r59 && r59 instanceof j ? r59 : null;
  if (Te(a58))
    return ae2(e59, r59, a58.signal).then((r60) => {
      le(e59, t60, n73, s63, r60, i66, o61, a58);
    }, (e60) => a58.resolver.reject(e60)), null;
  const c67 = se2(e59, r59);
  return le(e59, t60, n73, s63, c67, i66, o61, a58);
}
function le(e59, t60, n73, r59, i66, a58, s63, c67) {
  if (t(r59)) {
    const t61 = e59.renderSpatialReference;
    if (r59 = In(i66, t61, N11(e59)), t(r59))
      return null;
  }
  a58 = Math.max(a58, e59.state.constraints.minimumPoiDistance);
  const l48 = pe(e59, t60, n73, i66, a58, s63), f37 = (0, V11(e59).eyeForCenterWithHeadingTilt)(i66, a58, l48.heading, l48.tilt);
  if (s63 === Y4.ADJUST && "global" === e59.viewingMode && n73 > 0) {
    const o61 = () => {
      const o62 = ge2(e59, i66, a58, ve(e59, a58, n73, i66));
      return s63 = n73 - o62 < 1 ? Y4.LOCKED : Y4.ADJUST, le(e59, t60, o62, r59, i66, a58, s63, c67);
    }, l49 = e59.map.ground.navigationConstraint;
    if (!l49 || "stay-above" === l49.type) {
      if (ie2(e59, f37.eye))
        return o61();
      if (Te(c67))
        return oe2(e59, f37.eye, c67.signal).then((e60) => e60 ? o61() : (c67.resolver.resolve({ eye: f37.eye, up: f37.up, center: t5(i66), heading: f37.heading, tilt: f37.tilt }), null)), null;
    }
  }
  const u51 = !c67 || Te(c67) ? { center: n7(), eye: n7(), up: n7(), tilt: 0, heading: 0 } : c67;
  return u51.eye = f37.eye, u51.up = f37.up, u51.center = t5(i66), u51.heading = f37.heading, u51.tilt = f37.tilt, Te(c67) && c67.resolver.resolve(u51), u51;
}
function fe(e59, t60, n73, r59, i66, s63 = null) {
  const c67 = null != t60.zmax && null != t60.zmin;
  let l48, f37, u51;
  if (e59.state.isGlobal) {
    if (!r35(t60.spatialReference, l13.Global))
      return Te(s63) && s63.resolver.reject(), null;
    const e60 = new j(t60.xmin, t60.ymin, t60.spatialReference), n74 = new j(t60.xmax, t60.ymax, t60.spatialReference), r60 = t60.spatialReference.isGeographic ? K6 : X5;
    l48 = new j({ x: r60.center(e60.x, n74.x), y: (n74.y + e60.y) / 2, z: c67 ? (t60.zmax + t60.zmin) / 2 : null, spatialReference: t60.spatialReference });
    const i67 = p3(t60.spatialReference), o61 = i42(l48, e60, n74);
    f37 = o61.lon, u51 = o61.lat, r60.diff(e60.x, n74.x) > r60.range / 2 && (f37 += i67.halfCircumference), f37 = Math.min(f37, i67.halfCircumference), u51 = Math.min(u51, i67.halfCircumference);
  } else {
    const n74 = c(e59.renderSpatialReference, t60.spatialReference);
    n74.equals(t60.spatialReference) || (t60 = rn(t60, n74)), f37 = t60.xmax - t60.xmin, u51 = t60.ymax - t60.ymin;
    const r60 = c67 ? (t60.zmax + t60.zmin) / 2 : null;
    l48 = new j({ x: t60.xmin + 0.5 * f37, y: t60.ymin + 0.5 * u51, z: r60, spatialReference: n74 });
  }
  const m40 = c67 ? t60.zmax - t60.zmin : 0, p52 = e59.state.camera, d32 = 1 / Math.tan(p52.fovX / 2), h44 = 1 / Math.tan(p52.fovY / 2), g45 = 1 / Math.tan(p52.fov / 2), y33 = Math.max(0.5 * f37 * d32, 0.5 * u51 * h44, 0.5 * m40 * g45) / G14;
  if (Te(s63)) {
    const t61 = new Se(s63.signal);
    return ce2(e59, n73, r59, l48, y33, i66, t61), void t61.resolver.promise.then((t62) => {
      const n74 = Re2(e59, t62, e59.camera.fov);
      if (!t(n74))
        return s63.resolver.resolve(n74);
      s63.resolver.reject();
    }, (e60) => s63.resolver.reject(e60));
  }
  const R21 = ce2(e59, n73, r59, l48, y33, i66);
  return Re2(e59, R21, e59.camera.fov, s63);
}
function ue(e59, t60, n73) {
  const r59 = e59.renderSpatialReference, i66 = In(n73, r59, N11(e59));
  if (t(i66))
    return null;
  const a58 = Math.tan(t60.fovX / 2), s63 = Math.tan(t60.fovY / 2), c67 = U2(t60.eye, n73), l48 = 2 * c67 * a58 * G14, f37 = 2 * c67 * s63 * G14;
  return "global" === e59.viewingMode ? A31(e59, i66, l48, f37) : E22(e59, i66, l48, f37);
}
function me2(e59, t60, n73) {
  const r59 = e59.pointsOfInterest.centerOnSurfaceFrequent.distance;
  if (Math.log(n73 / r59) / Math.LN2 > O19)
    return true;
  const i66 = e59.renderSpatialReference, a58 = N11(e59), s63 = In(t60, i66, a58), c67 = In(e59.pointsOfInterest.centerOnSurfaceFrequent.renderLocation, i66, a58);
  if (t(s63) || t(c67))
    return false;
  const l48 = Math.tan(0.5 * e59.state.camera.fov) * r59;
  return c67.distance(s63) / l48 > k21;
}
function pe(e59, t60, n73, r59, i66, o61) {
  let a58 = 0;
  return o61 === Y4.ADJUST && me2(e59, r59, i66) ? (t60 = 0, a58 = he3(e59, i66, n73, r59)) : a58 = ye(e59, r59, i66, n73), a58 = e59.state.constraints.clampTilt(i66, a58), { heading: t60, tilt: n73 = ge2(e59, r59, i66, a58) };
}
var de = 0.7;
function he3(e59, t60, n73, r59) {
  const i66 = e59.state.constraints.tilt(t60);
  i66.max = Math.min(i66.max, 0.5 * Math.PI);
  const o61 = i66.min * (1 - de) + i66.max * de, a58 = ye(e59, r59, t60, n73);
  return Math.min(a58, o61);
}
function ve(e59, t60, n73, r59) {
  const i66 = e59.state.constraints.tilt(t60);
  let o61 = ye(e59, r59, t60, n73);
  return o61 = Math.min(o61, 0.5 * Math.PI), i66.min * (1 - de) + o61 * de;
}
function ge2(e59, t60, n73, r59) {
  return V11(e59).lookAtTiltToEyeTilt(r59, t60, n73);
}
function ye(e59, t60, n73, r59) {
  return V11(e59).eyeTiltToLookAtTilt(r59, t60, n73);
}
function Re2(t60, n73, r59, i66) {
  if (t(n73))
    return null;
  const a58 = t60.renderSpatialReference, c67 = In(n73.eye, a58, N11(t60));
  return t(c67) ? null : r(i66) ? (i66.position = c67, i66.heading = n73.heading, i66.tilt = n73.tilt, i66.fov = r59, i66) : new d7(c67, n73.heading, n73.tilt, r59);
}
function xe(e59, t60) {
  var _a;
  const n73 = (_a = e59.basemapTerrain) == null ? void 0 : _a.tilingScheme;
  if (n73)
    return n73.levelAtScale(t60);
  P14.error("#scaleToZoom()", "Cannot compute zoom from scale without a tiling scheme");
}
function je(e59, t60) {
  var _a;
  const n73 = (_a = e59.basemapTerrain) == null ? void 0 : _a.tilingScheme;
  if (n73)
    return n73.scaleAtLevel(t60);
  P14.error("#zoomToScale()", "Cannot compute scale from zoom without a tiling scheme");
}
function Me(e59, t60) {
  return e59.spatialReference ? i14(t60, e59.spatialReference) : void 0;
}
function we(t60, n73, r59) {
  const i66 = t60.renderSpatialReference;
  let o61, a58;
  n73 || (n73 = t60.state.camera);
  const s63 = k2.WGS84;
  return n73 instanceof d7 ? (o61 = n73.position.latitude, Hn(n73.position, q10, i66), Hn(r59, J7, i66), a58 = x(q10, J7)) : (Bn(n73.center, i66, J7, s63), o61 = J7[1], a58 = n73.distance), ee2(t60, a58, o61);
}
var Se = class {
  constructor(e59) {
    this.signal = e59, this.resolver = D();
  }
};
function Te(e59) {
  return e59 && "resolver" in e59;
}

// node_modules/@arcgis/core/views/3d/state/controllers/GamepadKeyboardController.js
var q11 = class extends a38 {
  constructor(t60) {
    super(t60), this.transformation = { translation: [0, 0, 0], heading: 0, tilt: 0, zoom: 0 }, this.keysButtonState = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], this.tmpCamera = new K3(), this.constraintOptions = { selection: N8.ALL, interactionType: i43.NONE, interactionStartCamera: new K3(), interactionFactor: 0, interactionDirection: null, tiltMode: m21.LOOK_AROUND };
  }
  handleEventGamepad(t60) {
    const e59 = i19(t60, this.view.navigation.gamepad, this.transformation);
    ("end" === t60.action || s19(e59)) && this.finishController();
  }
  activateDirection(t60) {
    this.keysButtonState[t60] = 1, o25(this.keysButtonState, this.transformation);
  }
  deactivateDirection(t60) {
    this.keysButtonState[t60] = 0;
    const e59 = o25(this.keysButtonState, this.transformation);
    s19(e59) && this.finishController();
  }
  onControllerStart(t60) {
    this.filteredSurfaceElevation = this.view.pointsOfInterest.cameraOnSurface.location.z, this.headingStart = this.view.camera.heading, super.onControllerStart(t60);
  }
  _updateFilteredSurfaceElevation(t60) {
    const e59 = this.view.pointsOfInterest.cameraOnSurface.location.z, i66 = 1;
    this.filteredSurfaceElevation += i66 * (e59 - this.filteredSurfaceElevation) * t60;
  }
  stepController(t60, e59) {
    this._updateStartHeading(), this._updateFilteredSurfaceElevation(t60), this.currentCamera.copyViewFrom(e59), this._updateCameraCenter(), this.constraintOptions.interactionStartCamera.copyFrom(this.currentCamera), this._calculateControlTransformation(t60, this.currentCamera, it2), this._applyDisabledMovementTypes(it2), this._applyPan(it2.pan), this._applyRotate(it2.rotate), this._applyZoom(it2.zoom), this._applyAscend(it2.ascend), this.constraintOptions.interactionType = i43.NONE, this.constraintOptions.selection = N8.COLLISION, E21(this.view, this.currentCamera, this.constraintOptions), super.stepController(t60, e59);
  }
  _updateStartHeading() {
    0 !== this.transformation.heading && (this.headingStart = this.view.camera.heading);
  }
  _applyRotate(t60) {
    if (!t60.enabled)
      return;
    const e59 = this.currentCamera;
    e7(at2, e59.center, e59.eye), L2(at2, at2, t60.matrix), e59.center = u3(at2, at2, e59.eye), e59.up = L2(at2, e59.up, t60.matrix), this.constraintOptions.interactionType = i43.LOOK_AROUND, this.constraintOptions.selection = N8.ALL_EXCEPT_COLLISION, E21(this.view, e59, this.constraintOptions);
  }
  _applyPan(t60, e59 = this.currentCamera) {
    if (!t60.enabled)
      return;
    e59.eye = L2(at2, e59.eye, t60.matrix), e59.center = L2(at2, e59.center, t60.matrix);
    this.view.state.isGlobal && (e59.up = L2(at2, e59.up, t60.matrix)), this.constraintOptions.interactionType = i43.PAN, this.constraintOptions.selection = N8.ALL, E21(this.view, e59, this.constraintOptions);
  }
  _applyZoom(t60) {
    if (!t60)
      return;
    const e59 = this.currentCamera.viewForward;
    this.currentCamera.eye = u3(at2, this.currentCamera.eye, q(c9.get(), e59, t60)), r7(rt2, e59), j2(rt2, rt2), this.constraintOptions.interactionDirection = rt2, this.constraintOptions.interactionType = i43.ZOOM, this.constraintOptions.selection = N8.ALL_EXCEPT_COLLISION, E21(this.view, this.currentCamera, this.constraintOptions), this.constraintOptions.interactionDirection = null;
  }
  _applyAscend(t60) {
    if (!t60)
      return;
    const e59 = this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye, c9.get());
    this.constraintOptions.interactionDirection = r7(rt2, e59);
    if (this.view.state.isGlobal) {
      const e60 = s8(this.currentCamera.eye), i66 = (e60 + t60) / e60;
      this.currentCamera.eye = q(at2, this.currentCamera.eye, i66), this.currentCamera.center = q(at2, this.currentCamera.center, i66);
    } else {
      const i66 = q(c9.get(), e59, t60);
      this.currentCamera.eye = u3(at2, this.currentCamera.eye, i66), this.currentCamera.center = u3(at2, this.currentCamera.center, i66);
    }
    this._updateCameraCenter(), this.constraintOptions.interactionType = i43.ASCEND, this.constraintOptions.selection = N8.COLLISION, E21(this.view, this.currentCamera, this.constraintOptions) && this._updateCameraCenter(), this.constraintOptions.selection = N8.ALL_EXCEPT_COLLISION, E21(this.view, this.currentCamera, this.constraintOptions), this.constraintOptions.interactionDirection = null;
  }
  _calculateControlTransformation(t60, e59, i66) {
    st2(i66);
    const a58 = this._computeVelocities(t60);
    this.view.state.isLocal ? this._calculateControlTransformationLocal(a58, e59, i66) : this._calculateControlTransformationGlobal(a58, e59, i66);
  }
  _updateCameraCenter() {
    const t60 = this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude, e59 = this.view.renderCoordsHelper, i66 = this.currentCamera.ray;
    this.currentCamera.center = e59.intersectManifoldClosestSilhouette(i66, t60, at2);
  }
  _calculateControlTransformationLocal(t60, a58, r59) {
    const { viewRight: o61, viewForward: s63 } = a58, n73 = this.transformation, l48 = this.view.navigation.gamepad, p52 = o3(c9.get(), s63[0], s63[1], 0);
    z2(p52, p52);
    const h44 = n73.translation[0] * t60.pan;
    if (0 !== h44) {
      const t61 = q(c9.get(), o61, h44);
      c5(r59.pan.matrix, r59.pan.matrix, t61), r59.pan.enabled = true;
    }
    switch (l48.mode) {
      case "pan": {
        const e59 = -n73.translation[1] * t60.pan;
        if (0 !== e59) {
          const t61 = q(c9.get(), p52, e59);
          c5(r59.pan.matrix, r59.pan.matrix, t61), r59.pan.enabled = true;
        }
        r59.zoom = n73.zoom * t60.zoom;
        break;
      }
      case "zoom":
        r59.zoom = (-n73.translation[1] + n73.zoom) * t60.zoom;
        break;
      default:
        n13(l48.mode);
    }
    const d32 = n73.translation[2] * t60.ascend;
    r59.ascend = d32;
    const u51 = -n73.heading * t60.rotate;
    0 !== u51 && (f5(r59.rotate.matrix, r59.rotate.matrix, u51, this.view.renderCoordsHelper.worldUpAtPosition(a58.eye, c9.get())), r59.rotate.enabled = true);
    const v36 = n73.tilt * t60.rotate, C25 = n48(this.view.renderCoordsHelper, a58.center, a58.eye), g45 = o4(C25 + v36, h21.min, h21.max) - C25;
    g45 && (f5(r59.rotate.matrix, r59.rotate.matrix, g45, o61), r59.rotate.enabled = true);
  }
  _calculateControlTransformationGlobal(t60, e59, i66) {
    const { eye: a58, viewRight: r59 } = e59, o61 = this.transformation, s63 = this.view.navigation.gamepad, n73 = _(c9.get(), r59, a58);
    z2(n73, n73), j2(n73, n73), Gt(this.startCamera, e59, o61, t60, this.view.camera.heading, this.headingStart, this.view.camera.tilt, i66, s63), this.tmpCamera.copyFrom(this.currentCamera), this._applyPan(it2.pan, this.tmpCamera);
    const c67 = this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude, l48 = o61.translation[2] * t60.ascend;
    i66.ascend = l48;
    const p52 = -o61.heading * t60.rotate;
    0 !== p52 && (f5(i66.rotate.matrix, i66.rotate.matrix, p52, this.tmpCamera.eye), i66.rotate.enabled = true);
    const h44 = o61.tilt * t60.rotate, d32 = this._clampTiltDeltaGlobalToValidRange(h44, e59.ray, c67);
    0 !== d32 && (f5(i66.rotate.matrix, i66.rotate.matrix, d32, this.tmpCamera.viewRight), i66.rotate.enabled = true), i66.zoom += o61.zoom * t60.zoom;
  }
  _clampTiltDeltaGlobalToValidRange(t60, e59, r59) {
    const o61 = p3(this.view.spatialReference), s63 = at(h21.min, e59.origin, r59, o61);
    let n73 = 0, c67 = 0;
    const m40 = c9.get();
    if (this.view.renderCoordsHelper.intersectManifold(e59, r59, m40)) {
      const t61 = n48(this.view.renderCoordsHelper, m40, e59.origin);
      n73 = at(t61, e59.origin, r59, o61), c67 = at(h21.max, e59.origin, r59, o61);
    } else {
      B3(T5($, r59 + o61.radius), e59, m40);
      const t61 = l4(-P2(e59.direction, z2(m40, m40)));
      n73 = it(t61, e59.origin, r59, o61), c67 = it(h21.max, e59.origin, r59, o61);
    }
    return o4(n73 + t60, s63, c67) - n73;
  }
  _getPointAbsoluteSurfaceElevation(t60, e59, i66) {
    const { renderCoordsHelper: a58 } = this.view, r59 = a58.getAltitude(t60), o61 = e59 + Math.abs(r59 - e59);
    return a58.setAltitude(i66, o61, t60), o61;
  }
  _clampedDistanceToSurface(t60, e59) {
    const { renderCoordsHelper: i66 } = this.view, { camera: a58 } = this.view.state, { direction: r59 } = Z5(this.view, e59, 0, Q10, ot), o61 = i66.intersectManifoldClosestSilhouette(j7(e59, r59), t60, c9.get()), s63 = x(e59, o61), n73 = i66.intersectManifoldClosestSilhouette(j7(e59, H(c9.get(), e59, a58.center)), t60, c9.get()), c67 = x(e59, n73);
    return Math.min(s63, c67);
  }
  _computeHeadingRotateRadius(t60) {
    const { renderCoordsHelper: e59, state: i66 } = this.view, { camera: r59, isGlobal: o61 } = i66, s63 = e59.intersectManifoldClosestSilhouette(r59.ray, this.filteredSurfaceElevation, c9.get());
    if (o61) {
      const e60 = e7(c9.get(), t60, s63), i67 = s8(e60);
      q(e60, e60, 1 / i67);
      const r60 = z2(c9.get(), t60), o62 = l4(P2(r60, e60));
      return i67 * Math.sin(Math.min(W10, o62));
    }
    {
      const i67 = r7(c9.get(), t60);
      return e59.setAltitude(i67, this.filteredSurfaceElevation), x(s63, i67);
    }
  }
  _minimumAscendVelocity() {
    return this.view.state.constraints.collision.enabled ? 0 : $5;
  }
  _computeVelocities(t60) {
    const e59 = this.filteredSurfaceElevation, a58 = e59 + p3(this.view.spatialReference).radius, { camera: r59, isGlobal: o61 } = this.view.state, s63 = c9.get(), n73 = this._getPointAbsoluteSurfaceElevation(r59.eye, e59, s63), c67 = this._clampedDistanceToSurface(e59, s63), m40 = r59.width / 2, l48 = Y5 * r59.width, p52 = Y5 * r59.width, h44 = c67 * Math.tan(0.5 * r59.fovX) / m40, d32 = h44 / a58, u51 = h44 / this._computeHeadingRotateRadius(s63), f37 = n73 - e59;
    return { pan: (o61 ? d32 : h44) * l48 * t60, ascend: Math.max(this._minimumAscendVelocity() * t60, 2 ** (l48 * t60 / m40) * f37 - f37), zoom: 2 ** (l48 * t60 / m40) * c67 - c67, rotate: o4(u51 * p52, tt2, et3) * t60 };
  }
  _applyDisabledMovementTypes(t60) {
    !r(this.disableMovements) || void 0 !== this.disableMovements.mode && this.view.state.viewingMode !== this.disableMovements.mode || (t60.zoom = this.disableMovements.zoom ? 0 : t60.zoom, t60.ascend = this.disableMovements.ascend ? 0 : t60.ascend, t60.pan.enabled = !this.disableMovements.pan, this.disableMovements.pan && r11(t60.pan.matrix), t60.rotate.enabled = !this.disableMovements.rotate, this.disableMovements.rotate && r11(t60.rotate.matrix));
  }
  static activatesFor(t60, e59) {
    const i66 = i19(e59, t60.navigation.gamepad, J8);
    return !("end" === e59.action || s19(i66));
  }
};
e([d({ constructOnly: true })], q11.prototype, "view", void 0), e([d({ constructOnly: true })], q11.prototype, "gamepadDevice", void 0), e([d({ constructOnly: true })], q11.prototype, "disableMovements", void 0), q11 = e([n6("esri.views.3d.state.controllers.GamepadKeyboardController")], q11);
var J8 = { translation: [0, 0, 0], heading: 0, tilt: 0, zoom: 0 };
var Q10 = 80;
var W10 = M4(Q10);
var Y5 = 0.75;
var $5 = 5;
var tt2 = M4(30);
var et3 = M4(80);
var it2 = { zoom: 0, ascend: 0, pan: { enabled: false, matrix: e12() }, rotate: { enabled: false, matrix: e12() } };
var at2 = n7();
var rt2 = n7();
var ot = h29();
function st2(t60) {
  t60.zoom = 0, t60.ascend = 0, t60.pan.enabled = false, r11(t60.pan.matrix), t60.rotate.enabled = false, r11(t60.rotate.matrix);
}

// node_modules/@arcgis/core/views/3d/input/handlers/GamepadNavigation.js
var l32 = class extends i17 {
  constructor(e59) {
    super(true), this.view = e59, this.watchHandles = new u4(), this.handle = this.registerIncoming("gamepad", (a58) => this._handleEventGamepad(a58)), this.handle.pause();
  }
  onInstall(a58) {
    super.onInstall(a58), this.watchHandles.add([l6(() => this.view.navigation.gamepad.enabled, (a59) => {
      a59 ? this.handle.resume() : (this.handle.pause(), this.cameraControllerGamepad && (this.cameraControllerGamepad.finishController(), this.cameraControllerGamepad = null));
    }, h3), l6(() => this.view.navigation.gamepad.device, (a59) => {
      this.cameraControllerGamepad && a59 && this.cameraControllerGamepad.gamepadDevice !== a59 && (this.cameraControllerGamepad.finishController(), this.cameraControllerGamepad = null);
    })]);
  }
  onUninstall() {
    this.watchHandles.removeAll(), super.onUninstall();
  }
  _handleEventGamepad(a58) {
    const e59 = this.view.navigation.gamepad.device;
    if (e59 && a58.data.device !== e59)
      return;
    const t60 = this.cameraControllerGamepad && this.cameraControllerGamepad.active;
    if (t60 || q11.activatesFor(this.view, a58.data)) {
      if (!t60) {
        const e60 = new q11({ view: this.view, gamepadDevice: a58.data.device });
        this.view.state.switchCameraController(e60) && (this.cameraControllerGamepad = e60);
      }
      this.cameraControllerGamepad && this.cameraControllerGamepad.active && this.cameraControllerGamepad.gamepadDevice === a58.data.device && this.cameraControllerGamepad.handleEventGamepad(a58.data);
    }
  }
};

// node_modules/@arcgis/core/views/3d/input/handlers/KeyboardNavigation.js
var a40;
!function(e59) {
  e59[e59.LEFT = 0] = "LEFT", e59[e59.RIGHT = 1] = "RIGHT", e59[e59.FORWARD = 2] = "FORWARD", e59[e59.BACKWARD = 3] = "BACKWARD", e59[e59.UP = 4] = "UP", e59[e59.DOWN = 5] = "DOWN", e59[e59.HEADINGLEFT = 6] = "HEADINGLEFT", e59[e59.HEADINGRIGHT = 7] = "HEADINGRIGHT", e59[e59.TILTUP = 8] = "TILTUP", e59[e59.TILTDOWN = 9] = "TILTDOWN", e59[e59.ZOOMIN = 10] = "ZOOMIN", e59[e59.ZOOMOUT = 11] = "ZOOMOUT";
}(a40 || (a40 = {}));
var o46 = class extends i17 {
  constructor(t60, r59) {
    super(true), this.view = t60, this.disableMovements = { pan: true, zoom: false, ascend: true, rotate: false, mode: l13.Local }, this.keyToNumber = { [r59.left]: a40.LEFT, [r59.right]: a40.RIGHT, [r59.forward]: a40.FORWARD, [r59.backward]: a40.BACKWARD, [r59.up]: a40.UP, [r59.down]: a40.DOWN, [r59.headingLeft]: a40.HEADINGLEFT, [r59.headingRight]: a40.HEADINGRIGHT, [r59.tiltUp]: a40.TILTUP, [r59.tiltDown]: a40.TILTDOWN, [r59.zoomIn]: a40.ZOOMIN, [r59.zoomOut]: a40.ZOOMOUT }, this.registerIncoming("key-down", null, (e59) => this._handleKeyDown(e59)), this.registerIncoming("key-up", null, (e59) => this._handleKeyUp(e59)), this.registerIncoming("blur", null, () => this._handleBlur());
  }
  _handleKeyDown(e59) {
    if (e59.data.native.ctrlKey || e59.data.native.metaKey)
      return;
    const r59 = this.keyToNumber[e59.data.key];
    null != r59 && (this.cameraControllerKeyboard && this.cameraControllerKeyboard.active || (this.cameraControllerKeyboard = new q11({ view: this.view, disableMovements: this.disableMovements }), this.view.state.switchCameraController(this.cameraControllerKeyboard)), this.cameraControllerKeyboard.active && (this.cameraControllerKeyboard.activateDirection(r59), e59.stopPropagation()));
  }
  _handleBlur() {
    this.cameraControllerKeyboard && this.cameraControllerKeyboard.active && (this.cameraControllerKeyboard.finishController(), this.cameraControllerKeyboard = null);
  }
  _handleKeyUp(e59) {
    if (e59.data.native.ctrlKey || e59.data.native.metaKey)
      return;
    const t60 = this.keyToNumber[e59.data.key];
    null != t60 && this.cameraControllerKeyboard && this.cameraControllerKeyboard.active && (this.cameraControllerKeyboard.deactivateDirection(t60), e59.stopPropagation());
  }
};

// node_modules/@arcgis/core/views/3d/input/handlers/MouseWheelZoom.js
var i50 = class extends i17 {
  constructor(e59, t60) {
    super(true), this.view = e59, this.registerIncoming("mouse-wheel", t60, (e60) => this._handleMouseWheel(e60));
  }
  _handleMouseWheel(r59) {
    if (!this.view.navigation.mouseWheelZoomEnabled)
      return;
    const i66 = r59.data;
    this.cameraController && this.cameraController.active || (this.cameraController = this.view.state.isGlobal ? new F10({ view: this.view, mode: "interaction" }) : new F11({ view: this.view, mode: "interaction" }), this.view.state.switchCameraController(this.cameraController)), this.cameraController.zoomStep(-1 / 60 * i66.deltaY, i3(i66.x, i66.y)), r59.preventDefault(), r59.stopPropagation();
  }
};

// node_modules/@arcgis/core/views/3d/input/util.js
var t47 = class {
  constructor(t60) {
    this._gain = t60;
  }
  reset(t60) {
    this._value = t60;
  }
  set gain(t60) {
    this._gain = t60;
  }
  get value() {
    return void 0 === this._value ? 0 : this._value;
  }
  update(t60) {
    void 0 === this._value ? this._value = t60 : this._value = this._gain * t60 + (1 - this._gain) * this._value;
  }
};

// node_modules/@arcgis/core/views/3d/state/controllers/momentum/MomentumController.js
var p36 = class extends a37 {
  constructor(t60) {
    super(t60), this.view = null, this.beginCamera = new K3(), this.elapsedTimeSec = 0, this.constraintOptions = { selection: N8.ALL, interactionType: i43.PAN, interactionFactor: 0, interactionStartCamera: new K3(), interactionDirection: null, tiltMode: m21.TUMBLE };
  }
  initialize() {
    this.constraintOptions.interactionType = this.interactionType, this.viewAnimation = new n29();
  }
  get steppingFinished() {
    return this.momentum.isFinished(this.elapsedTimeSec);
  }
  onControllerStart(t60) {
    this.beginCamera.copyFrom(t60), this.constraintOptions.interactionStartCamera = this.beginCamera, super.onControllerStart(t60);
  }
  stepController(t60, e59) {
    e59.copyViewFrom(this.beginCamera), this.elapsedTimeSec += t60, this.momentumStep(this.elapsedTimeSec, e59), E21(this.view, e59, this.constraintOptions);
  }
};
e([d({ constructOnly: true })], p36.prototype, "view", void 0), p36 = e([n6("esri.views.3d.state.controllers.momentum.MomentumController")], p36);

// node_modules/@arcgis/core/views/3d/state/controllers/momentum/PanPlanarMomentumController.js
var i51 = class extends p36 {
  constructor(t60) {
    super(t60), this.interactionType = i43.PAN, this.tmpPan = n7();
  }
  momentumStep(t60, o61) {
    const r59 = this.momentum.value(t60);
    q(this.tmpPan, this.momentum.direction, r59), o61.eye = e7(p37, o61.eye, this.tmpPan), o61.center = e7(p37, o61.center, this.tmpPan), this.constraintOptions.interactionDirection = this.tmpPan;
  }
};
e([d({ constructOnly: true })], i51.prototype, "momentum", void 0), i51 = e([n6("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")], i51);
var p37 = n7();

// node_modules/@arcgis/core/views/3d/state/controllers/momentum/PanSphericalMomentumController.js
var p38 = n7();
var u33 = n7();
var l33 = class extends p36 {
  constructor(o61) {
    super(o61), this.interactionType = i43.PAN;
  }
  momentumStep(o61, s63) {
    const t60 = this.momentum.value1(o61), i66 = this.momentum.value2(o61);
    r7(u33, s63.eye), z2(u33, u33), _(this.momentum.axis2, u33, this.momentum.axis1), kt(s63, p38, this.momentum.axis1, t60, this.momentum.axis2, i66);
  }
};
e([d({ constructOnly: true })], l33.prototype, "momentum", void 0), l33 = e([n6("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")], l33);

// node_modules/@arcgis/core/views/3d/state/controllers/momentum/RotationMomentumController.js
var n51 = class extends p36 {
  constructor(t60) {
    super(t60), this.interactionType = i43.TUMBLE;
  }
  set center(t60) {
    this._set("center", t5(t60));
  }
  set axis(t60) {
    this._set("axis", t5(t60));
  }
  momentumStep(t60, o61) {
    const r59 = this.momentum.value(t60);
    Z4(o61, this.center, m19(this.axis, r59));
  }
};
e([d({ constructOnly: true })], n51.prototype, "momentum", void 0), e([d({ constructOnly: true })], n51.prototype, "center", null), e([d({ constructOnly: true })], n51.prototype, "axis", null), n51 = e([n6("esri.views.3d.state.controllers.momentum.MomentumController")], n51);

// node_modules/@arcgis/core/views/3d/state/controllers/momentum/ZoomPlanarMomentumController.js
var p39 = class extends p36 {
  constructor(t60) {
    super(t60), this.interactionType = i43.ZOOM, this.constraintOptions.interactionDirection = n7();
  }
  set zoomCenter(t60) {
    this._set("zoomCenter", t5(t60));
  }
  momentumStep(t60, o61) {
    r7(this.constraintOptions.interactionDirection, o61.eye);
    const r59 = this.momentum.valueDelta(0, t60);
    tt(o61, this.zoomCenter, r59, this.view.state.constraints.minimumPoiDistance), this.constraintOptions.interactionDirection = H(this.constraintOptions.interactionDirection, o61.eye, this.constraintOptions.interactionDirection);
  }
};
e([d({ constructOnly: true })], p39.prototype, "momentum", void 0), e([d({ constructOnly: true })], p39.prototype, "zoomCenter", null), p39 = e([n6("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")], p39);

// node_modules/@arcgis/core/views/3d/state/controllers/momentum/ZoomSphericalMomentumController.js
var j23 = class extends p36 {
  constructor(t60) {
    super(t60), this.interactionType = i43.ZOOM, this.radius = 0, this.tmpSceneCenter = n7(), this.tmpZoomAxisAngle = i41(), this.sphere = _3();
  }
  set screenCenter(t60) {
    this._set("screenCenter", i3(t60[0], t60[1]));
  }
  set sceneCenter(t60) {
    this._set("sceneCenter", t5(t60));
  }
  initialize() {
    this.sphere[3] = this.radius;
  }
  momentumStep(t60, e59) {
    const s63 = this.momentum.valueDelta(0, t60);
    et2(this.sphere, e59, s63), this.constraintOptions.interactionType = i43.ZOOM, E21(this.view, e59, this.constraintOptions), Mt(this.sphere, e59, this.screenCenter, this.tmpSceneCenter), k9(this.sceneCenter, this.tmpSceneCenter, this.tmpZoomAxisAngle), Z4(e59, this.sphere, this.tmpZoomAxisAngle), this.constraintOptions.interactionType = i43.PAN;
  }
};
e([d({ constructOnly: true })], j23.prototype, "momentum", void 0), e([d({ constructOnly: true })], j23.prototype, "screenCenter", null), e([d({ constructOnly: true })], j23.prototype, "sceneCenter", null), e([d({ constructOnly: true })], j23.prototype, "radius", void 0), j23 = e([n6("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")], j23);

// node_modules/@arcgis/core/views/navigation/FilteredValue.js
var e37 = class {
  constructor(e59) {
    this.gain = e59;
  }
  update(e59) {
    this.hasFilteredValue ? this.filteredValue = (1 - this.gain) * this.filteredValue + this.gain * e59 : this.filteredValue = e59;
  }
  reset() {
    this.filteredValue = void 0;
  }
  get hasFilteredValue() {
    return void 0 !== this.filteredValue;
  }
};

// node_modules/@arcgis/core/views/navigation/PanSphericalMomentumEstimator.js
var u34 = 1e-5;
var c49 = class extends t20 {
  constructor(t60, e59, i66, s63, a58, h44 = 0, n73) {
    super(t60, e59, i66), this.angularVelocity1 = s63, this.axis1 = a58, this.angularVelocity2 = h44, this.axis2 = n73;
  }
  value1(t60) {
    return super.valueFromInitialVelocity(this.angularVelocity1, t60);
  }
  value2(t60) {
    return super.valueFromInitialVelocity(this.angularVelocity2, t60);
  }
};
var o47 = class {
  constructor(e59 = 300, i66 = 12, s63 = 0.84) {
    this.minimumInitialVelocity = e59, this.stopVelocity = i66, this.friction = s63, this.enabled = true, this.tmpAxis1 = n7(), this.tmpAxis2 = n7(), this.tmpAngles = n17(), this.time = new t19(0.3), this.screen = [new t19(0.4), new t19(0.4)], this.angle1 = new e37(0.6), this.angle2 = new e37(0.6), this.axis1 = n7(), this.axis2 = n7(), this.lastScene = n7();
  }
  addMomentumDirectRotation(t60, a58, n73, l48, r59, m40) {
    if (this.enabled) {
      if (this.time.hasLastValue) {
        if (this.time.computeDelta(n73) < 0.01)
          return;
        let t61 = bt(this.lastScene, a58, this.tmpAxis2, l48, r59, m40);
        this.angle2.update(0), v3(this.tmpAxis2) < u34 ? t61 = 0 : z2(this.axis1, this.tmpAxis2), this.angle1.update(t61), r7(this.lastScene, a58);
      }
      this.screen[0].update(t60[0]), this.screen[1].update(t60[1]), this.time.update(n73);
    }
  }
  addMomentumPreserveHeading(t60, a58, h44, l48, r59, m40, c67) {
    if (this.enabled) {
      if (this.time.hasLastValue) {
        if (this.time.computeDelta(h44) < 0.01)
          return;
        xt(this.lastScene, a58, this.tmpAxis2, this.tmpAxis1, this.tmpAngles, l48, r59, m40, c67, false), v3(this.tmpAxis2) < u34 ? (this.angle1.update(0), this.angle2.update(0)) : (this.angle1.update(this.tmpAngles[1]), this.angle2.update(this.tmpAngles[0]), z2(this.axis1, this.tmpAxis1), z2(this.axis2, this.tmpAxis2)), r7(this.lastScene, a58);
      }
      this.screen[0].update(t60[0]), this.screen[1].update(t60[1]), this.time.update(h44);
    }
  }
  reset() {
    this.screen[0].reset(), this.screen[1].reset(), this.angle1.reset(), this.angle2.reset(), this.time.reset();
  }
  evaluateMomentum() {
    if (!this.enabled || !this.screen[0].hasFilteredDelta)
      return null;
    const t60 = this.screen[0].filteredDelta, e59 = this.screen[1].filteredDelta, i66 = Math.sqrt(t60 * t60 + e59 * e59) / this.time.filteredDelta;
    return Math.abs(i66) < this.minimumInitialVelocity ? null : this.createMomentum(i66, this.stopVelocity, this.friction);
  }
  createMomentum(t60, e59, i66) {
    const s63 = this.angle1.filteredValue / this.time.filteredDelta, a58 = this.angle2.filteredValue / this.time.filteredDelta;
    return new c49(t60, e59, i66, s63, this.axis1, a58, this.axis2);
  }
};

// node_modules/@arcgis/core/views/3d/state/controllers/global/PinchAndPanController.js
var it3 = class extends a38 {
  constructor(t60) {
    super(t60), this.view = null, this.smoothRotation = new t47(0.05), this.rotationAxis = n7(), this.panningPlane = p17(), this.smoothScaling = new t47(0.05), this.zoomCenterScreen = i3(), this.zoomMomentumEstimator = new s17(), this.rotationMomentumEstimator = new a21(), this.panSphericalMomentumEstimator = new o47(), this.panPlanarMomentumEstimator = new h12(), this.adjustedSphere = _3(), this.tmp3d = n7(), this.tmpScreenPointArray = i3(), this.beginScreenPoint = i3(), this.beginScenePoint = n7(), this.screenPickPoint = i3(), this.navMode = st.Horizontal, this.tmpInteractionDirection = n7(), this.constraintOptions = { selection: N8.ALL, interactionType: i43.NONE, interactionFactor: 0, interactionStartCamera: new K3(), interactionDirection: null, tiltMode: m21.TUMBLE };
  }
  get intersectionHelper() {
    return this.view.sceneIntersectionHelper;
  }
  begin(t60) {
    if (!this.active)
      return;
    const n73 = this.view.navigation.momentumEnabled;
    this.zoomMomentumEstimator.enabled = n73, this.rotationMomentumEstimator.enabled = n73, this.panPlanarMomentumEstimator.enabled = n73, this.panSphericalMomentumEstimator.enabled = n73, this.beginHeading = -r25.normalize(M4(this.view.camera.heading)), this.beginRadius = t60.radius, this.pointerCount = t60.pointers.size, this.beginAngle = t60.angle, this.smoothRotation.reset(), d2(t60.center, this.screenPickPoint), a9(this.beginScreenPoint, this.screenPickPoint);
    const o61 = p3(this.view.spatialReference), r59 = lt(this.intersectionHelper, this.startCamera, this.screenPickPoint, o61, K5.Silhouette);
    this.scenePickPoint = r59.scenePickPoint, this.sphere = r59.sphere, r7(this.beginScenePoint, this.scenePickPoint), this.navMode = pt(this.startCamera, this.screenPickPoint, r59.hasGeometryIntersection, o61), this.navMode === st.Vertical && this._preparePlanarPanMode(t60), this.constraintOptions.interactionStartCamera.copyFrom(this.startCamera);
  }
  _preparePlanarPanMode(t60) {
    const i66 = j2(this.tmp3d, this.startCamera.viewForward);
    _4(this.scenePickPoint, i66, this.panningPlane);
    const e59 = i3(this.screenPickPoint[0], 0), r59 = n7(), a58 = s8(this.startCamera.eye);
    this.adjustedSphere[3] = a58 < this.sphere[3] ? a58 - 100 : this.sphere[3], Mt(this.adjustedSphere, this.startCamera, e59, r59);
    const m40 = x2();
    this.startCamera.projectToRenderScreen(r59, m40);
    const M22 = 0.9 * m40[1];
    this.screenPickPoint[1] = Math.min(this.screenPickPoint[1], M22);
    const C25 = this.intersectionHelper.intersectScreen(this.screenPickPoint, this.scenePickPoint);
    C25 && _4(this.scenePickPoint, Z(this.panningPlane), this.panningPlane);
    const S25 = n7(), f37 = n7(), j36 = n7(), E39 = 80, y33 = 5, O33 = 50;
    e7(S25, this.scenePickPoint, this.currentCamera.eye);
    const k32 = s8(S25);
    z2(S25, S25);
    const A39 = y33 * Math.max(Math.abs(this.view.camera.position.z), O33), z20 = this.view._stage.renderView.getMinimalDepthForArea(null, this.screenPickPoint[0], this.screenPickPoint[1], this.view.state.camera, E39);
    let R21 = z20 ? Math.min(z20, A39) : A39;
    R21 = C25 ? Math.min(R21, k32) : R21, r7(j36, u3(f37, this.currentCamera.eye, q(f37, S25, R21))), this.panningPlane[3] = -P2(this.panningPlane, j36), this.startCamera.center = u3(f37, this.startCamera.eye, q(f37, this.startCamera.viewForward, R21));
    const x30 = d2(t60.center, this.tmpScreenPointArray);
    _13(this.panningPlane, this.startCamera, x30, this.beginScenePoint);
  }
  update(t60) {
    if (!this.active)
      return;
    this.currentCamera.copyFrom(this.startCamera);
    const i66 = t60.pointers.size > 1;
    this.navMode === st.Horizontal ? (i66 && this._zoomSpherical(t60), this._panningSpherical(t60), i66 && this._rotateSpherical(t60)) : (i66 && this._zoomPlanar(t60), this._panningPlanar(t60), i66 && this._rotatePlanar(t60));
  }
  end(t60) {
    t60.pointers.size === this.pointerCount && this.update(t60), this.finishController();
    const i66 = this.zoomMomentumEstimator.evaluateMomentum();
    if (i66)
      return this.navMode === st.Horizontal ? new j23({ view: this.view, momentum: i66, screenCenter: this.zoomCenterScreen, sceneCenter: this.beginScenePoint, radius: this.sphere[3] }) : new p39({ view: this.view, momentum: i66, zoomCenter: this.beginScenePoint });
    const e59 = this.rotationMomentumEstimator.evaluateMomentum();
    if (e59)
      return new n51({ view: this.view, momentum: e59, center: this.sphere, axis: this.rotationAxis });
    if (this.navMode === st.Horizontal) {
      const t61 = this.panSphericalMomentumEstimator.evaluateMomentum();
      if (t61)
        return new l33({ view: this.view, momentum: t61 });
    } else {
      const t61 = this.panPlanarMomentumEstimator.evaluateMomentum();
      if (t61)
        return new i51({ view: this.view, momentum: t61 });
    }
    return null;
  }
  _zoomSpherical(t60) {
    const i66 = this.beginRadius / t60.radius, e59 = 1875e-6 * Math.min(Math.max(t60.radius, 40), 120);
    this.smoothScaling.gain = e59, this.smoothScaling.update(i66), et2(this.sphere, this.currentCamera, this.smoothScaling.value), d2(t60.center, this.zoomCenterScreen), this.zoomMomentumEstimator.add(this.smoothScaling.value, 1e-3 * t60.timestamp), this.constraintOptions.interactionType = i43.ZOOM, this.constraintOptions.interactionFactor = y19(t60.radius - this.beginRadius), E21(this.view, this.currentCamera, this.constraintOptions);
  }
  _panningSpherical(t60) {
    const i66 = d2(t60.center, this.tmpScreenPointArray);
    Mt(this.sphere, this.currentCamera, i66, this.tmp3d), It2(this.beginScenePoint, P2(this.currentCamera.up, this.beginScenePoint), this.sphere[3], this.beginHeading, this.view.camera.tilt, this.startCamera) ? (Et(this.sphere, this.currentCamera, this.beginScenePoint, this.tmp3d, this.beginHeading, this.view.camera.tilt, false), this.panSphericalMomentumEstimator.addMomentumPreserveHeading(i66, this.tmp3d, 1e-3 * t60.timestamp, this.startCamera, this.sphere, this.beginHeading, this.view.camera.tilt)) : (wt(this.sphere, this.currentCamera, this.beginScenePoint, this.tmp3d, this.view.camera.tilt, false), this.panSphericalMomentumEstimator.addMomentumDirectRotation(i66, this.tmp3d, 1e-3 * t60.timestamp, this.startCamera, this.sphere[3], this.view.camera.tilt)), this.constraintOptions.interactionType = i43.PAN, this.constraintOptions.interactionFactor = y19(this.screenPickPoint, i66), E21(this.view, this.currentCamera, this.constraintOptions);
  }
  _rotateSpherical(t60) {
    z2(this.rotationAxis, this.scenePickPoint), this.currentCamera.aboveGround || j2(this.rotationAxis, this.rotationAxis);
    const i66 = this.smoothRotation.value, e59 = i66 + Y3(t60.angle - i66), n73 = 125e-5 * Math.min(Math.max(t60.radius, 40), 120);
    this.smoothRotation.gain = n73, this.smoothRotation.update(e59);
    const s63 = this.smoothRotation.value - this.beginAngle;
    this.rotationMomentumEstimator.add(s63, 1e-3 * t60.timestamp), Z4(this.currentCamera, this.sphere, m19(this.rotationAxis, s63)), this.constraintOptions.interactionType = i43.TUMBLE, this.constraintOptions.interactionFactor = y19(t60.radius * e59), E21(this.view, this.currentCamera, this.constraintOptions);
  }
  _panningPlanar(t60) {
    const i66 = d2(t60.center, this.tmpScreenPointArray);
    _13(this.panningPlane, this.currentCamera, i66, this.tmp3d) && (ft(this.currentCamera, this.beginScenePoint, this.tmp3d), this.panPlanarMomentumEstimator.add(i66, this.tmp3d, 1e-3 * t60.timestamp), this.constraintOptions.interactionType = i43.PAN, this.constraintOptions.interactionFactor = y19(this.beginScreenPoint, i66), this.constraintOptions.interactionDirection = this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye, this.tmpInteractionDirection), E21(this.view, this.currentCamera, this.constraintOptions), this.constraintOptions.interactionDirection = null);
  }
  _zoomPlanar(t60) {
    const i66 = this.beginRadius / t60.radius, e59 = 1875e-6 * Math.min(Math.max(t60.radius, 40), 120);
    this.smoothScaling.gain = e59, this.smoothScaling.update(i66), this.zoomMomentumEstimator.add(this.smoothScaling.value, 1e-3 * t60.timestamp), tt(this.currentCamera, this.beginScenePoint, this.smoothScaling.value, this.view.state.constraints.minimumPoiDistance), this.constraintOptions.interactionType = i43.ZOOM, this.constraintOptions.interactionFactor = y19(t60.radius - this.beginRadius), E21(this.view, this.currentCamera, this.constraintOptions);
  }
  _rotatePlanar(t60) {
    r7(this.rotationAxis, this.beginScenePoint), this.currentCamera.aboveGround || j2(this.rotationAxis, this.rotationAxis);
    const i66 = this.smoothRotation.value;
    let e59 = t60.angle - i66;
    e59 = Y3(e59);
    const n73 = i66 + e59, s63 = 125e-5 * Math.min(Math.max(t60.radius, 40), 120);
    this.smoothRotation.gain = s63, this.smoothRotation.update(n73);
    const o61 = this.smoothRotation.value - this.beginAngle;
    this.rotationMomentumEstimator.add(o61, 1e-3 * t60.timestamp), Z4(this.currentCamera, this.sphere, m19(this.rotationAxis, o61)), this.constraintOptions.interactionType = i43.TUMBLE, this.constraintOptions.interactionFactor = y19(t60.radius * o61), E21(this.view, this.currentCamera, this.constraintOptions);
  }
};
e([d({ constructOnly: true })], it3.prototype, "view", void 0), it3 = e([n6("esri.views.3d.state.controllers.global.PinchAndPanController")], it3);

// node_modules/@arcgis/core/views/3d/state/controllers/local/PinchAndPanController.js
var G15 = r6(0, 0, 1);
var Z6 = { ELEVATION_THRESHOLD: 3e4, ANGLE_THRESHOLD: 16 / 180 * Math.PI };
var B9 = 80;
var W11 = class extends a38 {
  constructor(t60) {
    super(t60), this.view = null, this.rotationValueSmooth = new t47(0.05), this.scalingValueSmooth = new t47(0.05), this.planeHorizontal = p17(), this.planeVertical = p17(), this.rotationMomentumEstimator = new a21(), this.panMomentumEstimator = new h12(300, 12, 0.9), this.zoomMomentumEstimator = new s17(), this.beginCenter = n7(), this.tmpPoints = [], this.beginCenterScreen = i3(), this.tmpCentroid3d = n7(), this.tmpCentroid2d = i3(), this.tmp2d = i3(), this.constraintOptions = { selection: N8.ALL, interactionType: i43.NONE, interactionFactor: 0, interactionStartCamera: new K3(), interactionDirection: null, tiltMode: m21.TUMBLE };
  }
  get intersectionHelper() {
    return this.view.sceneIntersectionHelper;
  }
  begin(t60) {
    if (!this.active)
      return;
    const e59 = this.view.navigation.momentumEnabled;
    this.zoomMomentumEstimator.enabled = e59, this.rotationMomentumEstimator.enabled = e59, this.panMomentumEstimator.enabled = e59, this.beginRadius = t60.radius, this.pointerCount = t60.pointers.size, this.beginAngle = t60.angle, this.rotationValueSmooth.reset(), this.scalingValueSmooth.reset(), d2(t60.center, this.beginCenterScreen), T6(G15, 0, this.planeHorizontal);
    const o61 = n7(), s63 = this.intersectionHelper.intersectScreenFreePointFallback(this.beginCenterScreen, o61), C25 = n7();
    j2(C25, this.startCamera.viewForward);
    const g45 = n7();
    r7(g45, G15);
    const v36 = P2(C25, g45), w25 = b2(v36 < 0 ? -v36 : v36);
    if (this.panMode = w25 >= Z6.ANGLE_THRESHOLD ? st.Horizontal : st.Vertical, L7(this.planeHorizontal, this.planeHorizontal, o61), this.startCamera.aboveGround || P4(this.planeHorizontal, this.planeHorizontal), this.panMode === st.Vertical) {
      q(g45, g45, v36), e7(this.planeVertical, C25, g45), z2(this.planeVertical, this.planeVertical), L7(this.planeVertical, this.planeVertical, o61);
      const i66 = n7(), e60 = n7(), n73 = n7();
      e7(i66, o61, this.currentCamera.eye);
      const r59 = s8(i66);
      z2(i66, i66);
      const M22 = 5 * Math.max(Math.abs(this.view.camera.position.z), 50), f37 = this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm, this.beginCenterScreen[0], this.beginCenterScreen[1], this.view.state.camera, B9);
      let w26 = f37 ? Math.min(f37, M22) : M22;
      w26 = s63 ? Math.min(w26, r59) : w26, r7(n73, u3(e60, this.currentCamera.eye, q(e60, i66, w26))), this.planeVertical[3] = -P2(this.planeVertical, n73), this.computePlanePoints(t60.pointers, this.planeVertical, this.startCamera, this.tmpPoints), rt(this.tmpPoints, this.beginCenter);
    } else
      this.computePlanePoints(t60.pointers, this.planeHorizontal, this.startCamera, this.tmpPoints), rt(this.tmpPoints, this.beginCenter);
    this.constraintOptions.interactionStartCamera.copyFrom(this.startCamera);
  }
  update(t60) {
    if (!this.active)
      return;
    this.currentCamera.copyFrom(this.startCamera);
    const i66 = t60.pointers.size > 1, e59 = this.panMode === st.Horizontal ? this.planeHorizontal : this.planeVertical, o61 = this.beginCenter;
    if (i66) {
      const i67 = this.beginRadius / t60.radius, e60 = 1875e-6 * Math.min(Math.max(t60.radius, 40), 120);
      this.scalingValueSmooth.gain = e60, this.scalingValueSmooth.update(i67), tt(this.currentCamera, o61, this.scalingValueSmooth.value, this.view.state.constraints.minimumPoiDistance), this.zoomMomentumEstimator.add(this.scalingValueSmooth.value, 1e-3 * t60.timestamp), this.constraintOptions.interactionType = i43.ZOOM, this.constraintOptions.interactionFactor = y19(Math.abs(t60.radius - this.beginRadius)), E21(this.view, this.currentCamera, this.constraintOptions);
    }
    if (this.computePlanePoints(t60.pointers, e59, this.currentCamera, this.tmpPoints), rt(this.tmpPoints, this.tmpCentroid3d), d2(t60.center, this.tmpCentroid2d), ft(this.currentCamera, o61, this.tmpCentroid3d), this.panMomentumEstimator.add(this.tmpCentroid2d, this.tmpCentroid3d, 1e-3 * t60.timestamp), this.constraintOptions.interactionType = i43.PAN, this.constraintOptions.interactionFactor = y19(this.beginCenterScreen, this.tmpCentroid2d), E21(this.view, this.currentCamera, this.constraintOptions), i66) {
      const i67 = this.planeHorizontal, e60 = o61, n73 = this.rotationValueSmooth.value, s63 = n73 + Y3(t60.angle - n73), r59 = 125e-5 * Math.min(Math.max(t60.radius, 40), 120);
      this.rotationValueSmooth.gain = r59, this.rotationValueSmooth.update(s63);
      const a58 = this.rotationValueSmooth.value - this.beginAngle;
      this.rotationMomentumEstimator.add(a58, 1e-3 * t60.timestamp), Z4(this.currentCamera, e60, m19(i67, a58)), this.constraintOptions.interactionType = i43.TUMBLE, this.constraintOptions.interactionFactor = y19(Math.abs(t60.radius * a58)), E21(this.view, this.currentCamera, this.constraintOptions);
    }
  }
  end(t60) {
    t60.pointers.size === this.pointerCount && this.update(t60), this.finishController();
    const i66 = this.zoomMomentumEstimator.evaluateMomentum();
    if (i66)
      return new p39({ view: this.view, momentum: i66, zoomCenter: this.beginCenter });
    const e59 = this.rotationMomentumEstimator.evaluateMomentum();
    if (e59)
      return new n51({ view: this.view, momentum: e59, center: this.beginCenter, axis: Z(this.planeHorizontal) });
    const n73 = this.panMomentumEstimator.evaluateMomentum();
    return n73 ? new i51({ view: this.view, momentum: n73 }) : null;
  }
  computePlanePoints(t60, i66, e59, n73) {
    n73.length = t60.size;
    const o61 = this.tmp2d;
    let s63 = 0;
    return t60.forEach((t61) => {
      o61[0] = t61.x, o61[1] = t61.y, void 0 === n73[s63] && (n73[s63] = n7()), _13(i66, e59, o61, n73[s63]), s63 += 1;
    }), n73;
  }
};
e([d({ constructOnly: true })], W11.prototype, "view", void 0), W11 = e([n6("esri.views.3d.state.controllers.local.PinchAndPanController")], W11);

// node_modules/@arcgis/core/views/3d/input/handlers/PinchAndPanNavigation.js
var i52 = class extends i17 {
  constructor(t60, e59, s63) {
    super(true), this.view = t60, this.pointerAction = e59, this.lastEndTimestamp = 0, this.lastTimestamp = 0, this.registerIncoming("drag", s63, (t61) => this._handleDrag(t61));
  }
  _handleDrag(t60) {
    if ("mouse" === t60.data.pointerType && !r29(t60.data, this.pointerAction))
      return;
    const e59 = t60.timestamp - this.lastEndTimestamp, s63 = 40, i66 = this.momentum && this.momentum.active && e59 < s63;
    switch (t60.data.action) {
      case "start":
      case "update":
        if (i66)
          break;
        this.controller && this.controller.active ? t60.data.timestamp - this.lastTimestamp > 2 && (this.controller.update(t60.data), this.lastTimestamp = t60.timestamp) : this._startController(t60);
        break;
      case "end":
      case "removed":
        this._endController(t60, true);
        break;
      case "added":
        this._endController(t60, false), this._startController(t60);
    }
    t60.stopPropagation();
  }
  _endController(t60, e59) {
    if (this.controller && this.controller.active) {
      this.lastEndTimestamp = t60.timestamp;
      const s63 = this.controller.end(t60.data);
      e59 && s63 && (this.momentum = s63, this.view.state.switchCameraController(this.momentum));
    }
    this.controller = null;
  }
  _startController(t60) {
    this.controller = this._createController(), this.view.state.switchCameraController(this.controller), this.controller.begin(t60.data), this.lastTimestamp = t60.timestamp;
  }
  _createController() {
    return this.view.state.isGlobal ? new it3({ view: this.view }) : new W11({ view: this.view });
  }
};

// node_modules/@arcgis/core/views/3d/input/handlers/PointerDownCancelAnimation.js
var e38 = class extends i17 {
  constructor(t60, e59) {
    super(true), this.view = t60, this.registerIncoming("pointer-down", e59, () => this.view.state.stopActiveCameraController());
  }
};

// node_modules/@arcgis/core/views/3d/input/handlers/SingleKey.js
var e39 = class extends i17 {
  constructor(t60, e59) {
    super(true), this.key = t60, this.registerIncoming("key-down", e59, (t61) => this._handleKeyDown(t61));
  }
  _handleKeyDown(t60) {
    t60.data.key === this.key && (this.activate(), t60.stopPropagation());
  }
};

// node_modules/@arcgis/core/views/3d/input/handlers/SingleKeyResetHeading.js
var t48 = class extends e39 {
  constructor(e59, t60, i66) {
    super(t60, i66), this.view = e59;
  }
  activate() {
    this.view.goTo({ heading: 0 }).catch(() => {
    });
  }
};

// node_modules/@arcgis/core/views/3d/input/handlers/SingleKeyResetTilt.js
var e40 = class extends e39 {
  constructor(t60, e59, i66) {
    super(e59, i66), this.view = t60;
  }
  activate() {
    this.view.goTo({ tilt: 0 }).catch(() => {
    });
  }
};

// node_modules/@arcgis/core/views/3d/input/handlers/TwoFingerTilt.js
var o48 = class extends i17 {
  constructor(e59, t60 = false) {
    super(true), this.view = e59, this.invert = t60, this.registerIncoming("vertical-two-finger-drag", (e60) => this._handleTwoFinger(e60));
  }
  _handleTwoFinger(a58) {
    var _a, _b, _c;
    const o61 = this.invert ? -1 : 1, i66 = i3(0, a58.data.delta * o61);
    switch (a58.data.action) {
      case "begin":
        (_a = this.cameraController) == null ? void 0 : _a.end(), this.cameraController = new L19({ view: this.view, pivot: g27.CENTER }), this.view.state.switchCameraController(this.cameraController), this.cameraController.begin(i66);
        break;
      case "update":
        (_b = this.cameraController) == null ? void 0 : _b.update(i66);
        break;
      case "end":
        (_c = this.cameraController) == null ? void 0 : _c.end(), this.cameraController = null;
    }
  }
};

// node_modules/@arcgis/core/views/input/recognizers/VerticalTwoFingerDrag.js
var a41 = class extends i17 {
  constructor(e59 = 20, a58 = 40) {
    super(false), this._threshold = e59, this._maxDelta = a58, this.state = "ready", this.emittedArtificalEnd2 = false, this._vertical = this.registerOutgoing("vertical-two-finger-drag"), this._artificalDrag = this.registerOutgoing("drag"), this.dragEventSeparator = new t22({ start: (t60, e60) => this._observeStart(t60, e60), update: (t60, e60, a59) => this._observeUpdate(t60, e60, a59), end: (t60, e60) => this._observeEnd(e60) }), this.registerIncoming("drag", (t60) => this.dragEventSeparator.handle(t60));
  }
  get failed() {
    return "failed" === this.state;
  }
  _observeStart(t60, e59) {
    1 === t60 && this.emittedArtificalEnd2 && (this.emittedArtificalEnd2 = false, this._artificalDrag.emit({ action: "start", button: e59.data.button, buttons: e59.data.buttons, pointerType: e59.data.pointerType, timestamp: e59.data.timestamp, pointers: e59.data.pointers, pointer: e59.data.pointer, angle: e59.data.angle, radius: e59.data.radius, center: e59.data.center }), e59.stopPropagation()), this.state = 2 === t60 ? "ready" : "failed";
  }
  _observeUpdate(t60, e59, a58) {
    if ("failed" !== this.state && 2 === t60)
      return "active" === this.state ? (this._vertical.emit({ delta: e59.data.center.y - this._thresholdReachedCenter.y, action: "update" }), void e59.stopPropagation()) : void (this._checkMovementWithinLimits(e59.data, a58.data) ? this._checkVerticalThresholdReached(e59.data, a58.data) && (this.state = "active", this.emittedArtificalEnd2 = true, this._thresholdReachedCenter = e59.data.center, this._artificalDrag.emit({ action: "end", button: e59.data.button, buttons: e59.data.buttons, pointerType: e59.data.pointerType, timestamp: e59.data.timestamp, pointers: e59.data.pointers, pointer: e59.data.pointer, angle: e59.data.angle, radius: e59.data.radius, center: e59.data.center }), this._vertical.emit({ delta: e59.data.center.y - this._thresholdReachedCenter.y, action: "begin" }), e59.stopPropagation()) : this.state = "failed");
  }
  _observeEnd(t60) {
    "active" === this.state && (this._vertical.emit({ delta: t60.data.center.y - this._thresholdReachedCenter.y, action: "end" }), this.state = "ready", t60.stopPropagation());
  }
  _checkMovementWithinLimits(t60, e59) {
    let a58 = -1 / 0, i66 = 1 / 0, r59 = -1 / 0, s63 = 1 / 0;
    e59.pointers.forEach((t61) => {
      a58 = Math.max(a58, t61.x), i66 = Math.min(i66, t61.x), r59 = Math.max(r59, t61.y), s63 = Math.min(s63, t61.y);
    });
    let n73 = -1 / 0, h44 = 1 / 0, d32 = -1 / 0, o61 = 1 / 0;
    t60.pointers.forEach((t61) => {
      n73 = Math.max(n73, t61.x), h44 = Math.min(h44, t61.x), d32 = Math.max(d32, t61.y), o61 = Math.min(o61, t61.y);
    });
    const c67 = a58 - i66, l48 = r59 - s63, p52 = n73 - h44, m40 = d32 - o61;
    return Math.abs(t60.center.x - e59.center.x) < this._threshold && Math.abs(p52 - c67) <= this._maxDelta && Math.abs(m40 - l48) <= this._maxDelta;
  }
  _checkVerticalThresholdReached(t60, e59) {
    let a58 = Math.abs(t60.center.y - e59.center.y);
    return t60.pointers.forEach((t61, i66) => {
      const r59 = e59.pointers.get(i66);
      a58 = Math.min(a58, Math.abs(t61.y - r59.y));
    }), a58 >= this._threshold;
  }
};

// node_modules/@arcgis/core/views/3d/input/SceneInputManager.js
var z13 = class extends y {
  constructor() {
    super(...arguments), this._handles = new u4();
  }
  destroy() {
    this._handles && (this._handles.removeAll(), this._handles = null), this.disconnect();
  }
  get primaryDragAction() {
    return this._get("primaryDragAction");
  }
  set primaryDragAction(e59) {
    "pan" !== e59 && "rotate" !== e59 || e59 === this._get("primaryDragAction") || (this._set("primaryDragAction", e59), this._updateMode());
  }
  get mode() {
    return this._get("mode");
  }
  set mode(e59) {
    "default" !== e59 && "pro" !== e59 || e59 === this._get("mode") || (this._set("mode", e59), this._updateMode());
  }
  get hasPendingInputs() {
    var _a;
    return (_a = this._inputManager) == null ? void 0 : _a.hasPendingInputs;
  }
  get latestPointerType() {
    var _a;
    return (_a = this._inputManager) == null ? void 0 : _a.latestPointerType;
  }
  get latestPointerLocation() {
    var _a;
    return (_a = this._inputManager) == null ? void 0 : _a.latestPointerLocation;
  }
  disconnect() {
    this.view.viewEvents.disconnect(), this._inputManager && (this._inputManager.destroy(), this._inputManager = null), this._source && (this._source.destroy(), this._source = null);
  }
  connect() {
    const e59 = this.view;
    this._source = new u15(this.view.surface, e59.input);
    const t60 = [new n31(), new o26(), new a22(), new s20(this.view.navigation), new a41()], r59 = new c16({ eventSource: this._source, recognizers: t60 });
    this._inputManager = r59, r59.installHandlers("prevent-context-menu", [new e22()], g8.INTERNAL), this._modeDragPan = new i52(e59, "primary"), this._modeDragRotate = new a39(e59, "secondary", g27.CENTER), this._modeDragZoom = new s48(e59, "tertiary");
    const i66 = { lookAround: "b", pan: { left: "ArrowLeft", right: "ArrowRight", forward: "ArrowUp", backward: "ArrowDown", up: "u", down: "j", headingLeft: "a", headingRight: "d", tiltUp: "w", tiltDown: "s", zoomIn: "+", zoomOut: "-" }, resetHeading: "n", resetTilt: "p" };
    r59.installHandlers("navigation", [new e38(e59), new s47(e59), new l32(e59), new o46(e59, i66.pan), new i50(e59), new e40(e59, i66.resetTilt), new t48(e59, i66.resetHeading), new a39(e59, "primary", g27.EYE, [i66.lookAround]), new a39(e59, "secondary", g27.CENTER, [i66.lookAround]), new i52(e59, "tertiary", [i66.lookAround]), this._modeDragRotate, this._modeDragZoom, this._modeDragPan, new o48(e59)], g8.INTERNAL), this.view.viewEvents.connect(r59), this._updateMode(), this._handles.add(l6(() => {
      var _a;
      return (_a = this.view.navigation) == null ? void 0 : _a.browserTouchPanEnabled;
    }, (e60) => {
      this._source.browserTouchPanningEnabled = !e60;
    }, h3));
  }
  _updateMode() {
    const e59 = this.mode, t60 = this.primaryDragAction, r59 = E25.get(e59).get(t60);
    this._modeDragPan && (this._modeDragPan.pointerAction = r59.pan), this._modeDragRotate && (this._modeDragRotate.pointerAction = r59.rotate), this._modeDragZoom && (this._modeDragZoom.pointerAction = r59.zoom);
  }
  get test() {
    return { inputManager: this._inputManager, modeDragPan: this._modeDragPan, modeDragRotate: this._modeDragRotate, modeDragZoom: this._modeDragZoom };
  }
};
e([d()], z13.prototype, "view", void 0), e([d({ value: "pan" })], z13.prototype, "primaryDragAction", null), e([d({ value: "default" })], z13.prototype, "mode", null), e([d({ readOnly: true })], z13.prototype, "hasPendingInputs", null), e([d()], z13.prototype, "latestPointerType", null), e([d()], z13.prototype, "latestPointerLocation", null), e([d()], z13.prototype, "_inputManager", void 0), z13 = e([n6("esri.views.3d.input.SceneInputManager")], z13);
var E25 = /* @__PURE__ */ new Map();
var b14 = /* @__PURE__ */ new Map();
var k22 = /* @__PURE__ */ new Map();
b14.set("pan", { pan: "primary", rotate: "secondary", zoom: "tertiary" }), b14.set("rotate", { pan: "secondary", rotate: "primary", zoom: "tertiary" }), k22.set("pan", { pan: "primary", rotate: "tertiary", zoom: "secondary" }), k22.set("rotate", { pan: "tertiary", rotate: "primary", zoom: "secondary" }), E25.set("default", b14), E25.set("pro", k22);
var C15 = z13;

// node_modules/@arcgis/core/views/3d/layers/graphics/deconflictorDebug.js
var e41;
var n52;
var i53 = false;
var l34 = false;
var o49 = false;
var s49 = false;
var a42 = null;
function c50(t60, e59) {
  if (!l34 || !n52)
    return;
  u35();
  const i66 = n52;
  let o61 = 0;
  for (let n73 = 0; n73 < t60.accBinsNumX; n73++)
    for (let e60 = 0; e60 < t60.accBinsNumY; e60++) {
      const l48 = t60.accBins[n73][t60.accBinsNumY - 1 - e60];
      o61 += l48.length;
      const s63 = n73 * t60.accBinsSizeX, a58 = (n73 + 1) * t60.accBinsSizeX, c67 = e60 * t60.accBinsSizeY, r59 = (e60 + 1) * t60.accBinsSizeY;
      i66.fillText(l48.length.toFixed(), s63 + 5, c67 + 15), h31(s63, a58, c67, r59, "blue");
    }
  i66.fillText("total totalShownLabels: " + o61, 70, 40), i66.fillText("total visible labels: " + e59.size, 70, 50), i66.fillText("total numTests: " + t60.accNumTests, 70, 30);
}
function r45(n73) {
  o49 = t25.DECONFLICTOR_SHOW_VISIBLE, s49 = t25.DECONFLICTOR_SHOW_INVISIBLE, i53 = o49 || s49, l34 = t25.DECONFLICTOR_SHOW_GRID, a42 = null, i53 || l34 ? a42 = () => p40(n73) : e41 && (e41.parentElement.removeChild(e41), e41 = null);
}
function u35() {
  a42 && (a42(), a42 = null);
}
function p40(t60) {
  null == e41 && (e41 = document.createElement("canvas"), e41.setAttribute("id", "canvas2d"), t60.surface.parentElement.style.position = "relative", t60.surface.parentElement.appendChild(e41));
  const { state: i66 } = t60, { camera: l48, pixelRatio: o61 } = i66, { width: s63, height: a58 } = l48, c67 = s63 * o61, r59 = a58 * o61;
  e41.setAttribute("width", `${c67}px`), e41.setAttribute("height", `${r59}px`), e41.setAttribute("style", `position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${s63}px;height:${a58}px`), n52 = e41.getContext("2d"), n52.clearRect(0, 0, s63, a58), n52.font = "12px Arial";
}
function h31(t60, i66, l48, o61, s63) {
  u35();
  const a58 = e41.height, c67 = n52;
  c67.beginPath(), c67.lineWidth = 1, c67.strokeStyle = s63, c67.moveTo(t60, a58 - l48), c67.lineTo(i66, a58 - l48), c67.stroke(), c67.lineTo(i66, a58 - o61), c67.stroke(), c67.lineTo(i66, a58 - l48), c67.stroke(), c67.lineTo(t60, a58 - l48), c67.stroke(), c67.lineTo(t60, a58 - l48), c67.stroke(), c67.closePath();
}
function f23(t60, e59) {
  i53 && (e59 && o49 || !e59 && s49) && h31(t60.aabr[0], t60.aabr[2], t60.aabr[1], t60.aabr[3], e59 ? "green" : "red");
}

// node_modules/@arcgis/core/views/3d/layers/graphics/Deconflictor.js
var H14 = n7();
var Z7 = n10();
var q12 = n10();
var J9 = n7();
var K7 = e12();
var Q11 = _3();
var $6 = d6();
var ii = n7();
var ti = u6();
var si = class {
  constructor() {
    this.aabr = u6(), this.distance = 0, this.culled = false, this.visible = false;
  }
};
var ei = class {
  constructor(i66, t60, s63 = {}) {
    this.graphics3DGraphic = i66, this.slicePlaneEnabled = t60, this.info = s63;
  }
};
var ri = class {
  constructor() {
    this.active = /* @__PURE__ */ new Map(), this.visible = /* @__PURE__ */ new Map();
  }
  clear() {
    this.active.clear(), this.visible.clear();
  }
};
var ai = class {
};
var oi = class {
  constructor() {
    this.sortArray = new n2({ allocator: (i66) => i66 || new ai() });
  }
};
var ci;
!function(i66) {
  i66[i66.Idle = 0] = "Idle", i66[i66.Process = 1] = "Process", i66[i66.Sort = 2] = "Sort", i66[i66.Deconflict = 3] = "Deconflict", i66[i66.NumStates = 4] = "NumStates";
}(ci || (ci = {}));
var ni = class {
  constructor() {
    this.camera = new K3(), this.slicePlane = G8(), this.slicePlaneEnabled = false;
  }
  copyFrom(i66) {
    this.camera.copyFrom(i66.camera), X2(i66.slicePlane, this.slicePlane), this.slicePlaneEnabled = i66.slicePlaneEnabled;
  }
};
var hi = class extends y {
  constructor() {
    super(...arguments), this._dirty = false, this._runningViewState = new ni(), this._state = ci.Idle, this.graphics = new ri(), this.iterators = new oi(), this.accBinsNumX = 15, this.accBinsNumY = 20, this.accBinsSizeX = 0, this.accBinsSizeY = 0, this.accBins = null, this.accNumTests = 0;
  }
  get dirty() {
    return this._dirty;
  }
  get state() {
    return this._state;
  }
  destroy() {
    this.graphics.clear(), this.iterators = null;
  }
  setDirty() {
    !this._dirty && this.graphics.active.size > 0 && (this._dirty = true, this.notifyChange("updating"));
  }
  get updating() {
    return this._state !== ci.Idle || this._dirty;
  }
  get updatingProgress() {
    if (!this.updating)
      return 1;
    const i66 = this._state / ci.NumStates;
    return this._dirty ? 0.5 * i66 : i66;
  }
  get running() {
    return this.view.ready && null != this.view.state && this.updating;
  }
  runTask(i66) {
    switch (this._state) {
      case ci.Idle:
        this._startUpdate(), i66.madeProgress();
      case ci.Process:
        if (this._state = ci.Process, !this._processActiveGraphics(i66))
          return;
      case ci.Sort:
        if (this._state = ci.Sort, !this._sortVisibleGraphics(i66))
          return;
      case ci.Deconflict:
        if (this._state = ci.Deconflict, !this._deconflictVisibleGraphics(i66))
          return;
      default:
        c50(this, this.graphics.visible), this._state = ci.Idle, this.notifyChange("updating");
    }
  }
  modifyGraphics(i66, t60) {
    t60 ? i66.forEach((i67) => this.addToActiveGraphics(i67)) : i66.forEach((i67) => this.removeFromActiveGraphics(i67)), this.setDirty();
  }
  layerSupportsDeconfliction(i66) {
    if (t(i66) || "object3d" !== i66.type)
      return false;
    const t60 = i66.stageObject;
    if (1 !== (t60 ? t60.geometryRecords.length : 0))
      return false;
    return t60.geometryRecords[0].material instanceof J5;
  }
  _startUpdate() {
    r45(this.view), this._dirty = false, this._runningViewState.copyFrom(this.viewState);
    const { fullWidth: i66, fullHeight: t60 } = this._runningViewState.camera;
    this._initBins(i66, t60), this._resetIterators();
  }
  addToActiveGraphics(i66) {
    i66.info[this.visibilityGroup] = new si(), this.graphics.active.set(i66.graphics3DGraphic.graphic.uid, i66), this.setDirty();
  }
  removeFromActiveGraphics(i66) {
    this._removeFromVisibleGraphics(i66), li(i66, this.visibilityGroup), delete i66.info[this.visibilityGroup], this.graphics.active.delete(i66.graphics3DGraphic.graphic.uid), this.setDirty();
  }
  _addToVisibleGraphics(i66) {
    this.graphics.visible.set(i66.graphics3DGraphic.graphic.uid, i66);
  }
  _removeFromVisibleGraphics(i66) {
    this.graphics.visible.delete(i66.graphics3DGraphic.graphic.uid);
  }
  _processActiveGraphics(i66) {
    const t60 = this._ensureActiveGraphicsIterator(), s63 = h4(K7, this._runningViewState.camera.projectionMatrix), e59 = "global" === this.view.viewingMode && 1 === this.view.map.ground.opacity && this._runningViewState.camera.relativeElevation > 0 ? Q11 : null;
    let a58 = 0;
    for (r(e59) && (L2(e59, f3, this._runningViewState.camera.viewMatrix), e59[3] = p3(this.view.spatialReference).radius, a58 = G5(e59, f3)); !i66.done; ) {
      i66.madeProgress();
      const r59 = t60.next();
      if (true === r59.done)
        return this._resetActiveGraphicsIterator(), true;
      const o61 = r59.value, c67 = o61 && o61.info[this.visibilityGroup];
      c67 && (this._collectGraphics3DGraphics(o61, s63, e59, a58), c67.culled ? this._removeFromVisibleGraphics(o61) : this._addToVisibleGraphics(o61));
    }
    return false;
  }
  _sortVisibleGraphics(i66) {
    const t60 = this._ensureSortGraphicsIterator();
    for (; !i66.done; ) {
      const s63 = t60.next();
      if (i66.madeProgress(), true === s63.done)
        return this._resetSortGraphicsIterator(), true;
    }
    return false;
  }
  _deconflictVisibleGraphics(i66) {
    const t60 = this._ensureVisibleGraphicsIterator(), s63 = this.visibilityGroup === E16.LABEL;
    for (; !i66.done; ) {
      i66.madeProgress();
      const e59 = t60.next();
      if (true === e59.done)
        return this._resetVisibleGraphicsIterator(), true;
      const r59 = e59.value, a58 = r59.info[this.visibilityGroup];
      if (!a58 || a58.culled)
        continue;
      const o61 = r59.graphics3DGraphic, c67 = (!s63 || o61.isVisible()) && !this._isConflicted(r59);
      c67 && this._addToBins(r59), a58.visible = c67, this._setGraphicVisibility(r59, c67), f23(a58, c67);
    }
    return false;
  }
  _resetIterators() {
    this.iterators.active = null, this.iterators.visible = null, this.iterators.sort = null;
  }
  _ensureActiveGraphicsIterator() {
    return this.iterators.active || (this.iterators.active = pi(this.graphics.active)), this.iterators.active;
  }
  _resetActiveGraphicsIterator() {
    this.iterators.active = null;
  }
  _ensureVisibleGraphicsIterator() {
    return this.iterators.visible || (this.iterators.visible = pi(this.graphics.visible)), this.iterators.visible;
  }
  _resetVisibleGraphicsIterator() {
    this.iterators.visible = null;
  }
  _ensureSortGraphicsIterator() {
    return this.iterators.sort || (this.iterators.sort = ui(this.graphics.visible, this.iterators.sortArray, this.visibilityGroup)), this.iterators.sort;
  }
  _resetSortGraphicsIterator() {
    this.iterators.sort = null;
  }
  _collectGraphics3DGraphics(i66, t60, s63, a58) {
    const o61 = i66.graphics3DGraphic;
    if (o61.destroyed)
      return;
    const c67 = i66.info[this.visibilityGroup];
    if (!o61.isVisible(E16.GRAPHIC, C6.DECONFLICTION))
      return void (c67.culled = true);
    const n73 = this.getGraphicsLayers(o61);
    D3(c67.aabr);
    let h44 = null;
    for (const l48 of n73) {
      if (!this.layerSupportsDeconfliction(l48))
        continue;
      const o62 = l48.stageObject.geometryRecords[0].material;
      if (t(h44)) {
        if (h44 = this._getProjectionInfo(l48, t60, mi), h44.isOutsideScreen || this._isCulledBySlice(i66, H14) || r(s63) && this._isCulledByHorizon(h44, s63, a58))
          return void (c67.culled = true);
        !t25.TESTS_DISABLE_OPTIMIZATIONS && c67.visible && (h44.distance *= 0.7);
      }
      this._expandBoundingRect(c67, l48, o62, h44);
    }
    t(h44) ? c67.culled = true : (c67.distance = h44.distance, c67.culled = false);
  }
  _getProjectionInfo(i66, t60, s63) {
    const e59 = this._runningViewState.camera, r59 = i66.stageObject, a58 = r59.geometryRecords[0], o61 = a58.material, c67 = E10(r59.boundingVolumeWorldSpace.bounds);
    L2(H14, c67, e59.viewMatrix);
    const n73 = a58.geometry.vertexAttributes, h44 = n73.get(O3.NORMAL).data, l48 = n73.get(O3.AUXPOS1).data;
    return o61.applyShaderOffsetsView(H14, h44, r59.transformation, l48, e59, s63.scaleInfo, H14), r8(Z7, H14[0], H14[1], H14[2], 1), w(q12, Z7, e59.projectionMatrix), q(s63.positionNDC, q12, 1 / q12[3]), o61.applyShaderOffsetsNDC(s63.positionNDC, l48, e59, s63.positionNDC, J9), s63.distanceWithoutPolygonOffset = e59.depthNDCToWorld(J9[2]), s63.distance = J9[2] === s63.positionNDC[2] ? s63.distanceWithoutPolygonOffset : e59.depthNDCToWorld(s63.positionNDC[2]), r8(q12, s63.positionNDC[0], s63.positionNDC[1], s63.positionNDC[2], 1), w(Z7, q12, t60), l3(Z7, Z7, 1 / Z7[3]), o3(s63.positionView, H14[0], H14[1], H14[2]), s63;
  }
  _isCulledByHorizon(i66, t60, s63) {
    return r7($6.direction, i66.positionView), o3($6.origin, 0, 0, 0), !!U6(t60, $6, ii) && i66.distanceWithoutPolygonOffset > s63;
  }
  _isCulledBySlice(i66, t60) {
    return i66.slicePlaneEnabled && this._runningViewState.slicePlaneEnabled && cs(this._runningViewState.slicePlane, t60);
  }
  _expandBoundingRect(i66, t60, e59, { positionNDC: r59, scaleInfo: a58 }) {
    const o61 = this._runningViewState.camera, c67 = t60.getScreenSize(di);
    f12(c67, a58.factor, c67), c67[0] *= o61.pixelRatio, c67[1] *= o61.pixelRatio;
    const n73 = z3(e59.calculateRelativeScreenBounds(c67, a58.factorAlignment.scale, ti), s10(0, o61.fullWidth, 0.5 + 0.5 * r59[0]), s10(0, o61.fullHeight, 0.5 + 0.5 * r59[1])), h44 = this.iconMarginFactor;
    if (0 !== h44) {
      const i67 = h44 * Math.min(s12(n73), l9(n73));
      n73[0] -= i67, n73[1] -= i67, n73[2] += i67, n73[3] += i67;
    }
    h5(i66.aabr, n73, i66.aabr);
  }
  _isConflicted(i66) {
    const t60 = i66.graphics3DGraphic.graphic.uid, s63 = i66.info[this.visibilityGroup];
    for (let e59 = Math.floor(s63.aabr[0] / this.accBinsSizeX); e59 <= Math.floor(s63.aabr[2] / this.accBinsSizeX); e59++)
      if (!(e59 < 0 || e59 >= this.accBinsNumX))
        for (let i67 = Math.floor(s63.aabr[1] / this.accBinsSizeY); i67 <= Math.floor(s63.aabr[3] / this.accBinsSizeY); i67++) {
          if (i67 < 0 || i67 >= this.accBinsNumY)
            continue;
          const r59 = this.accBins[e59][i67];
          for (let i68 = 0; i68 < r59.length; i68++) {
            const e60 = r59.data[i68], a58 = e60.info[this.visibilityGroup];
            if (a58 && a58.visible && (e60.graphics3DGraphic.graphic.uid !== t60 && (this.accNumTests++, E4(a58.aabr, s63.aabr))))
              return true;
          }
        }
    return false;
  }
  _initBins(i66, t60) {
    if (null == this.accBins) {
      this.accBins = [];
      for (let i67 = 0; i67 < this.accBinsNumX; i67++) {
        this.accBins.push([]);
        const i68 = this.accBins[this.accBins.length - 1];
        for (let t61 = 0; t61 < this.accBinsNumY; t61++)
          i68.push(new n2());
      }
    } else
      for (let s63 = 0; s63 < this.accBinsNumX; s63++)
        for (let i67 = 0; i67 < this.accBinsNumY; i67++)
          this.accBins[s63][i67].clear();
    this.accBinsSizeX = i66 / this.accBinsNumX, this.accBinsSizeY = t60 / this.accBinsNumY, this.accNumTests = 0;
  }
  _addToBins(i66) {
    const t60 = i66.info[this.visibilityGroup], s63 = Math.floor(t60.aabr[0] / this.accBinsSizeX), e59 = Math.floor(t60.aabr[2] / this.accBinsSizeX), r59 = Math.floor(t60.aabr[1] / this.accBinsSizeY), a58 = Math.floor(t60.aabr[3] / this.accBinsSizeY);
    for (let o61 = s63; o61 <= e59; o61++)
      if (!(o61 < 0 || o61 >= this.accBinsNumX))
        for (let t61 = r59; t61 <= a58; t61++)
          t61 < 0 || t61 >= this.accBinsNumY || this.accBins[o61][t61].push(i66);
  }
  _setGraphicVisibility(i66, t60) {
    const s63 = i66.graphics3DGraphic;
    s63.destroyed || (s63.setVisibilityFlag(C6.DECONFLICTION, t60, this.visibilityGroup), this.visibilityGroup === E16.LABEL && this.view.labeler.setLabelGraphicVisibility(s63, t60));
  }
};
function li(i66, t60) {
  const s63 = i66.graphics3DGraphic;
  s63.destroyed || s63.clearVisibilityFlag(C6.DECONFLICTION, t60);
}
function* pi(i66) {
  if (Map.prototype.entries) {
    const t60 = i66.entries();
    for (let i67 = t60.next(); !i67.done; i67 = t60.next())
      yield i67.value[1];
  } else
    yield* i66.values();
}
function* ui(i66, t60, s63) {
  t60.clear(), i66.forEach((i67, e60) => {
    const r59 = t60.pushNew();
    r59.id = e60, r59.prio = i67.info ? -i67.info[s63].distance : Number.MAX_VALUE;
  }), yield;
  const e59 = t60.iterableSort((i67, t61) => t61.prio - i67.prio);
  for (let r59 = e59.next(); !r59.done; r59 = e59.next())
    yield;
  t60.forAll((t61) => {
    const s64 = i66.get(t61.id);
    s64 && (i66.delete(t61.id), i66.set(t61.id, s64));
  }), t60.clear();
}
e([d({ constructOnly: true })], hi.prototype, "view", void 0), e([d({ type: Boolean, readOnly: true })], hi.prototype, "updating", null), hi = e([n6("esri.views.3d.layers.graphics.Deconflictor")], hi);
var di = n17();
var fi = class {
  constructor() {
    this.positionView = n7(), this.positionNDC = n7(), this.distance = 0, this.distanceWithoutPolygonOffset = 0, this.scaleInfo = { factor: { scale: 0, factor: 0, minPixelSize: 0, paddingPixels: 0 }, factorAlignment: { scale: 0, factor: 0, minPixelSize: 0, paddingPixels: 0 } };
  }
  get isOutsideScreen() {
    const i66 = this.positionNDC;
    return i66[0] < -1 || i66[1] < -1 || i66[2] < -1 || i66[0] >= 1 || i66[1] >= 1;
  }
};
var mi = new fi();

// node_modules/@arcgis/core/views/3d/layers/graphics/LabelDeconflictor.js
var c51 = 2e3;
var n53 = class extends hi {
  constructor() {
    super(...arguments), this.visibilityGroup = E16.LABEL, this.iconMarginFactor = 0, this._lastDeconfliction = 0;
  }
  get viewState() {
    return this.parent.viewState;
  }
  runTask(r59) {
    if (this.parent.running)
      return;
    const t60 = performance.now();
    (r59.state === N3.IDLE || t60 - this._lastDeconfliction > c51) && (super.runTask(r59), this.state === ci.Idle && (this._lastDeconfliction = t60));
  }
  enabledChanged(r59, t60) {
    this.modifyGraphics(t60, r59.labelsEnabled);
  }
  getGraphicsLayers(r59) {
    return r59.labelGraphics;
  }
};
e([d({ constructOnly: true })], n53.prototype, "parent", void 0), n53 = e([n6("esri.views.3d.layers.graphics.LabelDeconflictor")], n53);

// node_modules/@arcgis/core/views/3d/layers/graphics/GraphicsDeconflictor.js
var _18 = class extends hi {
  constructor() {
    super(...arguments), this._handles = new u4(), this._contexts = /* @__PURE__ */ new Map(), this._viewState = new ni(), this.visibilityGroup = E16.GRAPHIC, this._iconMarginFactor = -0.1;
  }
  get labels() {
    return this._labels;
  }
  get viewState() {
    return this._viewState;
  }
  initialize() {
    this._handles.add([l6(() => {
      var _a, _b;
      return (_b = (_a = this.view) == null ? void 0 : _a.state) == null ? void 0 : _b.camera;
    }, () => {
      this._updateViewState(), this.setDirty();
    }), l6(() => {
      var _a, _b, _c;
      return (_c = (_b = (_a = this.view) == null ? void 0 : _a.map) == null ? void 0 : _b.ground) == null ? void 0 : _c.opacity;
    }, (e59, t60) => {
      1 !== e59 && 1 !== t60 || this.setDirty();
    }), l6(() => {
      var _a;
      return (_a = this.view) == null ? void 0 : _a.slicePlane;
    }, () => {
      this._updateSlicePlane(), this._slicePlaneChanged();
    }, h3)]), this._frameTask = this.view.resourceController.scheduler.registerTask(L3.GRAPHICS_DECONFLICTOR, this), this._labels = new n53({ view: this.view, parent: this });
  }
  destroy() {
    this._labels.destroy(), this._labels = null, this._handles.destroy(), this._handles = null, this._frameTask && (this._frameTask.remove(), this._frameTask = null);
  }
  get iconMarginFactor() {
    return this._iconMarginFactor;
  }
  set iconMarginFactor(e59) {
    this._iconMarginFactor = e59, this.setDirty();
  }
  setDirty() {
    this._contexts.size > 0 && (super.setDirty(), this._labels.setDirty());
  }
  runTask(e59) {
    super.runTask(e59), this.running || this._labels.setDirty();
  }
  setInitialIconVisibilityFlag(e59, t60) {
    const i66 = !(this._graphicSupportsDeconfliction(t60) && g29(e59));
    t60.setVisibilityFlag(C6.DECONFLICTION, i66, E16.GRAPHIC);
  }
  _updateViewState() {
    this.view && this.view.state && (this._viewState.camera.copyFrom(this.view.state.camera), this._updateSlicePlane());
  }
  _updateSlicePlane() {
    const e59 = this.view ? this.view.slicePlane : null;
    r(e59) && ls(e59, this._viewState.camera.viewMatrix, this._viewState.slicePlane), this._viewState.slicePlaneEnabled = r(e59);
  }
  _slicePlaneChanged() {
    n5(this._contexts, (e59, t60) => t60.symbolCreationContext.slicePlaneEnabled) && this.setDirty();
  }
  addGraphicsOwner(e59) {
    let t60 = this._contexts.get(e59);
    return null == t60 && (t60 = /* @__PURE__ */ new Map(), this._contexts.set(e59, t60), this.setDirty()), { addGraphic: (i66) => this._addGraphic(e59, t60, i66), removeGraphic: (e60) => this._removeGraphic(t60, e60), labelingInfoChange: () => this._labels.enabledChanged(e59, t60), featureReductionChange: () => this.enabledChanged(e59, t60), slicePlaneEnabledChange: () => this._slicePlaneEnabledChanged(e59, t60), clear: () => t60.forEach((e60) => this._removeGraphic(t60, e60.graphics3DGraphic)) };
  }
  removeGraphicsOwner(e59) {
    const t60 = this._contexts.get(e59);
    t60 && (t60.forEach((e60) => this._removeGraphic(t60, e60.graphics3DGraphic)), this._contexts.delete(e59), this.setDirty());
  }
  _addGraphic(e59, t60, i66) {
    const s63 = i66.graphic.uid, r59 = new ei(i66, e59.symbolCreationContext.slicePlaneEnabled);
    t60.set(s63, r59), g29(e59) && this.addToActiveGraphics(r59), e59.labelsEnabled && this._labels.addToActiveGraphics(r59);
  }
  _removeGraphic(e59, t60) {
    const i66 = t60.graphic.uid, s63 = e59.get(i66);
    s63 && (this.removeFromActiveGraphics(s63), this._labels.removeFromActiveGraphics(s63), e59.delete(i66), this.setDirty());
  }
  enabledChanged(e59, t60) {
    const i66 = g29(e59);
    i66 || f24(e59), this.modifyGraphics(t60, i66);
  }
  _slicePlaneEnabledChanged(e59, t60) {
    const i66 = e59.symbolCreationContext.slicePlaneEnabled;
    t60.forEach((e60) => e60.slicePlaneEnabled = i66), this.setDirty();
  }
  getGraphicsLayers(e59) {
    return e59.graphics;
  }
  _graphicSupportsDeconfliction(e59) {
    if (e59.isDraped)
      return false;
    const t60 = e59.graphics;
    if (!t60 || !t60.length)
      return false;
    for (const i66 of t60)
      if (this.layerSupportsDeconfliction(i66))
        return true;
    return false;
  }
};
function g29(e59) {
  const t60 = e59.layer;
  return !(!t60 || !t60.featureReduction || "selection" !== t60.featureReduction.type);
}
function f24(e59) {
  const t60 = e59.graphics3DGraphics;
  t60 && t60.forEach((e60) => e60.clearVisibilityFlag(C6.DECONFLICTION));
}
_18 = e([n6("esri.views.3d.layers.graphics.GraphicsDeconflictor")], _18);

// node_modules/@arcgis/core/views/3d/layers/graphics/graphicSymbolUtils.js
function i54(i66) {
  return i66 instanceof e29 ? i66.graphics3DSymbol : i66 instanceof d8 ? i66 : null;
}

// node_modules/@arcgis/core/views/3d/layers/graphics/labelPlacement.js
var u36 = s3.getLogger("esri.views.3d.layers.graphics.labelPlacement");
function g30(e59) {
  const r59 = C16(e59);
  if (t(r59))
    return null;
  const n73 = O20(e59, r59);
  if (t(n73))
    return null;
  const c67 = n73.anchor, l48 = !!r59.hasLabelVerticalOffset;
  return w17({ anchor: c67, verticalOffset: r59.verticalOffset, screenOffset: n17(), centerOffset: r10(0, 0, 0, -1), centerOffsetUnits: "world", translation: n7(), elevationOffset: 0, hasLabelVerticalOffset: l48 }, n73, e59);
}
function O20(e59, t60) {
  if (t60.anchor)
    return t60;
  const r59 = e59.labelClass.labelPlacement, n73 = x24[r59], a58 = n73 || P15(e59);
  return r59 && !n73 && u36.warnOncePerTick(`the requested label placement '${r59}' is currently unsupported in SceneView.`), v24(a58, e59);
}
function d23(e59) {
  const t60 = e59.graphics3DGraphic.graphics3DSymbol, n73 = i54(t60);
  return r(n73) ? n73.symbol.symbolLayers.getItemAt(0) : null;
}
function v24(e59, n73) {
  const a58 = n73.graphics3DGraphic.graphic.geometry;
  if (t(a58))
    return null;
  if (r(n73.disablePlacement)) {
    return n73.labelClass.labelPlacement ? (u36.warnOncePerTick(y21(e59.placement, n73.disablePlacement.logEntityDescription)), P15(n73)) : e59;
  }
  const c67 = a58.type;
  switch (c67) {
    case "polyline":
    case "polygon":
    case "extent":
    case "multipoint":
      if (n73.labelClass.labelPlacement)
        return u36.warnOncePerTick(y21(e59.placement, `'${c67}' geometries`)), P15(n73);
      break;
    case "point":
    case "mesh":
      return e59;
  }
  return e59;
}
function y21(e59, t60) {
  return `the requested label placement '${e59}' is currently unsupported for ${t60} in SceneView.`;
}
function P15(e59) {
  const n73 = e59.graphics3DGraphic.graphic.geometry;
  if (t(n73))
    return null;
  switch (n73.type) {
    case "polyline":
    case "extent":
    case "multipoint":
      return { placement: "center-center", normalizedOffset: null, anchor: "center" };
    case "polygon": {
      const t60 = d23(e59);
      return r(t60) && "extrude" === t60.type ? x24["above-center"] : { placement: "center-center", normalizedOffset: null, anchor: "center" };
    }
    case "point":
    case "mesh":
      return x24["above-center"];
    default:
      return;
  }
}
function w17(e59, r59, n73) {
  const a58 = n73.graphics3DGraphic.graphic.geometry;
  if (t(a58))
    return null;
  switch (a58.type) {
    case "point":
      z14(e59, r59, n73);
      break;
    case "polygon":
      L22(e59, r59, n73);
      break;
    case "mesh":
      D14(e59, r59, n73.graphics3DGraphic.graphics[0]);
  }
  return e59;
}
function L22(e59, n73, a58) {
  const l48 = d23(a58);
  if (!t(l48))
    switch (l48.type) {
      case "extrude": {
        const t60 = a58.graphics3DGraphic.graphics[0];
        r(t60) ? (t60.getBoundingBoxObjectSpace($7), p9($7, e59.translation), e59.translation[2] = N2($7) / 2) : o3(e59.translation, 0, 0, 0), D14(e59, n73, t60);
        break;
      }
    }
}
function z14(e59, n73, a58) {
  const l48 = d23(a58);
  if (t(l48))
    return;
  const o61 = a58.graphics3DGraphic.graphics[0];
  switch (r(o61) ? o61.getCenterObjectSpace(e59.translation) : o3(e59.translation, 0, 0, 0), l48.type) {
    case "icon":
    case "text":
      j24(e59, n73, a58, o61);
      break;
    case "object":
      D14(e59, n73, o61);
  }
}
function j24(e59, t60, n73, a58) {
  const { graphics3DGraphic: c67 } = n73, l48 = r(a58) ? a58.getScreenSize() : null;
  if (!c67.isDraped && r(l48)) {
    const r59 = S15(n73);
    B10[0] = l48[0] / 2 * (t60.normalizedOffset[0] - r59[0]), B10[1] = l48[1] / 2 * (t60.normalizedOffset[1] - r59[1]), e59.screenOffset[0] = B10[0], e59.hasLabelVerticalOffset ? (e59.centerOffset[1] = B10[1], e59.centerOffsetUnits = "screen") : e59.screenOffset[1] = B10[1];
  } else
    e59.hasLabelVerticalOffset || "center" === e59.anchor || (x24[n73.labelClass.labelPlacement] && u36.warnOncePerTick(`the requested placement '${t60.placement}' is currently unsupported for draped graphics`), e59.anchor = "center");
}
function S15(e59, t60 = T19) {
  const { graphics3DGraphic: n73 } = e59, a58 = n73.graphics[0], c67 = r(a58) ? a58.stageObject.geometryRecords[0].material : null;
  if (c67 && c67 instanceof J5) {
    const e60 = c67.parameters.anchorPosition;
    t60[0] = 2 * (e60[0] - 0.5), t60[1] = 2 * (e60[1] - 0.5);
  } else
    t60[0] = 0, t60[1] = 0;
  return t60;
}
function D14(e59, t60, n73) {
  const a58 = r(n73) ? n73.getBoundingBoxObjectSpace($7) : $7, c67 = r6(a58[3] - a58[0], a58[4] - a58[1], a58[5] - a58[2]), s63 = Math.sqrt(c67[0] * c67[0] + c67[1] * c67[1]);
  e59.centerOffset[0] = s63 / 2 * t60.normalizedOffset[0];
  const i66 = e59.translation[2], f37 = c67[2] / 2 * t60.normalizedOffset[1];
  e59.translation[2] = 0, e59.elevationOffset = i66 + f37;
  const m40 = s8(c67);
  e59.centerOffset[2] = m40 / 2 * t60.normalizedOffset[2];
}
function k23(e59) {
  return "above-center" === e59;
}
function C16(e59) {
  const a58 = e59.labelClass.labelPlacement, { labelSymbol: c67, graphics3DGraphic: l48 } = e59, o61 = i54(l48.graphics3DSymbol), s63 = o(o61, (e60) => "point-3d" === e60.symbol.type ? e60.symbol : null), i66 = x24[a58] || P15(e59);
  return r(s63) && s63.supportsCallout() && s63.hasVisibleVerticalOffset() && !l48.isDraped ? { placement: null, hasLabelVerticalOffset: false, verticalOffset: V12(s63.verticalOffset), anchor: null, normalizedOffset: null } : c67 && c67.hasVisibleVerticalOffset() && (t(s63) || !s63.supportsCallout() || !s63.verticalOffset || l48.isDraped) ? k23(i66.placement) ? { placement: "above-center", verticalOffset: V12(c67.verticalOffset), anchor: "bottom", normalizedOffset: [0, i66.normalizedOffset[1], 0], hasLabelVerticalOffset: true } : (u36.errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with " + a58 + " placement)"), null) : { placement: null, verticalOffset: null, anchor: null, normalizedOffset: null, hasLabelVerticalOffset: false };
}
function V12(e59) {
  const { screenLength: t60, minWorldLength: r59, maxWorldLength: n73 } = e59;
  return { screenLength: t60, minWorldLength: r59, maxWorldLength: n73 };
}
var x24 = { "above-center": { placement: "above-center", normalizedOffset: [0, 1, 0], anchor: "bottom" }, "above-left": { placement: "above-left", normalizedOffset: [-1, 1, 0], anchor: "bottom-right" }, "above-right": { placement: "above-right", normalizedOffset: [1, 1, 0], anchor: "bottom-left" }, "below-center": { placement: "below-center", normalizedOffset: [0, -1, 2], anchor: "top" }, "below-left": { placement: "below-left", normalizedOffset: [-1, -1, 0], anchor: "top-right" }, "below-right": { placement: "below-right", normalizedOffset: [1, -1, 0], anchor: "top-left" }, "center-center": { placement: "center-center", normalizedOffset: [0, 0, 1], anchor: "center" }, "center-left": { placement: "center-left", normalizedOffset: [-1, 0, 0], anchor: "right" }, "center-right": { placement: "center-right", normalizedOffset: [1, 0, 0], anchor: "left" } };
var G16 = { "above-center": ["default", "esriServerPointLabelPlacementAboveCenter"], "above-left": ["esriServerPointLabelPlacementAboveLeft"], "above-right": ["esriServerPointLabelPlacementAboveRight"], "below-center": ["esriServerPointLabelPlacementBelowCenter"], "below-left": ["esriServerPointLabelPlacementBelowLeft"], "below-right": ["esriServerPointLabelPlacementBelowRight"], "center-center": ["esriServerPointLabelPlacementCenterCenter"], "center-left": ["esriServerPointLabelPlacementCenterLeft"], "center-right": ["esriServerPointLabelPlacementCenterRight"] };
for (const q18 in G16) {
  const e59 = G16[q18], t60 = x24[q18];
  e59.forEach((e60) => {
    x24[e60] = t60;
  });
}
Object.freeze && (Object.freeze(x24), Object.keys(x24).forEach((e59) => {
  Object.freeze(x24[e59]), Object.freeze(x24[e59].normalizedOffset);
}));
var B10 = [0, 0];
var T19 = [0, 0];
var $7 = a8();

// node_modules/@arcgis/core/views/3d/webgl-engine/lib/MaterialCollection.js
var s50 = class {
  constructor(s63) {
    this._stage = s63, this._materials = /* @__PURE__ */ new Map();
  }
  get(s63) {
    return this._materials.get(s63);
  }
  add(s63, t60) {
    this._materials.set(s63, t60), this._stage.add(t60);
  }
  dispose() {
    this._stage.removeMany(Array.from(this._materials.values())), this._materials.clear();
  }
};

// node_modules/@arcgis/core/views/3d/webgl-engine/lib/TextTextureAtlas.js
var v25 = 512;
var z15 = 4096;
var R13 = 0.85;
var w18 = 0.95;
var b15 = class extends y {
  constructor(e59) {
    super(e59), this.type = e17.Texture, this.id = e5(), this.events = new n8(), this._glTexture = null, this.needsClear = false, this.elementsToAddOrUpdate = /* @__PURE__ */ new Map(), this.elementsToRemove = /* @__PURE__ */ new Map(), this.elementsToRender = /* @__PURE__ */ new Map(), this.elements = /* @__PURE__ */ new Map(), this.stageObjects = /* @__PURE__ */ new Map(), this.updating = false;
  }
  initialize() {
    this.stage = this.view._stage, this.canvas = this._create2DCanvas(), this.ctx = this.canvas.getContext("2d"), this.stage.add(this);
    const e59 = this._computeAtlasResolution(this.view.width, this.view.height);
    this._createAtlasRegion(e59), this._update2DCanvasSize(), this._resetAtlasCursor();
  }
  unload() {
    this._glTexture = s(this._glTexture), this.updating = false, this.events.emit("unloaded");
  }
  get width() {
    return this.atlas.size.width;
  }
  get height() {
    return this.atlas.size.height;
  }
  get requiresFrameUpdates() {
    return false;
  }
  _createDescriptor(e59) {
    return { target: M6.TEXTURE_2D, pixelFormat: P3.RGBA, dataType: G4.UNSIGNED_BYTE, wrapMode: D4.CLAMP_TO_EDGE, flipped: true, samplingMode: L4.LINEAR_MIPMAP_LINEAR, hasMipmap: true, preMultiplyAlpha: true, maxAnisotropy: e59.parameters.maxMaxAnisotropy };
  }
  get glTexture() {
    return this._glTexture;
  }
  load(e59) {
    return r(this._glTexture) || (this._glTexture = new u10(e59, this._createDescriptor(e59), this.canvas), this.frameWorker = this.view.resourceController.scheduler.registerTask(L3.TEXT_TEXTURE_ATLAS, this), this.setDirty()), this._glTexture;
  }
  dispose() {
    this.elements = null, this.elementsToAddOrUpdate = null, this.elementsToRemove = null, this.elementsToRender = null, this.frameWorker = a2(this.frameWorker), this._glTexture && (this.stage.remove(this), this._glTexture = s(this._glTexture)), this.canvas.width = 0, this.canvas.height = 0, this.canvas = null, this.ctx = null;
  }
  _create2DCanvas() {
    const e59 = document.createElement("canvas");
    return e59.setAttribute("id", "canvas2d"), e59.setAttribute("style", "display:none"), e59.setAttribute("width", v25.toString()), e59.setAttribute("height", v25.toString()), e59;
  }
  _update2DCanvasSize() {
    this.canvas.setAttribute("width", this.atlas.size.width.toString()), this.canvas.setAttribute("height", this.atlas.size.height.toString());
  }
  _createAtlasRegion(e59 = v25) {
    this.atlas = { size: { width: e59, height: e59 }, cursor: { x: 0, y: 0 }, lineHeight: 0 };
  }
  _computeAtlasResolution(e59, t60) {
    let s63 = Math.max(e59, t60);
    return s63 += 256, s63 = a4(s63), s63 = Math.min(s63, z15), s63;
  }
  _resizeAtlas(e59, t60) {
    t60 = t60 || e59;
    const s63 = this.atlas;
    s63.size.width = e59, s63.size.height = t60, r(this._glTexture) && this._glTexture.resize(e59, t60), this._update2DCanvasSize();
  }
  _resetAtlasCursor() {
    const e59 = this.atlas;
    e59.cursor.x = O21, e59.cursor.y = O21 + j25, e59.lineHeight = 0, this.needsClear = true;
  }
  _getAtlasUsage() {
    const e59 = this.atlas;
    return (e59.cursor.x + e59.cursor.y * e59.size.width) / (e59.size.width * e59.size.height);
  }
  _getExpectedAtlasUsage() {
    const e59 = this.elementsToRemove.size, t60 = this.elementsToAddOrUpdate.size, s63 = this.elements.size;
    return this._getAtlasUsage() / s63 * (s63 + t60 - e59);
  }
  _addAtlasElement(e59, t60, s63, i66) {
    const r59 = this.atlas, { renderedWidth: a58, renderedHeight: n73, displayWidth: h44, displayHeight: o61 } = e59.textRenderer;
    e59.placement.offset.x = r59.cursor.x, e59.placement.offset.y = r59.cursor.y, e59.placement.size.width = a58, e59.placement.size.height = n73, e59.placement.size.displayWidth = h44, e59.placement.size.displayHeight = o61, e59.placement.uvMinMax = [e59.placement.offset.x / r59.size.width, 1 - (e59.placement.offset.y + n73) / r59.size.height, (e59.placement.offset.x + a58) / r59.size.width, 1 - e59.placement.offset.y / r59.size.height], r59.cursor.x += s63, r59.lineHeight = Math.max(r59.lineHeight, i66), this.elements.set(t60, e59);
  }
  _removeAtlasElement(e59) {
    if (e59 && this.elements.has(e59.textId)) {
      const t60 = e59.placement.offset, s63 = e59.placement.size;
      this.ctx.clearRect(t60.x, t60.y, s63.width, s63.height), this.elements.delete(e59.textId);
    }
  }
  _ensureStageObjects(e59) {
    const t60 = this.stageObjects.get(e59);
    if (t60)
      return t60;
    const s63 = /* @__PURE__ */ new Set();
    return this.stageObjects.set(e59, s63), s63;
  }
  _addStageObject(e59, t60) {
    this._ensureStageObjects(e59).add(t60);
  }
  _removeStageObject(e59, t60) {
    const s63 = this.stageObjects.get(e59);
    s63 && s63.delete(t60) && (t60.geometries[0].vertexAttributes.get(O3.SIZE).data = [0, 0], t60.geometryVertexAttrsUpdated(t60.geometryRecords[0]));
  }
  _processAddition(e59, t60) {
    const s63 = this.atlas, i66 = e59.textId, r59 = e59.textRenderer.renderedWidth, a58 = e59.textRenderer.renderedHeight, n73 = r59 + O21, h44 = a58 + O21 + j25;
    if (s63.cursor.x + n73 < s63.size.width && s63.cursor.y + h44 < s63.size.height)
      this._addAtlasElement(e59, i66, n73, h44), this.elementsToRender.set(i66, e59), this.elementsToAddOrUpdate.delete(i66);
    else {
      if (!(s63.cursor.y + h44 + s63.lineHeight < s63.size.height)) {
        const e60 = this._getExpectedAtlasUsage(), i67 = e60 > R13 && s63.size.width < z15;
        return i67 && this._resizeAtlas(2 * s63.size.width, 2 * s63.size.height), !t60 || !i67 && e60 > w18 && s63.size.width === z15 ? (this._processRemovals(), E26.OK) : (this._repack(), E26.REPACK);
      }
      s63.cursor.x = O21, s63.cursor.y += s63.lineHeight, s63.lineHeight = 0, this._addAtlasElement(e59, i66, n73, h44), this.elementsToRender.set(i66, e59), this.elementsToAddOrUpdate.delete(i66);
    }
    return E26.OK;
  }
  _processRemovals() {
    this.elementsToRemove.forEach((e59, t60) => {
      const s63 = this.stageObjects.get(t60);
      s63 && 0 !== s63.size || this._removeAtlasElement(e59), s63 && 0 === s63.size && this.stageObjects.delete(t60);
    }), this.elementsToRemove.clear();
  }
  _repack() {
    this._processRemovals(), this.elements.forEach((e59, t60) => {
      e59.rendered = false, this.elementsToAddOrUpdate.set(t60, e59);
    }), this.elements.clear(), this._resetAtlasCursor(), this.elementsToRender.clear();
  }
  _processRenderingRequest(e59) {
    this.ctx.clearRect(e59.placement.offset.x, e59.placement.offset.y, e59.placement.size.width, e59.placement.size.height), e59.textRenderer.render(this.ctx, e59.placement.offset.x, e59.placement.offset.y);
    const t60 = this.stageObjects.get(e59.textId);
    t60 && t60.forEach((t61) => {
      t61.geometries[0].vertexAttributes.get(O3.UV0).data = new Float32Array(e59.placement.uvMinMax), t61.geometries[0].vertexAttributes.get(O3.SIZE).data = [e59.placement.size.displayWidth, e59.placement.size.displayHeight], t61.geometryVertexAttrsUpdated(t61.geometryRecords[0]);
    }), e59.rendered = true;
  }
  get running() {
    return this.updating;
  }
  runTask(e59, t60 = true) {
    if (!this._glTexture)
      return;
    let s63 = false;
    if (n5(this.elementsToAddOrUpdate, (e60, i66) => {
      const r60 = this.elements.get(i66);
      if (r60 && r60.rendered) {
        const e61 = this.stageObjects.get(i66);
        return e61 && e61.forEach((e62) => {
          const t61 = e62.geometries[0].vertexAttributes, s64 = this.elements.get(i66);
          t61.get(O3.UV0).data = new Float32Array(s64.placement.uvMinMax), t61.get(O3.SIZE).data = new Float32Array([s64.placement.size.displayWidth, s64.placement.size.displayHeight]), e62.geometryVertexAttrsUpdated(e62.geometryRecords[0]);
        }), this.elementsToAddOrUpdate.delete(i66), false;
      }
      return this._processAddition(this.elementsToAddOrUpdate.get(i66), t60) === E26.REPACK && (s63 = true, true);
    }), s63)
      return void this.runTask(w3, false);
    let r59 = false;
    this.elementsToRender.size > 0 && this.needsClear && (this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height), this.needsClear = false), n5(this.elementsToRender, (t61, s64) => (this._processRenderingRequest(t61), this.elementsToRender.delete(s64), r59 = true, e59.madeProgress(), e59.done)), r59 && r(this._glTexture) && this._glTexture.setData(this.canvas), this.updating = this.elementsToRender.size > 0, !this.updating && e27.orderedRepackingEnabled && this.repackOrdered();
  }
  addTextTexture(e59, t60) {
    const s63 = e59.key;
    this.elementsToAddOrUpdate.has(s63) || this.elementsToAddOrUpdate.set(s63, { textId: s63, placement: { offset: { x: 0, y: 0 }, size: { width: 0, height: 0, displayWidth: 0, displayHeight: 0 }, uvMinMax: [] }, textRenderer: e59, rendered: false }), this._addStageObject(s63, t60), this.elementsToRemove.delete(s63), this.setDirty();
  }
  removeTextTexture(e59, t60) {
    const s63 = e59.key;
    this.elementsToRemove.set(s63, this.elements.get(s63)), this._removeStageObject(s63, t60);
  }
  setDirty() {
    this._glTexture && (this.updating = true);
  }
  repackOrdered() {
    if (0 === this.elements.size)
      return;
    const e59 = [];
    this.elements.forEach((t61, s63) => e59.push({ element: t61, key: s63 }));
    let t60 = true;
    for (let s63 = 0; s63 < e59.length - 1; s63++)
      if (e59[s63].key.localeCompare(e59[s63 + 1].key) > 0) {
        t60 = false;
        break;
      }
    if (!t60 || this.elementsToRemove.size) {
      e59.sort((e60, t61) => e60.key.localeCompare(t61.key)), this.elements.clear();
      for (const { element: t61, key: s63 } of e59)
        this.elements.set(s63, t61);
      this._repack(), this.setDirty();
    }
  }
  get test() {
    const { elements: e59, stageObjects: t60, elementsToRemove: s63, atlas: i66 } = this, r59 = this;
    return { elements: e59, stageObjects: t60, elementsToRemove: s63, atlas: i66, _resizeAtlas: (e60, t61) => r59._resizeAtlas(e60, t61), run: (e60, t61) => r59.runTask(e60, t61) };
  }
};
e([d({ constructOnly: true })], b15.prototype, "view", void 0), e([d({ type: Boolean })], b15.prototype, "updating", void 0), b15 = e([n6("esri.views.3d.webgl-engine.lib.TextTextureAtlas")], b15);
var O21 = 2;
var j25 = 2;
var E26;
!function(e59) {
  e59[e59.OK = 0] = "OK", e59[e59.REPACK = 1] = "REPACK";
}(E26 || (E26 = {}));

// node_modules/@arcgis/core/views/3d/layers/graphics/Labeler.js
var V13 = s3.getLogger("esri.views.3d.layers.graphics.Labeler");
var F13 = class extends y {
  constructor() {
    super(...arguments), this._dirty = false, this._labels = /* @__PURE__ */ new Map(), this._labelsToAdd = /* @__PURE__ */ new Map(), this._labelsToRemove = /* @__PURE__ */ new Map(), this._labelingContexts = new Array();
  }
  setup() {
    this.dispose(), this._handles = new u4(), this._handles.add([l6(() => {
      var _a;
      return (_a = this.view.state) == null ? void 0 : _a.camera;
    }, () => this.setDirty()), l6(() => {
      var _a;
      return (_a = this.view.state) == null ? void 0 : _a.pixelRatio;
    }, () => this._resetAllLabels()), this.view.resourceController.scheduler.registerTask(L3.LABELER, this)]), this._textTextureAtlas = new b15({ view: this.view }), this._hudMaterialCollection = new s50(this.view._stage), this._calloutMaterialCollection = new s50(this.view._stage);
  }
  dispose() {
    this._handles = l(this._handles), this._textTextureAtlas = s(this._textTextureAtlas), this._hudMaterialCollection = s(this._hudMaterialCollection), this._calloutMaterialCollection = s(this._calloutMaterialCollection), this._labelingContexts.length = 0, this._labels.clear(), this._labelsToAdd.clear(), this._labelsToRemove.clear();
  }
  _activateLabelingContext(e59) {
    e59.labels.forEach((e60, t60) => {
      this._labels.set(t60, e60), e60.graphics3DGraphic.setVisibilityFlag(C6.USER_SETTING, true, E16.LABEL);
    }), e59.active = true;
  }
  _deactivateLabelingContext(e59) {
    e59.labels.forEach((e60, t60) => {
      e60.graphics3DGraphic.setVisibilityFlag(C6.USER_SETTING, false, E16.LABEL), this.setLabelGraphicVisibility(e60.graphics3DGraphic, false), this._labels.delete(t60);
    }), e59.active = false;
  }
  _addLabelTextureToAtlas(e59) {
    for (const t60 of e59.graphics3DGraphic.labelGraphics) {
      if (!t60._labelClass)
        continue;
      const s63 = e59.textTextureResources.textRenderers[t60._labelIndex];
      r(s63) && this._textTextureAtlas.addTextTexture(s63, t60.stageObject);
    }
    e59.rendered = true;
  }
  _removeLabelTextureFromAtlas(e59) {
    for (const t60 of e59.graphics3DGraphic.labelGraphics) {
      if (!t60._labelClass)
        continue;
      const s63 = e59.textTextureResources.textRenderers[t60._labelIndex];
      r(s63) && this._textTextureAtlas.removeTextTexture(s63, t60.stageObject);
    }
    e59.rendered = false;
  }
  get running() {
    var _a;
    return this.view.ready && (this._dirty || ((_a = this._textTextureAtlas) == null ? void 0 : _a.updating) || this.deconflictor.running);
  }
  runTask(e59) {
    this._updateLabels(e59), !this._dirty && this.deconflictor.running && this.deconflictor.runTask(e59);
  }
  _updateLabels(e59) {
    if (this._dirty) {
      this._dirty = false;
      for (const t60 of this._labelingContexts)
        if (M15(t60)) {
          if (!B11(t60)) {
            if (k24(t60)) {
              this._deactivateLabelingContext(t60);
              continue;
            }
            if (this._createLabelClassContext(t60), z16(t60)) {
              this._dirty = true;
              continue;
            }
            if (!B11(t60))
              continue;
          }
          n5(t60.labelsToInitialize, (s63, l48) => (this._ensureGraphics3DResources(s63) && (this._labels.set(l48, s63), this.deconflictor.setDirty(), e59.madeProgress()), (s63.visible && s63.textTextureResources.initialized || !s63.visible && s63.hasGraphics3DResources) && (t60.labelsToInitialize.delete(l48), e59.madeProgress()), e59.done)) && (this._dirty = true);
        }
      this._labelsToRemove.forEach((e60) => this._removeLabelTextureFromAtlas(e60)), this._labelsToAdd.forEach((e60) => this._addLabelTextureToAtlas(e60)), this._labelsToRemove.clear(), this._labelsToAdd.clear(), this._dirty || this.notifyChange("updating");
    }
  }
  async _createLabelClassContextAsync(e59) {
    const t60 = e59.labelClassAbortController.signal;
    await e59.layer.when(), f(t60), e59.scaleVisibility && e59.scaleVisibility.updateScaleRangeActive();
    const i66 = e59.graphics3DCore, a58 = i66.layer, r59 = a58.labelingInfo && a58.labelingInfo.filter((e60) => !!e60.symbol);
    if (!r59 || 0 === r59.length)
      return;
    const o61 = new Array(r59.length);
    let n73 = false;
    await n12(r59, async (s63, a59) => {
      const r60 = s63.symbol, c67 = i54(i66.getOrCreateGraphics3DSymbol(r60));
      if (t(c67))
        return void V13.error("Failed to create Graphics3DSymbol for label");
      await c67.load(), f(t60);
      let b23 = null;
      o14(r60) && r60.hasVisibleCallout() && (b23 = e25(r60, i66.symbolCreationContext), await b23.load(), f(t60));
      const p52 = await a11(p16(s63, e59.layer.fieldsIndex, this.view.spatialReference));
      if (f(t60), true === p52.ok) {
        const e60 = await this._createTextRenderParameters(c67.symbol);
        f(t60), o61[a59] = { labelClass: s63, labelFunction: p52.value, graphics3DSymbol: c67, graphics3DCalloutSymbolLayer: b23, calloutSymbolLayerIndex: 0, textRenderParameters: e60 };
      } else
        V13.error(`Label expression failed to evaluate: ${p52.error}`), n73 = true;
    }), f(t60), n73 || (e59.labelClassContexts = o61);
  }
  async _createLabelClassContext(e59) {
    return e59.labelClassPromise || (e59.labelClassPromise = this._createLabelClassContextAsync(e59).catch((t60) => {
      if (g(t60))
        throw t60;
      e59.labelClassContexts = null;
    }).then(() => {
      e59.labelClassAbortController = null, this.notifyChange("updating");
    }).catch(() => {
    }), this.notifyChange("updating")), e59.labelClassPromise;
  }
  async _createTextRenderParameters(e59) {
    const t60 = e59.symbolLayers.getItemAt(0);
    return t60 && "text" === t60.type ? a25.fromSymbol(t60, this.view.state.pixelRatio) : null;
  }
  _destroyLabelClassContext(e59) {
    for (const s63 of e59.labelClassContexts)
      --s63.graphics3DSymbol.referenced, s63.graphics3DSymbol = null;
    const t60 = e59.labelClassAbortController;
    e59.labelClassAbortController = new AbortController(), t60 && t60.abort(), e59.labelClassContexts = [], e59.labelClassPromise = null, this.notifyChange("updating");
  }
  _createTextSymbolGraphic(e59, t60, s63, l48, i66) {
    const a58 = { text: e59.text, centerOffset: s63.centerOffset, translation: s63.translation, elevationOffset: s63.elevationOffset, screenOffset: s63.screenOffset, centerOffsetUnits: s63.centerOffsetUnits, horizontalPlacement: n34(s63.anchor), verticalPlacement: s28(s63.anchor), verticalOffset: s63.verticalOffset, debugDrawLabelBorder: t25.LABELS_SHOW_BORDER, displayWidth: e59.displayWidth, displayHeight: e59.displayHeight };
    return N12.graphic = t60, N12.renderingInfo = null, N12.layer = l48, i66.createLabel(N12, a58, this._hudMaterialCollection, this._textTextureAtlas);
  }
  _createLineCalloutGraphic(e59, t60, s63, l48, i66) {
    const a58 = { symbol: t60, translation: l48.translation, elevationOffset: l48.elevationOffset, screenOffset: l48.screenOffset, centerOffset: l48.centerOffset, centerOffsetUnits: l48.centerOffsetUnits, materialCollection: this._calloutMaterialCollection };
    return N12.graphic = e59, N12.renderingInfo = a58, N12.layer = i66, s63.createGraphics3DGraphic(N12);
  }
  _ensureGraphics3DResources(e59) {
    if (e59.hasGraphics3DResources)
      return false;
    const t60 = e59.graphics3DGraphic;
    if (t60.destroyed)
      return false;
    this._ensureTextTextureResources(e59);
    const { textTextureResources: s63 } = e59, l48 = e59.labelingContext, i66 = l48.labelClassContexts;
    if (!i66 || 0 === i66.length || !l48.emptySymbolLabelSupported && 0 === t60.graphics.length)
      return false;
    let a58 = false;
    const r59 = t60.graphic, o61 = l48.layer, n73 = s13(l48.layer), b23 = this.view._stage;
    for (let d32 = 0; d32 < i66.length; d32++) {
      const e60 = s63.textRenderers[d32], p52 = s63.labelPlacements[d32];
      if (t(e60) || t(p52))
        continue;
      const u51 = i66[d32], g45 = u51.graphics3DSymbol, y33 = g45.symbol && "label-3d" === g45.symbol.type ? g45.symbol : null, f37 = g45.symbolLayers[0];
      if (!f37)
        continue;
      f37.setElevationInfoOverride(l48.elevationInfoOverride);
      const m40 = this._createTextSymbolGraphic(e60, r59, p52, o61, f37);
      if (!m40)
        return false;
      m40._labelClass = u51.labelClass, m40._labelIndex = d32, t60.addLabelGraphic(m40, b23, l48.stageLayer), t60.setVisibilityFlag(C6.USER_SETTING, n73, E16.LABEL), t60.clearVisibilityFlag(C6.SCALE_RANGE, E16.LABEL), t60.setVisibilityFlag(C6.DECONFLICTION, false, E16.LABEL), a58 = true;
      const _30 = u51.graphics3DCalloutSymbolLayer;
      if (_30 && p52.hasLabelVerticalOffset) {
        _30.setElevationInfoOverride(l48.elevationInfoOverride);
        const e61 = this._createLineCalloutGraphic(r59, y33, _30, p52, o61);
        r(e61) && (u51.calloutSymbolLayerIndex = t60.labelGraphics.length, t60.addLabelGraphic(e61, b23, l48.stageLayer));
      }
      break;
    }
    return l48.scaleVisibility && a58 && l48.scaleVisibility.updateGraphicLabelScaleVisibility(t60), e59.hasGraphics3DResources = true, true;
  }
  _destroyGraphics3DResources(e59) {
    const t60 = e59.labelingContext.labelClassContexts;
    for (const s63 of e59.graphics3DGraphic.labelGraphics) {
      if (null == s63._labelClass)
        continue;
      const e60 = t60[s63._labelIndex].graphics3DSymbol.symbolLayers[0];
      null != e60 && e60.onRemoveGraphic(s63);
    }
    e59.graphics3DGraphic.clearLabelGraphics(), e59.hasGraphics3DResources = false;
  }
  _ensureTextTextureResources(e59) {
    const { textTextureResources: t60 } = e59;
    if (t60.initialized)
      return;
    const s63 = e59.labelingContext, l48 = s63.labelClassContexts;
    if (!l48 || 0 === l48.length)
      return;
    const i66 = e59.graphics3DGraphic.graphic;
    for (let r59 = 0; r59 < l48.length; r59++) {
      const o61 = l48[r59];
      if (t60.textRenderers[r59] = null, t60.labelPlacements[r59] = null, !o61.textRenderParameters)
        continue;
      const n73 = o61.labelFunction;
      let c67;
      if ("arcade" === n73.type)
        try {
          const e60 = n73.needsHydrationToEvaluate() ? c17(i66, s63.layer) : i66;
          c67 = n73.evaluate(e60);
        } catch (a58) {
          c67 = null;
        }
      else
        c67 = n73.evaluate(i66);
      if (t(c67) || "" === c67 || /^\s+$/.test(c67))
        continue;
      const b23 = o61.graphics3DSymbol, d32 = b23.symbol && "label-3d" === b23.symbol.type ? b23.symbol : null;
      if (!b23.symbolLayers[0])
        continue;
      const p52 = e59.graphics3DGraphic, u51 = o61.labelClass, g45 = s63.disablePlacement, y33 = g30({ graphics3DGraphic: p52, labelSymbol: d32, labelClass: u51, disablePlacement: g45 });
      if (t(y33))
        continue;
      const m40 = n34(y33.anchor), _30 = c23(m40);
      t60.textRenderers[r59] = new s27(c67, _30, o61.textRenderParameters), t60.labelPlacements[r59] = y33;
    }
    t60.initialized = true;
  }
  _destroyTextTextureResources(e59) {
    const { textTextureResources: t60 } = e59;
    t60.initialized = false, t60.textRenderers = [], t60.labelPlacements = [];
  }
  _addGraphic(e59, t60) {
    const s63 = { hasGraphics3DResources: false, visible: false, rendered: false, labelingContext: e59, graphics3DGraphic: t60, textTextureResources: { initialized: false, textRenderers: [], labelPlacements: [] } }, l48 = t60.graphic.uid;
    e59.labels.set(l48, s63), e59.labelsToInitialize.set(l48, s63), this.setDirty(), this.deconflictor.setDirty();
  }
  _removeGraphic(e59, t60) {
    const s63 = t60.graphic.uid, l48 = e59.labels.get(s63);
    l48 && (this._destroyGraphic(l48, s63), e59.labels.delete(s63), e59.labelsToInitialize.delete(s63), this.setDirty(), this.deconflictor.setDirty());
  }
  _destroyGraphic(e59, t60) {
    this._labels.has(t60) && (this._labels.delete(t60), this._labelsToAdd.delete(t60), this._labelsToRemove.delete(t60)), e59.textTextureResources.initialized && (this._removeLabelTextureFromAtlas(e59), this._destroyTextTextureResources(e59)), e59.hasGraphics3DResources && this._destroyGraphics3DResources(e59);
  }
  async _labelingInfoChange(e59, t60) {
    if (!t60)
      return this._visibilityInfoChange(e59), this._resetLabels(e59), this._createLabelClassContext(e59);
    for (const s63 of t60) {
      const t61 = e59.labels.get(s63);
      t61 && (this._removeGraphic(e59, t61.graphics3DGraphic), this._addGraphic(e59, t61.graphics3DGraphic));
    }
  }
  _globalPropertyChanged(e59, t60) {
    for (const s63 of t60.labelClassContexts) {
      const l48 = /* @__PURE__ */ new Map();
      t60.labels.forEach((e60) => {
        const t61 = e60.graphics3DGraphic;
        l48.set(t61.graphic.uid, t61);
      });
      const i66 = (e60) => e60.labelGraphics[0];
      if (e2(s63.graphics3DSymbol.symbolLayers[0]).globalPropertyChanged(e59, l48, i66), s63.graphics3DCalloutSymbolLayer) {
        const t61 = (e60) => e60.labelGraphics[s63.calloutSymbolLayerIndex];
        s63.graphics3DCalloutSymbolLayer.globalPropertyChanged(e59, l48, t61);
      }
    }
  }
  _visibilityInfoChange(e59) {
    const t60 = e59.layer.labelsVisible;
    t60 && !e59.active && this._activateLabelingContext(e59), !t60 && e59.active && this._deactivateLabelingContext(e59), this.setDirty();
  }
  _resetAllLabels() {
    for (const e59 of this._labelingContexts)
      this._resetLabels(e59);
  }
  _resetLabels(e59) {
    e59.labels.forEach((t60, s63) => {
      this._destroyGraphic(t60, s63), t60.visible = false, t60.rendered = false, e59.labelsToInitialize.set(s63, t60);
    }), this._destroyLabelClassContext(e59), this.setDirty(), this.deconflictor.setDirty();
  }
  _findLabelingContext(e59) {
    for (const t60 of this._labelingContexts)
      if (t60.graphics3DCore === e59)
        return t60;
    return null;
  }
  addGraphicsOwner(e59, t60, s63) {
    const l48 = s63 && s63.emptySymbolLabelSupported || false, i66 = s63 && s63.elevationInfoOverride || null, a58 = s63 && s63.disablePlacement || null;
    if (this._findLabelingContext(e59))
      return;
    const r59 = e59.layer, o61 = { graphics3DCore: e59, layer: r59, scaleVisibility: t60, emptySymbolLabelSupported: l48, elevationInfoOverride: i66, disablePlacement: a58, active: r59.labelsVisible, labelClassPromise: null, labelClassAbortController: new AbortController(), labelClassContexts: [], labels: /* @__PURE__ */ new Map(), labelsToInitialize: /* @__PURE__ */ new Map(), stageLayer: new l19({ isPickable: true }, r59.uid) };
    return this.view._stage.add(o61.stageLayer), this._labelingContexts.push(o61), this.setDirty(), { addGraphic: (e60) => this._addGraphic(o61, e60), removeGraphic: (e60) => this._removeGraphic(o61, e60), featureReductionChange: () => {
    }, layerLabelsEnabled: () => s13(o61.layer), labelingInfoChange: (e60) => this._labelingInfoChange(o61, e60), elevationInfoChange: () => this._globalPropertyChanged("elevationInfo", o61), slicePlaneEnabledChange: () => this._globalPropertyChanged("slicePlaneEnabled", o61), visibilityInfoChange: () => this._visibilityInfoChange(o61), reset: () => this._resetLabels(o61), clear: () => {
    } };
  }
  removeGraphicsOwner(e59) {
    const t60 = this._findLabelingContext(e59);
    if (!t60)
      return;
    const s63 = this._labelingContexts.indexOf(t60);
    this._labelingContexts.splice(s63, 1), t60.labels.forEach((e60) => this._removeGraphic(t60, e60.graphics3DGraphic)), this.view._stage.remove(t60.stageLayer), t60.stageLayer = null, this.setDirty();
  }
  setLabelGraphicVisibility(e59, t60) {
    const s63 = e59.graphic.uid, l48 = this._labels.get(s63);
    l48 && l48.visible !== t60 && (t60 && !l48.rendered ? (this._labelsToAdd.set(s63, l48), this._labelsToRemove.delete(s63), l48.textTextureResources.initialized || l48.labelingContext.labelsToInitialize.set(s63, l48)) : !t60 && l48.rendered && (this._labelsToRemove.set(s63, l48), this._labelsToAdd.delete(s63)), l48.visible = t60, this.setDirty());
  }
  setDirty() {
    !this._dirty && this._labelingContexts.length > 0 && (this._dirty = true, this.notifyChange("updating"));
  }
  get updating() {
    var _a;
    return this._dirty || ((_a = this._textTextureAtlas) == null ? void 0 : _a.updating) || this.deconflictor.updating || this._labelingContexts.some((e59) => z16(e59));
  }
  get updatingProgress() {
    if (!this.updating || !this._textTextureAtlas)
      return 1;
    const e59 = this._labelingContexts.length > 0 ? this._labelingContexts.reduce((e60, t60) => e60 + (z16(t60) ? 0 : 1), 0) / this._labelingContexts.length : 1;
    return (this._dirty ? 0 : 0.3) + (this._textTextureAtlas.updating ? 0 : 0.1) + 0.1 * e59 + 0.5 * this.deconflictor.updatingProgress;
  }
  get test() {
    return { textTextureAtlas: this._textTextureAtlas, resetAllLabels: () => this._resetAllLabels() };
  }
};
function M15(e59) {
  return e59.active && s13(e59.layer);
}
function z16(e59) {
  return e59.labelClassPromise && !!e59.labelClassAbortController;
}
function B11(e59) {
  return e59.labelClassContexts && e59.labelClassContexts.length;
}
function k24(e59) {
  return null === e59.labelClassContexts;
}
e([d({ constructOnly: true })], F13.prototype, "view", void 0), e([d({ constructOnly: true })], F13.prototype, "deconflictor", void 0), e([d()], F13.prototype, "_textTextureAtlas", void 0), e([d({ type: Boolean, readOnly: true })], F13.prototype, "updating", null), F13 = e([n6("esri.views.3d.layers.graphics.Labeler")], F13);
var N12 = new r30(null, null, null);

// node_modules/@arcgis/core/views/3d/layers/graphics/ObjectResourceCache.js
var c52 = class {
  constructor() {
    this.gltfCache = /* @__PURE__ */ new Map(), this.wosrCache = /* @__PURE__ */ new Map(), this.evictHandles = new u4();
  }
  loadGLTF(e59, t60, r59) {
    const o61 = r59 ? `gltfPBR:${e59}` : `gltf:${e59}`;
    return this._fromCache(this.gltfCache, o61, (t61) => c8(new n16(t61.streamDataRequester), e59, t61, r59), t60);
  }
  loadWOSR(e59, t60) {
    const r59 = `wosr:${e59}:${t60.disableTextures}`;
    return this._fromCache(this.wosrCache, r59, (t61) => w7(e59, t61), t60);
  }
  destroy() {
    this.evictHandles.destroy(), this.gltfCache.clear(), this.wosrCache.clear();
  }
  get size() {
    return this.wosrCache.size + this.gltfCache.size;
  }
  _fromCache(e59, t60, a58, n73) {
    return new Promise((l48, c67) => {
      if (p2(n73))
        return void c67(m3());
      const m40 = v(n73, () => {
        this._remove(e59, t60), c67(m3());
      }), h44 = e59.get(t60);
      if (h44)
        return this.evictHandles.remove(t60), h44.refCount++, void h44.item.then(l48, c67);
      const f37 = new AbortController(), d32 = { ...n73, signal: f37.signal }, C25 = { refCount: 1, abortController: f37, item: a58(d32).then((r59) => (C25.abortController = null, r59.remove = () => this._remove(e59, t60), r59)) };
      e59.set(t60, C25), C25.item.then((e60) => {
        r(m40) && m40.remove(), l48(e60);
      }, (e60) => {
        r(m40) && m40.remove(), c67(e60);
      });
    });
  }
  _remove(e59, o61) {
    const s63 = e59.get(o61);
    s63 && (s63.refCount--, 0 === s63.refCount && this.evictHandles.add(u(() => {
      e59.delete(o61), r(s63.abortController) && s63.abortController.abort();
    }, h32), o61));
  }
};
var m29 = 1e4;
var h32 = m29;

// node_modules/@arcgis/core/views/3d/layers/support/FeatureTileVisibility3D.js
var A32 = class {
  constructor(e59) {
    this.renderCoordsHelper = e59, this.surfaceElevation = 0, this.cache = /* @__PURE__ */ new Map(), this.frustum = new d9(e59), this.extendedFrustum = new d9(e59), this.intersector = new _7({ renderCoordsHelper: e59 }), this.renderCoordsHelper = e59;
  }
  begin(e59, t60) {
    this.surfaceElevation = t60, this.aboveGround = this.renderCoordsHelper.getAltitude(e59.eye) > t60, this.frustum.update(e59), this._shortenFrustumFarPlane(this.frustum), this._updateExtendedFrustum(e59);
  }
  end() {
    this.cache.clear();
  }
  calculate(e59) {
    if (this.allTilesInvisible)
      return s31.INVISIBLE;
    const t60 = this.renderCoordsHelper.viewingMode === l13.Global && e59.lij[0] >= R14 && e59.lij[0] < O22, i66 = this._getOrCalculateSingleTileVisibility(e59, !t60);
    return i66 !== s31.INVISIBLE && t60 ? this._calculateAggregatedChildrenVisibility(e59) : i66;
  }
  _shortenFrustumFarPlane(e59) {
    const t60 = d9.nearFarLineIndices, n73 = e59.mutablePoints;
    for (const o61 of t60) {
      const [e60, t61] = o61, a58 = n73[e60], u51 = n73[t61];
      e7(S16, u51, a58), q(S16, S16, b16), u3(n73[t61], a58, S16);
    }
    e59.updatePoints(n73);
  }
  _calculateAggregatedChildrenVisibility(e59) {
    let t60 = s31.INVISIBLE;
    const i66 = this.cache.get(e59.id);
    if (null != i66)
      return i66;
    const s63 = H15.acquire();
    e59.getChildren(s63);
    for (const r59 of s63) {
      const e60 = this.calculate(r59);
      if (e60 !== s31.INVISIBLE && (t60 = e60, e60 === s31.VISIBLE_ON_SURFACE))
        break;
    }
    return H15.release(s63), this.cache.set(e59.id, t60), t60;
  }
  _getOrCalculateSingleTileVisibility(e59, t60) {
    const i66 = this.cache.get(e59.id);
    if (null != i66)
      return i66;
    const s63 = this._calculateSingleTileVisibility(e59);
    return t60 && this.cache.set(e59.id, s63), s63;
  }
  _calculateSingleTileVisibility(e59) {
    if (!this.aboveGround && this.renderCoordsHelper.viewingMode === l13.Global && e59.lij[0] < g31) {
      return this._calculateSingleTileVisibilitySided(e59, false) === s31.INVISIBLE ? this._calculateSingleTileVisibilitySided(e59, true) : void 0;
    }
    return this._calculateSingleTileVisibilitySided(e59, this.aboveGround);
  }
  _calculateSingleTileVisibilitySided(e59, t60) {
    this.intersector.update(e59.extent, e59.tilingScheme.spatialReference, this.surfaceElevation, t60);
    const i66 = p3(e59.tilingScheme.spatialReference).radius;
    return this.intersector.isVisibleInFrustum(this.extendedFrustum, i66) ? this.intersector.isVisibleInFrustum(this.frustum, i66, true) ? s31.VISIBLE_ON_SURFACE : s31.VISIBLE_WHEN_EXTENDED : s31.INVISIBLE;
  }
  _updateExtendedFrustum(t60) {
    this.extendedFrustum.update(t60), this._shortenFrustumFarPlane(this.extendedFrustum);
    const i66 = this.renderCoordsHelper.worldUpAtPosition(t60.eye, S16);
    this.aboveGround || j2(i66, i66);
    const r59 = l4(-P2(i66, t60.viewForward));
    if (this.allTilesInvisible = r59 > (Math.PI + t60.fovY) / 2, this.allTilesInvisible)
      return;
    if (this.hasExtendedFrustum = r59 > t60.fovY / 2, !this.hasExtendedFrustum)
      return;
    const a58 = this._extendedFrustumParameters(), u51 = this.extendedFrustum.mutablePoints;
    for (let e59 = 0; e59 < 4; e59++) {
      const t61 = a58.pointIndices[e59], i67 = u51[t61], r60 = this.renderCoordsHelper.getAltitude(i67);
      if (a58.needsAltitudeAdjustment(r60)) {
        switch (this.renderCoordsHelper.worldUpAtPosition(i67, S16), t61) {
          case v7.FAR_BOTTOM_LEFT:
          case v7.FAR_TOP_LEFT:
          case v7.NEAR_BOTTOM_LEFT:
          case v7.NEAR_TOP_LEFT:
            Q3(this.extendedFrustum.planes[k6.LEFT], S16, S16);
            break;
          case v7.FAR_BOTTOM_RIGHT:
          case v7.FAR_TOP_RIGHT:
          case v7.NEAR_BOTTOM_RIGHT:
          case v7.NEAR_TOP_RIGHT:
            Q3(this.extendedFrustum.planes[k6.RIGHT], S16, S16);
        }
        q(S16, S16, a58.direction), this.renderCoordsHelper.intersectInfiniteManifold(j7(i67, S16), a58.zWithMargin, i67);
      }
    }
    if (this.extendedFrustum.updatePoints(u51), j9(u51[v7.NEAR_BOTTOM_LEFT], u51[v7.NEAR_BOTTOM_RIGHT], u51[v7.NEAR_TOP_RIGHT], N13), j9(u51[v7.NEAR_BOTTOM_RIGHT], u51[v7.NEAR_TOP_RIGHT], u51[v7.NEAR_TOP_LEFT], v26), P2(Z(N13), Z(v26)) < 0) {
      const e59 = this.extendedFrustum.mutablePoints;
      this.aboveGround ? [e59[v7.NEAR_BOTTOM_LEFT], e59[v7.NEAR_BOTTOM_RIGHT]] = [e59[v7.NEAR_BOTTOM_RIGHT], e59[v7.NEAR_BOTTOM_LEFT]] : [e59[v7.NEAR_TOP_LEFT], e59[v7.NEAR_TOP_RIGHT]] = [e59[v7.NEAR_TOP_RIGHT], e59[v7.NEAR_TOP_LEFT]], this.extendedFrustum.updatePoints(e59);
    }
  }
  _extendedFrustumParameters() {
    return this.aboveGround ? this._extendedFrustumParametersAboveSurface() : this._extendedFrustumParametersBelowSurface();
  }
  _extendedFrustumParametersAboveSurface() {
    const e59 = this.surfaceElevation - P16;
    return { zWithMargin: e59, pointIndices: d9.planePointIndices.bottom, direction: -1, needsAltitudeAdjustment: (t60) => t60 > e59 };
  }
  _extendedFrustumParametersBelowSurface() {
    const e59 = this.surfaceElevation + P16;
    return { zWithMargin: e59, pointIndices: d9.planePointIndices.top, direction: 1, needsAltitudeAdjustment: (t60) => t60 < e59 };
  }
};
var R14 = 2;
var O22 = 6;
var g31 = 12;
var b16 = 0.95;
var P16 = 1;
var S16 = n7();
var N13 = p17();
var v26 = p17();
var H15 = new e3(Array, (e59) => {
  4 !== e59.length && (e59[0] = new t30(), e59[1] = new t30(), e59[2] = new t30(), e59[3] = new t30());
}, (e59) => {
  e59[0].release(), e59[1].release(), e59[2].release(), e59[3].release();
});

// node_modules/@arcgis/core/views/3d/layers/support/FeatureTileMeasurements3D.js
var j26 = class {
  constructor(e59) {
    this.camera = new K3(), this.focusOnMap = [0, 0], this.screenRect = u6(), this.tileSize = e59.tileSize, this.renderCoordsHelper = e59.renderCoordsHelper, this.tilingScheme = e59.tilingScheme, this.visibility = new A32(e59.renderCoordsHelper);
  }
  begin(e59, t60, i66) {
    this.camera.copyFrom(e59), this.surfaceElevation = i66, this.focusOnMap[0] = t60.x, this.focusOnMap[1] = t60.y, o5(0, 0, e59.fullWidth, e59.fullHeight, this.screenRect), this.visibility.begin(this.camera, i66);
  }
  end() {
    this.visibility.end();
  }
  updateTile(e59) {
    e59.measures.visibility = this.visibility.calculate(e59), e59.measures.distance = d3(e59.extent, this.focusOnMap), e59.measures.visibility !== s31.INVISIBLE && this._updateScreenMeasure(e59);
  }
  _updateScreenMeasure(e59) {
    const t60 = T20, i66 = 1 << t60, r59 = e59.measures.screenRect;
    D3(r59);
    let s63 = 0;
    const o61 = e59.lij[0] + t60, n73 = e59.lij[1] << t60, a58 = e59.lij[2] << t60, l48 = this._tileSizeWithBias(e59), h44 = l48 * l48;
    for (let c67 = 0; c67 < i66; c67++)
      for (let t61 = 0; t61 < i66; t61++)
        if (s63 += this._computeScreenArea(e59, o61, n73 + c67, a58 + t61, r59), s63 > h44)
          return void (e59.measures.shouldSplit = true);
    e59.measures.shouldSplit = false;
  }
  _tileSizeWithBias(e59) {
    return e59.measures.visibility === s31.VISIBLE_WHEN_EXTENDED ? this.tileSize * y22 : this.tileSize;
  }
  _computeScreenArea(e59, t60, i66, r59, s63) {
    const o61 = e59.measures.visibility === s31.VISIBLE_WHEN_EXTENDED;
    this._projectToScreen(t60, i66, r59, o61, E27), D3(g32);
    for (let n73 = 0; n73 < 4; n73++)
      m6(g32, E27[n73]);
    return h5(s63, g32, s63), S5(E27[0], E27[1], E27[2]) + S5(E27[0], E27[2], E27[3]);
  }
  _projectToScreen(e59, t60, i66, r59, s63) {
    this.tilingScheme.ensureMaxLod(e59), this.tilingScheme.getExtent(e59, t60, i66, b17), this._toRenderCoords(b17, 0, 3, R15[0]), this._toRenderCoords(b17, 2, 3, R15[1]), this._toRenderCoords(b17, 2, 1, R15[2]), this._toRenderCoords(b17, 0, 1, R15[3]), r59 && (this._projectToPlane(R15, this.camera.frustum[k6.NEAR]), this._projectToPlane(R15, this.camera.frustum[k6.TOP]), this._projectToPlane(R15, this.camera.frustum[k6.BOTTOM]));
    for (let o61 = 0; o61 < 4; o61++)
      this.camera.projectToRenderScreen(R15[o61], M16), this.camera.renderToScreen(M16, s63[o61]);
  }
  _projectToPlane(e59, t60) {
    for (let i66 = 0; i66 < 4; i66++)
      C17[i66] = W3(t60, e59[i66]);
    const s63 = Math.max(C17[0], C17[1], C17[2], C17[3]);
    if (s63 > 0) {
      const o61 = q(v27, Z(t60), -s63);
      for (let t61 = 0; t61 < 4; t61++)
        u3(e59[t61], e59[t61], o61);
    }
  }
  _toRenderCoords(e59, t60, i66, r59) {
    return v27[0] = e59[t60], v27[1] = e59[i66], v27[2] = this.surfaceElevation, this.renderCoordsHelper.toRenderCoords(v27, this.tilingScheme.spatialReference, r59), r59;
  }
};
var g32 = u6();
var T20 = 2;
var y22 = 5;
var E27 = [i3(), i3(), i3(), i3()];
var b17 = u6();
var v27 = n7();
var R15 = [n7(), n7(), n7(), n7()];
var C17 = [0, 0, 0, 0];
var M16 = x2();

// node_modules/@arcgis/core/views/3d/layers/support/FeatureTileTree3D.js
var C18 = s3.getLogger("esri.views.3d.layers.support.FeatureTileTree3D");
var j27 = class extends y {
  constructor(e59) {
    super(e59), this.tiles = new j4(), this.tileSize = 512, this._idToTile = /* @__PURE__ */ new Map(), this._handles = new u4(), this._clients = /* @__PURE__ */ new Set(), this._dirty = false, this._newTiles = new n2();
  }
  get tilingScheme() {
    const e59 = this.tilingSchemeOwner.tilingScheme;
    if (!e59)
      return null;
    return e59.clone();
  }
  set filterExtent(e59) {
    if (r(e59) && !e59.spatialReference.equals(this.viewState.spatialReference))
      return void C18.error("#extent", "extent spatial reference needs to be in the same spatial reference as the view");
    const t60 = this._get("filterExtent");
    if (t60 === e59 || r(t60) && e59 && t60.equals(e59))
      return;
    const i66 = r(e59) ? e59.clone() : null;
    this._set("filterExtent", i66), this._setDirty();
  }
  get filterExtentRect() {
    if (t(this.filterExtent) || !this.tilingScheme)
      return null;
    const e59 = u6();
    return e24(this.filterExtent, e59, this.tilingScheme.spatialReference), e59;
  }
  get rootTileIds() {
    return this.filterExtentRect ? this.tilingScheme.rootTilesInExtent(this.filterExtentRect) : [[0, 0, 0]];
  }
  set suspended(e59) {
    e59 !== this._get("suspended") && (this._set("suspended", e59), this._setDirty());
  }
  get updating() {
    return this._dirty || !!this._pendingTiles;
  }
  initialize() {
    this._handles.add([l6(() => [this.tilingScheme, this.tileSize], () => this._reset(), U3), l6(() => {
      var _a, _b, _c;
      return [this.tileSize, (_a = this.cameraOnSurface) == null ? void 0 : _a.location, this.tilingScheme, (_b = this.viewState) == null ? void 0 : _b.contentCamera, (_c = this.focus) == null ? void 0 : _c.location];
    }, () => this._setDirty(), w2)]), this.scheduler && (this._frameWorker = this.scheduler.registerTask(L3.FEATURE_TILE_TREE, this));
  }
  destroy() {
    this._frameWorker = a2(this._frameWorker), this._handles = l(this._handles);
  }
  addClient() {
    const e59 = I19();
    return this._clients.add(e59), 1 === this._clients.size && this._setDirty(), { remove: () => this._removeClient(e59) };
  }
  _removeClient(e59) {
    this._clients.delete(e59), this._hasClients || this._clear();
  }
  get _hasClients() {
    return this._clients.size > 0;
  }
  _setDirty() {
    !this._hasClients || this.suspended || this._dirty || (this._frameWorker ? (this._dirty = true, this.notifyChange("updating")) : this.runTask(w3));
  }
  _clear() {
    this.tiles.removeAll(), this._idToTile.clear(), this._reset(), this._dirty = false, this.notifyChange("updating");
  }
  get running() {
    return this.updating;
  }
  runTask(e59) {
    this._dirty = false, this._pendingTiles || (this._startUpdate(), r(this._frameWorker) && (this._frameWorker.priority = L3.FEATURE_TILE_TREE_ACTIVE)), this._subdivideTilesForView(e59), !this._pendingTiles && r(this._frameWorker) && (this._frameWorker.priority = L3.FEATURE_TILE_TREE), this.notifyChange("updating");
  }
  _startUpdate() {
    if (this.suspended)
      return;
    if (!this.tilingScheme)
      return void this._clear();
    this._tileMeasurements || (this._tileMeasurements = new j26({ renderCoordsHelper: this.renderCoordsHelper, tilingScheme: this.tilingScheme, tileSize: this.tileSize }));
    const e59 = this.viewState.contentCamera;
    this._tileMeasurements.begin(e59, this.focus.location, this.cameraOnSurface.location.z), this._pendingTiles = this._getRootTiles();
  }
  _reset() {
    this._newTiles.clear(), this._tileMeasurements = null, this._pendingTiles = null, this._setDirty();
  }
  _getRootTiles() {
    return this.rootTileIds.map((e59) => new t30(e59[0], e59[1], e59[2], this.tilingScheme));
  }
  _purgeHorizonTiles(e59) {
    e59.sort((e60, t60) => {
      const i66 = e60.measures.screenRect, s63 = t60.measures.screenRect;
      return i66[1] + i66[3] - (s63[1] + s63[3]);
    }), D3(k25);
    for (let t60 = 0; t60 < e59.length; t60++)
      if (h5(k25, e59.data[t60].measures.screenRect, k25), l9(k25) > z17)
        return e59.data.slice(t60, e59.length);
    return [];
  }
  _subdivideTilesForView(e59) {
    if (this._pendingTiles) {
      for (; this._pendingTiles.length > 0 && !e59.done; ) {
        const t60 = this._pendingTiles.pop();
        e59.madeProgress(), this.filterExtentRect && !E4(this.filterExtentRect, t60.extent) || (this._tileMeasurements.updateTile(t60), t60.measures.visibility !== s31.INVISIBLE && (t60.measures.shouldSplit ? (this.tilingScheme.ensureMaxLod(t60.lij[0] + 1), this._pendingTiles.push(...t60.getChildren())) : this._newTiles.push(t60)));
      }
      0 === this._pendingTiles.length && (this._updateTiles(this._purgeHorizonTiles(this._newTiles)), this._newTiles.clear(), this._tileMeasurements.end(), this._pendingTiles = null);
    }
  }
  _updateTiles(e59) {
    for (const s63 of this.tiles.items)
      s63.used = false;
    const t60 = e59.filter((e60) => {
      const t61 = this._idToTile.get(e60.id);
      return t61 ? (t61.copyMeasurementsFrom(e60), t61.used = true) : this._idToTile.set(e60.id, e60), !t61;
    }), i66 = this.tiles.items.filter((e60) => !e60.used && (this._idToTile.delete(e60.id), true));
    this.tiles.removeMany(i66), this.tiles.addMany(t60), this._sortTiles();
  }
  _sortTiles() {
    this.viewState.fixedContentCamera || this.tiles.sort((e59, t60) => e59.measures.visibility !== t60.measures.visibility ? e59.measures.visibility === s31.VISIBLE_ON_SURFACE ? -1 : 1 : e59.measures.distance - t60.measures.distance), this.tiles.forEach((e59, t60) => e59.loadPriority = t60);
  }
};
e([d({ constructOnly: true })], j27.prototype, "scheduler", void 0), e([d({ constructOnly: true })], j27.prototype, "renderCoordsHelper", void 0), e([d({ constructOnly: true })], j27.prototype, "tilingSchemeOwner", void 0), e([d({ constructOnly: true })], j27.prototype, "cameraOnSurface", void 0), e([d({ constructOnly: true })], j27.prototype, "focus", void 0), e([d({ constructOnly: true })], j27.prototype, "viewState", void 0), e([d({ constructOnly: true })], j27.prototype, "terrain", void 0), e([d()], j27.prototype, "tiles", void 0), e([d()], j27.prototype, "tileSize", void 0), e([d({ readOnly: true })], j27.prototype, "tilingScheme", null), e([d()], j27.prototype, "filterExtent", null), e([d({ readOnly: true })], j27.prototype, "filterExtentRect", null), e([d({ readOnly: true })], j27.prototype, "rootTileIds", null), e([d({ value: false })], j27.prototype, "suspended", null), e([d({ readOnly: true })], j27.prototype, "updating", null), j27 = e([n6("esri.views.3d.layers.support.FeatureTileTree3D")], j27);
var O23 = 0;
function I19() {
  return O23++;
}
var k25 = u6();
var z17 = 10;

// node_modules/@arcgis/core/views/3d/state/ViewState.js
var w19 = class extends y {
  constructor() {
    super(...arguments), this._propertiesPool = new o23({ camera: K3 }, this), this._lastSeenCameraProjectionValues = new K3(), this.events = new n8(), this.viewingMode = l13.Global, this._cameraChanged = false, this.updateQueue = new Array(), this.processingUpdates = false;
  }
  init(e59, t60) {
    this._set("viewingMode", e59), this._set("spatialReference", t60), this._set("constraints", new p23({ mode: this.viewingMode }));
  }
  exit() {
    this.cameraController = null, this._propertiesPool.destroy(), this._propertiesPool = new o23({ camera: K3 }, this);
  }
  createInitialCamera() {
    if (this.viewingMode === l13.Global) {
      const e59 = p3(this.spatialReference).radius;
      this.camera = new K3(r6(4 * e59, 0, 0), r6(e59, 0, 0), r6(0, 0, 1));
    } else
      this.camera = new K3(r6(0, 0, 100), r6(0, 0, 0), r6(0, 1, 0));
  }
  get animation() {
    return this.cameraController instanceof a37 && r(this.cameraController.viewAnimation) ? this.cameraController.viewAnimation : null;
  }
  get camera() {
    return this._get("camera");
  }
  set camera(e59) {
    e59 !== v28 && v28.copyFrom(e59), v28.computeUp(this.viewingMode), j28.camera = v28, this.events.emit("before-camera-change", j28);
    const t60 = this._get("camera");
    if (this._cameraProjectionChanged(this._lastSeenCameraProjectionValues, v28) && (this._lastSeenCameraProjectionValues.copyFrom(v28), O24.camera = this._lastSeenCameraProjectionValues, this.events.emit("camera-projection-changed", O24)), (!t60 || !t60.equals(v28)) && (this._set("camera", this._propertiesPool.get("camera").copyFrom(v28)), this._cameraChanged = !t60 || !t60.almostEquals(v28), this._cameraChanged)) {
      const e60 = U(() => {
        this._cameraChanged = false, e60.remove();
      });
    }
  }
  get pixelRatio() {
    return this.camera.pixelRatio;
  }
  get contentCamera() {
    return r(this._contentCamera) ? this._contentCamera : this.camera;
  }
  set contentCamera(e59) {
    this._contentCamera = r(e59) ? e59.clone() : null;
  }
  get fixedContentCamera() {
    return r(this._contentCamera);
  }
  get isGlobal() {
    return this.viewingMode === l13.Global;
  }
  get isLocal() {
    return this.viewingMode === l13.Local;
  }
  get navigating() {
    return !(!this.cameraController || !this.cameraController.isInteractive);
  }
  get stationary() {
    return !this._cameraChanged && !this.navigating;
  }
  get cameraController() {
    return this._get("cameraController");
  }
  set cameraController(e59) {
    this.stopActiveCameraController() ? (e59 && (this.own(l6(() => e59.state, (t60) => {
      t60 !== o45.Finished && t60 !== o45.Stopped || (this._set("cameraController", null), this.updateCamera((t61) => e59.onControllerEnd(t61)));
    }, U3)), e59.onControllerStart(this.camera)), this._set("cameraController", e59)) : e59 && (e59.state = o45.Rejected);
  }
  switchCameraController(e59) {
    return this.cameraController = e59, e59.state !== o45.Rejected;
  }
  stopActiveCameraController() {
    return !(this.cameraController && !this.cameraController.stopController());
  }
  updateCamera(e59) {
    this.updateQueue.push(e59), this._processUpdateQueue();
  }
  _processUpdateQueue() {
    if (0 === this.updateQueue.length || this.processingUpdates)
      return;
    this.processingUpdates = true;
    const e59 = this.updateQueue.shift();
    v28.copyFrom(this._get("camera")), e59(v28), this.camera = v28, this.processingUpdates = false, this._processUpdateQueue();
  }
  _cameraProjectionChanged(e59, t60) {
    return e59.fov !== t60.fov || (e59.fullViewport[0] !== t60.fullViewport[0] || e59.fullViewport[1] !== t60.fullViewport[1] || e59.fullViewport[2] !== t60.fullViewport[2] || e59.fullViewport[3] !== t60.fullViewport[3] || (e59.padding[et.TOP] !== t60.padding[et.TOP] || e59.padding[et.RIGHT] !== t60.padding[et.RIGHT] || e59.padding[et.BOTTOM] !== t60.padding[et.BOTTOM] || e59.padding[et.LEFT] !== t60.padding[et.LEFT]));
  }
};
e([d({ readOnly: true, type: n29 })], w19.prototype, "animation", null), e([d({ type: K3 })], w19.prototype, "camera", null), e([d()], w19.prototype, "pixelRatio", null), e([d({})], w19.prototype, "_contentCamera", void 0), e([d({ type: K3 })], w19.prototype, "contentCamera", null), e([d({ readOnly: true })], w19.prototype, "fixedContentCamera", null), e([d({ readOnly: true })], w19.prototype, "constraints", void 0), e([d({ readOnly: true })], w19.prototype, "events", void 0), e([d({ readOnly: true })], w19.prototype, "isGlobal", null), e([d({ readOnly: true })], w19.prototype, "isLocal", null), e([d({ readOnly: true })], w19.prototype, "viewingMode", void 0), e([d({ readOnly: true })], w19.prototype, "spatialReference", void 0), e([d({ readOnly: true })], w19.prototype, "navigating", null), e([d({ readOnly: true })], w19.prototype, "stationary", null), e([d()], w19.prototype, "_cameraChanged", void 0), e([d()], w19.prototype, "cameraController", null), w19 = e([n6("esri.views.3d.state.ViewState")], w19);
var _19 = w19;
var v28 = new K3();
var j28 = { camera: null };
var O24 = { camera: null };

// node_modules/@arcgis/core/views/3d/state/NearFarHeuristic.js
function c53(e59, t60, i66) {
  return e59 === l13.Global ? new M17(i66) : new u37(t60, i66);
}
var u37 = class {
  constructor(e59, t60) {
    this.elevationProvider = e59, this._referenceEllipsoid = p3(t60), this.unitInMeters = z(t60, this._referenceEllipsoid.metersPerDegree);
  }
  compute(r59, o61, m40, l48, x30) {
    x30 || (x30 = { near: 0, far: 0 });
    let c67 = r59[2] * this.unitInMeters;
    const u51 = c67, M22 = c67 - l48, d32 = this.elevationProvider ? this.elevationProvider.elevationBounds : null;
    d32 && (c67 = M22 >= 0 ? u51 - this.unitInMeters * d32.min : this.unitInMeters * d32.max - u51);
    const E39 = { x: (m40 = r(m40) ? m40 : new M3({ xmin: 0, ymin: 0, zmin: 0, xmax: 0, ymax: 0, zmax: 0 })).xmax - m40.xmin, y: m40.ymax - m40.ymin, z: 4 * Math.max(m40.xmax - m40.xmin, m40.ymax - m40.ymin) }, b23 = Math.max(E39.x, E39.y, E39.z);
    e7(I20, o61, r59), v29[0] = I20[0] > 0 ? m40.xmax : m40.xmin, v29[1] = I20[1] > 0 ? m40.ymax : m40.ymin, v29[2] = I20[2] > 0 ? b23 / 2 : -b23 / 2, e7(v29, v29, r59), z2(I20, I20);
    const g45 = 1.1 * P2(v29, I20) * this.unitInMeters, _30 = Math.sqrt(c67 * (c67 + 2 * this._referenceEllipsoid.radius)), w25 = Math.max(m40.xmax - m40.xmin, m40.ymax - m40.ymin), z20 = w25 * y23 * this.unitInMeters, P22 = w25 * j29 * this.unitInMeters;
    let k32 = o4((c67 - P22) / (z20 - P22), 0, 1);
    k32 *= k32 * k32;
    let q18 = s10(_30, g45, k32);
    return q18 *= Math.max(Math.log(Math.abs(M22)), 1), q18 = Math.min(q18, Math.max(34064e4, b23)), q18 /= this.unitInMeters, f25(q18, p41, this.unitInMeters, x30);
  }
};
var M17 = class {
  constructor(e59) {
    this._referenceEllipsoid = p3(e59);
  }
  compute(e59, i66, r59, n73, s63) {
    s63 || (s63 = { near: 0, far: 0 });
    const a58 = s8(e59) - this._referenceEllipsoid.radius, m40 = this._referenceEllipsoid.radius + Math.min(0, n73), h44 = Math.abs(a58 - n73), l48 = Math.max(h44, Math.abs(a58));
    return f25(1.2 * Math.sqrt(l48 * (l48 + 2 * m40)), o4(2e4 - (Math.log(l48) - 7.983) / 9.011 * 19e3, 1e3, 2e4), 1, s63);
  }
};
function f25(e59, t60, i66, r59) {
  const n73 = d24 / i66;
  return e59 / t60 > n73 ? (r59.far = e59, r59.near = r59.far / t60) : (r59.near = n73, r59.far = r59.near * t60), r59;
}
var p41 = 2e4;
var d24 = 2;
var y23 = 1e-3;
var j29 = 1e-4;
var v29 = n7();
var I20 = n7();

// node_modules/@arcgis/core/views/3d/state/SurfaceCollisionConstraint.js
var c54 = class extends y {
  constructor(e59) {
    super(e59), this.handles = new u4();
  }
  initialize() {
    this.handles.add(this.view.basemapTerrain.on("elevation-change", (e59) => this._handleElevationChangeEvent(e59)));
  }
  destroy() {
    this.handles && (this.handles.destroy(), this.handles = null);
  }
  _handleElevationChangeEvent(e59) {
    if (this.view.state.cameraController)
      return;
    const t60 = this.view.state.camera;
    p32(this.view, t60, e59.extent, e59.spatialReference) && this._applyToCurrentCamera();
  }
  _applyToCurrentCamera() {
    this.view.state.updateCamera((e59) => {
      o41(this.view, e59, i44.EYE_AND_CENTER);
    });
  }
};
e([d({ constructOnly: true })], c54.prototype, "view", void 0), c54 = e([n6("esri.views.3d.state.ElevationCollisionConstraint")], c54);

// node_modules/@arcgis/core/views/3d/state/ConstraintsManager.js
var M18 = class extends y {
  constructor(t60) {
    super(t60), this._handles = new u4(), this.nearFarHeuristic = c53(t60.view.state.viewingMode, t60.view.basemapTerrain, t60.view.renderCoordsHelper.spatialReference);
  }
  initialize() {
    this._handles.add([l6(() => {
      var _a, _b, _c, _d;
      return [(_b = (_a = this.view.constraints) == null ? void 0 : _a.clipDistance) == null ? void 0 : _b.near, (_d = (_c = this.view.constraints) == null ? void 0 : _c.clipDistance) == null ? void 0 : _d.far];
    }, () => this._clipDistanceNearFarChanged()), l6(() => {
      var _a, _b;
      return (_b = (_a = this.view.constraints) == null ? void 0 : _a.clipDistance) == null ? void 0 : _b.mode;
    }, () => this._updateNearFar()), this.view.state.events.on("before-camera-change", (t60) => this._updateCameraNearFar(t60.camera)), l6(() => this.view.renderDataExtent, () => this._updateNearFar(), U3), l6(() => {
      var _a, _b, _c, _d;
      return [(_b = (_a = this.view.constraints) == null ? void 0 : _a.altitude) == null ? void 0 : _b.min, (_d = (_c = this.view.constraints) == null ? void 0 : _c.altitude) == null ? void 0 : _d.max];
    }, () => this._updateAltitude(), U3), l6(() => {
      var _a, _b;
      return (_b = (_a = this.view.constraints) == null ? void 0 : _a.tilt) == null ? void 0 : _b.max;
    }, () => this._updateTiltMax(), U3), l6(() => {
      var _a, _b;
      return (_b = (_a = this.view.constraints) == null ? void 0 : _a.tilt) == null ? void 0 : _b.mode;
    }, () => this._updateTilt(), U3), l6(() => {
      var _a;
      return (_a = this.view.state) == null ? void 0 : _a.camera;
    }, () => this._updateTiltAutoMax(), U3), l6(() => {
      var _a, _b, _c, _d, _e4, _f;
      return [(_c = (_b = (_a = this.view.map) == null ? void 0 : _a.ground) == null ? void 0 : _b.navigationConstraint) == null ? void 0 : _c.type, (_f = (_e4 = (_d = this.view.state) == null ? void 0 : _d.constraints) == null ? void 0 : _e4.collision) == null ? void 0 : _f.enabled];
    }, () => this._updateCollision(), U3)]), this.view.state.isLocal && this._handles.add(l6(() => this.view.renderDataExtent, (t60) => this._updateLocalSurfaceDistance(t60), h3)), this._updateNearFar(), this.view.state.viewingMode !== l13.Local && this._updateAltitude(), this._updateTilt(), this._updateCollision(), this._set("surfaceCollisionConstraint", new c54({ view: this.view }));
  }
  destroy() {
    this._handles = l(this._handles), this.surfaceCollisionConstraint && (this.surfaceCollisionConstraint.destroy(), this._set("surfaceCollisionConstraint", null));
  }
  _clipDistanceNearFarChanged() {
    var _a;
    const t60 = (_a = this.view.constraints) == null ? void 0 : _a.clipDistance;
    t60 && "auto" !== t60.mode && this.view.state.updateCamera((i66) => (this._updateCameraNearFarManual(i66, t60), true));
  }
  _updateNearFar() {
    this.view.state.updateCamera((t60) => (this._updateCameraNearFar(t60), true));
  }
  _updateCameraNearFar(t60) {
    const i66 = this.view.constraints && this.view.constraints.clipDistance;
    "manual" === (i66 ? i66.mode : "auto") ? this._updateCameraNearFarManual(t60, i66) : this._updateCameraNearFarAuto(t60, i66);
  }
  _updateCameraNearFarAuto(t60, i66) {
    this.nearFarHeuristic.compute(t60.eye, t60.center, this.view.renderDataExtent, m22(this.view, t60.eye), t60), i66 && i66.autoUpdate(t60.near, t60.far);
  }
  _updateCameraNearFarManual(t60, i66) {
    i66 && (t60.near = i66.near, t60.far = i66.far);
  }
  _updateCollision() {
    var _a, _b, _c;
    const t60 = (_c = (_b = (_a = this.view.map) == null ? void 0 : _a.ground) == null ? void 0 : _b.navigationConstraint) == null ? void 0 : _c.type, i66 = !t60 || "stay-above" === t60, a58 = this.view.state.constraints.collision;
    if (i66 !== a58.enabled) {
      a58.enabled = i66, i66 && this._reapplyConstraints(N8.COLLISION);
      const t61 = this.view.constraints && this.view.constraints.tilt;
      t61 && "auto" !== t61.mode || this._updateTiltAuto();
    }
  }
  _updateAltitude() {
    const t60 = this.view.constraints && this.view.constraints.altitude;
    t60 && this.view.state.viewingMode !== l13.Local ? this.view.state.constraints.altitude = { min: t60.min, max: t60.max } : this.view.state.constraints.altitude = null, this._reapplyConstraints();
  }
  _updateTiltMax() {
    const t60 = this.view.constraints && this.view.constraints.tilt;
    t60 && "auto" !== t60.mode && (this._updateTiltManual(t60), this._reapplyConstraints());
  }
  _updateTilt() {
    const t60 = this.view.constraints && this.view.constraints.tilt;
    "manual" === (t60 ? t60.mode : "auto") ? this._updateTiltManual(t60) : this._updateTiltAuto(), this._reapplyConstraints();
  }
  _updateTiltManual(t60) {
    const i66 = this.view.state.constraints;
    i66.tilt = i66.createConstantMaxTilt(M4(t60.max));
  }
  _updateTiltAuto() {
    const t60 = this.view.state.constraints;
    t60.tilt = t60.createDefaultTilt(), this._updateTiltAutoMax();
  }
  _updateTiltAutoMax() {
    const t60 = this.view.constraints && this.view.constraints.tilt;
    if (!t60 || "auto" !== t60.mode)
      return;
    const i66 = this.view.state.constraints;
    if (i66.tilt) {
      const a58 = i66.tilt(this.view.state.camera.distance).max;
      t60.autoUpdate(m4(a58));
    }
  }
  _updateLocalSurfaceDistance(t60) {
    if (t(t60))
      return;
    let i66 = Math.max(t60.width, t60.height);
    if (i66 <= 0)
      return;
    t60.hasZ && (i66 = Math.max(i66, t60.zmax - t60.zmin));
    const a58 = this.view.state, e59 = 3 * i66 / Math.atan(a58.camera.fov / 2);
    e59 !== a58.constraints.distance && (a58.constraints.distance = e59);
  }
  _reapplyConstraints(t60 = N8.ALL) {
    this.view.state.updateCamera((i66) => E21(this.view, i66, { selection: t60, interactionType: i43.NONE, interactionFactor: null, interactionStartCamera: null, interactionDirection: null, tiltMode: m21.TUMBLE }));
  }
};
e([d({ constructOnly: true })], M18.prototype, "view", void 0), e([d({ readOnly: true })], M18.prototype, "surfaceCollisionConstraint", void 0), M18 = e([n6("esri.views.3d.state.ConstraintsManager")], M18);

// node_modules/@arcgis/core/views/3d/state/controllers/SurfaceCollisionCorrectionController.js
var c55 = class extends i49 {
  constructor(e59) {
    super(e59), this.handles = new u4();
  }
  set desiredCamera(e59) {
    this._set("desiredCamera", e59.clone());
  }
  get canStop() {
    return true;
  }
  get constraintEnabled() {
    return this.view.state.constraints.collision.enabled;
  }
  onControllerStart() {
    this.state = o45.Running, this.handles.add(this.view.basemapTerrain.on("elevation-change", (e59) => this._handleElevationChangeEvent(e59))), this._applyCorrection();
  }
  onControllerEnd() {
    this.handles.removeAll();
  }
  stepController() {
  }
  _handleElevationChangeEvent(e59) {
    p32(this.view, this.desiredCamera, e59.extent, e59.spatialReference) && this._applyCorrection();
  }
  _applyCorrection() {
    this.view.state.updateCamera((e59) => {
      e59.copyViewFrom(this.desiredCamera), o41(this.view, e59, i44.EYE_AND_CENTER) || this.constraintEnabled || (this.state = o45.Stopped);
    });
  }
};
e([d({ constructOnly: true })], c55.prototype, "view", void 0), e([d({ constructOnly: true })], c55.prototype, "desiredCamera", null), c55 = e([n6("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")], c55);

// node_modules/@arcgis/core/views/3d/support/viewpointUtils.js
var ce3 = 0.66;
function le2(e59) {
  return 360 - s16.normalize(e59);
}
function me3(e59) {
  return s16.normalize(360 - e59);
}
function ue2(e59) {
  return r(e59) && e59.resolver && e59.resolver.reject(), null;
}
function fe2(e59, t60) {
  return r(e59) && e59.resolver && e59.resolver.resolve(t60), t60;
}
function pe2(e59, t60, n73, r59 = null) {
  if (!t60)
    return ue2(r59);
  const a58 = e59.spatialReference || k2.WGS84;
  if (r(t60.camera)) {
    const e60 = M2(t60.camera.position, a58);
    if (t(e60))
      return ue2(r59);
    const n74 = t60.camera.clone();
    return n74.position = e60, fe2(r59, n74);
  }
  if (t(t60.targetGeometry))
    return ue2(r59);
  const o61 = t60.get("targetGeometry.spatialReference");
  if (o61 && !g2(o61, a58))
    return ue2(r59);
  const c67 = $4(e59, e59.state.camera);
  let l48 = Y4.ADJUST;
  if (null != t60.rotation && (c67.heading = le2(t60.rotation), l48 = Y4.LOCKED), null != n73 && (c67.tilt = n73), "point" === t60.targetGeometry.type) {
    const n74 = t60.targetGeometry;
    let a59;
    const o62 = t60.targetGeometry.clone();
    return a59 = null != t60.scale ? _17(e59, t60.scale, n74.latitude) : e59.state.camera.distance, ne2(e59, o62, a59, c67, l48, r59);
  }
  const m40 = t60.targetGeometry.extent;
  return fe(e59, m40, c67.heading, c67.tilt, l48, r59);
}
function ge3(e59, t60, r59 = null) {
  return t(r59) && (r59 = new u14()), we2(e59, null, t60.clone(), r59);
}
async function he4(t60, r59, a58) {
  const i66 = Fe(t60, r59);
  if (!i66)
    throw new s4("viewpointutils-create:no-target", "Missing target for creating viewpoint");
  const s63 = new d7({ fov: t60.camera.fov }), c67 = new u14({ camera: s63 });
  if (i66.target instanceof u14) {
    return Ee(await Re3(t60, i66.target, i66, a58, c67));
  }
  if (i66.target instanceof d7)
    return Ee(Ge(t60, i66.target, c67));
  const l48 = null != i66.scale || null != i66.zoom;
  if (i66.target instanceof M3) {
    const e59 = i66.target.xmin === i66.target.xmax || i66.target.ymin === i66.target.ymax;
    return Ee(l48 || e59 ? await Se2(t60, i66, i66.target.center, s63, a58, c67) : await Me2(t60, i66, i66.target, s63, a58, c67));
  }
  const m40 = { boundingBox: B(), hasZ: false, screenSpaceObjects: [] }, u51 = l48 ? de2(t60, i66) : void 0;
  if (await je2(t60, i66.target, u51, m40), isFinite(m40.boundingBox[0])) {
    let e59;
    if (p9(m40.boundingBox, Te2), Ne.x = Te2[0], Ne.y = Te2[1], Ne.z = Te2[2], Ne.spatialReference = t60.spatialReference, isFinite(Ne.z) && m40.hasZ ? e59 = S2(m40.boundingBox) : (Ne.z = void 0, e59 = H2(G3(m40.boundingBox, Pe2))), l48 || e59)
      return Ee(await Se2(t60, i66, Ne, s63, a58, c67));
    const n73 = De(t60, m40.screenSpaceObjects);
    return Ee(await Ae(t60, i66, Ne, m40.boundingBox, n73, s63, a58, c67));
  }
  return i66.position ? Ee(Be(t60, i66, s63, c67)) : Ee(await ke(t60, i66, s63, a58, c67));
}
function ye2(e59, t60) {
  return null == t60.scale && null != t60.zoom ? je(e59, t60.zoom) : t60.scale;
}
function de2(e59, t60) {
  return Me(e59, ye2(e59, t60));
}
function xe2(e59, t60) {
  let n73 = false;
  return null != t60.heading ? (e59.heading = t60.heading, n73 = true) : null != t60.rotation && (e59.heading = le2(t60.rotation), n73 = true), null != t60.tilt && (e59.tilt = t60.tilt, n73 = true), null != t60.fov && (e59.fov = t60.fov), n73;
}
function we2(e59, t60, n73, r59) {
  const a58 = e59.spatialReference || k2.WGS84;
  return t60 = r(t60) ? t60 : B8(e59, n73), t(t60) || (r59.targetGeometry = In(t60.center, e59.renderSpatialReference, a58), r59.scale = we(e59, t60), r59.rotation = me3(n73.heading), r59.camera = n73), r59;
}
function ve2(e59, t60, n73) {
  if (!t60)
    return;
  if (!g2(t60.spatialReference, e59.spatialReference))
    throw new s4("viewpointutils:incompatible-spatialreference", `Spatial reference (${t60.spatialReference ? t60.spatialReference.wkid : "unknown"}) is incompatible with the view (${e59.spatialReference.wkid})`, { geometry: t60 });
  const r59 = [];
  if (!t60.hasZ && e59.basemapTerrain) {
    let n74;
    switch (t60.type) {
      case "point":
        n74 = t60;
        break;
      case "multipoint":
      case "polyline":
        n74 = t60.extent.center;
        break;
      case "mesh":
        n74 = t60.origin;
        break;
      case "extent":
        n74 = t60.center;
        break;
      case "polygon":
        n74 = t60.centroid;
    }
    n74 && g2(n74, e59.basemapTerrain.spatialReference) ? Te2[2] = c(i21(e59.elevationProvider, n74), 0) : Te2[2] = 0;
  }
  (0, Ve[t60.type])(t60, (e60) => {
    r59.push(e60[0], e60[1], e60[2]);
  }, Te2);
  const a58 = r59.length / 3;
  if (0 === a58)
    return;
  const i66 = new Array(r59.length);
  if (Un(r59, t60.spatialReference, 0, i66, e59.spatialReference, 0, a58)) {
    t60.hasZ && (n73.hasZ = true);
    for (let e60 = 0; e60 < i66.length; e60 += 3)
      t60.hasZ ? (Te2[0] = i66[e60 + 0], Te2[1] = i66[e60 + 1], Te2[2] = i66[e60 + 2]) : (Te2[0] = i66[e60 + 0], Te2[1] = i66[e60 + 1]), h6(n73.boundingBox, Te2);
  }
}
async function be(e59, t60, n73, a58) {
  const o61 = await a11(e59.whenViewForGraphic(t60));
  if (false === o61.ok || t(o61.value) || !("whenGraphicBounds" in o61.value))
    return void ve2(e59, t60.geometry, a58);
  const i66 = o61.value, c67 = await a11(i66.whenGraphicBounds(t60, { minDemResolution: n73 }));
  if (false === c67.ok)
    return void ve2(e59, t60.geometry, a58);
  const { screenSpaceObjects: l48, boundingBox: m40 } = c67.value;
  f7(a58.boundingBox, m40), l48 && l48.forEach((e60) => {
    a58.screenSpaceObjects.push(e60);
  }), isFinite(m40[2]) && (a58.hasZ = true);
}
async function je2(e59, n73, r59, a58) {
  if (Array.isArray(n73) && 2 === n73.length) {
    const t60 = n73[0], r60 = n73[1];
    if ("number" == typeof t60 && "number" == typeof r60)
      return Ne.x = t60, Ne.y = r60, Ne.z = void 0, Ne.spatialReference = e59.spatialReference.isGeographic ? e59.spatialReference : k2.WGS84, void ve2(e59, Ne, a58);
  }
  n73 && "function" == typeof n73.map ? await E2(n73.map((t60) => je2(e59, t60, r59, a58))) : n73 instanceof p4 ? ve2(e59, n73, a58) : n73 instanceof g7 && await be(e59, n73, r59, a58);
}
async function Re3(e59, t60, n73, r59, a58) {
  if (r(t60.camera))
    return Ge(e59, t60.camera, a58);
  a58.scale = t60.scale, a58.rotation = t60.rotation, a58.targetGeometry = r(t60.targetGeometry) ? t60.targetGeometry.clone() : null, a58.camera = null, null != n73.heading ? a58.rotation = me3(n73.heading) : null != n73.rotation && (a58.rotation = n73.rotation);
  const o61 = ye2(e59, n73);
  null != o61 && (a58.scale = o61);
  const s63 = new Se(r59);
  return pe2(e59, a58, n73.tilt, s63), a58.camera = await s63.resolver.promise, a58;
}
function Ge(e59, t60, n73) {
  const r59 = e59.spatialReference, a58 = M2(t60.position, r59);
  return t(a58) ? null : ((t60 = t60.clone()).fov = e59.camera.fov, t60.position = a58, we2(e59, null, t60, n73));
}
function ze(e59, t60, n73, r59, a58, o61) {
  const i66 = e59.renderSpatialReference;
  return Hn(n73.position, Je, i66), Hn(t60, Ke, i66), o61.targetGeometry = new j(t60), a58.position = new j(n73.position), e7(Ie, Ke, Je), re2(e59, Je, Ie, r59.up, a58), o61.scale = ee2(e59, x(Je, Ke), o61.targetGeometry.latitude), o61.rotation = me3(a58.heading), o61.camera = a58, o61;
}
async function Se2(e59, t60, n73, r59, a58, i66) {
  if (t(n73))
    throw new s4("createfromcenter", "invalid point");
  i66.targetGeometry = n73.clone();
  const c67 = g23(e59);
  if (t60.position)
    return ze(e59, i66.targetGeometry, t60, c67, r59, i66);
  if (t60.zoomFactor) {
    const r60 = c67.distance / t60.zoomFactor, a59 = q(Te2, c67.viewForward, -r60);
    c67.eye = u3(Te2, c67.center, a59), i66.scale = ee2(e59, r60, n73.latitude);
  }
  $4(e59, c67, r59);
  const l48 = xe2(r59, t60) ? Y4.LOCKED : Y4.ADJUST;
  if (!t60.zoomFactor) {
    i66.scale = ye2(e59, t60), null == i66.scale && (Hn(n73, Te2, e59.renderSpatialReference), U8(c67.frustum, Te2) ? i66.scale = ee2(e59, x(c67.eye, Te2), n73.latitude) : i66.scale = we(e59, c67));
    const o61 = new Se(a58);
    te2(e59, i66.targetGeometry, i66.scale, r59, l48, o61), i66.camera = await o61.resolver.promise;
  }
  return i66;
}
function Be(e59, t60, n73, r59) {
  const a58 = g23(e59);
  return r7(Ie, a58.viewForward), re2(e59, a58.eye, Ie, a58.up, Le), n73.position = new j(t60.position), n73.heading = null != t60.heading ? t60.heading : Le.heading, n73.tilt = null != t60.tilt ? t60.tilt : Le.tilt, we2(e59, null, n73, r59);
}
async function ke(e59, t60, n73, r59, a58) {
  const o61 = g23(e59);
  return Se2(e59, t60, In(o61.center, e59.renderSpatialReference, e59.spatialReference), n73, r59, a58);
}
async function Me2(e59, t60, n73, r59, a58, o61) {
  o61.targetGeometry = n73.clone();
  const i66 = g23(e59);
  $4(e59, i66, r59);
  const s63 = xe2(r59, t60) ? Y4.LOCKED : Y4.ADJUST, c67 = new Se(a58);
  return fe(e59, n73, r59.heading, r59.tilt, s63, c67), o61.camera = await c67.resolver.promise, o61;
}
function Ze(e59, t60, n73, r59, a58) {
  let o61 = 0;
  n73.hasZ ? o61 = n73.z : e59.basemapTerrain && (o61 = e2(i21(e59.elevationProvider, n73))), o3(Te2, n73.x, n73.y, o61), qn(e59.spatialReference, Te2, Ue, e59.renderSpatialReference), a10(Oe, Ue), o10(Oe, Oe), B(Ce2);
  const i66 = [[0, 1, 2], [3, 1, 2], [0, 4, 2], [3, 4, 2], [0, 1, 5], [3, 1, 5], [0, 4, 5], [3, 4, 5]];
  for (let l48 = 0; l48 < i66.length; l48++) {
    const t61 = i66[l48];
    let n74 = r59[t61[2]];
    isFinite(n74) || (n74 = o61), o3(Te2, r59[t61[0]], r59[t61[1]], n74), Bn(Te2, e59.spatialReference, Te2, e59.renderSpatialReference), h6(Ce2, O2(Te2, Te2, Oe));
  }
  const s63 = I3(Ce2), c67 = N2(Ce2), m40 = y2(Ce2), p52 = 1 / Math.tan(t60.fovX / 2), g45 = 1 / Math.tan(t60.fovY / 2), h44 = 0.5 * Math.sqrt(s63 * s63 + m40 * m40) * Math.max(g45, p52) + 0.5 * c67, y33 = 0.5 * c67 * g45 + 0.5 * Math.max(s63, m40);
  return Math.max(h44, y33) / a58;
}
async function Ae(e59, t60, n73, r59, a58, o61, i66, s63) {
  s63.targetGeometry = n73.clone();
  const c67 = g23(e59), l48 = Ze(e59, c67, n73, r59, a58);
  $4(e59, c67, o61);
  const m40 = xe2(o61, t60) ? Y4.LOCKED : Y4.ADJUST;
  s63.scale = ee2(e59, l48, s63.targetGeometry.latitude);
  const u51 = new Se(i66);
  return te2(e59, s63.targetGeometry, s63.scale, o61, m40, u51), s63.camera = await u51.resolver.promise, s63;
}
function Fe(e59, t60) {
  if (!t60 || !e59.spatialReference)
    return null;
  const n73 = { target: null };
  if ("declaredClass" in t60 || Array.isArray(t60))
    n73.target = t60;
  else {
    for (const e60 in t60)
      n73[e60] = t60[e60];
    t60.center && !n73.target && (n73.target = t60.center);
  }
  return n73;
}
function Ee(e59) {
  return e59 && r(e59.camera) && (e59.rotation = me3(e59.camera.heading)), e59;
}
function De(e59, t60) {
  const n73 = ce3;
  if (!t60.length)
    return n73;
  let r59 = Number.NEGATIVE_INFINITY;
  for (let a58 = 0; a58 < t60.length; a58++) {
    const e60 = t60[a58].screenSpaceBoundingRect;
    r59 = Math.max(r59, Math.abs(e60[0]), Math.abs(e60[1]), Math.abs(e60[2]), Math.abs(e60[3]));
  }
  return n73 - r59 / Math.min(e59.width, e59.height) * 2;
}
var Te2 = n7();
var Ue = e12();
var Oe = e11();
var Ce2 = a8();
var Pe2 = u6();
var Ie = n7();
var Je = n7();
var Ke = n7();
var Le = { heading: 0, tilt: 0 };
var Ne = new j();
var Ve = { point(e59, t60, n73) {
  n73[0] = e59.x, n73[1] = e59.y, e59.hasZ && (n73[2] = e59.z), t60(n73);
}, polygon(e59, t60, n73) {
  const r59 = e59.hasZ;
  for (let a58 = 0; a58 < e59.rings.length; a58++) {
    const o61 = e59.rings[a58];
    for (let e60 = 0; e60 < o61.length; e60++)
      n73[0] = o61[e60][0], n73[1] = o61[e60][1], r59 && (n73[2] = o61[e60][2]), t60(n73);
  }
}, polyline(e59, t60, n73) {
  const r59 = e59.hasZ;
  for (let a58 = 0; a58 < e59.paths.length; a58++) {
    const o61 = e59.paths[a58];
    for (let e60 = 0; e60 < o61.length; e60++)
      n73[0] = o61[e60][0], n73[1] = o61[e60][1], r59 && (n73[2] = o61[e60][2]), t60(n73);
  }
}, multipoint(e59, t60, n73) {
  const r59 = e59.points, a58 = e59.hasZ;
  for (let o61 = 0; o61 < r59.length; o61++)
    n73[0] = r59[o61][0], n73[1] = r59[o61][1], a58 && (n73[2] = r59[o61][2]), t60(n73);
}, extent(e59, t60, n73) {
  e59.hasZ ? (t60(o3(n73, e59.xmin, e59.ymin, e59.zmin)), t60(o3(n73, e59.xmax, e59.ymin, e59.zmin)), t60(o3(n73, e59.xmin, e59.ymax, e59.zmin)), t60(o3(n73, e59.xmax, e59.ymax, e59.zmin)), t60(o3(n73, e59.xmin, e59.ymin, e59.zmax)), t60(o3(n73, e59.xmax, e59.ymin, e59.zmax)), t60(o3(n73, e59.xmin, e59.ymax, e59.zmax)), t60(o3(n73, e59.xmax, e59.ymax, e59.zmax))) : (t60(o3(n73, e59.xmin, e59.ymin, n73[2])), t60(o3(n73, e59.xmax, e59.ymin, n73[2])), t60(o3(n73, e59.xmin, e59.ymax, n73[2])), t60(o3(n73, e59.xmax, e59.ymax, n73[2])));
}, mesh(e59, t60, n73) {
  const r59 = e59.vertexAttributes && e59.vertexAttributes.position;
  if (r59)
    for (let a58 = 0; a58 < r59.length; a58 += 3)
      t60(o3(n73, r59[a58 + 0], r59[a58 + 1], r59[a58 + 2]));
} };

// node_modules/@arcgis/core/views/3d/state/GoToOperation.js
var C19 = class {
  constructor(t60, i66, e59) {
    this.target = t60, this.options = i66, this.view = e59, this.state = "pending", this.abortController = null, this.animationController = null, this.promise = new Promise((t61, i67) => {
      this.resolveCallback = t61, this.rejectCallback = i67;
      const e60 = new AbortController();
      r(this.options.signal) && v(this.options.signal, () => {
        this.abort();
      }), this.abortController = e60, this.waitForReady();
    });
  }
  then(t60, i66) {
    return this.promise.then(t60, i66);
  }
  catch(t60) {
    return this.promise.catch(t60);
  }
  resolve(t60) {
    return this.state = "finished", this.resolveCallback(t60);
  }
  reject(t60) {
    return this.state = "finished", this.rejectCallback(t60);
  }
  abort(t60 = false) {
    switch (this.state) {
      case "pending":
      case "wait-for-ready":
      case "wait-for-viewpoint":
        this.reject(m3());
        break;
      case "wait-for-animation-finish":
        !t60 && r(this.animationController) && this.view.state.cameraController === this.animationController && this.animationController.active && this.animationController.stopController(), this.reject(m3());
    }
  }
  async waitForReady() {
    if (this.state = "wait-for-ready", !this.view.ready)
      try {
        await j5(() => this.view.ready, this.abortController.signal);
      } catch (t60) {
        return this.reject(t60);
      }
    this.createViewPoint();
  }
  createViewPoint() {
    "finished" !== this.state && (this.state = "wait-for-viewpoint", this.animationController = this.options.animate ? this._getAnimationController() : null, he4(this.view, this.target, this.abortController.signal).then((t60) => {
      if ("finished" === this.state)
        return;
      const i66 = this._getCameraFromViewpoint(t60);
      if (!t(i66))
        if (this.options.animate) {
          if (t(this.animationController))
            return;
          this.startAnimation(i66, this.animationController);
        } else
          this.view.stateManager.setStateCamera(i66.camera, { applyConstraints: !i66.isFullySpecified, positionAndOrientationOnly: true, doNotCancelGoToOperation: true }), this.resolve();
    }, (t60) => {
      this.reject(t60);
    }));
  }
  _getCameraFromViewpoint(a58) {
    const o61 = !!(this.target instanceof u14 && this.target.camera || this.target instanceof d7), r59 = a58.camera;
    if (t(r59))
      return null;
    if (!this.view.stateManager.isCompatible(r59)) {
      const t60 = r59.position, i66 = t60 && t60.spatialReference, a59 = i66 ? i66.wkid : "none", n73 = this.view.spatialReference.wkid;
      return this.reject(new s4("GotoAnimation:incompatible-spatialreference", `Resulting camera has an incompatible spatial reference (camera: ${a59}, view: ${n73})`, { camera: r59 })), null;
    }
    const s63 = B8(this.view, r59);
    return t(s63) ? (this.reject(new s4("GotoAnimation:invalid-camera", "Resulting camera is invalid")), null) : { viewpoint: a58, camera: s63, isFullySpecified: o61 };
  }
  startAnimation(t60, i66) {
    this.state = "wait-for-animation-finish";
    const o61 = i66.viewAnimation;
    if (t(o61))
      return void this.reject(new s4("GotoAnimation:missing-animation", "Unreachable code in view.stateManager"));
    if (o61.update(t60.viewpoint, "running"), !i66.active || t(i66.viewAnimation) || i66.viewAnimation.target !== t60.viewpoint || this.view.state.cameraController !== i66)
      return this.abort();
    let r59;
    t60.isFullySpecified ? (r59 = new c55({ view: this.view, desiredCamera: t60.camera }), o41(this.view, t60.camera, i44.EYE_AND_CENTER)) : E21(this.view, t60.camera), i66.begin(t60.camera, this.options);
    const s63 = () => {
      const e59 = this.view.state.cameraController;
      r59 && (e59 && e59.active ? e59 instanceof h28 && r(e59.viewAnimation) && e59.viewAnimation.target === t60.viewpoint && (this.view.state.cameraController = r59) : r(i66.viewAnimation) && i66.viewAnimation.target === t60.viewpoint && "finished" === i66.state && (this.view.state.cameraController = r59));
    }, w25 = (t61) => {
      if (!t(this.view.state))
        switch (i66.state) {
          case o45.Finished:
            switch (this.state) {
              case "pending":
              case "wait-for-ready":
              case "wait-for-viewpoint":
              case "wait-for-animation-finish":
                this.resolve();
            }
            break;
          case o45.Ready:
          case o45.Rejected:
          case o45.Running:
          case o45.Stopped:
            switch (this.state) {
              case "pending":
              case "wait-for-ready":
              case "wait-for-viewpoint":
              case "wait-for-animation-finish":
                this.reject(t61);
            }
        }
    };
    o61.when(s63, (t61) => w25(t61)), i66.asyncResult = { resolve: () => w25(), reject: (t61) => w25(t61) };
  }
  _getAnimationController() {
    let t60, i66 = null;
    const n73 = this.view.state.cameraController;
    return n73 instanceof h28 && (n73.updateStateFromViewAnimation(), n73.active && (t60 = n73, i66 = t60.viewAnimation)), null != t60 || (t60 = new h28({ view: this.view, mode: "animation" }), i66 = t60.viewAnimation, this.view.state.switchCameraController(t60)) ? t60 : (r(i66) && i66.stop(), this.reject(new s4("GotoAnimation:goto-cannot-interrupt", "Cannot start an animation while interacting")), null);
  }
};

// node_modules/@arcgis/core/views/3d/state/ViewStateManager.js
var q13 = s3.getLogger("esri.views.3d.state.ViewStateManager");
var W12 = class extends y {
  constructor(e59) {
    super(e59), this.propertiesPool = new o23({ frustum: d9 }, this), this.handles = new u4(), this.cameraSetByUser = false, this.gotoOperation = null, this.ready = false, this._windowDevicePixelRatio = 1, this._devicePixelRatioOverride = null, this._maximumPixelRatioOverride = null, this.test = { contentCameraResetState: /* @__PURE__ */ new Map(), setDevicePixelRatio: (e60) => this._devicePixelRatioOverride = e60, setMaximumPixelRatio: (e60) => this._maximumPixelRatioOverride = e60 };
  }
  get camera() {
    const e59 = this._get("camera");
    if (!this.ready)
      return e59;
    const t60 = $4(this.view, this.view.state.camera);
    return t60 && e59 && t60.equals(e59) ? e59 : t60;
  }
  set camera(e59) {
    this._updatePropertyBeforeReady("camera", e59) || (this.view.elevationProvider.enableElevationCache(true), this.setStateCamera(B8(this.view, e59), { applyConstraints: false }) || q13.error("#camera=", "Invalid camera", e59), this.view.elevationProvider.enableElevationCache(false));
  }
  get contentCamera() {
    const e59 = this._get("contentCamera");
    if (!this.ready)
      return e59;
    const t60 = $4(this.view, this.view.state.contentCamera);
    return t60 && e59 && t60.equals(e59) ? e59 : t60;
  }
  set contentCamera(e59) {
    if (this._updatePropertyBeforeReady("contentCamera", e59))
      return;
    const t60 = B8(this.view, e59);
    t(t60) ? this.view.state.contentCamera = null : (this._updateElevation(t60), this.view.state.contentCamera = t60);
  }
  installContentCameraReset(e59) {
    if (this.handles.remove("contentCameraReset"), this.test.contentCameraResetState.clear(), !this.view.state.fixedContentCamera)
      return false;
    const t60 = this.zoom, i66 = this.view.state.camera.distance ** 2, r59 = e6(this.view.state.camera.center), a58 = e59.sticky ? this.contentCamera.clone() : null;
    return this.handles.add([l6(() => this.contentCamera, () => {
      e59.sticky || (this.handles.remove("contentCameraReset"), this.test.contentCameraResetState.clear());
    }), l6(() => this.zoom, (e60) => {
      this.test.contentCameraResetState.set("view.zoom", Math.abs(e60 - t60) / 2), Math.abs(e60 - t60) > 2 ? this.contentCamera = null : this.view.state.fixedContentCamera || (this.contentCamera = a58);
    }), l6(() => this.view.state.camera, (e60) => {
      const t61 = p5(r59, e60.center);
      this.test.contentCameraResetState.set("camera.center", t61 / i66), t61 > i66 ? this.contentCamera = null : this.view.state.fixedContentCamera || (this.contentCamera = a58);
    })], "contentCameraReset"), true;
  }
  get center() {
    return this.ready ? this.view.pointsOfInterest.centerOnContent.location : this._get("center");
  }
  set center(e59) {
    this._updatePropertyBeforeReady("center", e59) || (e59 ? this.isCompatible(e59) ? this.setStateCamera(this._centerToCamera(e59), { applyConstraints: true }) ? this.view.pointsOfInterest.centerOnContent.runTask() : q13.error("#center=", "Invalid center", e59) : q13.error("#center=", "Center has an incompatible spatial reference (center: " + (e59.spatialReference ? e59.spatialReference.wkid : "none") + ", view: " + this.view.spatialReference.wkid + ")", e59) : q13.error("#center=", "Center may not be null or undefined"));
  }
  get extent() {
    if (!this.ready)
      return this._get("extent");
    const e59 = this.view, t60 = ue(e59, e59.state.camera, e59.pointsOfInterest.centerOnContent.renderLocation);
    return r(t60) ? t60 : this._get("extent");
  }
  set extent(e59) {
    this._updatePropertyBeforeReady("extent", e59) || (e59 ? this.isCompatible(e59) ? this.setStateCamera(this._extentToCamera(e59), { applyConstraints: true }) || q13.error("#extent=", "Invalid extent", e59) : q13.error("#extent=", "Extent has an incompatible spatial reference (extent: " + (e59.spatialReference ? e59.spatialReference.wkid : "none") + ", view: " + this.view.spatialReference.wkid + ")", e59) : q13.error("#extent=", "Extent may not be null or undefined"));
  }
  get frustum() {
    const e59 = this.propertiesPool.get("frustum");
    return e59.renderCoordsHelper = this.view.renderCoordsHelper, e59.update(this.view.state.camera), e59;
  }
  get hasInitialView() {
    return !!this.view.get("map.initialViewProperties.viewpoint");
  }
  get scale() {
    if (this.ready) {
      const e59 = this.view.pointsOfInterest.centerOnContent;
      return ee2(this.view, e59.distance, e59.location.latitude);
    }
    return this._get("scale");
  }
  set scale(e59) {
    this._updatePropertyBeforeReady("scale", e59) || this.setStateCamera(this._scaleToCamera(e59), { applyConstraints: true }) || q13.error("#scale=", "Invalid scale", e59);
  }
  get padding() {
    if (!this.ready)
      return this._get("padding");
    const e59 = this.view.state.camera, t60 = e59.padding, i66 = e59.pixelRatio, r59 = this._get("padding"), a58 = Math.round(t60[et.TOP] / i66), s63 = Math.round(t60[et.RIGHT] / i66), o61 = Math.round(t60[et.BOTTOM] / i66), n73 = Math.round(t60[et.LEFT] / i66);
    return null != r59 && r59.top === a58 && r59.right === s63 && r59.bottom === o61 && r59.left === n73 ? r59 : { top: a58, right: s63, bottom: o61, left: n73 };
  }
  set padding(e59) {
    this._updatePropertyBeforeReady("padding", e59) || (this._paddingToArray(e59, this.view.state.camera.pixelRatio, $8), this.view.state.updateCamera((e60) => e60.padding = $8));
  }
  _paddingToArray(e59, t60, i66) {
    e59 ? r8(i66, e59.top || 0, e59.right || 0, e59.bottom || 0, e59.left || 0) : r8(i66, 0, 0, 0, 0);
    for (let r59 = 0; r59 < 4; r59++)
      i66[r59] = Math.round(i66[r59] * t60);
  }
  get screenCenter() {
    const e59 = this.padding;
    return c4((this.view.width - (e59.left + e59.right)) / 2 + e59.left, (this.view.height - (e59.top + e59.bottom)) / 2 + e59.top);
  }
  get viewpoint() {
    return this.ready ? ge3(this.view, this.camera) : this._get("viewpoint");
  }
  set viewpoint(e59) {
    if (!this._updatePropertyBeforeReady("viewpoint", e59))
      if (e59)
        if (this.isCompatible(e59))
          this.setStateCamera(this._viewpointToCamera(e59), { applyConstraints: !e59.camera }) || q13.error("#viewpoint=", "Invalid viewpoint", e59);
        else {
          const t60 = r(e59.camera) ? e59.camera.position : e59.targetGeometry, i66 = r(t60) && t60.spatialReference;
          q13.error("#viewpoint=", "Viewpoint has an incompatible spatial reference (viewpoint: " + (i66 ? i66.wkid : "none") + ", view: " + this.view.spatialReference.wkid + ")", e59);
        }
      else
        q13.error("#viewpoint=", "Viewpoint may not be null or undefined");
  }
  get zoom() {
    return this.ready ? xe(this.view, this.scale) : this._get("zoom");
  }
  set zoom(e59) {
    this._updatePropertyBeforeReady("zoom", e59) || this.setStateCamera(this._zoomToCamera(e59), { applyConstraints: true }) || q13.error("#zoom=", "Invalid zoom", e59);
  }
  get maximumPixelRatio() {
    if (r(this._maximumPixelRatioOverride))
      return this._maximumPixelRatioOverride;
    let e59 = 1 / 0;
    const { maximumPixelRatio: t60, maximumRenderResolution: i66 } = this.view.qualitySettings;
    if (null != t60 && (e59 = Math.min(e59, t60)), null != i66) {
      const t61 = i66 / Math.max(this.view.width, this.view.height);
      e59 = Math.min(e59, t61);
    }
    return e59;
  }
  get _devicePixelRatio() {
    return t(this._devicePixelRatioOverride) ? Math.min(this._windowDevicePixelRatio, this.maximumPixelRatio) : this._devicePixelRatioOverride;
  }
  initialize() {
    this.handles.add([a5(() => this.view.state.events, "before-camera-change", (e59) => this._updateElevation(e59.camera))]), l6(() => this.view.state.camera, (e59) => this._updateElevation(e59), { once: true, sync: true }), this.handles.add(A2({ prepare: () => this._prepareFrame() })), this.handles.add(l6(() => this.view.state.cameraController, () => {
      this.cameraSetByUser = true, this.handles.remove(ee3);
    })), this.handles.add(a5(() => this.view.state.events, "camera-projection-changed", () => this.notifyChange("scale")));
  }
  destroy() {
    this.deinit(), this.handles && (this.handles.destroy(), this.handles = null), this.propertiesPool && (this.propertiesPool.destroy(), this.propertiesPool = null);
  }
  init() {
    this.constraintsManager = new M18({ view: this.view }), this._prepareFrame();
    const e59 = this._getInitialProperties();
    this.cameraSetByUser = false, this._set("ready", true);
    for (const t60 of e59)
      this.set(t60.name, t60.value);
    if (!this.cameraSetByUser) {
      const e60 = this.view.get("map.initialViewProperties.viewpoint") || this.view.initialExtent;
      e60 && this.isCompatible(e60) ? this._setInitialView(e60) : this.view.state.viewingMode === l13.Local && this.handles.add(f4(() => this.view.basemapTerrain.ready, () => {
        this.handles.remove(ee3), this._setInitialView(this.view.dataExtent);
      }, { once: true, initial: true }), ee3);
    }
  }
  deinit() {
    this._cancelGoToOperation(), this.ready && (this._override("padding", this.padding), this._set("ready", false), this._clearOverride("hasInitialView"), this.cameraSetByUser = false, this.handles.remove(ee3), this.constraintsManager && (this.constraintsManager.destroy(), this.constraintsManager = null));
  }
  async goTo(e59, t60) {
    const i66 = { animate: true, ...t60 };
    return r(this.gotoOperation) && this.gotoOperation.abort(i66.animate), this.gotoOperation = new C19(e59, i66, this.view), this.view.resourceController.scheduler.stopFrame(), this.gotoOperation;
  }
  debugSetCameraOnContent() {
    this.setStateCamera(g23(this.view), { applyConstraints: false });
  }
  step(e59) {
    const t60 = this.view.state, i66 = t60 && this.view.state.cameraController;
    i66 && (t60.updateCamera((t61) => {
      i66.stepController(e59, t61);
    }), i66.steppingFinished && i66.finishController());
  }
  _cancelGoToOperation() {
    r(this.gotoOperation) && (this.gotoOperation.abort(), this.gotoOperation = null);
  }
  _getInitialProperties() {
    const e59 = /* @__PURE__ */ new Set(), t60 = [];
    for (const { propertyName: i66, overrides: r59 } of Q12) {
      const a58 = e59.has(i66), s63 = this._isOverridden(i66);
      !a58 && s63 && t60.push({ name: i66, value: this._get(i66) }), this._clearOverride(i66), (a58 || s63) && r59.forEach((t61) => e59.add(t61));
    }
    return t60;
  }
  _setInitialView(e59) {
    if (t(e59) || this.cameraSetByUser)
      return;
    if (e59 instanceof d7)
      return void this.setStateCamera(B8(this.view, e59), { applyConstraints: false });
    if (e59 instanceof u14) {
      if (e59.targetGeometry instanceof M3) {
        const t61 = fe(this.view, e59.targetGeometry, 0, 0.5, Y4.LOCKED);
        return void (r(t61) && this.setStateCamera(B8(this.view, t61), { applyConstraints: true }));
      }
      const t60 = { applyConstraints: !e59.camera }, i66 = this._viewpointToCamera(e59);
      return void this.setStateCamera(i66, t60);
    }
    const r59 = fe(this.view, e59, 0, 0.5, Y4.LOCKED);
    r(r59) && this.setStateCamera(B8(this.view, r59), { applyConstraints: true });
  }
  _updatePropertyBeforeReady(e59, t60) {
    return !this.ready && (this._override(e59, t60), t60 && K8.includes(e59) && this._override("hasInitialView", true), true);
  }
  isCompatible(e59) {
    return !t(e59) && (e59 instanceof u14 ? e59.camera ? this.isCompatible(e59.camera) : this.isCompatible(e59.targetGeometry) : e59 instanceof d7 ? this.isCompatible(e59.position) : e59.spatialReference && g2(e59.spatialReference, this.view.spatialReference));
  }
  _getPreservingHeadingTilt(e59 = X6) {
    return this.cameraSetByUser ? (e59.heading = this.camera.heading, e59.tilt = this.camera.tilt) : (e59.heading = 0, e59.tilt = 0.5), e59;
  }
  _centerPointAtDistanceToCamera(e59, t60, i66 = Z8) {
    const { heading: r59, tilt: a58 } = this._getPreservingHeadingTilt(), s63 = ce2(this.view, r59, a58, e59, t60, Y4.ADJUST);
    return t(s63) ? null : (i66.copyFrom(this.view.state.camera), i66.eye = s63.eye, i66.center = s63.center, i66.up = s63.up, i66);
  }
  _centerToCamera(e59) {
    const t60 = this.view.pointsOfInterest.centerOnContent;
    t60.runTask();
    const i66 = t60.distance;
    return this._centerPointAtDistanceToCamera(e59, i66);
  }
  _extentToCamera(e59) {
    const { heading: t60, tilt: i66 } = this._getPreservingHeadingTilt(), r59 = fe(this.view, e59, t60, i66, Y4.ADJUST, Y6);
    return r(r59) ? B8(this.view, r59) : null;
  }
  _scaleToCamera(e59) {
    if (null == e59)
      return null;
    const t60 = this.view.pointsOfInterest.centerOnContent;
    t60.runTask();
    const i66 = t60.renderLocation, r59 = t60.location.latitude, a58 = _17(this.view, e59, r59);
    return this._centerPointAtDistanceToCamera(i66, a58);
  }
  _zoomToCamera(e59) {
    return this._scaleToCamera(je(this.view, e59));
  }
  _viewpointToCamera(e59) {
    return B8(this.view, pe2(this.view, e59));
  }
  setStateCamera(e59, t60) {
    return !(t(e59) || !this.view.state.stopActiveCameraController()) && (this.cameraSetByUser = true, t60.doNotCancelGoToOperation || this._cancelGoToOperation(), this.view.state.updateCamera((i66) => {
      t60.positionAndOrientationOnly ? (i66.eye = e59.eye, i66.center = e59.center, i66.up = e59.up) : i66.copyFrom(e59), t60.applyConstraints && E21(this.view, i66);
    }), t60.applyConstraints || (this.view.state.cameraController = new c55({ view: this.view, desiredCamera: e59 })), true);
  }
  _prepareFrame() {
    const { surface: e59, canvas: t60 } = this.view;
    if (!e59 || !t60)
      return;
    this._windowDevicePixelRatio = window.devicePixelRatio;
    const i66 = this._devicePixelRatio, r59 = Math.round(e59.clientWidth * i66), a58 = Math.round(e59.clientHeight * i66);
    if (0 !== r59 && 0 !== a58 && (t60.width === r59 && t60.height === a58 || (t60.width = r59, t60.height = a58), this.view.state)) {
      const e60 = this.view.state.camera;
      e60.fullWidth === r59 && e60.fullHeight === a58 && e60.pixelRatio === i66 || (Z8.copyFrom(e60), Z8.pixelRatio !== i66 && (this._paddingToArray(this.padding, i66, $8), Z8.padding = $8), Z8.fullWidth = r59, Z8.fullHeight = a58, Z8.pixelRatio = i66, this.view.state.camera = Z8);
    }
  }
  _updateElevation(e59) {
    const t60 = this.view.basemapTerrain && this.view.basemapTerrain.spatialReference, i66 = this.view.renderCoordsHelper.getAltitude(e59.eye), r59 = t60 ? m22(this.view, e59.eye) : 0;
    e59.relativeElevation = i66 - r59;
  }
};
e([d({ type: d7, dependsOn: ["view.state.camera", "ready"] })], W12.prototype, "camera", null), e([d({ type: d7, dependsOn: ["view.state.contentCamera", "ready"] })], W12.prototype, "contentCamera", null), e([d({ type: j })], W12.prototype, "center", null), e([d({ type: M3 })], W12.prototype, "extent", null), e([d({ readOnly: true })], W12.prototype, "frustum", null), e([d({ readOnly: true })], W12.prototype, "hasInitialView", null), e([d({ readOnly: true, type: Boolean })], W12.prototype, "ready", void 0), e([d({ type: Number })], W12.prototype, "scale", null), e([d()], W12.prototype, "padding", null), e([d({ readOnly: true })], W12.prototype, "screenCenter", null), e([d({ constructOnly: true })], W12.prototype, "view", void 0), e([d({ type: u14 })], W12.prototype, "viewpoint", null), e([d({ type: Number })], W12.prototype, "zoom", null), e([d()], W12.prototype, "maximumPixelRatio", null), e([d()], W12.prototype, "_devicePixelRatio", null), e([d()], W12.prototype, "_windowDevicePixelRatio", void 0), e([d()], W12.prototype, "_devicePixelRatioOverride", void 0), e([d()], W12.prototype, "_maximumPixelRatioOverride", void 0), W12 = e([n6("esri.views.3d.state.ViewStateManager")], W12);
var J10 = W12;
var K8 = ["camera", "viewpoint", "extent", "scale", "center", "zoom"];
var Q12 = [{ propertyName: "camera", overrides: ["viewpoint"] }, { propertyName: "viewpoint", overrides: ["extent"] }, { propertyName: "extent", overrides: ["center", "scale"] }, { propertyName: "center", overrides: [] }, { propertyName: "scale", overrides: ["zoom"] }, { propertyName: "zoom", overrides: [] }, { propertyName: "padding", overrides: [] }];
var X6 = { heading: 0, tilt: 0 };
var Y6 = new d7();
var Z8 = new K3();
var $8 = n10();
var ee3 = "pending-initial-view";

// node_modules/@arcgis/core/views/3d/state/helpers/SceneIntersectionHelper.js
var H16 = class {
  constructor(e59, t60, r59) {
    this.viewingMode = e59, this._forEachLayer = t60, this.view = r59, this.externalIntersectionHandlers = new n2(), this.tolerance = A17, this.tmpRay = d6(), this.tmpRegion = u6(), this.validateHUDIntersector = x6(this.viewingMode), this.validateHUDIntersector.options.hud = false;
  }
  intersectScreen(e59, t60, r59) {
    return this.intersectRay(this._getPickRay(e59, this.tmpRay), k26(this.viewingMode), t60, r59);
  }
  intersectScreenFreePointFallback(e59, t60, r59) {
    return this.intersectRayFreePointFallback(this._getPickRay(e59, this.tmpRay), t60, r59);
  }
  intersectRayFreePointFallback(e59, t60, r59) {
    return this.intersectRay(e59, k26(this.viewingMode), t60, r59) || this._intersectRayFreePointLocal(e59, t60);
  }
  intersectRay(e59, t60, r59, i66) {
    return t60.options.selectionMode = false, t60.options.store = t27.MIN, this.computeIntersection(e59, t60, i66), !!t60.results.min && t60.results.min.getIntersectionPoint(r59);
  }
  getCenterRayWithSubpixelOffset(e59, t60, r59 = 0.5, i66 = 0.5) {
    return e59.getRenderCenter(N14, r59, i66), N14[0] += 0.0466, N14[1] -= 0.0123, g12(e59, N14, t60);
  }
  intersectIntersectorScreen(e59, t60, r59) {
    this.computeIntersection(this._getPickRay(e59, this.tmpRay), t60, r59);
  }
  intersectToolIntersectorScreen(e59, t60, r59) {
    const i66 = this._getPickRay(e59, this.tmpRay);
    this.intersectToolIntersectorRay(i66, t60, r59);
  }
  intersectToolIntersectorRay(e59, t60, r59) {
    t60.options.selectionMode = true, this.computeIntersection(e59, t60, r59);
    const i66 = t60.results.min;
    !!this.view.basemapTerrain && this.view.basemapTerrain.opaque || c21(i66) && i66.intersector !== i23.TERRAIN || (t60.options.selectionMode = false, this.computeIntersection(e59, t60, r59));
  }
  setTolerance(e59 = A17) {
    this.tolerance = e59;
  }
  addIntersectionHandler(e59) {
    this.externalIntersectionHandlers.push(e59), this.externalIntersectionHandlers.sort((e60, t60) => e60.type === i23.TERRAIN ? 1 : t60.type === i23.TERRAIN ? -1 : 0);
  }
  removeIntersectionHandler(e59) {
    null != this.externalIntersectionHandlers.removeUnordered(e59) && this.externalIntersectionHandlers.sort((e60, t60) => e60.type === i23.TERRAIN ? 1 : t60.type === i23.TERRAIN ? -1 : 0);
  }
  _getPickRay(e59, t60) {
    const r59 = this.view.state.camera;
    return s30(r59, e59, t60);
  }
  _intersectRayFreePointLocal(t60, r59) {
    if (this.viewingMode !== l13.Local || t(t60))
      return false;
    const i66 = this.view.renderDataExtent;
    if (t(i66))
      return u3(r59, t60.origin, z2(c9.get(), t60.direction)), true;
    const n73 = { x: i66.xmax - i66.xmin, y: i66.ymax - i66.ymin, z: 8 * Math.max(i66.xmax - i66.xmin, i66.ymax - i66.ymin) }, s63 = Math.max(n73.x, n73.y, n73.z);
    if (0 === s63)
      return u3(r59, t60.origin, z2(c9.get(), t60.direction)), true;
    const h44 = this.view.state.camera, u51 = Math.max(0, i66.xmin - h44.eye[0], h44.eye[0] - i66.xmax), m40 = Math.max(0, i66.ymin - h44.eye[1], h44.eye[1] - i66.ymax), d32 = Math.sqrt(u51 * u51 + m40 * m40), p52 = Math.abs(h44.relativeElevation) + Number.MIN_VALUE, y33 = Math.max(0, Math.log(s63 / p52)) ** 2;
    let g45 = s63 / Math.max(1, y33);
    g45 = Math.max(g45, Math.min(d32, s63));
    const f37 = q(c9.get(), t60.direction, g45 / s8(t60.direction));
    return u3(r59, t60.origin, f37), true;
  }
  intersectElevationFromScreen(e59, t60, r59 = 0, i66 = null) {
    return this._intersectElevation(this._getPickRay(e59, this.tmpRay), t60, r59, i66);
  }
  _intersectElevation(i66, s63, a58 = 0, c67 = null) {
    if (t(i66))
      return null;
    const l48 = r(s63) ? s63.mode : "absolute-height", h44 = r(s63) ? c(s63.offset, 0) : 0, u51 = "on-the-ground" !== l48 ? h44 + a58 : 0, m40 = u51 / this.view.renderCoordsHelper.unitInMeters;
    if ("absolute-height" === l48) {
      if (this.view.renderCoordsHelper.intersectInfiniteManifold(i66, u51, S17)) {
        const e59 = this.view.computeMapPointFromVec3d(S17);
        return e59.z -= h44, e59;
      }
      return null;
    }
    const d32 = this.view.state.camera, p52 = p6(c9.get());
    d32.projectToRenderScreen(i66.origin, p52);
    const y33 = new A33(null, this._forEachLayer), g45 = this.view.slicePlane, f37 = r(g45) ? s26(g45) : null, v36 = x6(this.viewingMode);
    v36.options.store = t27.MIN, v36.options.verticalOffset = m40;
    const x30 = i66.origin, w25 = u3(c9.get(), x30, i66.direction);
    v36.reset(x30, w25, d32), v36.point = p52;
    const b23 = r(c67) ? "type" in c67 && "graphics" === c67.type ? (e59) => e59.metadata.layerUid !== c67.uid : (e59) => e59.metadata.graphicUid !== c67.uid : null;
    switch (l48) {
      case "relative-to-scene":
        {
          const t60 = (t61) => (t(b23) || b23(t61)) && t61.metadata && t61.metadata.isElevationSource;
          v36.intersect(y33.layers, p52, this.tolerance, null, t60), this.externalIntersectionHandlers.forAll((e59) => {
            if (e59.type === i23.I3S || e59.type === i23.TERRAIN) {
              const t61 = e59.slicePlaneEnabled ? f37 : null;
              e59.intersect(v36, t61, v36.rayBegin, v36.rayEnd, p52);
            }
          });
        }
        break;
      case "on-the-ground":
      case "relative-to-ground":
        this.externalIntersectionHandlers.forAll((e59) => {
          if (e59.isGround) {
            const t60 = e59.slicePlaneEnabled ? f37 : null;
            e59.intersect(v36, t60, v36.rayBegin, v36.rayEnd, p52);
          }
        });
    }
    if (v36.results.min.getIntersectionPoint(S17)) {
      const e59 = this.view.computeMapPointFromVec3d(S17);
      return e59.z = a58, e59;
    }
    return null;
  }
  computeIntersection(i66, s63, a58) {
    if (t(i66))
      return;
    const c67 = this.view.state.camera, l48 = p6(c9.get());
    c67.projectToRenderScreen(i66.origin, l48);
    const h44 = new A33(a58, this._forEachLayer);
    s63.options.selectOpaqueTerrainOnly = !a58 || !("include" in a58 || "exclude" in a58);
    const u51 = i66.origin, m40 = u3(c9.get(), i66.origin, i66.direction);
    s63.reset(u51, m40, c67), s63.intersect(h44.layers, l48, this.tolerance);
    const d32 = this.view.slicePlane, p52 = r(d32) ? s26(d32) : null;
    s63.intersect(h44.sliceableLayers, l48, this.tolerance, p52);
    const y33 = a58 && (a58.requiresGroundFeedback || a58.enableDraped);
    this.externalIntersectionHandlers.forAll((e59) => {
      if (s63.options.isFiltered = !h44.filterLayerUid(e59.layerUid), e59.isGround && y33 || !s63.options.isFiltered) {
        const t60 = e59.slicePlaneEnabled ? p52 : null;
        e59.intersect(s63, t60, u51, m40, l48);
      }
    });
    const g45 = c9.get();
    if (a58 && a58.enableDraped && s63.results.ground.getIntersectionPoint(g45)) {
      const e59 = this.view.basemapTerrain, t60 = e59.overlayManager.renderer, i67 = this.view.renderCoordsHelper.spatialReference, n73 = c9.get();
      this.view.renderCoordsHelper.fromRenderCoords(g45, n73, e59.spatialReference), n73[2] = c(this.view.elevationProvider.getElevation(g45[0], g45[1], g45[2], i67, "ground"), 0), t60.intersect(s63, n73, s63.results.ground, (e60) => h44.filterRenderGeometry(e60));
    }
    s63.sortResults(), this._processHUDResults(s63);
  }
  _processHUDResults(r59) {
    const i66 = r59.results.hud;
    a7(this.tmpRegion, K);
    const n73 = this.view.state.camera, s63 = [], o61 = this.tmpRegion, a58 = (e59) => {
      const t60 = new T21(e59);
      n73.projectToRenderScreen(e59.target.center, t60.screenPoint), t60.screenPoint[0] = Math.floor(t60.screenPoint[0]), t60.screenPoint[1] = Math.floor(t60.screenPoint[1]), s63.push(t60), m6(o61, t60.screenPoint);
    };
    r59.sortResults(i66.all), r(i66.min.dist) && a58(i66.min);
    for (const e59 of i66.all)
      i66.min.target.object !== e59.target.object && i66.max.target.object !== e59.target.object && a58(e59);
    if (r(i66.max.dist) && i66.max.target.object !== i66.min.target.object && a58(i66.max), !s63.length)
      return;
    o61[0] === o61[2] && (o61[2] += 1), o61[1] === o61[3] && (o61[3] += 1);
    const c67 = n73.fullWidth, l48 = n73.fullHeight, h44 = Math.max(0, o61[0] - U21), u51 = Math.max(0, o61[1] - U21), f37 = Math.min(s12(o61) + 2 * U21, c67 - h44), R21 = Math.min(l9(o61) + 2 * U21, l48 - u51), v36 = new Uint8Array(f37 * R21 * 4);
    this.view._stage.renderView.readHUDVisibility(h44, u51, f37, R21, v36);
    let x30 = true;
    const w25 = t(r59.results.max.dist);
    let b23 = 0;
    for (const e59 of s63)
      for (const t60 of L23) {
        if (v36[4 * (Math.min(e59.screenPoint[0] + t60[0], c67) - o61[0] + (Math.min(e59.screenPoint[1] + t60[1], l48) - o61[1]) * f37)]) {
          x30 && (r59.results.min.copy(e59.result), x30 = false), w25 && r59.results.max.copy(e59.result), r59.options.store === t27.ALL && r59.results.all.splice(b23++, 0, e59.result);
          break;
        }
      }
  }
};
var U21 = 1;
var L23 = (() => {
  const e59 = [], t60 = U21;
  for (let r59 = -t60; r59 <= t60; r59++)
    for (let i66 = -t60; i66 <= t60; i66++)
      e59.push([i66 + t60, r59 + t60]);
  return e59;
})();
var T21 = class {
  constructor(e59) {
    this.result = e59, this.screenPoint = x2();
  }
};
var _20;
function k26(e59) {
  return _20 && _20.viewingMode === e59 || (_20 = x6(e59)), _20;
}
var A33 = class {
  constructor(e59, t60) {
    this.layers = new Array(), this.sliceableLayers = new Array(), this.include = e59 == null ? void 0 : e59.include, this.exclude = e59 == null ? void 0 : e59.exclude, t60((e60) => {
      e60.isPickable && this.filterLayerUid(e60.apiLayerUid) && (e60.isSliceable ? this.sliceableLayers : this.layers).push(e60);
    });
  }
  filterLayerUid(t60) {
    const { include: r59, exclude: i66 } = this;
    return t(t60) ? null == r59 && null == i66 : (null == r59 || r59.has(t60)) && (null == i66 || !i66.has(t60));
  }
  filterRenderGeometry(e59) {
    return this.filterLayerUid(e59.layerUid);
  }
};
function F14(e59) {
  return "object" == typeof e59 && "intersect" in e59;
}
var S17 = n7();
var N14 = x2();

// node_modules/@arcgis/core/views/3d/support/CombinedElevationProvider.js
var u38 = class extends n8.EventedMixin(y) {
  constructor(e59) {
    super(e59), this.im = new Array(), this.ground = new Array(), this.scene = new Array(), this.handles = /* @__PURE__ */ new Map(), this.lastElevationQuery = null, this.elevationCacheEnabled = false;
  }
  destroy() {
    this._elevationQuery = l(this._elevationQuery);
  }
  get elevationQuery() {
    return t(this._elevationQuery) && (this._elevationQuery = new a24(this.view.resourceController.scheduler, this.view.spatialReference, () => this.view.map && this.view.map.ground, { maximumAutoTileRequests: 4 })), this._elevationQuery;
  }
  enableElevationCache(e59) {
    e59 || (this.lastElevationQuery = null), this.elevationCacheEnabled = e59;
  }
  getElevation(e59, t60, s63, r59, o61) {
    if (this.elevationCacheEnabled && null != this.lastElevationQuery) {
      const i66 = this.lastElevationQuery;
      if (e59 === i66.x && t60 === i66.y && s63 === i66.z && r59.equals(i66.spatialReference) && o61 === i66.queryContext)
        return i66.result;
    }
    let n73 = null;
    return n73 = p42(n73, this.im, e59, t60, s63, r59, o61), t(n73) && (n73 = p42(n73, this.ground, e59, t60, s63, r59, o61)), "scene" === o61 && (n73 = p42(n73, this.scene, e59, t60, s63, r59, o61)), this.elevationCacheEnabled && (this.lastElevationQuery = { x: e59, y: t60, z: s63, spatialReference: r59, queryContext: o61, result: n73 }), n73;
  }
  queryElevation(e59, t60, s63, r59, i66, o61 = null, l48 = 0) {
    const c67 = D();
    return this.elevationQuery.queryElevation(e59, t60, o61, l48).then((o62) => {
      "scene" === i66 && (o62 = p42(o62, this.scene, e59, t60, s63, r59, i66)), c67.resolve(o62);
    }).catch((o62) => {
      g(o62) ? c67.reject(o62) : c67.resolve(this.getElevation(e59, t60, s63, r59, i66));
    }), c67.promise;
  }
  register(e59, t60) {
    this.handles.set(t60, t60.on("elevation-change", (e60) => this.emit("elevation-change", e60))), this[e59].push(t60);
  }
  unregister(e59) {
    this.handles.has(e59) && (this.handles.get(e59).remove(), this.handles.delete(e59));
    for (const t60 of [this.im, this.ground, this.scene]) {
      const s63 = t60.indexOf(e59);
      s63 > -1 && t60.splice(s63, 1);
    }
  }
};
function p42(e59, t60, s63, r59, i66, n73, a58) {
  for (const l48 of t60) {
    const t61 = l48.getElevation(s63, r59, i66, n73, a58);
    r(t61) && (e59 = r(e59) ? Math.max(t61, e59) : t61);
  }
  return e59;
}
e([d({ constructOnly: true })], u38.prototype, "view", void 0), e([d({ readOnly: true, aliasOf: "view.basemapTerrain.spatialReference" })], u38.prototype, "spatialReference", void 0), u38 = e([n6("esri.views.3d.support.CombinedElevationProvider")], u38);

// node_modules/@arcgis/core/views/3d/support/DisplayQualityProfile.js
var a43 = class {
  static isValidProfile(e59) {
    return e59 in a43.profiles;
  }
  static getDefaultProfile() {
    return a("trident") || a("esri-iPhone") ? "low" : "medium";
  }
  static apply(e59, i66) {
    const o61 = a43.profiles[e59];
    i66.graphics3D.maxTotalNumberOfFeatures = o61.graphics3D.maxTotalNumberOfFeatures, i66.graphics3D.maxTotalNumberOfPrimitives = o61.graphics3D.maxTotalNumberOfPrimitives, i66.graphics3D.polygonLodFactor = o61.graphics3D.polygonLodFactor, i66.graphics3D.polylineLodFactor = o61.graphics3D.polylineLodFactor, i66.graphics3D.snapshotAvailable = o61.graphics3D.snapshotAvailable;
    {
      const e60 = i66.sceneService["3dObject"], a58 = o61.sceneService["3dObject"];
      e60.lodFactor = a58.lodFactor, e60.lodCrossfadeinDuration = a58.lodCrossfadeinDuration, e60.lodCrossfadeoutDuration = a58.lodCrossfadeoutDuration, e60.lodCrossfadeUncoveredDuration = a58.lodCrossfadeUncoveredDuration;
    }
    i66.sceneService.point.lodFactor = o61.sceneService.point.lodFactor, i66.sceneService.integratedMesh.lodFactor = o61.sceneService.integratedMesh.lodFactor, i66.sceneService.pointCloud.lodFactor = o61.sceneService.pointCloud.lodFactor, i66.sceneService.uncompressedTextureDownsamplingEnabled = o61.sceneService.uncompressedTextureDownsamplingEnabled, i66.tiledSurface.lodBias = o61.tiledSurface.lodBias, i66.tiledSurface.angledSplitBias = o61.tiledSurface.angledSplitBias, i66.tiledSurface.reduceTileLevelDifferences = o61.tiledSurface.reduceTileLevelDifferences, i66.tiledSurface.textureFadeDuration = o61.tiledSurface.textureFadeDuration, i66.heatmap.pixelRatio = o61.heatmap.pixelRatio, i66.heatmap.maxTotalNumberOfFeatures = o61.heatmap.maxTotalNumberOfFeatures, i66.antialiasingEnabled = o61.antialiasingEnabled, i66.physicallyBasedRenderingEnabled = o61.physicalBasedRenderingEnabled, i66.highQualityTransparency = o61.highQualityTransparency, i66.memoryLimit = o61.memoryLimit, i66.additionalCacheMemory = o61.additionalCacheMemory, i66.frameRate = o61.frameRate, i66.maximumRenderResolution = o61.maximumRenderResolution, i66.maximumPixelRatio = o61.maximumPixelRatio;
  }
};
function i55() {
  const a58 = !!a("esri-mobile"), i66 = !!a("ios");
  return { low: { graphics3D: { maxTotalNumberOfFeatures: 25e3, maxTotalNumberOfPrimitives: 85e4, polygonLodFactor: 0.5, polylineLodFactor: 1, snapshotAvailable: false }, heatmap: { pixelRatio: 0.125, maxTotalNumberOfFeatures: 25e3 }, sceneService: { "3dObject": { lodFactor: 0.2, lodCrossfadeinDuration: 0, lodCrossfadeoutDuration: 0, lodCrossfadeUncoveredDuration: 0 }, point: { lodFactor: 1 }, integratedMesh: { lodFactor: 0.6 }, pointCloud: { lodFactor: 0.5 }, uncompressedTextureDownsamplingEnabled: true }, tiledSurface: { lodBias: -1, angledSplitBias: 0.5, reduceTileLevelDifferences: false, textureFadeDuration: 0 }, antialiasingEnabled: false, physicalBasedRenderingEnabled: false, highQualityTransparency: false, memoryLimit: 200, additionalCacheMemory: 0, frameRate: 0, maximumRenderResolution: null, maximumPixelRatio: 1 }, medium: { graphics3D: { maxTotalNumberOfFeatures: 5e4, maxTotalNumberOfPrimitives: 17e5, polygonLodFactor: a58 ? 0.8 : 1, polylineLodFactor: a58 ? 1.2 : 1.5, snapshotAvailable: !i66 }, heatmap: { pixelRatio: 0.25, maxTotalNumberOfFeatures: 5e4 }, sceneService: { "3dObject": { lodFactor: 1, lodCrossfadeinDuration: 0, lodCrossfadeoutDuration: 0, lodCrossfadeUncoveredDuration: 400 }, point: { lodFactor: 1 }, integratedMesh: { lodFactor: 1 }, pointCloud: { lodFactor: 1 }, uncompressedTextureDownsamplingEnabled: a58 }, tiledSurface: { lodBias: 0, angledSplitBias: 1, reduceTileLevelDifferences: !a("disable-feature:reduce-map-tile-levels"), textureFadeDuration: 400 }, antialiasingEnabled: true, physicalBasedRenderingEnabled: true, highQualityTransparency: true, memoryLimit: a58 ? 600 : 750, additionalCacheMemory: a58 ? 0 : 150, frameRate: 0, maximumRenderResolution: null, maximumPixelRatio: 1 }, high: { graphics3D: { maxTotalNumberOfFeatures: 5e4, maxTotalNumberOfPrimitives: 17e5, polygonLodFactor: a58 ? 1.2 : 2, polylineLodFactor: a58 ? 1.2 : 2, snapshotAvailable: !i66 }, heatmap: { pixelRatio: 0.5, maxTotalNumberOfFeatures: 5e4 }, sceneService: { "3dObject": { lodFactor: 1, lodCrossfadeinDuration: 0, lodCrossfadeoutDuration: 0, lodCrossfadeUncoveredDuration: 400 }, point: { lodFactor: 1 }, integratedMesh: { lodFactor: 1 }, pointCloud: { lodFactor: 1 }, uncompressedTextureDownsamplingEnabled: false }, tiledSurface: { lodBias: 0, angledSplitBias: 1, reduceTileLevelDifferences: !a("disable-feature:reduce-map-tile-levels"), textureFadeDuration: 400 }, antialiasingEnabled: true, physicalBasedRenderingEnabled: true, highQualityTransparency: true, memoryLimit: a58 ? 900 : 1500, additionalCacheMemory: 0, frameRate: 0, maximumRenderResolution: a58 ? null : 4096, maximumPixelRatio: a58 ? 1 : null } };
}
a43.debug = { reset() {
  const e59 = i55();
  for (const i66 in e59)
    a43.profiles[i66] = e59[i66];
} }, function(e59) {
  e59.profiles = i55();
}(a43 || (a43 = {}));
var o50 = a43;

// node_modules/@arcgis/core/views/3d/support/HighlightOptions.js
var e42 = class extends y {
  constructor() {
    super(...arguments), this.color = new l5([0, 255, 255]), this.haloColor = null, this.haloOpacity = 1, this.fillOpacity = 0.25, this.shadowOpacity = 0.4, this.shadowColor = new l5([0, 0, 0]), this.shadowDifference = 0.2;
  }
  static toEngineOptions(o61) {
    const r59 = l5.toUnitRGBA(o61.color), i66 = r(o61.haloColor) ? l5.toUnitRGBA(o61.haloColor) : r59, p52 = l5.toUnitRGBA(o61.shadowColor);
    return { color: r28(r59[0], r59[1], r59[2], r59[3]), haloColor: r28(i66[0], i66[1], i66[2], i66[3]), haloOpacity: o61.haloOpacity, haloOpacityOccluded: 0.25 * o61.haloOpacity, fillOpacity: o61.fillOpacity, fillOpacityOccluded: 0.25 * o61.fillOpacity, shadowOpacity: o61.shadowOpacity, shadowColor: r10(p52[0], p52[1], p52[2], p52[3]), occludedShadowOpacity: o61.shadowOpacity * (1 - o61.shadowDifference) };
  }
};
e([d({ type: l5 })], e42.prototype, "color", void 0), e([d({ type: l5 })], e42.prototype, "haloColor", void 0), e([d()], e42.prototype, "haloOpacity", void 0), e([d()], e42.prototype, "fillOpacity", void 0), e([d()], e42.prototype, "shadowOpacity", void 0), e([d({ type: l5 })], e42.prototype, "shadowColor", void 0), e([d()], e42.prototype, "shadowDifference", void 0), e42 = e([n6("esri.views.3d.support.HighlightOptions")], e42);
var l35 = e42;

// node_modules/@arcgis/core/views/3d/support/MapCoordsHelper.js
var a44 = class {
  constructor(i66, s63) {
    this.spatialReference = s63, this.unitInMeters = z(this.spatialReference, p3(this.spatialReference).metersPerDegree), this._geometryServiceURLPromise = n28(i66 && i66.get("portalItem")).catch(() => {
      throw new s4("mapcoordshelper:missing-geometry-service", "Must specify geometryService in esri/config");
    });
  }
  async toGeographic(e59) {
    const r59 = await this._geometryServiceURLPromise;
    let t60, o61 = true;
    Array.isArray(e59[0]) && "number" != typeof e59[0] ? t60 = e59 : (t60 = [e59], o61 = false);
    const a58 = t60.map((e60) => e60 instanceof j ? e60 : new j(e60, this.spatialReference)), c67 = new a20({ geometries: a58, outSpatialReference: k2.WGS84 }), n73 = (await n27(r59, c67)).map((e60) => "point" === e60.type ? [e60.x, e60.y] : void 0);
    return o61 ? n73 : n73[0];
  }
};

// node_modules/@arcgis/core/views/3d/support/QualitySettings.js
var s51 = class extends y {
  constructor() {
    super(...arguments), this.minTotalNumberOfFeatures = 2e3, this.maxTotalNumberOfFeatures = 5e4, this.maxTotalNumberOfPrimitives = 17e5, this.snapshotAvailable = true, this.polygonLodFactor = 1, this.polylineLodFactor = 1;
  }
};
e([d()], s51.prototype, "minTotalNumberOfFeatures", void 0), e([d()], s51.prototype, "maxTotalNumberOfFeatures", void 0), e([d()], s51.prototype, "maxTotalNumberOfPrimitives", void 0), e([d()], s51.prototype, "snapshotAvailable", void 0), e([d()], s51.prototype, "polygonLodFactor", void 0), e([d()], s51.prototype, "polylineLodFactor", void 0), s51 = e([n6("esri.views.3d.support.QualitySettings.Graphics3DSettings")], s51);
var r46 = class extends y {
  constructor() {
    super(...arguments), this.lodFactor = 1;
  }
};
e([d()], r46.prototype, "lodFactor", void 0), r46 = e([n6("esri.views.3d.support.QualitySettings.LoDFactorSettings")], r46);
var p43 = class extends r46 {
  constructor() {
    super(...arguments), this.lodCrossfadeinDuration = 0, this.lodCrossfadeoutDuration = 0, this.lodCrossfadeUncoveredDuration = 0;
  }
};
p43 = e([n6("esri.views.3d.support.QualitySettings.LoDFactor3DObjectSettings")], p43);
var a45 = class extends y {
  constructor() {
    super(...arguments), this["3dObject"] = new p43(), this.point = new r46(), this.integratedMesh = new r46(), this.pointCloud = new r46(), this.uncompressedTextureDownsamplingEnabled = false;
  }
};
e([d({ type: p43 })], a45.prototype, "3dObject", void 0), e([d({ type: r46 })], a45.prototype, "point", void 0), e([d({ type: r46 })], a45.prototype, "integratedMesh", void 0), e([d({ type: r46 })], a45.prototype, "pointCloud", void 0), e([d()], a45.prototype, "uncompressedTextureDownsamplingEnabled", void 0), a45 = e([n6("esri.views.3d.support.QualitySettings.SceneServiceSettings")], a45);
var n54 = class extends y {
  constructor() {
    super(...arguments), this.lodBias = 0, this.angledSplitBias = 1, this.reduceTileLevelDifferences = true, this.textureFadeDuration = 500;
  }
};
e([d()], n54.prototype, "lodBias", void 0), e([d()], n54.prototype, "angledSplitBias", void 0), e([d()], n54.prototype, "reduceTileLevelDifferences", void 0), e([d()], n54.prototype, "textureFadeDuration", void 0), n54 = e([n6("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")], n54);
var d25 = class extends y {
  constructor() {
    super(...arguments), this.pixelRatio = 1, this.maxTotalNumberOfFeatures = 5e4;
  }
};
e([d()], d25.prototype, "pixelRatio", void 0), e([d()], d25.prototype, "maxTotalNumberOfFeatures", void 0), d25 = e([n6("esri.views.3d.support.QualitySettings.HeatmapSettings")], d25);
var l36 = class extends y {
  constructor() {
    super(...arguments), this.graphics3D = new s51(), this.sceneService = new a45(), this.tiledSurface = new n54(), this.heatmap = new d25(), this.antialiasingEnabled = true, this.physicallyBasedRenderingEnabled = false, this.highQualityTransparency = true;
  }
};
e([d({ type: s51 })], l36.prototype, "graphics3D", void 0), e([d({ type: a45 })], l36.prototype, "sceneService", void 0), e([d({ type: n54 })], l36.prototype, "tiledSurface", void 0), e([d({ type: d25 })], l36.prototype, "heatmap", void 0), e([d()], l36.prototype, "antialiasingEnabled", void 0), e([d()], l36.prototype, "physicallyBasedRenderingEnabled", void 0), e([d()], l36.prototype, "highQualityTransparency", void 0), e([d()], l36.prototype, "memoryLimit", void 0), e([d()], l36.prototype, "additionalCacheMemory", void 0), e([d()], l36.prototype, "frameRate", void 0), e([d()], l36.prototype, "maximumRenderResolution", void 0), e([d()], l36.prototype, "maximumPixelRatio", void 0), l36 = e([n6("esri.views.3d.support.QualitySettings.QualitySettings")], l36);
var c56 = l36;

// node_modules/@arcgis/core/views/3d/layers/support/MemoryManagedLayerView.js
function e43(e59) {
  return "function" == typeof e59.getUsedMemory;
}

// node_modules/@arcgis/core/views/3d/support/MemoryController.js
var y24 = s3.getLogger("esri.views.3d.support.MemoryController");
function l37(t60) {
  return new p44({ view: t60 });
}
var n55 = 1;
var d26 = 1;
var u39 = 0.75;
var c57 = 0.6;
var _21 = 1.3;
var p44 = class extends y {
  constructor(t60) {
    super(t60), this._quality = 1, this._memoryUsed = 0, this._updating = false, this.minQuality = 0.1, this._stableQuality = 0, this._downscaleMemoryUsed = 0, this._canFastRecover = false, this._memoryPredicted = 0, this._cacheStorage = new h7(), this._numQualityChanges = 0, this._maxMemory = 500, this._additionalCacheMemory = 100;
  }
  destroy() {
    this._cacheStorage.destroy();
  }
  set maxMemory(t60) {
    null == t60 || t60 <= 0 || (this._stableQuality = 0, this._canFastRecover = false, this._maxMemory < t60 && this._updateQuality(n55), this._maxMemory = t60);
  }
  get maxMemory() {
    return this._maxMemory;
  }
  set additionalCacheMemory(t60) {
    null != t60 && t60 >= 0 && (this._additionalCacheMemory = t60);
  }
  get additionalCacheMemory() {
    return this._additionalCacheMemory;
  }
  get memoryFactor() {
    return this._quality;
  }
  get updating() {
    return this._updating;
  }
  get usedMemory() {
    return this._memoryUsed;
  }
  newCache(t60, e59) {
    return new r12(t60, this._cacheStorage, e59);
  }
  resetStableQuality() {
    this._stableQuality = 0;
  }
  disableMemCache() {
    this.additionalCacheMemory = -4096;
  }
  update() {
    if (this._updateMemory(), this._memoryPredicted <= 0 && !this._updating)
      return;
    let t60 = this._layersUpdating();
    if (this._memoryPredicted < c57 && this._canFastRecover)
      this._downscaleMemoryUsed = 0, this._stableQuality = 0, this._canFastRecover = false, this._updateQuality(n55);
    else if (t60)
      (this._memoryPredicted > 1.1 * d26 || this._memoryUsed > d26) && (this._stableQuality > 0 ? (this._downscaleMemoryUsed = 0, this._updateQuality(this._stableQuality)) : this._quality > this.minQuality && this._downscaleMemoryUsed < this._memoryUsed && (this._updateQuality(this._quality / _21), this._downscaleMemoryUsed = this._memoryUsed, this._canFastRecover = false));
    else if (this._downscaleMemoryUsed = 0, this._memoryUsed > d26)
      this._stableQuality = 0, this._canFastRecover = false, t60 = this._updateQuality(this._quality / _21), this._downscaleMemoryUsed = this._memoryPredicted;
    else if (this._stableQuality !== this._quality)
      if (this._memoryUsed < u39 && this._quality < n55) {
        this._stableQuality = this._quality;
        const e59 = 0.05;
        t60 = this._updateQuality(this._quality + e59);
      } else
        this._quality < 1 && (this._canFastRecover = true);
    this._updating = t60;
  }
  _updateQuality(t60) {
    return (t60 = Math.min(Math.max(t60, this.minQuality), n55)) !== this._quality && (this._quality = t60, ++this._numQualityChanges, true);
  }
  _layersUpdating() {
    return this.view.allLayerViews.some((t60) => !!t60.updating);
  }
  _updateMemory() {
    let t60 = 0, e59 = 0;
    this.view.basemapTerrain && this.view.basemapTerrain.getUsedMemory && (t60 += this.view.basemapTerrain.getUsedMemory());
    const i66 = this.view._stage && this.view._stage.renderView && this.view._stage.renderView.edgeView;
    r(i66) && (t60 += i66.usedMemory), this.view.allLayerViews && this.view.allLayerViews.forEach((i67) => {
      if (e43(i67)) {
        const s63 = i67.ignoresMemoryFactor() ? this._quality : 1;
        t60 += i67.getUsedMemory() * s63, e59 += i67.getUnloadedMemory() * s63;
      }
    });
    const r59 = null == this._warnMemoryUsage || Math.round(10 * t60) !== Math.round(10 * this._warnMemoryUsage), a58 = 1048576 * this.maxMemory;
    if (t60 > a58 && r59) {
      this._warnMemoryUsage = t60;
      const i67 = (t61) => (t61 / 1048576).toLocaleString(void 0, { maximumFractionDigits: 1 }) + " MB", s63 = Math.round(100 * this._quality);
      y24.warn(`Memory Limit exceeded! Limit: ${i67(a58)} Current: ${i67(t60)} Projected: ${i67(t60 + e59)} Quality: ${s63}%`);
    }
    this._memoryUsed = t60 / a58, this._memoryPredicted = (t60 + e59) / a58;
    const o61 = a58 - t60;
    this._cacheStorage.maxSize = Math.max(0, o61 + 1048576 * this.additionalCacheMemory);
  }
  get test() {
    const t60 = this;
    return { cacheStorage: this._cacheStorage, resetQualityChanges: () => {
      const e59 = t60._numQualityChanges;
      return t60._numQualityChanges = 0, e59;
    } };
  }
};
e([d({ constructOnly: true })], p44.prototype, "view", void 0), e([d()], p44.prototype, "maxMemory", null), e([d()], p44.prototype, "additionalCacheMemory", null), e([d()], p44.prototype, "memoryFactor", null), e([d()], p44.prototype, "updating", null), e([d()], p44.prototype, "usedMemory", null), e([d()], p44.prototype, "_quality", void 0), e([d()], p44.prototype, "_memoryUsed", void 0), e([d()], p44.prototype, "_updating", void 0), e([d()], p44.prototype, "_stableQuality", void 0), e([d()], p44.prototype, "_maxMemory", void 0), e([d()], p44.prototype, "_additionalCacheMemory", void 0), p44 = e([n6("esri.views.3d.support.MemoryController")], p44);

// node_modules/@arcgis/core/views/3d/support/ResourceController.js
var T22 = class extends y {
  constructor() {
    super(...arguments), this.updating = false;
  }
};
function f26(e59) {
  return new v30.ResourceController({ view: e59 });
}
var v30;
e([d({ readOnly: true })], T22.prototype, "updating", void 0), T22 = e([n6("esri.views.3d.support.ResourceController")], T22), function(t60) {
  let f37 = class extends T22 {
    constructor() {
      super(...arguments), this._scheduler = null, this._memoryController = null, this._streamDataLoader = null, this._scheduleTask = Q2, this._cameraChangeTime = 0, this._handles = new u4(), this._frameTask = null, this._state = N3.IDLE;
    }
    initialize() {
      this._cameraChangeTime = performance.now(), this._scheduler = A6(), this._memoryController = l37(this.view), this._streamDataLoader = new y6(), this._streamDataLoader.setup(I7, E15, this._scheduler), this._handles.add([l6(() => {
        var _a;
        return (_a = this.view.state) == null ? void 0 : _a.camera;
      }, (e59, t61) => this._cameraChangedHandler(e59, t61), U3), l6(() => this.view.stationary, () => this._stationaryChangedHandler())]), this._frameTask = A2({ update: (e59) => this._frame(e59) }), this._scheduleTask = this._scheduler.registerTask(L3.RESOURCE_CONTROLLER);
    }
    destroy() {
      this._handles = l(this._handles), this._scheduleTask.remove(), this._frameTask = a2(this._frameTask), this._streamDataLoader = l(this._streamDataLoader), this._memoryController = l(this._memoryController), this._scheduler = l(this._scheduler);
    }
    get updating() {
      var _a, _b, _c;
      return !!(((_a = this._memoryController) == null ? void 0 : _a.updating) || ((_b = this._streamDataLoader) == null ? void 0 : _b.updating) || ((_c = this._scheduleTask) == null ? void 0 : _c.updating));
    }
    get scheduler() {
      return this._scheduler;
    }
    get memoryController() {
      return this._memoryController;
    }
    schedule(e59, t61, r59) {
      return this._scheduleTask.schedule(e59, t61, r59);
    }
    createStreamDataRequester(e59) {
      const t61 = this._streamDataLoader;
      return { request: (r59, s63, a58) => t61.request(r59, s63, e59, a58), get busy() {
        return !t61.hasDownloadSlots(e59);
      } };
    }
    _frame(e59) {
      this.view.suspended || this.view.stateManager && (this.view.stateManager.step(u2(e59.deltaTime)), !this._scheduler) || (this._updateState(), this._scheduler.state = this._state, this._scheduler.updateBudget(e59) ? (this._memoryController.update(), this._scheduler.frame()) : this._memoryController.updating && this._memoryController.update());
    }
    _cameraChangedHandler(e59, t61) {
      e59 && t61 && e59.almostEquals(t61) || (this._cameraChangeTime = performance.now(), this._updateState(), this._scheduler.state = this._state);
    }
    _stationaryChangedHandler() {
      this.memoryController.resetStableQuality();
    }
    _updateState() {
      this.view.animation ? this._state = N3.ANIMATING : this.view.interacting ? this._state = N3.INTERACTING : (this._state === N3.ANIMATING && (this._cameraChangeTime = 0), performance.now() - this._cameraChangeTime <= v36 ? this._state = N3.INTERACTING : this._state = N3.IDLE);
    }
    get test() {
      return { getQueueStats: (e59) => this._streamDataLoader.test.loadQueue.getStatsForType(e59), state: this._state };
    }
  };
  e([d({ constructOnly: true })], f37.prototype, "view", void 0), e([d()], f37.prototype, "_scheduler", void 0), e([d()], f37.prototype, "_memoryController", void 0), e([d()], f37.prototype, "_streamDataLoader", void 0), e([d()], f37.prototype, "_scheduleTask", void 0), e([d({ readOnly: true })], f37.prototype, "updating", null), f37 = e([n6("esri.views.3d.support.ResourceController")], f37), t60.ResourceController = f37;
  const v36 = 300;
}(v30 || (v30 = {}));

// node_modules/@arcgis/core/views/3d/layers/support/PerformanceInfoLayerView.js
function n56(n73) {
  return "performanceInfo" in n73;
}

// node_modules/@arcgis/core/views/3d/support/LayerPerformanceInfo.js
var t49 = class {
  constructor(t60, s63) {
    if (this.layer = null, this.memory = 0, this.displayedNumberOfFeatures = 0, this.maximumNumberOfFeatures = null, this.totalNumberOfFeatures = null, this.layer = t60.layer, this.memory = x5(t60) ? s63.basemapTerrain.getUsedMemoryForLayerView(t60) : t60.getUsedMemory(), n56(t60)) {
      const e59 = t60.performanceInfo;
      this.displayedNumberOfFeatures = e59.displayedNumberOfFeatures, this.maximumNumberOfFeatures = e59.maximumNumberOfFeatures, this.totalNumberOfFeatures = e59.totalNumberOfFeatures;
    }
  }
};

// node_modules/@arcgis/core/views/3d/support/SceneViewPerformanceInfo.js
var a46 = class {
  constructor(a58) {
    this.totalMemory = 0, this.usedMemory = 0, this.quality = 1, this.load = 0, this.terrainMemory = 0, this.edgesMemory = 0, this.layerPerformanceInfos = new Array();
    const m40 = a58.resourceController.memoryController;
    this.totalMemory = m40.maxMemory * o11.MEGABYTES, this.usedMemory = Math.round(m40.usedMemory * this.totalMemory), this.quality = m40.memoryFactor, this.load = a58.resourceController.scheduler.load, this.terrainMemory = a58.basemapTerrain ? a58.basemapTerrain.getUsedMemory() : 0;
    const i66 = a58._stage && a58._stage.renderView && a58._stage.renderView.edgeView;
    this.edgesMemory = r(i66) ? i66.usedMemory : 0, a58.allLayerViews.items.forEach((e59) => {
      (e43(e59) || x5(e59)) && this.layerPerformanceInfos.push(new t49(e59, a58));
    }), this.layerPerformanceInfos.sort((e59, r59) => r59.memory - e59.memory);
  }
};

// node_modules/@arcgis/core/views/3d/support/StreamTextureCollection.js
var h33 = class extends i18 {
  constructor(e59, t60, r59, s63) {
    super(t60, s63), this._streamDataRequester = e59, this._parameters = r59;
  }
  async fromUrl(i66, o61, n73) {
    f(n73);
    const a58 = r(n73) && n73.signal, h44 = this.makeUid(i66, o61);
    let l48 = this._textureRequests.get(h44);
    if (!l48) {
      const e59 = new AbortController(), t60 = this._streamDataRequester.request(i66, "image", { uid: h44, signal: e59.signal });
      l48 = { referenceCount: 0, texture: null, textureAsync: null, abortController: e59 }, this._textureRequests.set(h44, l48), l48.textureAsync = t60.then(async (e60) => {
        const t61 = this._createTexture(i66, e60, o61);
        return l48.texture = t61, l48.abortController = null, this._stage.add(t61), await this._stage.load(t61), { uid: h44, texture: t61, release: () => this._release(h44) };
      }, (e60) => {
        throw l48.abortController = null, e60;
      });
    }
    return l48.referenceCount++, new Promise((e59, t60) => {
      v(a58, () => {
        t60(m3());
      }), l48.textureAsync.then(e59, t60);
    }).catch((e59) => {
      throw this._release(h44), e59;
    });
  }
  _createTexture(e59, t60, r59) {
    const s63 = { ...this._parameters, powerOfTwoResizeMode: l12.PAD };
    if (It(e59)) {
      if (r59 || 0 === t60.width && 0 === t60.height) {
        const e60 = t60.width ? t60.height / t60.width : 1;
        r59 = r59 || 64, e60 > 1 ? (t60.width = Math.round(r59 / e60), t60.height = r59) : (t60.width = r59, t60.height = Math.round(r59 * e60));
      }
      this._stage.renderView && this._stage.renderView.renderingContext.driverTest.svgAlwaysPremultipliesAlpha && (s63.preMultiplyAlpha = false);
    }
    return s63.width = t60.width, s63.height = t60.height, new L5(t60, s63);
  }
};

// node_modules/@arcgis/core/views/3d/support/SharedSymbolResources.js
var h34 = class {
  constructor(e59) {
    this.textures = null, this.streamDataRequester = null, this.graphicsOwners = [], this.screenSizePerspectiveHandles = null, this.cimSymbolRasterizer = null, this.viewState = e59.viewState, this.view = e59.view, this.pointsOfInterest = e59.pointsOfInterest, this.objectResourceCache = e59.objectResourceCache, this.streamDataRequester = e59.resourceController.createStreamDataRequester(A16.SYMBOLOGY), this.textures = new h33(this.streamDataRequester, e59.view._stage, { preMultiplyAlpha: true, wrap: { s: D4.CLAMP_TO_EDGE, t: D4.CLAMP_TO_EDGE } }, e59.resourceController.scheduler);
    const t60 = p3(this.view.spatialReference).radius;
    this.screenSizePerspectiveSettings = r21(e59.viewingMode, t60), this.screenSizePerspectiveSettingsLabels = n23(e59.viewingMode, t60);
  }
  destroy() {
    this.textures.destroy(), this.textures = null, this.streamDataRequester = null;
  }
  addGraphicsOwner(t60) {
    if (!t60)
      return n();
    this.graphicsOwners.push(t60);
    const r59 = l6(() => {
      var _a;
      return (_a = t60.layer) == null ? void 0 : _a.screenSizePerspectiveEnabled;
    }, () => this._updateScreenSizePerspectiveEnabled());
    return this._updateScreenSizePerspectiveEnabled(), n(() => {
      r59.remove(), A(this.graphicsOwners, t60), this._updateScreenSizePerspectiveEnabled();
    });
  }
  _updateScreenSizePerspectiveEnabled() {
    const e59 = this.graphicsOwners.some((e60) => {
      var _a;
      return true === ((_a = e60.layer) == null ? void 0 : _a.screenSizePerspectiveEnabled);
    });
    if (e59 && !this.screenSizePerspectiveHandles) {
      this.screenSizePerspectiveHandles = new u4();
      const e60 = () => this._updateScreenSizePerspectiveSettings();
      this.screenSizePerspectiveHandles.add([l6(() => this.pointsOfInterest.centerOnSurfaceInfrequent.distance, e60, U3), this.viewState.events.on("camera-projection-changed", e60)]), this._updateScreenSizePerspectiveSettings();
    } else
      !e59 && this.screenSizePerspectiveHandles && (this.screenSizePerspectiveHandles.destroy(), this.screenSizePerspectiveHandles = null);
  }
  _updateScreenSizePerspectiveSettings() {
    const e59 = this.pointsOfInterest;
    S18.distance = e59.centerOnSurfaceInfrequent.distance, S18.fovY = this.viewState.camera.fovY, this.screenSizePerspectiveSettings.update(S18), this.screenSizePerspectiveSettingsLabels.update(S18), this.view._stage.renderView.requestRender();
  }
  get test() {
    return { screenSizePerspectiveHandles: this.screenSizePerspectiveHandles };
  }
};
var S18 = { distance: 0, fovY: 0 };

// node_modules/@arcgis/core/views/3d/support/debugUtils.js
var c58 = class {
  constructor(s63, o61, i66 = "") {
    this.graphics = s63, this._symbol = new h8({ symbolLayers: [new S4({ material: { color: o61 }, outline: { color: [255, 255, 255], size: 1 }, resource: { primitive: "circle" } }), new j6({ text: i66, halo: { color: "white", size: 1 / 0.75 }, material: { color: o61 }, size: 12 })] });
  }
  show(i66, e59) {
    if (t(e59))
      return;
    this.hide();
    const r59 = new j({ x: i66[0], y: i66[1], z: i66[2], spatialReference: e59 });
    this._graphic = new g7({ geometry: r59, symbol: this._symbol }), this.graphics.add(this._graphic);
  }
  hide() {
    r(this._graphic) && (this.graphics.remove(this._graphic), this._graphic = null);
  }
};

// node_modules/@arcgis/core/views/3d/support/pointsOfInterest/PointOfInterest.js
var c59 = class extends y {
  constructor(r59) {
    super(r59), this.handles = new u4();
  }
  destroy() {
    this.handles.destroy();
  }
};
e([d({ constructOnly: true })], c59.prototype, "renderCoordsHelper", void 0), e([d({ constructOnly: true })], c59.prototype, "surface", void 0), e([d({ constructOnly: true })], c59.prototype, "state", void 0), c59 = e([n6("esri.views.3d.support.PointOfInterest")], c59);

// node_modules/@arcgis/core/views/3d/support/pointsOfInterest/CameraOnSurface.js
var u40 = Array;
var m30 = class extends c59 {
  constructor(t60) {
    super(t60), this._dirty = false, this._propertiesPool = new o23({ location: j, renderLocation: u40 }, this), this._estimatedSurfaceAltitude = 0, this._pendingElevationQueryController = null, this.cameraName = "camera", this.renderLocation = n7(), this.tmpPoint = new j();
  }
  initialize() {
    if (this.scheduler && this.handles.add(this.scheduler.registerTask(this.task, this)), this.runTask(), this.map) {
      const t60 = () => this._setDirty();
      this.handles.add(a5(() => {
        var _a, _b;
        return (_b = (_a = this.map) == null ? void 0 : _a.ground) == null ? void 0 : _b.layers;
      }, "change", t60, { onListenerAdd: t60, onListenerRemove: t60 }));
    }
    this._updateRenderLocation();
  }
  destroy() {
    this._cancelPendingRequest(), this._propertiesPool.destroy(), this._propertiesPool = null;
  }
  get _camera() {
    return this.state[this.cameraName];
  }
  get location() {
    const t60 = this._propertiesPool.get("location");
    return this.renderCoordsHelper.fromRenderCoords(this.renderLocation, t60, this.state.spatialReference), t60;
  }
  get scale() {
    const t60 = this._camera, e59 = x(t60.eye, this.renderLocation), r59 = { renderCoordsHelper: this.renderCoordsHelper, state: { camera: t60 } };
    return ee2(r59, e59, 0);
  }
  get updating() {
    return this._dirty || null != this._pendingElevationQueryController;
  }
  updateRenderLocation() {
    this._setDirty(), this._updateRenderLocation();
  }
  _setDirty() {
    this._dirty || (this._dirty = true, this.notifyChange("updating"));
  }
  _cancelPendingRequest() {
    const t60 = this._pendingElevationQueryController;
    t60 && (this._pendingElevationQueryController = null, t60.abort(), this.notifyChange("updating"));
  }
  get running() {
    return !this._pendingElevationQueryController && this._dirty;
  }
  runTask() {
    if (this._cancelPendingRequest(), this._dirty = false, this.notifyChange("updating"), !this.map || !this.map.ground)
      return void this._updateSurfaceAltitude(0);
    this.renderCoordsHelper.fromRenderCoords(this._camera.eye, this.tmpPoint, this.state.spatialReference);
    let t60 = new AbortController();
    this.map.ground.queryElevation(this.tmpPoint, { signal: t60.signal, cache: this.cache }).then((t61) => this._updateSurfaceAltitude(t61.geometry.z)).catch((t61) => {
      g(t61) || this._updateSurfaceAltitude(0);
    }).catch(() => {
    }).then(() => {
      this._pendingElevationQueryController === t60 && (this._pendingElevationQueryController = null, this.notifyChange("updating")), t60 = null;
    }), this._pendingElevationQueryController = t60;
  }
  _updateSurfaceAltitude(t60) {
    this._estimatedSurfaceAltitude !== t60 && (this._estimatedSurfaceAltitude = t60, this._updateRenderLocation());
  }
  _updateRenderLocation() {
    this.renderCoordsHelper.setAltitude(y25, this._estimatedSurfaceAltitude, this._camera.eye), F2(this._get("renderLocation"), y25) || this._set("renderLocation", r7(this._propertiesPool.get("renderLocation"), y25));
  }
};
e([d({ constructOnly: true })], m30.prototype, "scheduler", void 0), e([d({ constructOnly: true })], m30.prototype, "cache", void 0), e([d({ constructOnly: true })], m30.prototype, "task", void 0), e([d({ constructOnly: true })], m30.prototype, "cameraName", void 0), e([d({ readOnly: true })], m30.prototype, "location", null), e([d({ constructOnly: true })], m30.prototype, "map", void 0), e([d({ readOnly: true })], m30.prototype, "renderLocation", void 0), e([d({ readOnly: true })], m30.prototype, "scale", null), e([d({ readOnly: true })], m30.prototype, "updating", null), m30 = e([n6("esri.views.3d.support.CameraOnSurface")], m30);
var y25 = n7();

// node_modules/@arcgis/core/views/3d/support/pointsOfInterest/CenterOnSurface.js
var j30 = Array;
var k27 = class extends c59 {
  constructor(t60) {
    super(t60), this._propertiesPool = new o23({ location: j, renderLocation: j30 }, this), this._currentSurfaceAltitude = 0, this._latestSurfaceAltitude = 0, this.cameraName = "camera", this.distance = 0, this.renderLocation = n7(), this.updating = false;
  }
  initialize() {
    this._frameWorker = this.scheduler.registerTask(this.task, this), this.runTask();
  }
  destroy() {
    this._frameWorker = a2(this._frameWorker), this._propertiesPool = l(this._propertiesPool);
  }
  get _camera() {
    return this.state[this.cameraName];
  }
  get location() {
    const t60 = this._propertiesPool.get("location");
    return this.renderCoordsHelper.fromRenderCoords(this.renderLocation, t60, this.state.spatialReference), t60;
  }
  updateRenderLocation() {
    this.updating = true, this._updateRenderLocation();
  }
  get estimatedSurfaceAltitude() {
    return this._latestSurfaceAltitude;
  }
  get running() {
    return this.updating;
  }
  runTask() {
    this._latestSurfaceAltitude = this.estimateSurfaceAltitudeAtCenter(), this._updateRenderLocation(), this.updating = false;
  }
  _updateRenderLocation() {
    const t60 = L24;
    let e59 = this._calculateSurfaceIntersection(this._currentSurfaceAltitude, t60);
    const r59 = this._currentSurfaceAltitude !== this._latestSurfaceAltitude;
    !e59 && r59 && (e59 = this._calculateSurfaceIntersection(this._latestSurfaceAltitude, t60), e59 && (this._currentSurfaceAltitude = this._latestSurfaceAltitude));
    const s63 = C20;
    e59 && this._latestSurfaceAltitudeChangesDistanceSignificantly(t60, s63) && (r7(t60, s63), this._currentSurfaceAltitude = this._latestSurfaceAltitude), e59 ? this.distance = x(this._camera.eye, t60) : (q(t60, this._camera.viewForward, this._get("distance")), u3(t60, t60, this._camera.eye)), F2(this._get("renderLocation"), t60) || this._set("renderLocation", r7(this._propertiesPool.get("renderLocation"), t60));
  }
  _calculateSurfaceIntersection(t60, r59) {
    const s63 = this._camera;
    if (!this.renderCoordsHelper.intersectManifold(s63.ray, t60, r59))
      return false;
    if (this.state.isGlobal) {
      const e59 = p3(this.renderCoordsHelper.spatialReference).radius, i66 = e59 + t60, o61 = v3(s63.eye), a58 = o61 < i66 * i66, c67 = x(s63.eye, r59);
      if (a58 && c67 > e59 / 4) {
        const t61 = i66 - Math.sqrt(o61);
        return q(r59, s63.viewForward, t61), u3(r59, r59, s63.eye), true;
      }
    } else {
      const t61 = this.surface.ready ? this.surface.extent : null;
      r(t61) && zn(t61, this.surface.spatialReference, O25, this.renderCoordsHelper.spatialReference) && (r59[0] = o4(r59[0], O25[0], O25[2]), r59[1] = o4(r59[1], O25[1], O25[3]));
    }
    return true;
  }
  _latestSurfaceAltitudeChangesDistanceSignificantly(t60, e59) {
    if (this._latestSurfaceAltitude === this._currentSurfaceAltitude || null == t60)
      return false;
    if (this._calculateSurfaceIntersection(this._latestSurfaceAltitude, e59)) {
      if (t25.TESTS_DISABLE_OPTIMIZATIONS)
        return true;
      const r59 = this._camera.eye, s63 = x(r59, t60), i66 = x(r59, e59);
      if (Math.abs(i66 - s63) / s63 > v32)
        return true;
    }
    return false;
  }
};
e([d({ constructOnly: true })], k27.prototype, "scheduler", void 0), e([d({ constructOnly: true })], k27.prototype, "task", void 0), e([d({ constructOnly: true })], k27.prototype, "cameraName", void 0), e([d()], k27.prototype, "distance", void 0), e([d({ constructOnly: true })], k27.prototype, "estimateSurfaceAltitudeAtCenter", void 0), e([d({ readOnly: true })], k27.prototype, "location", null), e([d({ readOnly: true })], k27.prototype, "renderLocation", void 0), e([d()], k27.prototype, "updating", void 0), k27 = e([n6("esri.views.3d.support.CenterOnSurface")], k27);
var v32 = 0.05;
var L24 = n7();
var C20 = n7();
var O25 = u6();

// node_modules/@arcgis/core/views/3d/support/pointsOfInterest/ContentGeometryUpdates.js
var t50 = class {
  constructor(t60) {
    this.handles = new u4(), this.events = new n8(), this.contentLayerViews = t60.contentLayerViews, this.handles.add(this.contentLayerViews.on("change", (e59) => this._layerViewsChanged(e59))), this._layerViewsChanged({ added: this.contentLayerViews.toArray(), removed: [], moved: [], target: this.contentLayerViews });
  }
  destroy() {
    this.handles && (this.handles.destroy(), this.handles = null);
  }
  _layerViewsChanged(e59) {
    e59.added.forEach((e60) => {
      "esri.views.3d.layers.SceneLayerView3D" === e60.declaredClass && this.handles.add(e60.on("visible-geometry-changed", () => this._contentChanged()), e60.uid);
    }), e59.removed.forEach((e60) => this.handles.remove(e60.uid));
  }
  _contentChanged() {
    this.events.emit("request-update", n57);
  }
};
var n57 = {};

// node_modules/@arcgis/core/views/3d/support/pointsOfInterest/Focus.js
var O26 = Array;
var j31 = class extends c59 {
  constructor(e59) {
    super(e59), this._propertiesPool = new o23({ location: j, renderLocation: O26 }, this), this._dirty = true, this.renderLocation = this._propertiesPool.get("renderLocation");
  }
  initialize() {
    this.handles.add([l6(() => this.centerOnSurface.renderLocation, () => this.updateRenderLocation()), l6(() => this.state.contentCamera, () => this.updateRenderLocation())]), this.scheduler && this.handles.add(this.scheduler.registerTask(L3.POINT_OF_INTEREST_FREQUENT, this));
  }
  destroy() {
    this._propertiesPool.destroy(), this._propertiesPool = null;
  }
  get updating() {
    return this._dirty || this.centerOnSurface.updating;
  }
  get location() {
    const e59 = this._propertiesPool.get("location");
    return this.renderCoordsHelper.fromRenderCoords(this.renderLocation, e59, this.state.spatialReference), e59;
  }
  get running() {
    return this._dirty;
  }
  runTask() {
    const e59 = this._get("renderLocation"), r59 = this.centerOnSurface.renderLocation, o61 = this.renderCoordsHelper, s63 = this.state.contentCamera;
    this._dirty = false, o61.worldUpAtPosition(r59, P17);
    const i66 = Math.max(0, (Math.acos(P2(P17, s63.viewForward)) - 0.5 * Math.PI) * (s63.aboveGround ? 1 : -1));
    if (Number.isNaN(i66)) {
      if (!e59 || !G(e59, r59)) {
        const e60 = this._propertiesPool.get("renderLocation");
        r7(e60, r59), this._set("renderLocation", e60);
      }
      return;
    }
    const p52 = 1 - o4(i66 / (0.5 * Math.PI), 0, 1), l48 = p52 * p52 * p52;
    this._calculateScreenHorizontalEdgeOnSurface(L25);
    const h44 = this._propertiesPool.get("renderLocation");
    A4(h44, r59, L25, l48), e59 && G(e59, h44) || this._set("renderLocation", h44);
  }
  _calculateScreenHorizontalEdgeOnSurface(e59) {
    const t60 = this.state.contentCamera, r59 = t60.getRenderCenter(x2());
    if (r59[1] = t60.aboveGround ? t60.padding[et.BOTTOM] : t60.fullHeight - t60.padding[et.TOP], this.estimateSurfaceIntersectionAtRenderPoint(r59, e59))
      return e59;
    const s63 = this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);
    if (t60.unprojectFromRenderScreen(r59, S20)) {
      e7(S20, S20, t60.eye);
      const r60 = z2(S20, S20);
      if (this.renderCoordsHelper.intersectManifold(j7(t60.eye, r60), s63, e59))
        return e59;
    }
    return this.renderCoordsHelper.setAltitude(e59, s63, t60.eye);
  }
  updateRenderLocation() {
    this._dirty = true;
  }
};
e([d()], j31.prototype, "_dirty", void 0), e([d({ constructOnly: true })], j31.prototype, "scheduler", void 0), e([d({ constructOnly: true })], j31.prototype, "centerOnSurface", void 0), e([d({ constructOnly: true })], j31.prototype, "estimateSurfaceIntersectionAtRenderPoint", void 0), e([d({ readOnly: true })], j31.prototype, "updating", null), e([d({ readOnly: true })], j31.prototype, "location", null), e([d({ readOnly: true })], j31.prototype, "renderLocation", void 0), j31 = e([n6("esri.views.3d.support.CenterOnSurface")], j31);
var P17 = n7();
var S20 = n7();
var L25 = n7();

// node_modules/@arcgis/core/views/3d/support/pointsOfInterest/StableSurfaceCenter.js
var h35 = class extends y {
  constructor(e59) {
    super(e59), this.location = null, this._updateController = null, this._handles = new u4();
  }
  get renderLocation() {
    if (!this.location)
      return null;
    const e59 = n7();
    return this.view.renderCoordsHelper.toRenderCoords(this.location, e59), e59;
  }
  initialize() {
    this.view.state.isLocal && (this._handles.add([l6(() => {
      var _a, _b;
      return [(_a = this.surfaceView) == null ? void 0 : _a.spatialReference, (_b = this.surfaceView) == null ? void 0 : _b.extent];
    }, () => this._update()), a5(() => {
      var _a;
      return (_a = this.surface) == null ? void 0 : _a.layers;
    }, "change", () => this._update())]), this._update());
  }
  destroy() {
    this._handles.destroy();
  }
  _update() {
    if (this._updateController && (this._updateController.abort(), this._updateController = null), !this.surfaceView || t(this.surfaceView.extent) || !this.surfaceView.spatialReference)
      return void this._set("location", null);
    const e59 = p8(this.surfaceView.extent), t60 = new j({ x: e59[0], y: e59[1], z: 0, spatialReference: this.surfaceView.spatialReference });
    this.surface && this.surface.layers.length > 0 ? (this._set("location", null), this._updateController = new AbortController(), this.surface.queryElevation(t60, { noDataValue: 0, signal: this._updateController.signal, cache: this.cache }).then((e60) => {
      this._updateController = null, this._set("location", e60.geometry);
    }).catch((e60) => {
      g(e60) || e60 && "elevation-query:invalid-layer" === e60.name || console.error("StableSurfaceCenter failed to update: ", e60);
    })) : this._set("location", t60);
  }
};
e([d({ constructOnly: true })], h35.prototype, "view", void 0), e([d({ constructOnly: true })], h35.prototype, "cache", void 0), e([d({ readOnly: true, aliasOf: "view.map.ground" })], h35.prototype, "surface", void 0), e([d({ readOnly: true, aliasOf: "view.basemapTerrain" })], h35.prototype, "surfaceView", void 0), e([d({ readOnly: true })], h35.prototype, "location", void 0), e([d({ readOnly: true })], h35.prototype, "renderLocation", null), h35 = e([n6("esri.views.3d.terrain.StableSurfaceCenter")], h35);

// node_modules/@arcgis/core/views/3d/support/pointsOfInterest/SurfaceGeometryUpdates.js
var u41 = class extends y {
  constructor() {
    super(...arguments), this.handles = new u4(), this._tileGeometryUpdateExtent = D3(), this._tileGeometryUpdateSpatialReference = null, this.events = new n8(), this.updating = false;
  }
  initialize() {
    this.handles.add([this.surface.on("elevation-change", (e59) => this._tileGeometryChanged(e59)), this.scheduler.registerTask(L3.SURFACE_GEOMETRY_UPDATES, this)]);
  }
  destroy() {
    this.handles = l(this.handles);
  }
  get running() {
    return this.updating;
  }
  runTask() {
    this.updating && (this._centerIntersectsExtent(this._tileGeometryUpdateExtent, this._tileGeometryUpdateSpatialReference) && this.events.emit("request-update", l38), D3(this._tileGeometryUpdateExtent), this._set("updating", false));
  }
  _tileGeometryChanged(e59) {
    this._tileGeometryUpdateSpatialReference = e59.spatialReference, h5(this._tileGeometryUpdateExtent, e59.tile.extent, this._tileGeometryUpdateExtent), this._set("updating", true);
  }
  _furthestCenterOnSurface() {
    let e59 = this.centerOnSurfaces[0];
    for (let t60 = 1; t60 < this.centerOnSurfaces.length; t60++) {
      const r59 = this.centerOnSurfaces[t60];
      r59.distance > e59.distance && (e59 = r59);
    }
    return e59;
  }
  _centerIntersectsExtent(e59, t60) {
    const r59 = this.state.camera.eye, s63 = f28, o61 = this._furthestCenterOnSurface();
    return this.renderCoordsHelper.fromRenderCoords(r59, m31, t60), this.renderCoordsHelper.fromRenderCoords(o61.renderLocation, y26, t60), m31[0] < y26[0] ? (s63[0] = m31[0], s63[2] = y26[0]) : (s63[0] = y26[0], s63[2] = m31[0]), m31[1] < y26[1] ? (s63[1] = m31[1], s63[3] = y26[1]) : (s63[1] = y26[1], s63[3] = m31[1]), E4(s63, e59);
  }
};
e([d({ constructOnly: true })], u41.prototype, "state", void 0), e([d({ constructOnly: true })], u41.prototype, "centerOnSurfaces", void 0), e([d({ constructOnly: true })], u41.prototype, "renderCoordsHelper", void 0), e([d({ constructOnly: true })], u41.prototype, "scheduler", void 0), e([d({ constructOnly: true })], u41.prototype, "surface", void 0), e([d({ readOnly: true })], u41.prototype, "updating", void 0), u41 = e([n6("esri.views.3d.support.SurfaceGeometryUpdates")], u41);
var l38 = {};
var m31 = n7();
var y26 = n7();
var f28 = D3();

// node_modules/@arcgis/core/views/3d/support/pointsOfInterest/PointsOfInterest.js
var E28 = class extends y {
  constructor(e59) {
    super(e59), this._handles = new u4(), this._tmpRay = d6(), this._centerRayDirty = true, this._surfaceAltitudeAtCenter = 0, this._surfaceAltitudeAtCenterDirty = true, this._contentAltitudeAtCenter = 0, this._contentAltitudeAtCenterDirty = true, this._propertiesPool = new o23({ renderPointOfView: N15 }, this), this.renderPointOfView = n7(), this._pois = new Array(), this._debugCenters = /* @__PURE__ */ new Map();
  }
  initialize() {
    var _a;
    const { state: e59, basemapTerrain: t60, renderCoordsHelper: r59, map: n73 } = this.view;
    this._surfaceIntersector = x6(e59.viewingMode), e59.isGlobal ? this._surfaceIntersector.options.backfacesTerrain = false : this._surfaceIntersector.options.backfacesTerrain = true, this._surfaceIntersector.options.invisibleTerrain = false, this._surfaceIntersector.options.store = t27.MIN, this._contentIntersector = x6(e59.viewingMode);
    const h44 = () => this._estimateSurfaceAltitudeAtCenter(), d32 = this.view.resourceController.scheduler, f37 = e2((_a = this.view.basemapTerrain) == null ? void 0 : _a.elevationQueryCache), p52 = { state: e59, scheduler: d32, surface: t60, renderCoordsHelper: r59 };
    this._set("centerOnSurfaceInfrequent", new k27({ ...p52, task: L3.POINT_OF_INTEREST_INFREQUENT, estimateSurfaceAltitudeAtCenter: h44 })), this._set("centerOnSurfaceFrequent", new k27({ ...p52, task: L3.POINT_OF_INTEREST_FREQUENT, estimateSurfaceAltitudeAtCenter: h44 })), this._set("contentCenterOnSurface", new k27({ ...p52, task: L3.POINT_OF_INTEREST_INFREQUENT, estimateSurfaceAltitudeAtCenter: h44, cameraName: "contentCamera" })), this._set("centerOnContent", new k27({ ...p52, task: L3.POINT_OF_INTEREST_FREQUENT, estimateSurfaceAltitudeAtCenter: () => this._estimateContentAltitudeAtCenter() })), this._set("cameraOnSurface", new m30({ ...p52, cache: f37, task: L3.POINT_OF_INTEREST_INFREQUENT, map: n73 })), this._set("contentCameraOnSurface", new m30({ ...p52, cache: f37, task: L3.POINT_OF_INTEREST_INFREQUENT, map: n73, cameraName: "contentCamera" })), this._set("surfaceGeometryUpdates", new u41({ ...p52, centerOnSurfaces: [this.centerOnSurfaceFrequent, this.centerOnContent, this.centerOnSurfaceInfrequent] })), this._set("contentGeometryUpdates", new t50({ contentLayerViews: this.view.allLayerViews, renderCoordsHelper: r59 })), this._set("surfaceOrigin", new h35({ cache: f37, view: this.view })), this._set("focus", new j31({ state: e59, scheduler: d32, surface: t60, renderCoordsHelper: r59, centerOnSurface: this.contentCenterOnSurface, estimateSurfaceIntersectionAtRenderPoint: (e60, t61) => this._estimateSurfaceIntersectionAtRenderPoint(e60, this.view.state.contentCamera, t61) })), this._pois.push(this.centerOnContent, this.centerOnSurfaceFrequent, this.centerOnSurfaceInfrequent, this.contentCenterOnSurface, this.cameraOnSurface, this.contentCameraOnSurface, this.focus);
    const m40 = this.view.graphics;
    this._debugCenters.set(this.centerOnContent, new c58(m40, "red", "CenterOnContent")), this._debugCenters.set(this.centerOnSurfaceFrequent, new c58(m40, "red", "CenterOnSurface")), this._debugCenters.set(this.centerOnSurfaceInfrequent, new c58(m40, "red", "CenterOnSurface")), this._debugCenters.set(this.contentCenterOnSurface, new c58(m40, "red", "ContentCenterOnSurface")), this._debugCenters.set(this.cameraOnSurface, new c58(m40, "blue", "CameraOnSurface")), this._debugCenters.set(this.contentCameraOnSurface, new c58(m40, "blue", "ContentCameraOnSurface")), this._debugCenters.set(this.focus, new c58(m40, "green", "Focus")), this._handles.add([l6(() => e59.camera, (e60) => this._cameraChanged(e60), U3), l6(() => t60.extent, () => this._updateCenterPointsOfInterest()), f4(() => !t60.updating, () => this._updateCenterPointsOfInterest(), U3), a5(() => this.surfaceGeometryUpdates.events, "request-update", () => this._updateCenterPointsOfInterest()), a5(() => this.contentGeometryUpdates.events, "request-update", () => this._updateCenterOnContent()), f4(() => t25.SHOW_POI, (e60) => this._setDebug(e60), h3)]), this._cameraChanged(this.view.state.camera);
    for (const s63 of this._pois)
      s63.runTask();
  }
  destroy() {
    this._setDebug(false), this._handles.destroy(), this._propertiesPool.destroy();
    for (const e59 of this._pois)
      e59.destroy();
    this.surfaceOrigin.destroy();
  }
  get updating() {
    var _a;
    return !(!((_a = this.surfaceGeometryUpdates) == null ? void 0 : _a.updating) && !this._pois.some((e59) => e59.updating));
  }
  get centerRay() {
    return this._centerRayDirty && (this._centerRay = this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.camera, this._tmpRay), this._centerRayDirty = false), this._centerRay;
  }
  _estimateContentAltitudeAtCenter() {
    if (!this._contentAltitudeAtCenterDirty)
      return this._contentAltitudeAtCenter;
    this._contentAltitudeAtCenterDirty = false;
    const e59 = this.centerRay;
    return t(e59) || (this.view.sceneIntersectionHelper.intersectRay(e59, this._contentIntersector, U22, D15) ? this._contentAltitudeAtCenter = this.view.renderCoordsHelper.getAltitude(U22) : this._contentAltitudeAtCenter = this._estimateSurfaceAltitudeAtCenter()), this._contentAltitudeAtCenter;
  }
  _estimateSurfaceAltitudeAtCenter() {
    if (!this.view.basemapTerrain)
      return 0;
    if (!this._surfaceAltitudeAtCenterDirty)
      return this._surfaceAltitudeAtCenter;
    this._surfaceAltitudeAtCenterDirty = false;
    const e59 = this.centerRay;
    if (t(e59))
      return this._surfaceAltitudeAtCenter;
    const t60 = e59.origin, r59 = u3(U22, e59.origin, e59.direction);
    return this._surfaceIntersector.resetWithRay(e59, this.view.state.camera), this.view.basemapTerrain.intersect(this._surfaceIntersector, null, t60, r59), this._surfaceIntersector.results.min.getIntersectionPoint(U22) && (this._surfaceAltitudeAtCenter = this.view.renderCoordsHelper.getAltitude(U22)), this._surfaceAltitudeAtCenter;
  }
  _estimateSurfaceIntersectionAtRenderPoint(e59, t60, r59) {
    const s63 = g12(t60, e59, F15);
    if (t(s63))
      return null;
    const i66 = s63.origin, o61 = u3(U22, s63.origin, s63.direction);
    return this._surfaceIntersector.resetWithRay(s63, t60), this.view.basemapTerrain.intersect(this._surfaceIntersector, null, i66, o61), this._surfaceIntersector.results.min.getIntersectionPoint(r59) ? r59 : null;
  }
  _cameraChanged(e59) {
    this._updateCenterPointsOfInterest();
    const t60 = e59.eye;
    F2(this.renderPointOfView, t60) || this._set("renderPointOfView", r7(this._propertiesPool.get("renderPointOfView"), t60));
  }
  _updateCenterPointsOfInterest() {
    this._centerRayDirty = true, this._surfaceAltitudeAtCenterDirty = true, this._contentAltitudeAtCenterDirty = true;
    for (const e59 of this._pois)
      e59.updateRenderLocation();
  }
  _updateCenterOnContent() {
    this._contentAltitudeAtCenterDirty = true, this.centerOnContent.updateRenderLocation();
  }
  _setDebug(e59) {
    if (!e59)
      return this._debugCenters.forEach((e60) => e60.hide()), void this._handles.remove("debug");
    for (const t60 of this._pois)
      this._handles.add(l6(() => t60.renderLocation, (e60) => this._debugCenters.get(t60).show(e60, t60.renderCoordsHelper.spatialReference), h3), "debug");
  }
  get test() {
    return { update: () => {
      this.surfaceGeometryUpdates.runTask();
      for (const e59 of this._pois)
        e59.runTask();
    }, surfaceGeometryUpdates: this.surfaceGeometryUpdates };
  }
};
e([d({ readOnly: true })], E28.prototype, "centerOnContent", void 0), e([d({ readOnly: true })], E28.prototype, "centerOnSurfaceFrequent", void 0), e([d({ readOnly: true })], E28.prototype, "centerOnSurfaceInfrequent", void 0), e([d({ readOnly: true })], E28.prototype, "contentCenterOnSurface", void 0), e([d({ readOnly: true })], E28.prototype, "cameraOnSurface", void 0), e([d({ readOnly: true })], E28.prototype, "contentCameraOnSurface", void 0), e([d({ readOnly: true })], E28.prototype, "focus", void 0), e([d({ readOnly: true })], E28.prototype, "renderPointOfView", void 0), e([d({ readOnly: true })], E28.prototype, "surfaceOrigin", void 0), e([d({ readOnly: true })], E28.prototype, "contentGeometryUpdates", void 0), e([d({ readOnly: true })], E28.prototype, "surfaceGeometryUpdates", void 0), e([d({ constructOnly: true })], E28.prototype, "view", void 0), e([d({ readOnly: true })], E28.prototype, "updating", null), E28 = e([n6("esri.views.3d.support.PointsOfInterest")], E28);
var N15 = Array;
var U22 = n7();
var F15 = d6();
var D15 = { exclude: /* @__PURE__ */ new Set([j8]) };

// node_modules/@arcgis/core/views/3d/terrain/ElevationBounds.js
var s52 = class {
  constructor(s63 = 0, a58 = 0) {
    this.min = s63, this.max = a58, this.level = 0, this.hasNoDataValues = false;
  }
  copyFrom(s63) {
    this.min = s63.min, this.max = s63.max, this.level = s63.level, this.hasNoDataValues = s63.hasNoDataValues;
  }
};

// node_modules/@arcgis/core/views/3d/terrain/ElevationData.js
var e44 = class {
  constructor(t60, a58, o61) {
    this.type = "elevation", this.samplerData = null, this.level = t60[0], this.i = t60[1], this.j = t60[2], this.extent = a58;
    const s63 = o61.noDataValue, i66 = o61.values;
    let e59 = 1 / 0, l48 = -1 / 0, h44 = true, r59 = false;
    for (let n73 = 0; n73 < i66.length; n73++) {
      const t61 = i66[n73];
      t61 !== s63 ? (e59 = t61 < e59 ? t61 : e59, l48 = t61 > l48 ? t61 : l48, h44 = false) : r59 = true;
    }
    h44 && (e59 = 0, l48 = 0), l48 = l48 > -3e38 ? l48 : 0, this.samplerData = { pixelData: o61.values, width: o61.width, height: o61.height, noDataValue: s63, safeWidth: 0.99999999 * (o61.width - 1), dx: (o61.width - 1) / (a58[2] - a58[0]), dy: (o61.width - 1) / (a58[3] - a58[1]), x0: a58[0], y1: a58[3] }, this.bounds = [e59, l48], this.hasNoDataValues = r59;
  }
  release() {
    this.samplerData = null, this.bounds = null;
  }
  computeMinMaxValue(t60, a58, o61, e59) {
    e59.min = 1 / 0, e59.max = -1 / 0, e59.hasNoDataValues = false;
    const l48 = t60 - this.level;
    if (l48 <= 0)
      return e59;
    const h44 = 2 ** l48;
    if (!(Math.floor(a58 / h44) === this.i && Math.floor(o61 / h44) === this.j))
      return e59;
    let r59 = 1 / 0, n73 = -1 / 0;
    const u51 = this.samplerData.width, f37 = this.samplerData.pixelData, m40 = 0.5 * C4;
    let c67 = (u51 - 1) / h44, p52 = (o61 - this.j * h44) * c67, d32 = (a58 - this.i * h44) * c67;
    if (c67 < 1) {
      const t61 = Math.floor(p52), a59 = Math.floor(d32), o62 = t61 + a59 * u51, i66 = f37[o62], l49 = f37[o62 + 1], h45 = f37[o62 + u51], r60 = f37[o62 + u51 + 1];
      if (i66 + l49 + h45 + r60 < m40) {
        const o63 = p52 - t61, n74 = d32 - a59, u52 = g5(i66, l49, h45, r60, o63, n74), f38 = g5(i66, l49, h45, r60, o63 + c67, n74), m41 = g5(i66, l49, h45, r60, o63, n74 + c67), x30 = g5(i66, l49, h45, r60, o63 + c67, n74 + c67);
        return e59.min = Math.min(u52, f38, m41, x30), e59.max = Math.max(u52, f38, m41, x30), e59;
      }
      p52 = t61, d32 = a59, c67 = 1;
    } else
      p52 = Math.floor(p52), d32 = Math.floor(d32), c67 = Math.ceil(c67);
    for (let s63 = p52; s63 <= p52 + c67; s63++)
      for (let t61 = d32; t61 <= d32 + c67; t61++) {
        const a59 = f37[s63 + t61 * u51];
        a59 < m40 ? (r59 = Math.min(r59, a59), n73 = Math.max(n73, a59)) : e59.hasNoDataValues = true;
      }
    return e59.min = r59, e59.max = n73, e59;
  }
};
function l39(o61, s63, e59) {
  if (t(e59))
    return null;
  for (const a58 of e59) {
    if (!a58)
      continue;
    const e60 = a58.safeWidth;
    let l48 = o4(a58.dy * (a58.y1 - s63), 0, e60), h44 = o4(a58.dx * (o61 - a58.x0), 0, e60);
    const r59 = Math.floor(l48), n73 = Math.floor(h44), u51 = a58.width, f37 = r59 * u51 + n73, m40 = a58.pixelData, c67 = m40[f37], p52 = m40[f37 + 1], d32 = f37 + u51, x30 = m40[d32], M22 = m40[d32 + 1];
    if (c67 + x30 + p52 + M22 < 0.5 * C4) {
      l48 -= r59, h44 -= n73;
      const t60 = c67 + (p52 - c67) * h44;
      return t60 + (x30 + (M22 - x30) * h44 - t60) * l48;
    }
  }
  return null;
}
function h36(t60, a58, s63) {
  const i66 = l39(t60, a58, s63);
  return r(i66) ? i66 : 0;
}

// node_modules/@arcgis/core/views/3d/terrain/ExtentHelper.js
var w20 = class extends y {
  constructor(e59) {
    super(e59), this._handles = new u4();
  }
  initialize() {
    this._handles.add([this.layerViews.on("change", () => this.notifyChange("stencilEnabledExtents"))]);
  }
  destroy() {
    this._handles.destroy(), this._handles = null;
  }
  get layerViewsExtent() {
    return this._computeLayerViewsExtent();
  }
  get tiledLayersExtent() {
    return this._computeTiledLayersExtent();
  }
  get stencilEnabledExtents() {
    return this._computeStencilEnabledExtents();
  }
  _computeStencilEnabledExtents() {
    const e59 = [];
    return this.layerViews.forEach((t60) => {
      const r59 = t60.layer;
      if ("IntegratedMeshLayer" === r59.operationalLayerType && null != this.viewSpatialReference) {
        const t61 = j32(r59.fullExtent, this.viewSpatialReference);
        r(t61) && e59.push(c6(t61));
      }
    }), e59;
  }
};
function g33(e59, t60) {
  return e59 === l13.Global ? new _22(t60) : new L26(t60);
}
e([d({ readOnly: true })], w20.prototype, "layerViewsExtent", null), e([d({ readOnly: true })], w20.prototype, "tiledLayersExtent", null), e([d({ readOnly: true })], w20.prototype, "stencilEnabledExtents", null), e([d()], w20.prototype, "viewSpatialReference", void 0), e([d()], w20.prototype, "tilingScheme", void 0), e([d()], w20.prototype, "defaultTiledLayersExtent", void 0), e([d({ constructOnly: true })], w20.prototype, "layers", void 0), e([d({ constructOnly: true })], w20.prototype, "layerViews", void 0), w20 = e([n6("esri.views.3d.terrain.ExtentHelper")], w20);
var _22 = class extends w20 {
  _computeLayerViewsExtent() {
    return this._globalExtent;
  }
  _computeTiledLayersExtent() {
    return this._globalExtent;
  }
  get _globalExtent() {
    return this.viewSpatialReference.isWebMercator ? s21 : T7;
  }
};
_22 = e([n6("esri.views.3d.terrain.ExtentHelperGlobal")], _22);
var L26 = class extends w20 {
  _computeLayerViewsExtent() {
    const e59 = D3(), t60 = this.viewSpatialReference;
    this.layerViews.forEach((r60) => {
      const s64 = r60.layer;
      if (r60.isResolved() && ("graphics" !== s64.type || !s64.internal)) {
        const s65 = j32("fullExtentInLocalViewSpatialReference" in r60 && r60.fullExtentInLocalViewSpatialReference || r60.layer.fullExtent, t60);
        h5(e59, s65, e59);
      }
    });
    const r59 = M5(e59) ? e59 : null, s63 = this._get("layerViewsExtent");
    return I2(r59, s63) ? s63 : r59;
  }
  _computeTiledLayersExtent() {
    const e59 = this.tilingScheme;
    if (!e59)
      return null;
    const t60 = this.viewSpatialReference, r59 = D3();
    this.layers.forEach((i67) => {
      if (i67.loaded && t10(i67)) {
        const o62 = C5(i67, t60, l13.Local);
        if (t(o62))
          return;
        const { tileInfo: l48, fullExtent: a58 } = o62;
        r(l48) && r(a58) && (H7(i67) || e59.compatibleWith(l48) && a58.spatialReference.equals(e59.spatialReference)) && h5(r59, a58, r59);
      }
    }), h5(r59, this.defaultTiledLayersExtent, r59);
    const i66 = M5(r59) ? r59 : null, o61 = this._get("tiledLayersExtent");
    return I2(i66, o61) ? o61 : i66;
  }
};
function j32(e59, t60) {
  return r(e59) && !e59.spatialReference.equals(t60) ? Sn(e59, e59.spatialReference, t60) : e59;
}
L26 = e([n6("esri.views.3d.terrain.ExtentHelperLocal")], L26);

// node_modules/@arcgis/core/views/3d/terrain/LayerClass.js
var A34;
!function(A39) {
  A39[A39.ELEVATION = 0] = "ELEVATION", A39[A39.MAP = 1] = "MAP";
}(A34 || (A34 = {}));
var E29 = [A34.ELEVATION, A34.MAP];

// node_modules/@arcgis/core/views/3d/webgl-engine/parts/requireUtils.js
function e45() {
  var _a;
  const e59 = (_a = globalThis.require) == null ? void 0 : _a.modules;
  if (e59) {
    const o61 = Object.keys(e59);
    for (const s63 of o61)
      -1 !== s63.search(".glsl") && delete e59[s63];
  }
}

// node_modules/@arcgis/core/views/3d/terrain/OverlayManager.js
var ne3 = [[-0.1, -2, 3.9, 2], [-0.1, -3.9, 3.9, 0.1], [-2, -3.9, 2, 0.1], [-3.9, -3.9, 0.1, 0.1], [-3.9, -2, 0.1, 2], [-3.9, -0.1, 0.1, 3.9], [-2, -0.1, 2, 3.9], [-0.1, -0.1, 3.9, 3.9]];
var oe3;
var le3 = class extends y {
  constructor(e59) {
    super(e59), this._handles = new u4(), this._spatialReference = null, this._renderSR = null, this._overlaySREqualsRenderSR = true, this._drapeSources = /* @__PURE__ */ new Set(), this._drapeTargets = /* @__PURE__ */ new Set(), this._placementDirty = false, this._contentUpdated = false, this._drawTexturesDirty = false, this._drawTexturesAnimateDirty = false, this._hasUnusedRenderTargets = false, this._longitudeCyclical = null, this._latestOriginId = 0, this._maxResolution = a("esri-mobile") ? 2048 : 4096, this._animationTimeLast = 0;
  }
  get running() {
    return this._placementDirty && (this._drapeSources.size > 0 || this.view.graphics.length > 0 || t25.OVERLAY_DRAW_DEBUG_TEXTURE) && !!this._spatialReference && !this.suspended && this.surface.ready;
  }
  get _isSpherical() {
    return this.view.state.isGlobal;
  }
  get _worldToPCSRatio() {
    return r(this._spatialReference) && this._spatialReference.isGeographic && !this.view.state.isLocal ? p3(this._spatialReference).metersPerDegree : 1;
  }
  get view() {
    return this.surface.view;
  }
  get updating() {
    return this.running || this.renderer.updating || this._contentUpdated;
  }
  get hasHighlights() {
    return this.renderer.hasHighlights;
  }
  get rendersOccluded() {
    return this.renderer.rendersOccluded;
  }
  initialize() {
    const e59 = this.view;
    this.renderer = new he({ view: e59, worldToPCSRatio: this._worldToPCSRatio, spatialReference: this._spatialReference }), this._groundIntersector = x6(this.view.state.viewingMode), this._groundIntersector.options.backfacesTerrain = true, this._groundIntersector.options.invisibleTerrain = true, this._groundIntersector.options.hud = false, this._handles.add([this.renderer.events.on("has-highlights", () => {
      this.setDrawTexturesDirty(), this.notifyChange("hasHighlights");
    }), this.renderer.events.on("has-water", (t60) => {
      var _a;
      return (_a = e59._stage) == null ? void 0 : _a.renderView.setRenderParameters({ hasOverlayWater: t60 });
    }), this.renderer.events.on("renders-occluded", () => {
      this.setDrawTexturesDirty(), this.notifyChange("rendersOccluded");
    }), this.renderer.events.on("content-changed", () => this.setDrawTexturesDirty()), this.renderer.events.on("textures-disposed", () => this.updateOverlayResult()), l6(() => {
      var _a, _b, _c;
      return [(_a = e59.pointsOfInterest) == null ? void 0 : _a.renderPointOfView, (_c = (_b = e59.pointsOfInterest) == null ? void 0 : _b.centerOnSurfaceFrequent) == null ? void 0 : _c.location];
    }, () => this.setPlacementDirty()), l6(() => {
      var _a;
      return (_a = e59.state) == null ? void 0 : _a.pixelRatio;
    }, () => this.setPlacementDirty(), U3), this.surface.on("elevation-change", () => this.setPlacementDirty()), e59.on("resize", () => this.setPlacementDirty()), A2({ preRender: (e60) => {
      this._contentUpdated = false, this.renderer.processSyncDrapeSources(), this.renderer.hasOverlays && (this._dispatchAnimationUpdate(e60), this._drawOverlayTextures(this.renderer.overlays, t12.UPDATE)), this._hasUnusedRenderTargets && this._collectUnusedRenderTargetMemory();
    } }), e59.resourceController.scheduler.registerTask(L3.OVERLAY, this), e59._stage.renderView.events.on("force-camera-for-screenshot", (e60) => {
      this._updateOverlays(e60, t12.BACKGROUND), this.renderer.hasOverlays && this._drawOverlayTextures(this.renderer.overlays, t12.BACKGROUND, e60);
    })]);
  }
  destroy() {
    this.renderer.dispose(), this._handles && (this._handles.destroy(), this._handles = null), r(oe3) && (oe3.hide(), oe3 = null);
  }
  get hasOverlays() {
    return this.renderer.hasOverlays;
  }
  setSpatialReference(e59) {
    this._spatialReference = e59, this.renderer.spatialReference = e59, this._longitudeCyclical = null;
    const t60 = this.view.renderSpatialReference;
    r(e59) && r(t60) ? (this._renderSR = t60, this._overlaySREqualsRenderSR = e59.equals(this._renderSR), this._isSpherical && (this._longitudeCyclical = e59.isWebMercator ? new i16(-20037508342787e-6, 20037508342787e-6) : new i16(-180, 180), this.renderer.longitudeCyclical = this._longitudeCyclical), this.renderer && (this.renderer.worldToPCSRatio = this._worldToPCSRatio)) : this.renderer.disposeOverlays();
  }
  get gpuMemoryUsage() {
    return this.renderer.gpuMemoryUsage;
  }
  registerDrapeSource(e59, t60, r59) {
    this._drapeSources.add(e59), this.renderer.ensureOverlays(this._drapeTargets, this._drapeSources);
    const s63 = this.renderer.createDrapeSourceRenderer(e59, t60, r59);
    return this._updateDrapeSourceExtent(e59), this._setContentDirty(), this.notifyChange("running"), s63;
  }
  registerGeometryDrapeSource(e59) {
    return this.registerDrapeSource(e59, y9);
  }
  _updateDrapeSourceExtent(e59) {
    2 === this.renderer.overlays.length && r(e59.setDrapingExtent) && r(this._spatialReference) && e59.setDrapingExtent(this.renderer.overlays, this._spatialReference);
  }
  unregisterDrapeSource(e59) {
    this._drapeSources.has(e59) && (this._drapeSources.delete(e59), this.renderer.removeDrapeSourceRenderer(e59), this.renderer.ensureDrapeSources(this._drapeSources), this._setContentDirty(), this.notifyChange("running"));
  }
  registerDrapeTarget(e59) {
    this._drapeTargets.add(e59), this.renderer.ensureOverlays(this._drapeTargets, this._drapeSources);
  }
  updateOverlayResult() {
    var _a;
    (_a = this.view._stage) == null ? void 0 : _a.renderView.setRenderParameters({ overlays: this.renderer.overlays });
  }
  unregisterDrapeTarget(e59) {
    this._drapeTargets.delete(e59), this.renderer.ensureDrapeTargets(this._drapeTargets);
  }
  _setContentDirty() {
    this.setPlacementDirty(), this.setDrawTexturesDirty();
  }
  setPlacementDirty() {
    this._placementDirty = true;
  }
  runTask() {
    this._updateOverlays(this.view.state.camera, t12.UPDATE);
  }
  _updateOverlays(e59, t60) {
    if (!this._spatialReference)
      return;
    const r59 = g11(e59.fullWidth, e59.fullHeight, this._maxResolution);
    this._computeOverlayExtents(e59, r59, ue3);
    const s63 = s12(ue3.inner) / s12(ue3.outer);
    this.renderer.ensureOverlays(this._drapeTargets, this._drapeSources);
    const i66 = this._updateOverlay(T8.INNER, ue3.inner, r59, 1 * ue3.pixelRatioAdjustment, ue3.mapUnitsPerPixel), a58 = this._updateOverlay(T8.OUTER, ue3.outer, r59, s63 * ue3.pixelRatioAdjustment, ue3.mapUnitsPerPixel);
    i66 !== ye3.EXTENT && a58 !== ye3.EXTENT || (this._drapeSources.forEach((e60) => this._updateDrapeSourceExtent(e60)), this.surface.updateTileOverlayParams(t60)), i66 === ye3.NONE && a58 === ye3.NONE || this.setDrawTexturesDirty(), this._placementDirty = false;
  }
  _updateOverlay(e59, t60, r59, s63, i66) {
    if (0 === this.renderer.overlays.length)
      return ye3.NONE;
    const a58 = this.renderer.overlays[e59], n73 = a58.mapUnitsPerPixel;
    if (a58.mapUnitsPerPixel = i66, a58.pixelRatio = s63, he5(t60, a58.extent) && r59 === a58.resolution)
      return n73 === i66 ? ye3.NONE : ye3.RERENDER_ONLY;
    a7(a58.extent, t60), a58.resolution = r59;
    const o61 = p8(a58.extent);
    return a58.renderLocalOrigin = c19(o61[0], o61[1], 0, "OV_" + this._latestOriginId++), ye3.EXTENT;
  }
  setTileParameters(e59) {
    const t60 = e59.renderData.overlay;
    if (this.renderer.overlays.length > 0) {
      const r59 = this.renderer.overlays[T8.INNER], s63 = this.renderer.overlays[T8.OUTER], i66 = U4(e59.extent, this.surface.extent, pe3);
      this._rectInsideRect(r59.extent, i66) || this._rectanglesOverlap(i66, r59.extent) || this._rectanglesOverlap(i66, s63.extent) ? (this._setTileOverlayData(i66, T8.INNER, t60), this._setTileOverlayData(i66, T8.OUTER, t60)) : (this._clearTileOverlayData(T8.INNER, t60), this._clearTileOverlayData(T8.OUTER, t60));
    } else
      this._clearTileOverlayData(T8.INNER, t60), this._clearTileOverlayData(T8.OUTER, t60);
  }
  overlayPixelSizeInMapUnits(e59) {
    if (0 === this.renderer.overlays.length)
      return 0;
    const t60 = this.renderer.overlays[T8.INNER], r59 = this.renderer.overlays[T8.OUTER], s63 = this._pointIsInExtent(e59, t60.extent) ? t60 : r59;
    return (s63.extent[2] - s63.extent[0]) / s63.resolution;
  }
  _setTileOverlayData(e59, t60, r59) {
    if (0 === this.renderer.overlays.length)
      return;
    const s63 = this.renderer.overlays[t60].extent, i66 = s12(s63), a58 = l9(s63);
    let n73 = e59[0];
    if (this._longitudeCyclical) {
      n73 = this._longitudeCyclical.minimalMonotonic(s63[0], n73);
      const t61 = this._longitudeCyclical.minimalMonotonic(s63[0], e59[2]);
      n73 > t61 && (n73 = t61 - (e59[2] - e59[0]));
    }
    r59.setScale(t60, s12(e59) / i66, l9(e59) / a58), r59.setOffset(t60, (n73 - s63[0]) / i66, (e59[1] - s63[1]) / a58);
  }
  _clearTileOverlayData(e59, t60) {
    t60.setScale(e59, -1, -1), t60.setOffset(e59, -1, -1);
  }
  async reloadShaders() {
    e45(), await this.renderer.reloadShaders(), this.setDrawTexturesDirty(), this.runTask();
  }
  _dispatchAnimationUpdate(e59) {
    const t60 = n3(e59.time - this._animationTimeLast);
    (t60 >= this.surface.view._stage.renderView.animationTimestep || r(this.forcedAnimationTime) || this._drawTexturesDirty || this._drawTexturesAnimateDirty) && (this.renderer.updateAnimation({ dt: t60, forcedTime: this.forcedAnimationTime, camera: this.view.state.camera }) && (this._drawTexturesAnimateDirty = true), this._animationTimeLast = e59.time);
  }
  setDrawTexturesDirty() {
    this.renderer.hasOverlays ? (this._contentUpdated = true, this._drawTexturesDirty = true) : this.setPlacementDirty();
  }
  _intersectGroundFromView(e59, t60, r59, s63) {
    const i66 = this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(e59, me4, t60, r59);
    if (t(i66))
      return false;
    const a58 = i66.origin, n73 = u3(de3, i66.origin, i66.direction);
    return this._groundIntersector.reset(a58, n73, e59), this._groundIntersector.intersect([], null), this.view.basemapTerrain.intersect(this._groundIntersector, null, a58, n73), this._groundIntersector.results.min.getIntersectionPoint(s63);
  }
  _findHorizonBasedPointOfInterest(e59, t60) {
    let r59 = 0.5;
    const i66 = 0.55, a58 = this.view.renderCoordsHelper.getAltitude(e59.eye), o61 = this.view.pointsOfInterest.centerOnSurfaceFrequent, l48 = 1e-5, h44 = o4(o61.estimatedSurfaceAltitude, e59.aboveGround ? -1 / 0 : a58 + l48, e59.aboveGround ? a58 - l48 : 1 / 0), c67 = e59.aboveGround;
    if ("global" === this.view.viewingMode) {
      const t61 = de3;
      B3(T5($, p3(this.view.spatialReference).radius + h44), j7(e59.eye, e59.viewForward), t61), e7(t61, t61, e59.eye);
      const a59 = r25.normalize(i10(e59.viewForward, t61, e59.viewRight)) / e59.fovY + 0.5, n73 = a59 <= 0 || a59 >= 1 ? 0.5 : i66;
      r59 = c67 ? n73 * a59 : a59 + n73 * (1 - a59);
    } else {
      const t61 = 0.5 * Math.PI - Math.acos(-e59.viewForward[2]), s63 = Math.tan(t61), a59 = r10(0, s63, 1, 0), o62 = w(a59, a59, e59.projectionMatrix)[1], l49 = o4(0.5 + 0.5 * o62, 0, 1);
      r59 = 1 === l49 || 0 === l49 ? 0.5 : c67 ? l49 * i66 : 1 - (1 - l49) * i66;
    }
    return !!this._intersectGroundFromView(e59, 0.5, r59, t60) && X(t60, e59.eye) < o61.distance * o61.distance;
  }
  _computeOverlayExtents(e59, t60, r59) {
    const s63 = this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation, i66 = n7();
    this._findHorizonBasedPointOfInterest(e59, i66) || r7(i66, s63);
    const a58 = Math.max(0.1, x(e59.eye, i66)), n73 = n48(this.view.renderCoordsHelper, s63, e59.eye), d32 = Math.PI / 2 - Math.abs(n73 - Math.PI / 2);
    t25.OVERLAY_SHOW_CENTER ? (t(oe3) && (oe3 = new c58(this.view.graphics, "red")), oe3.show(i66, this._renderSR)) : r(oe3) && oe3.hide(), this._overlaySREqualsRenderSR || Bn(i66, this._renderSR, i66, this._spatialReference);
    const u51 = this.surface.extent, p52 = !this._isSpherical && r(this._spatialReference) && this._spatialReference.isGeographic, _30 = p52 && r(this._spatialReference) ? 1 / p3(this._spatialReference).metersPerDegree : 1, m40 = e59.perRenderPixelRatio * a58 * _30;
    r59.mapUnitsPerPixel = m40 / this._worldToPCSRatio;
    let y33 = t60 * m40 / 2, f37 = false, v36 = p52 ? 90 : 1 / 0;
    this._isSpherical && r(u51) && r(this._spatialReference) && (this._spatialReference.isWebMercator ? (y33 /= Math.cos(c3(i66[1])), v36 = u51[3]) : (f37 = true, y33 /= p3(this._spatialReference).metersPerDegree, v36 = 90), y33 >= v36 && (y33 = v36, i66[1] = 0, this._spatialReference.isWebMercator && (i66[0] = 0)));
    let R21 = 1;
    f37 && (R21 = 1 / Math.max(0.2, Math.cos(Math.abs(M4(i66[1])))), y33 * R21 > 180 && (R21 = 180 / y33), r59.mapUnitsPerPixel *= R21);
    const D21 = Math.log(2) / 12;
    y33 = Math.exp(Math.round(Math.log(y33) / D21) * D21);
    const E39 = y33 * R21, P22 = 32, C25 = 0.5 * t60 / (P22 * E39), N23 = 0.5 * t60 / (P22 * y33);
    i66[0] = Math.round(i66[0] * C25) / C25, i66[1] = Math.round(i66[1] * N23) / N23;
    const A39 = r59.inner;
    A39[0] = i66[0] - E39, A39[1] = i66[1] - y33, A39[2] = i66[0] + E39, A39[3] = i66[1] + y33, this._isSpherical && this._shiftExtentToFitBounds(A39, 1 / 0, v36);
    const H20 = r59.outer;
    if (6 * E39 > s12(u51))
      a7(H20, e2(u51));
    else if (d32 <= 0.25 * Math.PI)
      H20[0] = A39[0] - E39, H20[1] = A39[1] - y33, H20[2] = A39[2] + E39, H20[3] = A39[3] + y33;
    else {
      Bn(e59.eye, this._renderSR, de3, this._spatialReference), o6(ce4, i66, de3);
      let t61 = -Math.atan2(ce4[1], ce4[0]) + 0.125 * Math.PI;
      t61 < 0 && (t61 += 2 * Math.PI);
      const r60 = Math.floor(t61 / (0.25 * Math.PI));
      l3(ce4, ne3[r60], 2 * y33), ce4[0] *= R21, ce4[2] *= R21, s9(H20, A39, ce4);
    }
    if (this._isSpherical)
      H20[0] = this._longitudeCyclical.clamp(H20[0]), H20[2] = this._longitudeCyclical.clamp(H20[2]), H20[1] = Math.max(H20[1], -v36), H20[3] = Math.min(H20[3], v36);
    else {
      const e60 = U4(A39, u51, pe3), t61 = U4(H20, u51, _e);
      R3(e60, t61) && (H20[2] = H20[0], H20[3] = H20[1]);
    }
    const L31 = Math.abs(A39[2] - A39[0]) / t60;
    r59.mapUnitsPerPixel = Math.max(r59.mapUnitsPerPixel, L31), r59.pixelRatioAdjustment = r59.mapUnitsPerPixel / L31;
  }
  _drawOverlayTextures(e59, t60, r59 = this.view.state.camera) {
    if (0 === e59.length || !this._drawTexturesDirty && !this._drawTexturesAnimateDirty)
      return;
    const s63 = this._drawTexturesDirty;
    this._drawTexturesDirty = false, this._drawTexturesAnimateDirty = false;
    const i66 = this._drawOverlay(e59[T8.INNER], r59), a58 = this._drawOverlay(e59[T8.OUTER], r59);
    i66 !== A8.CHANGED && a58 !== A8.CHANGED || this.surface.updateTileOverlayParams(t12.UPDATE), this._collectUnusedRenderTargetMemory(), this.updateOverlayResult(), s63 ? (this.surface.requestRender(t60), t60 === t12.UPDATE && this.surface.requestUpdate()) : this.surface.requestRender(t12.BACKGROUND);
  }
  _drawOverlay(e59, t60) {
    return this._longitudeCyclical ? e59.setupGeometryViewsCyclical(this._longitudeCyclical) : e59.setupGeometryViewsDirect(), e59.draw(this.renderer, t60.pixelRatio);
  }
  _collectUnusedRenderTargetMemory() {
    if (this._hasUnusedRenderTargets = false, this.renderer.hasOverlays) {
      const e59 = performance.now();
      this._hasUnusedRenderTargets = this.renderer.collectUnusedRenderTargetMemory(e59);
    }
  }
  _rectanglesOverlap(e59, t60) {
    return !t(e59) && (this._longitudeCyclical ? (this._longitudeCyclical.contains(t60[0], t60[2], e59[0]) || this._longitudeCyclical.contains(t60[0], t60[2], e59[2]) || this._longitudeCyclical.contains(e59[0], e59[2], t60[0])) && !(e59[1] > t60[3] || e59[3] < t60[1]) : E4(e59, t60));
  }
  _rectInsideRect(e59, t60) {
    return !t(t60) && (this._longitudeCyclical ? this._longitudeCyclical.contains(e59[0], e59[2], t60[0]) && this._longitudeCyclical.contains(e59[0], e59[2], t60[2]) && t60[1] > e59[1] && t60[3] < e59[3] : R3(e59, t60));
  }
  _pointIsInExtent(e59, t60) {
    if (this._longitudeCyclical)
      return this._longitudeCyclical.contains(t60[0], t60[2], e59.x) && e59.y >= t60[1] && e59.y <= t60[3];
    const r59 = e59.x, s63 = e59.y;
    return r59 > t60[0] && r59 < t60[2] && s63 > t60[1] && s63 < t60[3];
  }
  _shiftExtentToFitBounds(e59, t60, r59) {
    let s63 = 0, i66 = 0;
    e59[0] < -t60 ? s63 = e59[0] + t60 : e59[2] > t60 && (s63 = t60 - e59[2]), e59[1] < -r59 ? i66 = e59[1] + r59 : e59[3] > r59 && (i66 = r59 - e59[3]), z3(e59, s63, i66);
  }
  get test() {
    return { renderer: this.renderer, update: () => this.runTask() };
  }
};
function he5(e59, t60) {
  const r59 = 1e-5, s63 = t25.TESTS_DISABLE_OPTIMIZATIONS ? 0 : r59 * Math.max(e59[2] - e59[0], e59[3] - e59[1], t60[2] - t60[0], t60[3] - t60[1]);
  return Math.abs(t60[0] - e59[0]) <= s63 && Math.abs(t60[1] - e59[1]) <= s63 && Math.abs(t60[2] - e59[2]) <= s63 && Math.abs(t60[3] - e59[3]) <= s63;
}
e([d()], le3.prototype, "_spatialReference", void 0), e([d({ readOnly: true })], le3.prototype, "running", null), e([d()], le3.prototype, "_placementDirty", void 0), e([d()], le3.prototype, "_contentUpdated", void 0), e([d()], le3.prototype, "_isSpherical", null), e([d()], le3.prototype, "_worldToPCSRatio", null), e([d()], le3.prototype, "renderer", void 0), e([d({ constructOnly: true })], le3.prototype, "surface", void 0), e([d({ readOnly: true, aliasOf: "surface.suspended" })], le3.prototype, "suspended", void 0), e([d({ readOnly: true })], le3.prototype, "updating", null), e([d({ type: Boolean })], le3.prototype, "hasHighlights", null), e([d({ type: Boolean })], le3.prototype, "rendersOccluded", null), le3 = e([n6("esri.views.3d.terrain.OverlayManager")], le3);
var ce4 = n10();
var de3 = n7();
var ue3 = { inner: u6(), outer: u6(), mapUnitsPerPixel: 0, pixelRatioAdjustment: 1 };
var pe3 = u6();
var _e = u6();
var me4 = d6();
var ye3;
!function(e59) {
  e59[e59.NONE = 0] = "NONE", e59[e59.EXTENT = 1] = "EXTENT", e59[e59.RERENDER_ONLY = 2] = "RERENDER_ONLY";
}(ye3 || (ye3 = {}));

// node_modules/@arcgis/core/geometry/support/buffer/BufferPool.js
var t51 = class {
  constructor(e59, t60) {
    this._factoryCallback = e59, this._lengthCallback = t60, this._pool = /* @__PURE__ */ new Map();
  }
  acquire(e59) {
    if (!t51.test.disabled) {
      const t60 = this._pool.get(e59);
      if (t60 && 0 !== t60.length)
        return t60.pop();
    }
    try {
      return this._factoryCallback(e59);
    } catch (o61) {
      const t60 = window.performance && window.performance.memory;
      let i66 = "";
      throw t60 && (i66 = `
  totalJSHeapSize: ${t60.totalJSHeapSize}, usedJSHeapSize: ${t60.usedJSHeapSize}, jsHeapSizeLimit: ${t60.jsHeapSizeLimit}`), console.log("Array allocation of size " + e59 + " failed: " + o61 + i66), o61;
    }
  }
  release(o61) {
    if (t51.test.disabled)
      return;
    const i66 = this._lengthCallback(o61);
    let s63 = this._pool.get(i66);
    s63 || (s63 = new n2({ shrink: true }), this._pool.set(i66, s63)), s63.push(o61);
  }
  clear() {
    this._pool.clear();
  }
  get test() {
    return { size: this._pool.size };
  }
};
t51.test = { disabled: false };

// node_modules/@arcgis/core/views/3d/terrain/PatchGeometry.js
var h37 = class {
  constructor() {
    this.indices = null, this.vertexAttributes = null, this.boundingBox = B(), this.indexCount = 0, this.numVerticesPerSide = 0, this.uvOffsetAndScale = n10(), this.outerEdges = [null, null, null, null], this.innerEdges = [null, null, null, null];
  }
};
var n58 = class {
  constructor(t60, e59, s63, i66, r59) {
    this._buf = t60, this._localOrigin = e59, this.offset0 = s63, this.stride = i66, this.count = r59;
  }
  getVertexOffset(t60) {
    return E13(0 <= t60 && t60 < this.count), this.offset0 + this.stride * t60;
  }
  getVertex(t60, e59) {
    const s63 = this.getVertexOffset(e59) * H5;
    t60[0] = this._buf[s63 + 0] + this._localOrigin[0], t60[1] = this._buf[s63 + 1] + this._localOrigin[1], t60[2] = this._buf[s63 + 2] + this._localOrigin[2];
  }
  getVertexZ(t60) {
    const e59 = this.getVertexOffset(t60) * H5;
    return this._buf[e59 + 2] + this._localOrigin[2];
  }
  setVertex(t60, e59, s63, i66) {
    const f37 = this.getVertexOffset(t60) * H5;
    this._buf[f37 + 0] = e59[0] - this._localOrigin[0], this._buf[f37 + 1] = e59[1] - this._localOrigin[1], this._buf[f37 + 2] = e59[2] - this._localOrigin[2], this._buf[f37 + 3] = s63, this._buf[f37 + 4] = i66;
  }
  getNormal(t60, e59) {
    const s63 = this.getVertexOffset(e59) * H5;
    t60[0] = this._buf[s63 + 5], t60[1] = this._buf[s63 + 6], t60[2] = this._buf[s63 + 7];
  }
  setVertexRawXYZUV(t60, e59, s63, i66, f37, u51) {
    const h44 = this.getVertexOffset(t60) * H5;
    this._buf[h44 + 0] = e59, this._buf[h44 + 1] = s63, this._buf[h44 + 2] = i66, this._buf[h44 + 3] = f37, this._buf[h44 + 4] = u51;
  }
  setVertexRawXYZUVN(t60, e59, s63, i66, f37, u51, h44, n73, o61) {
    const l48 = this.getVertexOffset(t60) * H5;
    this._buf[l48 + 0] = e59, this._buf[l48 + 1] = s63, this._buf[l48 + 2] = i66, this._buf[l48 + 3] = f37, this._buf[l48 + 4] = u51, this._buf[l48 + 5] = h44, this._buf[l48 + 6] = n73, this._buf[l48 + 7] = o61;
  }
  setVertexRawNormal(t60, e59, s63, i66) {
    const f37 = this.getVertexOffset(t60) * H5;
    this._buf[f37 + 5] = e59, this._buf[f37 + 6] = s63, this._buf[f37 + 7] = i66;
  }
  getVertexRawNormal(t60, e59) {
    const s63 = this.getVertexOffset(e59) * H5;
    t60[0] = this._buf[s63 + 5], t60[1] = this._buf[s63 + 6], t60[2] = this._buf[s63 + 7];
  }
};
var o51 = T2().vec3f(O3.POSITION).vec2f(O3.UV0).vec3f(O3.NORMAL);
var l40 = new t51((t60) => o51.createBuffer(t60), (t60) => t60.count);
function c60() {
  l40.clear();
}
function b18(t60) {
  return l40.acquire(t60);
}
function _23(t60) {
  l40.release(t60.vertexAttributes), t60.vertexAttributes = null, t60.indices = null;
}

// node_modules/@arcgis/core/views/3d/terrain/PatchGeometryLUT.js
var o52 = class {
  constructor() {
    this.sinLonLUT = new Array(I5 + 1), this.cosLonLUT = new Array(I5 + 1);
  }
  update(s63, o61) {
    const t60 = o61[0], n73 = o61[2];
    for (let r59 = 0; r59 <= s63; r59++) {
      const o62 = r59 / s63, i66 = t60 * (1 - o62) + n73 * o62;
      this.sinLonLUT[r59] = Math.sin(i66), this.cosLonLUT[r59] = Math.cos(i66);
    }
  }
};

// node_modules/@arcgis/core/views/3d/terrain/GeometryState.js
var e46 = class {
  constructor() {
    this.elevation = 0, this.normal = [0, 0, 1], this.cornerTiles = [null, null, null, null];
  }
};
var l41 = class {
  constructor() {
    this.edgeNeighbours = [null, null, null, null], this.cornerNeighborData = [new e46(), new e46(), new e46(), new e46()], this.edgeResolutions = [1, 1, 1, 1], this.modifiedEdgeResolutions = [false, false, false, false];
  }
};
var i56 = class {
  constructor() {
    this.numVerticesPerSide = 0, this.samplerData = null, this.clippingArea = null, this.wireframe = false, this.samplerDataVersion = 0, this.neighborData = new l41();
  }
};

// node_modules/@arcgis/core/views/3d/terrain/TextureFader.js
var n59 = class {
  constructor(t60) {
    this._getFadeDuration = t60, this._fadeStart = 0, this._delayedTime = 0;
  }
  clear() {
    this._current = l(this._current), this._next = l(this._next), this._waiting = l(this._waiting), this._delayed = l(this._delayed);
  }
  get current() {
    if (t(this._current))
      return null;
    if (!this._isFadingEnabled) {
      const t60 = this._delayed || this._waiting || this._next || this._current;
      t60 !== this._current && (this._current = null, this.clear(), this._current = t60);
    }
    let a58 = n59.test.fadeMoment;
    if (r(this._delayed) && (a58 = a58 || performance.now(), a58 >= this._delayedTime && (this._push(this._delayed, s53.Immediate), this._delayed = null)), r(this._next)) {
      a58 = a58 || performance.now();
      const e59 = this._fadeDuration, n73 = r(this._current) && this._next.texture === this._current.texture, s63 = this._next.type !== A13.FADING, h44 = a58 - this._fadeStart >= e59;
      (n73 || s63 || h44) && (l(this._current), this._current = this._next, this._next = this._waiting, this._waiting = null, this._fadeStart = this._alignFadeStart(a58));
    }
    return this._current;
  }
  get next() {
    return this._next;
  }
  get fadeFactor() {
    if (t(this._next))
      return 1;
    const t60 = n59.test.fadeMoment || performance.now(), i66 = Math.max(0, t60 - this._fadeStart), r59 = this._fadeDuration;
    return i66 > r59 ? 0 : 1 - i66 / r59;
  }
  get isFading() {
    return r(this._next) || r(this._delayed);
  }
  push(e59, i66 = s53.Immediate) {
    this._delayed = l(this._delayed), this._push(e59, i66);
  }
  _push(i66, r59) {
    if (this._isFadingEnabled || this.clear(), t(this._current))
      return void (this._current = i66);
    const a58 = n59.test.fadeMoment || performance.now();
    return r59 !== s53.Immediate ? (this._delayed = i66, void (this._delayedTime = a58 + r59)) : t(this._next) ? (this._next = i66, void (this._fadeStart = this._alignFadeStart(a58))) : void (t(i66) || (l(this._waiting), this._waiting = i66));
  }
  get _fadeDuration() {
    return t(this._waiting) ? this._getFadeDuration() : 0.5 * this._getFadeDuration();
  }
  _alignFadeStart(t60) {
    const e59 = this._getFadeDuration();
    return t60 + e59 - t60 % e59;
  }
  get _isFadingEnabled() {
    return this._getFadeDuration() > 0;
  }
};
var s53;
n59.test = { fadeMoment: 0 }, function(t60) {
  t60[t60.Immediate = 0] = "Immediate", t60[t60.Delayed = 5e3] = "Delayed";
}(s53 || (s53 = {}));

// node_modules/@arcgis/core/views/3d/terrain/TileAgent.js
var n60 = class {
  get updating() {
    return !!this._tileRequested;
  }
  init(e59, t60, s63, i66) {
    this.tile = e59, this._layerIdx = t60, this._layerClass = s63, this._suspended = i66, this._tileLayerInfo = e59.getLayerInfo(t60, s63), this._tileRequested = null;
    const l48 = this._findAncestorWithData();
    this._setUpsampleTile(l48);
  }
  startLoading() {
    return this._requestNext();
  }
  dispose() {
    this._tileRequested && (this._tileRequested.unrequestLayerData(this._layerIdx, this._layerClass, this), this._tileRequested = null), this.tile = null, this._tileLayerInfo = null;
  }
  setSuspension(e59) {
    e59 !== this._suspended && (this._suspended = e59, e59 ? this._tileRequested && (this._tileRequested.unrequestLayerData(this._layerIdx, this._layerClass, this), this._tileRequested = null) : this._tileLayerInfo.data || this.update());
  }
  update() {
    const e59 = this._findAncestorWithData();
    return this._setUpsampleTile(e59), this._requestNext();
  }
  dataArrived(e59) {
    this._setUpsampleTile(e59), this._tileRequested = null, e59 === this.tile ? this.tile.updateRenderData(this._layerClass, A13.FADING) : this._requestNext();
  }
  dataMissing() {
    this._tileRequested = null, this._tileLayerInfo.data = null, this._requestNext();
  }
  _agentDone() {
    this.tile.agentDone(this._layerIdx, this._layerClass), this.dispose();
  }
  _requestNext() {
    if (this._suspended)
      return true;
    const t60 = this._findNextDownload();
    if (this._tileRequested) {
      if (t60 === this._tileRequested)
        return true;
      this._tileRequested.unrequestLayerData(this._layerIdx, this._layerClass, this), this._tileRequested = null;
    }
    return r(t60) ? t60.requestLayerData(this._layerIdx, this._layerClass, this) && (this._tileRequested = t60) : this._agentDone(), !!this._tileRequested;
  }
  _findNextDownload() {
    const i66 = this._layerIdx, n73 = this._layerClass, h44 = this.tile.surface.layerViewByIndex(i66, n73), d32 = y7(h44), { minLevel: _30, maxLevel: o61 } = h44.dataLevelRange, u51 = this._desiredMinLevelDelta, p52 = this._progressiveLevelModulo + u51, y33 = this._scaleRangeEnabled ? u17 : () => true;
    let f37 = this.tile;
    const I27 = f37.level;
    let q18;
    const v36 = this._tileLayerInfo.upsampleInfo, L31 = r(v36) ? v36.tile.level : -1, m40 = !!r(v36) && L31 - I27 >= u51, D21 = m(d32, "tilemapCache");
    for (; f37 && y33(f37, d32, false) && f37.level >= _30; ) {
      const e59 = f37.level, t60 = I27 - e59, a58 = f37.layerInfo[n73][i66];
      if (a58.data && t60 >= u51) {
        (!m40 || e59 > L31) && this._setUpsampleTile(f37), a58.dataInvalidated && (q18 = f37);
        break;
      }
      if ((t(D21) || "unavailable" !== D21.getAvailability(f37.lij[0], f37.lij[1], f37.lij[2])) && e59 <= o61 && !a58.data && !a58.dataMissing && ((t(q18) || f37.level === _30 || e59 % n32 == 0 || I27 - q18.level < u51) && (q18 = f37), t60 >= p52))
        break;
      f37 = f37.parent;
    }
    return r(q18) && I27 - q18.level < u51 && this._tileLayerInfo.upsampleInfo && (q18 = null), q18;
  }
  _findAncestorWithData() {
    const e59 = this.tile.vlevel, t60 = this._desiredMinLevelDelta;
    let s63;
    for (let i66 = this.tile; i66; i66 = i66.parent)
      if (i66.hasLayerData(this._layerIdx, this._layerClass)) {
        if (e59 - i66.level >= t60)
          return i66;
        s63 = i66;
      }
    return s63;
  }
  _setUpsampleTile(e59) {
    this._tileLayerInfo.setUpsampleInfo(this.tile, e59), this.tile.updateRenderData(this._layerClass, A13.FADING);
  }
  get test() {
    return { findNextDownload: () => this._findNextDownload(), tileLayerInfo: this._tileLayerInfo };
  }
};
var h38 = class extends n60 {
  get _desiredMinLevelDelta() {
    throw d27;
  }
  get _progressiveLevelModulo() {
    throw d27;
  }
  dispose() {
  }
};
var d27 = new Error("Abstract method called on TileAgent");
var _24 = new h38();

// node_modules/@arcgis/core/views/3d/terrain/ElevationTileAgent.js
var l42 = class extends n60 {
  constructor() {
    super(...arguments), this._scaleRangeEnabled = false;
  }
  get _desiredMinLevelDelta() {
    return E11(this.tile.level) - (this.tile.vlevel - this.tile.level);
  }
  get _progressiveLevelModulo() {
    return 0;
  }
};

// node_modules/@arcgis/core/views/3d/terrain/MapTileAgent.js
var t52 = class extends n60 {
  constructor() {
    super(), this._scaleRangeEnabled = true;
  }
  get _desiredMinLevelDelta() {
    return 0;
  }
  get _progressiveLevelModulo() {
    return n32;
  }
};

// node_modules/@arcgis/core/views/3d/terrain/TilePerLayerInfo.js
var p45 = class {
  constructor() {
    this.waitingAgents = new n2(), this._upsampleInfo = null, this.loadingAgent = null, this.requestPromise = null, this.requestAbort = null, this.pendingUpdates = 0;
  }
  static acquire(t60) {
    const s63 = r47.acquire();
    return s63._init(t60), s63;
  }
  release() {
    this.dispose(), h39.delete(this), r47.release(this);
  }
  dispose() {
    this.loadingAgent = s(this.loadingAgent), this.abortRequest(), this._unsetUpsampleInfo(), this.pendingUpdates = 0, this._data = j11(this._data);
  }
  static prune() {
    r47.prune(0);
  }
  _init(t60) {
    this.waitingAgents.clear(), this._data = j11(this._data), this.dataMissing = false, this.dataInvalidated = false, this._unsetUpsampleInfo(), this.abortRequest(), this.loadingAgent = null, this.pendingUpdates = 0, this._pool = t60, this.elevationBounds = null;
  }
  invalidateSourceData() {
    this.dataInvalidated = true, this.dataMissing = false, this._unsetUpsampleInfo();
  }
  abortRequest() {
    this.requestAbort = h(this.requestAbort), this.requestPromise = null;
  }
  get upsampleInfo() {
    return this._upsampleInfo;
  }
  _unsetUpsampleInfo() {
    r(this._upsampleInfo) && (this._upsampleInfo.tile.unrefMapData(), this._pool.release(this._upsampleInfo), this._upsampleInfo = null);
  }
  setUpsampleInfo(t60, s63) {
    if (t60 === s63 || t(s63))
      this._unsetUpsampleInfo();
    else {
      if (t(this._upsampleInfo))
        this._upsampleInfo = this._pool.acquire();
      else {
        if (this._upsampleInfo.tile === s63)
          return;
        this._upsampleInfo.tile.unrefMapData();
      }
      s63.refMapData(), f15(t60, s63, this._upsampleInfo);
    }
  }
  get data() {
    return this._data;
  }
  set data(t60) {
    j11(this._data), this._data = t60;
  }
};
var r47 = new e3(p45, null, () => {
});
var h39 = /* @__PURE__ */ new Map();
function u42() {
  h39.size > 0 && (console.log(`${h39.size} live TilePerLayerInfo allocations:`), h39.forEach((t60) => console.log(t60, "\n")));
}

// node_modules/@arcgis/core/views/3d/terrain/TileTexture.js
var t53 = class {
  constructor(t60) {
    this._texture = t60, this.type = "tile-texture", this._refCount = 1;
  }
  retain() {
    ++this._refCount;
  }
  release() {
    --this._refCount, 0 === this._refCount && this._texture.dispose();
  }
  get texture() {
    return this._texture;
  }
  generateMipmap() {
    this._texture.generateMipmap();
  }
  get descriptor() {
    return this._texture.descriptor;
  }
};

// node_modules/@arcgis/core/views/3d/terrain/TileUpdate.js
var E30;
!function(E39) {
  E39[E39.NONE = 0] = "NONE", E39[E39.NONE_HIT_MAXLOD = 1] = "NONE_HIT_MAXLOD", E39[E39.SPLIT = 2] = "SPLIT", E39[E39.VSPLITMERGE = 4] = "VSPLITMERGE", E39[E39.MERGE = 8] = "MERGE", E39[E39.RENDERDATA = 16] = "RENDERDATA", E39[E39.GEOMETRY = 32] = "GEOMETRY", E39[E39.TEXTURE_NOFADING = 64] = "TEXTURE_NOFADING", E39[E39.TEXTURE_FADING = 128] = "TEXTURE_FADING";
}(E30 || (E30 = {}));

// node_modules/@arcgis/core/views/3d/terrain/Tile.js
var te3 = n7();
var ie3 = n7();
var se3 = n7();
var ne4 = 0.1;
var re3 = class {
  constructor() {
    this.fovX = 0, this.fovY = 0, this.relativeWidthLimit = 0, this.relativeHeightLimit = 0, this.maxLod = 0, this.angledSplitBias = 0, this.aboveGround = true;
  }
};
var ae3 = class {
  constructor() {
    this.lij = [0, 0, 0], this._children = [null, null, null, null], this._pendingUpdates = 0, this._dirty = true, this._previouslyRendered = false, this.extent = u6(), this._elevationBounds = n17(), this.layerInfo = [[], []], this.extentInRadians = u6(), this.centerAtSeaLevel = n7(), this._center = [n7(), _3(), n7()], this.up = i2(), this._isWithinClippingArea = true, this._intersectsClippingArea = true, this._maxTesselation = 0, this._usedMemory = null, this._mapTileMemory = 0, this._mapDataRefCount = 0, this._screenDepth = 0, this.renderOrder = 0, this._edgeLen = 0, this._edgeLen2 = 0, this._curvatureHeight = 0;
  }
  static prune() {
    le4.prune(0), de4.prune(0), p45.prune();
  }
  get usedMemory() {
    return t(this._usedMemory) && this._updateMemoryUsed(), r(this._usedMemory) ? this._usedMemory : 0 + (this.isCached ? 0 : this.mapTileMemory);
  }
  get cachedMemory() {
    return this.isCached ? this.mapTileMemory : 0;
  }
  get mapTileMemory() {
    t(this._usedMemory) && this._updateMemoryUsed();
    let e59 = this._mapTileMemory;
    for (const { data: t60 } of this.layerInfo[A34.MAP])
      t60 instanceof m9 && (e59 += t60.memoryUsage);
    return e59;
  }
  get isCached() {
    return !this.shouldLoad && this._mapDataRefCount <= 0;
  }
  get maxTesselation() {
    return this._maxTesselation;
  }
  get isWithinClippingArea() {
    return this._isWithinClippingArea;
  }
  get intersectsClippingArea() {
    return this._intersectsClippingArea;
  }
  get clippingArea() {
    return this._clippingArea;
  }
  get parent() {
    return this._parent;
  }
  get children() {
    return this._children;
  }
  get surface() {
    return this._surface;
  }
  get elevationBounds() {
    return this._elevationBounds;
  }
  get level() {
    return this.lij[0];
  }
  get key() {
    return `${this.lij[0]}/${this.lij[1]}/${this.lij[2]}`;
  }
  get edgeLen() {
    return this._edgeLen;
  }
  get radius() {
    return this._center[ce5.MIDDLE][3];
  }
  get screenDepth() {
    return this._screenDepth;
  }
  get visible() {
    return this._dirty && this.computeVisibility(), this._visible;
  }
  computeVisibility() {
    this._dirty = false;
    const e59 = this._intersectsClippingArea && this._isVisible(this.surface.frustum);
    return e59 !== this._visible && (this._visible = e59, this._surface.emit("tiles-visibility-changed"), this._surface.renderer.setNeedsRender(), this.updateAgentSuspension()), this._visible;
  }
  get loadable() {
    return this.visible || this._surface.view.state.fixedContentCamera;
  }
  get rendered() {
    const e59 = !!this.renderData;
    return e59 !== this._previouslyRendered && (this._surface.emit("tiles-visibility-changed"), this._previouslyRendered = e59, this._surface.renderer.setNeedsRender()), e59;
  }
  get shouldLoad() {
    if (this._surface.lodSnapping === S6.ON) {
      const e59 = this.level - this._surface.snapLevel;
      if (0 === e59)
        return true;
      if (1 === e59)
        return false;
    }
    return this.isLeaf;
  }
  init(e59, t60, i66) {
    this.lij[0] = e59[0], this.lij[1] = e59[1], this.lij[2] = e59[2], this.ellipsoid = p3(i66.tilingScheme.spatialReference), i66.tilingScheme.getExtent(e59[0], e59[1], e59[2], this.extent), i66.tilingScheme.convertExtentToRadians(this.extent, this.extentInRadians), this._isWithinClippingArea = true, this._intersectsClippingArea = true, this._clippingArea = null, this._mapDataRefCount = 0, i66.upsampleMapCache.pop(this.key), this._edgeLen = 0, this._edgeLen2 = 0, this._center[ce5.MIDDLE][3] = 0, this.vlevel = e59 ? e59[0] : 0, t60 && t60.elevationBounds ? a9(this._elevationBounds, t60.elevationBounds) : r13(this._elevationBounds, 0, 0), this._pendingUpdates = 0, this.renderData = null, this._screenDepth = 0, this._visible = false, this._previouslyRendered = false, this._parent = t60, this.unsetChildren(), this._surface = i66, this.updateVisibility();
    for (const s63 of E29) {
      const e60 = i66.numLayers(s63), t61 = this.layerInfo[s63];
      for (const i67 of t61)
        i67.release();
      t61.length = e60;
      for (let i67 = 0; i67 < e60; i67++)
        t61[i67] = p45.acquire(this._surface.upsampleInfoPool), s63 === A34.ELEVATION && this.findElevationBoundsForLayer(i67, -1);
    }
    this.computeElevationBounds(), this._maxTesselation = Math.min(i66.tilingScheme.pixelSize, I5);
  }
  release() {
    T9(!this.renderData, "tile.renderData was not unloaded"), this._surface.upsampleMapCache.pop(this.key);
    for (const e59 of E29) {
      for (const t60 of this.layerInfo[e59])
        t60.release();
      this.layerInfo[e59].length = 0;
    }
    this._parent = null, this._surface = null, this._usedMemory = null;
  }
  refMapData() {
    ++this._mapDataRefCount, this.isCached || this._surface.upsampleMapCache.pop(this.key);
  }
  unrefMapData() {
    if (--this._mapDataRefCount, this.isCached) {
      const e59 = this.cachedMemory;
      e59 > 0 && (this._surface.upsampleMapCache.put(this.key, this, e59), this.setMemoryDirty());
    }
  }
  setMemoryDirty() {
    this._usedMemory = null;
  }
  get cpuImageMemorySize() {
    const e59 = 4, t60 = this._surface.tilingScheme.pixelSize;
    return t60 * t60 * e59;
  }
  _updateMemoryUsed() {
    this._usedMemory = 0, this._mapTileMemory = 0;
    const e59 = this.layerInfo[A34.MAP];
    for (let i66 = 0; i66 < e59.length; i66++)
      this._mapTileMemory += this.getUsedMemoryForLayer(A34.MAP, i66);
    const t60 = this.cpuImageMemorySize;
    for (const i66 of this.layerInfo[A34.ELEVATION])
      this._usedMemory += i66.data ? t60 : 0;
    this.renderData && (this._usedMemory += this.renderData.estimatedGeometryMemoryUsage, this._mapTileMemory += u11(this.renderData.textureDescriptor)), this.isCached && this._surface.upsampleMapCache.updateSize(this.key, this, this.cachedMemory);
  }
  getUsedMemoryForLayer(e59, t60) {
    const i66 = this.layerInfo[e59][t60];
    if (!i66 || !i66.data)
      return 0;
    if (e59 !== A34.MAP || this.isCached) {
      if (e59 === A34.ELEVATION)
        return this.cpuImageMemorySize;
    } else {
      const e60 = i66.data;
      if (e60 instanceof t53)
        return u11(e60.texture);
      if (e60 instanceof HTMLImageElement || e60 instanceof O6)
        return this.cpuImageMemorySize;
      if (e60 instanceof m9 || e60 instanceof _8)
        return e60.memoryUsage;
    }
    return 0;
  }
  updateScreenDepth(e59) {
    const t60 = this._center[ce5.MIDDLE], i66 = e59, s63 = t60[0], n73 = t60[1], r59 = t60[2], a58 = i66[2] * s63 + i66[6] * n73 + i66[10] * r59 + i66[14];
    this._screenDepth = a58 < 0 ? 0 : a58 / (i66[3] * s63 + i66[7] * n73 + i66[11] * r59 + i66[15]);
  }
  shouldSplit(e59, t60, s63) {
    if (r(e59.frustum) && (!this._intersectsClippingArea || !this._isVisible(e59.frustum)))
      return E30.NONE;
    const n73 = this.level;
    e7(te3, this._center[ce5.MIDDLE], t60);
    let r59 = v3(te3), a58 = ce5.MIDDLE;
    e7(ie3, this._center[ce5.TOP], t60);
    const o61 = v3(ie3);
    o61 < r59 && (r59 = o61, a58 = ce5.TOP), e7(ie3, this._center[ce5.BOTTOM], t60);
    const f37 = v3(ie3);
    if (f37 < r59 && (r59 = f37, a58 = ce5.BOTTOM), this._edgeLen2 > r59 && n73 < e59.maxLod)
      return E30.SPLIT;
    const p52 = Math.sqrt(r59), m40 = e59.fovX * p52 * 2, _30 = this._edgeLen / m40, A39 = () => {
      const t61 = n73 + Math.ceil(-Math.log2(e59.relativeWidthLimit / _30));
      return t61 !== this.vlevel ? (this.vlevel = t61, E30.VSPLITMERGE) : E30.NONE_HIT_MAXLOD;
    };
    if (s63 === S6.ON) {
      if (1 === this._surface.snapLevel - n73)
        return n73 >= e59.maxLod ? A39() : E30.SPLIT;
    }
    const y33 = P2(this.up, te3), E39 = this._elevationBounds[1] - this._elevationBounds[0], v36 = E39 / this.edgeLen;
    if (e59.aboveGround && y33 > 0 && v36 < 1e-3) {
      if (y33 / p52 - Math.sin(this._curvatureHeight / (this.edgeLen * Math.SQRT1_2) * Math.PI) - v36 > 0)
        return E30.NONE;
    }
    if (_30 < e59.relativeWidthLimit)
      return this.vlevel !== this.level ? (this.vlevel = this.level, E30.VSPLITMERGE) : E30.NONE;
    if (n73 >= e59.maxLod)
      return A39();
    if (n73 > 6) {
      e7(ie3, this._center[a58], t60), q(se3, this.up, y33), e7(se3, se3, ie3);
      const i66 = v3(se3);
      if (i66 > this.radius * this.radius) {
        q(se3, se3, this.radius / Math.sqrt(i66)), u3(se3, se3, this._center[a58]), e7(se3, t60, se3);
        const s64 = Math.min(1, (Math.abs(P2(se3, this.up)) + 0.5 * E39 + this._curvatureHeight) / s8(se3)), n74 = ne4 / e59.angledSplitBias, r60 = e59.fovY * p52 * 2;
        if (s64 * (this._edgeLen / r60) < n74 * e59.relativeHeightLimit)
          return E30.NONE;
      }
    }
    return E30.SPLIT;
  }
  setChildren(e59, t60, i66, s63) {
    T9(!!(e59 && t60 && i66 && s63), "Null child passed"), this._children[0] = e59, this._children[1] = t60, this._children[2] = i66, this._children[3] = s63;
  }
  unsetChildren() {
    this._children[0] = null, this._children[1] = null, this._children[2] = null, this._children[3] = null;
  }
  get isLoaded() {
    var _a;
    return ((_a = this.renderData) == null ? void 0 : _a.hasGeometry) ?? false;
  }
  prepareToLoad(e59) {
    this.refMapData();
    for (const t60 of E29)
      this._createOrUpdateAgents(0, t60);
    e59.updateTileGeometryState(this);
  }
  load(e59) {
    this.prepareToLoad(e59), this.loadPrepared(e59);
  }
  loadPrepared(e59) {
    e59.loadTile(this);
  }
  unload(e59) {
    e59.unloadTile(this);
    for (const t60 of E29) {
      const e60 = this.layerInfo[t60];
      for (const t61 of e60)
        t61.loadingAgent && t61.loadingAgent !== _24 && (he6(t61.loadingAgent), t61.loadingAgent = null), t61.pendingUpdates = 0;
    }
    this.resetPendingUpdate(E30.GEOMETRY), this.resetPendingUpdate(E30.TEXTURE_NOFADING), this.resetPendingUpdate(E30.TEXTURE_FADING), this.unrefMapData();
  }
  unloadMapData() {
    const e59 = this.layerInfo[A34.MAP];
    for (const t60 of e59)
      t60.loadingAgent && t60.loadingAgent !== _24 && (he6(t60.loadingAgent), t60.loadingAgent = null), t60.pendingUpdates = 0;
    this.renderData && this.renderData.releaseTexture(), this.setMemoryDirty();
  }
  updateClippingStatus(e59) {
    if (I2(e59, this._clippingArea))
      return false;
    const t60 = this._intersectsClippingArea, s63 = this._isWithinClippingArea;
    r(e59) ? (this._intersectsClippingArea = this.intersectsExtent(e59), this._isWithinClippingArea = this._isWithinExtent(e59)) : (this._intersectsClippingArea = true, this._isWithinClippingArea = true), this._clippingArea = e59, this.updateVisibility();
    const n73 = s63 && this._isWithinClippingArea, r59 = !(s63 || t60 || this._isWithinClippingArea || this._intersectsClippingArea);
    return !this.renderData || n73 || r59 || this.setPendingUpdate(E30.GEOMETRY), true;
  }
  updateVisibility() {
    this._dirty = true, this._surface.setTileTreeDirty();
  }
  getLayerInfo(e59, t60) {
    return this.layerInfo[t60][e59];
  }
  hasLayerData(e59, t60) {
    const i66 = this.layerInfo[t60][e59];
    return !(!i66 || !i66.data || i66.dataInvalidated);
  }
  get updating() {
    if (this.hasPendingUpdates)
      return true;
    for (const e59 of E29) {
      const t60 = this.layerInfo[e59];
      for (const e60 of t60)
        if (e60.loadingAgent && e60.loadingAgent !== _24 && e60.loadingAgent.updating)
          return true;
    }
    return false;
  }
  _isSuspended(e59) {
    return !!this.hasPendingUpdate(E30.SPLIT) || e59 !== A34.ELEVATION && !this.loadable;
  }
  get hasPendingUpdates() {
    return 0 !== this._pendingUpdates;
  }
  hasPendingUpdate(e59) {
    return (this._pendingUpdates & e59) === e59;
  }
  setPendingUpdate(e59) {
    this._pendingUpdates |= e59, e59 === E30.SPLIT || e59 === E30.MERGE ? this._surface.setTileTreeDirty() : this._surface.requestUpdate();
  }
  resetPendingUpdate(e59) {
    return !!this.hasPendingUpdate(e59) && (this._pendingUpdates &= ~e59, true);
  }
  requestLayerData(e59, t60, i66) {
    const n73 = this.layerInfo[t60][e59];
    if (n73.waitingAgents.has(i66))
      return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)", this.lij.toString(), i66.tile.lij.toString(), t60, e59), true;
    if (n73.waitingAgents.push(i66), n73.data && !n73.dataInvalidated)
      return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)", this.lij.toString(), i66.tile.lij.toString(), t60, e59), i66.dataArrived(this), true;
    if (n73.requestPromise)
      return true;
    h(n73.requestAbort), n73.requestAbort = new AbortController();
    const r59 = this._surface.requestTileData(this, e59, t60, n73.requestAbort);
    if (!r59)
      return n73.requestAbort = null, false;
    const a58 = () => {
      n73.requestPromise === r59 && (n73.requestPromise = null, n73.requestAbort = null);
    };
    return n73.requestPromise = r59, r59.then(a58, a58), true;
  }
  get isLeaf() {
    return null == this._children[0];
  }
  hasLij(e59) {
    return this.lij[0] === e59[0] && this.lij[1] === e59[1] && this.lij[2] === e59[2];
  }
  findByLij(e59) {
    if (this.hasLij(e59))
      return this;
    if (this.isLeaf)
      return null;
    const t60 = this._children[0].findByLij(e59) || this._children[1].findByLij(e59) || this._children[2].findByLij(e59) || this._children[3].findByLij(e59);
    return t60 || null;
  }
  distanceToSquared(e59) {
    return v3(e7(se3, this._center[ce5.MIDDLE], e59));
  }
  containsPoint(e59) {
    const t60 = this.extent;
    return e59[0] >= t60[0] && e59[1] >= t60[1] && e59[0] <= t60[2] && e59[1] <= t60[3];
  }
  unrequestLayerData(e59, t60, i66) {
    const s63 = this.layerInfo[t60][e59], n73 = s63.waitingAgents, r59 = null != n73.removeUnordered(i66);
    T9(r59, "agent has not requested this piece of map data"), n73.length < 1 && (s63.abortRequest(), this._updateMemoryUsed());
  }
  dataArrived(e59, t60, i66) {
    const s63 = this.layerInfo[t60][e59];
    s63.data = i66, s63.dataInvalidated = false, s63.waitingAgents.forAll((e60) => e60.dataArrived(this)), s63.waitingAgents.clear(), this._updateMemoryUsed();
  }
  dataMissing(e59, t60, i66) {
    i66.notInTilemap || console.error(`Tile ${this.lij.toString()} layer ${t60}/${e59} error ${i66}`);
    const s63 = this.layerInfo[t60][e59];
    s63.dataMissing = true, s63.waitingAgents.forAll((e60) => e60.dataMissing()), s63.waitingAgents.clear(), this._updateMemoryUsed();
  }
  updateRenderData(e59, t60) {
    switch (e59) {
      case A34.MAP:
        return this._updateTexture(t60);
      case A34.ELEVATION:
        return this._updateGeometry();
    }
  }
  _updateTexture(e59) {
    this.renderData && (this.resetPendingUpdate(e59 === A13.FADING ? E30.TEXTURE_NOFADING : E30.TEXTURE_FADING), this.setPendingUpdate(e59 === A13.FADING ? E30.TEXTURE_FADING : E30.TEXTURE_NOFADING));
  }
  _updateGeometry() {
    this.setPendingUpdate(E30.GEOMETRY);
    for (const e59 of this.layerInfo[A34.ELEVATION])
      e59.pendingUpdates |= E30.GEOMETRY;
  }
  invalidateLayerData(e59, t60) {
    this.layerInfo[t60][e59].invalidateSourceData(), this.restartAgents(t60);
  }
  computeElevationBounds() {
    const e59 = this._elevationBounds;
    r13(e59, Number.MAX_VALUE, -Number.MAX_VALUE);
    const t60 = this.layerInfo[A34.ELEVATION];
    let s63 = true;
    for (const n73 of t60)
      r(n73.elevationBounds) && (e59[0] = Math.min(e59[0], n73.elevationBounds.min), e59[1] = Math.max(e59[1], n73.elevationBounds.max), n73.elevationBounds.hasNoDataValues || (s63 = false));
    s63 && (e59[0] = Math.min(e59[0], 0), e59[1] = Math.max(e59[1], 0)), this.updateRadiusAndCenter(), this._surface.setTileTreeDirty();
  }
  _updateCenter() {
    const e59 = this._elevationBounds, t60 = 0.5 * (e59[0] + e59[1]);
    q(se3, this.up, t60), u3(this._center[ce5.MIDDLE], this.centerAtSeaLevel, se3), q(se3, this.up, e59[0]), u3(this._center[ce5.TOP], this.centerAtSeaLevel, se3), q(se3, this.up, e59[1]), u3(this._center[ce5.BOTTOM], this.centerAtSeaLevel, se3);
  }
  findElevationBoundsForLayer(e59, s63) {
    const n73 = this.layerInfo[A34.ELEVATION][e59];
    if (r(n73.elevationBounds) && n73.elevationBounds.level >= s63)
      return;
    const r59 = this._surface.layerViewByIndex(e59, A34.ELEVATION), a58 = y7(r59);
    if (!u17(this, a58, false))
      return;
    const o61 = ue4;
    let h44 = false;
    if (n73.data) {
      const e60 = n73.data;
      o61.min = e60.bounds[0], o61.max = e60.bounds[1], o61.hasNoDataValues = e60.hasNoDataValues, o61.level = this.level, h44 = true;
    } else {
      let t60, i66, s64 = 0;
      for (let n74 = this._parent; n74 && (!i66 || s64 < E11(this.level)) && (s64 = this.vlevel - n74.level, t60 = i66 || t60, i66 = n74.layerInfo[A34.ELEVATION][e59].data, !(!i66 && t60 && s64 >= E11(this.level))); n74 = n74.parent)
        ;
      i66 = i66 || t60, i66 && (i66.computeMinMaxValue(this.lij[0], this.lij[1], this.lij[2], o61), o61.min !== 1 / 0 && (o61.level = i66.level, h44 = true));
    }
    h44 && (t(n73.elevationBounds) && (n73.elevationBounds = new s52()), n73.elevationBounds.copyFrom(o61));
  }
  modifyLayers(e59, t60, i66) {
    const s63 = this.layerInfo[i66];
    for (const a58 of s63)
      a58.loadingAgent && a58.loadingAgent !== _24 && (he6(a58.loadingAgent), a58.loadingAgent = null), a58.waitingAgents.clear();
    for (let a58 = 0; a58 < s63.length; ++a58)
      void 0 === e59[a58] && s63[a58].release();
    const n73 = new Array(...s63), r59 = t60.length;
    s63.length = r59;
    for (let a58 = 0; a58 < r59; a58++) {
      const e60 = t60[a58];
      s63[a58] = e60 > -1 ? n73[e60] : p45.acquire(this._surface.upsampleInfoPool);
    }
    this._updateMemoryUsed();
  }
  restartAgents(e59) {
    this.renderData && (this._createOrUpdateAgents(0, e59), this.updateRenderData(e59, A13.FADING));
  }
  updateAgents(e59) {
    if (this.renderData) {
      const t60 = this.layerInfo[e59];
      for (const e60 of t60)
        e60.loadingAgent === _24 && (e60.loadingAgent = null);
      this._createOrUpdateAgents(0, e59);
    }
  }
  updateAgentSuspension() {
    for (const e59 of E29) {
      const t60 = this._isSuspended(e59);
      for (const i66 of this.layerInfo[e59])
        i66.loadingAgent && i66.loadingAgent !== _24 && (i66.loadingAgent.setSuspension(t60), i66.loadingAgent === _24 && this.updateRenderData(e59, A13.FADING));
    }
  }
  removeLayerAgent(e59, t60) {
    const i66 = this.layerInfo[t60][e59];
    i66.loadingAgent && i66.loadingAgent !== _24 && i66.loadingAgent.dispose(), i66.loadingAgent = null;
  }
  agentDone(e59, i66) {
    const s63 = this.layerInfo[i66][e59];
    s63.loadingAgent = _24, !s63.data && t(s63.upsampleInfo) && this._createOrUpdateAgents(e59 + 1, i66);
  }
  _createOrUpdateAgents(e59, t60) {
    const i66 = this.layerInfo[t60];
    if (0 === i66.length)
      return;
    const s63 = (() => {
      for (let s64 = e59; s64 < i66.length; ++s64) {
        const e60 = this._surface.layerViewByIndex(s64, t60);
        if (U10(e60) && "normal" !== e60.layer.blendMode)
          return true;
      }
      return false;
    })(), n73 = this._isSuspended(t60);
    for (let r59 = e59; r59 < i66.length; ++r59) {
      const e60 = i66[r59];
      let a58 = false;
      const o61 = this._surface.layerViewByIndex(r59, t60), h44 = y7(o61);
      if (e60.loadingAgent ? u17(this, h44, false) ? (e60.loadingAgent !== _24 && e60.loadingAgent.setSuspension(n73), e60.loadingAgent !== _24 && (a58 = e60.loadingAgent.update())) : e60.dispose() : u17(this, h44, false) && (e60.loadingAgent = oe4(this, r59, t60, n73), a58 = e60.loadingAgent.startLoading(), a58 ? e60.loadingAgent === _24 && this.setPendingUpdate(E30.GEOMETRY) : (he6(e60.loadingAgent), e60.loadingAgent = _24)), e60.loadingAgent === _24 && this.updateRenderData(t60, A13.FADING), !s63 && a58 && o61.isOpaque)
        return;
    }
  }
  _isWithinExtent(e59) {
    const t60 = this.extent;
    return t60[0] >= e59[0] && e59[2] >= t60[2] && t60[1] >= e59[1] && e59[3] >= t60[3];
  }
  intersectsExtent(e59) {
    const t60 = this.extent;
    return t60[2] >= e59[0] && e59[2] >= t60[0] && t60[3] >= e59[1] && e59[3] >= t60[1];
  }
  getElevationBasedVerticesPerSide(t60) {
    const i66 = this.vlevel - this.level, s63 = Math.max(this.level - t60, E11(this.level) - i66);
    return o4(1 + (this.maxTesselation >> s63), 2, this.maxTesselation + 1);
  }
  get test() {
    return { cachedMemory: this.cachedMemory };
  }
  _findLIJ(e59, t60) {
    if (!e59)
      return null;
    const s63 = this.surface.rootTiles;
    if (r(s63)) {
      for (const i66 of s63)
        if (ge4(i66, e59)) {
          let s64 = i66, n73 = e59[0] - s64.level - 1;
          for (; n73 >= 0 && !s64.isLeaf && !t60(s64); ) {
            const t61 = e59[1] >> n73 & 1, i67 = e59[2] >> n73 & 1;
            s64 = s64.children[2 * t61 + i67], n73--;
          }
          return t60(s64) ? s64 : null;
        }
    }
    return null;
  }
  findNeighborTile(e59, t60) {
    const i66 = this.lij, s63 = this.getNeighborLIJ(i66, e59);
    return s63 ? fe3(i66, s63) ? t60(this) ? this : null : this._findLIJ(s63, t60) : null;
  }
  findCorner(e59, t60) {
    const i66 = e59 === E12.NORTH_EAST ? 1 : e59 === E12.NORTH_WEST ? 0 : e59 === E12.SOUTH_WEST ? 2 : 3;
    let s63 = this;
    for (; !(s63.isLeaf || t60 && t60(s63)); )
      s63 = s63.children[i66];
    return s63;
  }
  findNeighborCornerTileExact(e59, t60) {
    var _a;
    return (_a = this.findNeighborTile(e59, (e60) => t60(e60) || e60.level === this.level)) == null ? void 0 : _a.findCorner(P6(e59), t60);
  }
  forAllSubtreeOnSide(e59, t60) {
    const i66 = e59 === E12.NORTH ? [0, 1] : e59 === E12.NORTH_EAST ? [1] : e59 === E12.EAST ? [1, 3] : e59 === E12.SOUTH_EAST ? [3] : e59 === E12.SOUTH ? [2, 3] : e59 === E12.SOUTH_WEST ? [2] : e59 === E12.WEST ? [0, 2] : [0], s63 = (e60) => {
      t60(e60) || e60.isLeaf || i66.forEach((t61) => s63(e60.children[t61]));
    };
    s63(this);
  }
  forallNeighbors(e59) {
    Z2.forEach((t60) => this.findNeighborCornerTileExact(t60, e59)), Y2.forEach((t60) => {
      var _a;
      return (_a = this.findNeighborTile(t60, (t61) => t61.level === this.level || e59(t61))) == null ? void 0 : _a.forAllSubtreeOnSide(q3(t60), e59);
    });
  }
  getNeighborEdgeStartVertexIndex(e59, t60) {
    const i66 = t60 ?? this.findNeighborTile(Y2[e59], (e60) => e60.isLoaded);
    if (!i66 || !this.isLoaded || !i66.isLoaded)
      return 0;
    const s63 = this.level - i66.level;
    if (0 === s63)
      return 0;
    const n73 = 2 ** s63, r59 = 1 == (1 & e59), a58 = r59 ? 0 : 1, o61 = i66.lij[a58 + 1] * n73, h44 = this.lij[a58 + 1] - o61;
    return r59 ? n73 - 1 - h44 : h44;
  }
  _updateNeighborsWithChangedEdgeResolution() {
    for (let e59 = 0; e59 < 4; ++e59)
      if (this.renderData.geometryState.neighborData.modifiedEdgeResolutions[e59]) {
        const t60 = Y2[e59], i66 = this.findNeighborTile(t60, (e60) => e60.isLoaded || e60.level === this.level);
        if (!i66)
          continue;
        if (!i66.isLoaded) {
          E13(!i66.isLeaf);
          const s63 = (e59 + 2) % 4, n73 = q3(t60);
          i66.forAllSubtreeOnSide(n73, (e60) => e60.isLoaded ? (e60.updateEdgeAfterResolutionChange(s63), true) : (E13(!e60.isLeaf), false));
        }
        this.renderData.geometryState.neighborData.modifiedEdgeResolutions[e59] = false;
      }
  }
  updateNeighborDataAndGeometryIfNeeded() {
    this.isLoaded && this.renderData.updateNeighborDataAndGeometryIfNeeded();
  }
  updateNeighborsAfterGeometryChange(e59 = this.level) {
    this.forEachLoadedNeighbor((e60) => this._updateNeighbor(e60)), Y2.forEach((t60) => {
      var _a;
      (_a = this.findNeighborTile(t60, (t61) => t61.isLoaded && t61.level < e59)) == null ? void 0 : _a.updateNeighborsWithChangedEdgeResolution();
    });
  }
  updateNeighborsWithChangedEdgeResolution() {
    this.isLoaded && this._updateNeighborsWithChangedEdgeResolution();
  }
  updateEdgeAfterResolutionChange(e59) {
    this.renderData.updateEdgeAfterResolutionChange(e59);
  }
  forEachLoadedNeighbor(e59) {
    const t60 = this.level, i66 = (e60) => e60.level === t60 || e60.isLoaded;
    Y2.forEach((t61, s63) => {
      var _a, _b;
      const n73 = this.findNeighborTile(t61, i66);
      null != n73 && n73 !== this && n73.forAllSubtreeOnSide(q3(t61), (t62) => !!t62.isLoaded && (e59(t62), true));
      const r59 = (_b = (_a = this.renderData) == null ? void 0 : _a.geometryState) == null ? void 0 : _b.neighborData;
      r59 && (r59.modifiedEdgeResolutions[s63] = false);
    }), Z2.forEach((t61) => {
      var _a;
      const s63 = (_a = this.findNeighborTile(t61, i66)) == null ? void 0 : _a.findCorner(P6(t61), (e60) => e60.isLoaded);
      E13(!s63 || _e2(this, s63, t61)), (s63 == null ? void 0 : s63.isLoaded) && e59(s63);
    });
  }
  _updateNeighbor(e59) {
    (e59 == null ? void 0 : e59.isLoaded) && e59.updateNeighborDataAndGeometryIfNeeded();
  }
  getNeighborLIJ(e59, t60) {
    const i66 = X3(t60) ? -1 : Q4(t60) ? 1 : 0, s63 = J2(t60) ? -1 : K2(t60) ? 1 : 0, n73 = [e59[0], e59[1] + i66, e59[2] + s63];
    return n73[1] < 0 ? null : this.surface.isGlobal ? this.wrapLIJ(n73) : n73[2] < 0 ? null : n73;
  }
  wrapLIJ(e59) {
    return !e59 || e59[1] < 0 || e59[1] >= 2 ** e59[0] ? null : this.surface.wrapEastWest(e59);
  }
  get westNeighborWestExtent() {
    return this.extent[0] * (this.isWestEnd ? -1 : 1);
  }
  get eastNeighborEastExtent() {
    return this.extent[2] * (this.isEastEnd ? -1 : 1);
  }
  get isEastEnd() {
    return this.lij[2] === this.surface.lijEastEnd(this.level) - 1;
  }
  get isWestEnd() {
    return 0 === this.lij[2];
  }
  get isNorthEnd() {
    return 0 === this.lij[1];
  }
  get isSouthEnd() {
    return this.extent[1] + t6 >= this.surface.extent[1];
  }
  compareLIJs(e59) {
    const t60 = this.lij, i66 = t60[0], s63 = e59[0];
    if (i66 === s63)
      return [t60, e59];
    const n73 = i66 - s63;
    if (n73 < 0) {
      const i67 = 2 ** -n73;
      return [[s63, t60[1] * i67, t60[2] * i67], e59];
    }
    {
      const s64 = 2 ** n73;
      return [t60, [i66, e59[1] * s64, e59[2] * s64]];
    }
  }
  checkGeometryWaterproofness() {
    m10 && (E13(this.isLoaded), this.renderData.checkGeometryWaterproofness());
  }
  shouldHaveNeighbor(e59) {
    const t60 = this.extent, i66 = this.surface.rootTilesExtent, s63 = 0.25 * (t60[2] - t60[0]);
    if (X3(e59) && t60[3] + s63 >= i66[3])
      return false;
    if (Q4(e59) && t60[1] - s63 <= i66[1])
      return false;
    const n73 = this.surface.isGlobal;
    return !(!n73 && J2(e59) && t60[0] - s63 <= i66[0]) && !(!n73 && K2(e59) && t60[2] + s63 >= i66[2]);
  }
};
function oe4(e59, t60, i66, s63) {
  const n73 = i66 === A34.ELEVATION ? de4.acquire() : le4.acquire();
  return n73.init(e59, t60, i66, s63), n73;
}
function he6(e59) {
  e59.dispose(), e59 instanceof l42 ? de4.release(e59) : e59 instanceof t52 && le4.release(e59);
}
var le4 = new e3(t52);
var de4 = new e3(l42);
var ue4 = new s52();
var ce5;
function ge4(e59, t60) {
  const i66 = e59.level, s63 = t60[0];
  if (i66 > s63)
    return false;
  const n73 = s63 - i66, r59 = Math.floor(t60[1] / 2 ** n73), a58 = Math.floor(t60[2] / 2 ** n73);
  return r59 === e59.lij[1] && a58 === e59.lij[2];
}
function fe3(e59, t60) {
  return e59[0] === t60[0] && e59[1] === t60[1] && e59[2] === t60[2];
}
function pe4(e59, t60, i66) {
  return Math.abs(e59 - t60) <= i66;
}
function _e2(e59, i66, s63) {
  return !t(e59) && !t(i66) && i66 !== e59 && (e59.level >= i66.level ? Ae2(e59, i66, s63) : Ae2(i66, e59, P6(s63)));
}
function Ae2(e59, t60, i66) {
  E13(e59.level >= t60.level);
  const s63 = z5(i66), n73 = B4(i66), r59 = e59.extent, a58 = t60.extent, o61 = [s63 ? r59[0] : r59[2], n73 ? r59[3] : r59[1]], h44 = [s63 ? a58[2] : a58[0], n73 ? a58[1] : a58[3]], l48 = 1e-5 * (r59[2] - r59[0]), d32 = pe4(o61[0], h44[0], l48) || e59.surface.isGlobal && pe4(o61[0], -h44[0], l48), u51 = pe4(o61[1], h44[1], l48);
  if (d32 && u51)
    return true;
  if (e59.level === t60.level)
    return false;
  if (!d32 && !u51)
    return false;
  return d32 ? ye4(a58[1], a58[3], r59[1], r59[3], l48) : ye4(a58[0], a58[2], r59[0], r59[2], l48);
}
function ye4(e59, t60, i66, s63, n73 = t6) {
  return e59 - n73 <= i66 && i66 <= s63 && s63 <= t60 + n73;
}
!function(e59) {
  e59[e59.TOP = 0] = "TOP", e59[e59.MIDDLE = 1] = "MIDDLE", e59[e59.BOTTOM = 2] = "BOTTOM";
}(ce5 || (ce5 = {}));

// node_modules/@arcgis/core/views/3d/terrain/TileOverlayData.js
var s54 = class {
  constructor() {
    this._scales = [-1, -1, -1, -1], this._offsets = [-1, -1, -1, -1];
  }
  clear() {
    this._scales[0] = this._scales[1] = this._scales[2] = this._scales[3] = -1, this._offsets[0] = this._offsets[1] = this._offsets[2] = this._offsets[3] = -1;
  }
  setScale(s63, t60, e59) {
    this._scales[2 * s63] = t60, this._scales[2 * s63 + 1] = e59;
  }
  setOffset(s63, t60, e59) {
    this._offsets[2 * s63] = t60, this._offsets[2 * s63 + 1] = e59;
  }
  get scales() {
    return this._scales;
  }
  get offsets() {
    return this._offsets;
  }
};

// node_modules/@arcgis/core/views/3d/terrain/PatchRenderData.js
var T23 = class {
  constructor() {
    this.geometryInfo = new h37(), this.intersectionData = null, this.geometryState = null, this._textureRef = new n59(() => this.tile.surface.textureFadeDuration), this.overlay = new s54(), this._geometryStateChangedSinceLastUpdate = true, this._hasGeometry = false, this._numVerticesPerSideChanged = false, this._samplerDataChanged = false, this._edgeResolutionChanged = false, this._edgeNeighborChanged = false, this._cornerElevationChanged = false, this._clippingAreaChanged = false, this._wireframeChanged = false;
  }
  get tile() {
    return this._tile;
  }
  init(e59) {
    this._tile = e59, this.clear();
    const t60 = this.geometryInfo;
    t60.indices = null, t60.vertexAttributes = null, B(t60.boundingBox), t60.indexCount = 0, t60.numVerticesPerSide = 0, this.intersectionData = null, this.geometryState = new i56(), this.localOrigin = null, this.overlay.clear();
  }
  clear() {
    this._releaseGeometry(), this.releaseTexture(), this._textureRef.clear();
  }
  updateGeometryIfChanged(e59, t60) {
    const r59 = this.updateGeometryStateAndPrepareForGeometryGeneration(t60);
    this._hasGeometry = true;
    return this.updateNeighborDataAndGeometryIfNeeded(r59, e59);
  }
  updateNeighborDataAndGeometryIfNeeded(e59 = false, t60 = this.vao.context) {
    const r59 = this._updateNeighborData(), i66 = e59 || this._geometryStateChangedSinceLastUpdate || r59;
    return i66 && (this._updateGeometry(t60), this._geometryStateChangedSinceLastUpdate = false), i66;
  }
  _calculateEdgeResolution(e59, t60) {
    var _a;
    const s63 = this.tile, a58 = this.geometryState.numVerticesPerSide - 1;
    if (!s63.surface.isGlobal) {
      const t61 = s63.surface.extent;
      if (r(t61) && (0 === e59 && s63.extent[3] > t61[3] || 1 === e59 && s63.extent[2] > t61[2] || 2 === e59 && s63.extent[1] < t61[1] || 3 === e59 && s63.extent[0] < t61[0]))
        return a58;
    }
    const o61 = s63.level, n73 = Y2[e59], l48 = t60 || s63.findNeighborTile(n73, (e60) => e60.isLoaded || e60.level === o61);
    if (!l48 || l48.isLeaf && !l48.isLoaded)
      return E13(t((_a = s63.surface) == null ? void 0 : _a.rootTiles) || s63.surface.updatingRootTiles || !s63.shouldHaveNeighbor(n73)), a58;
    if (l48.isLoaded) {
      const t61 = l48, r59 = t61.renderData.geometryState, i66 = o61 - t61.level;
      if (0 === i66) {
        const e60 = r59.numVerticesPerSide - 1;
        return Math.max(e60, a58);
      }
      const s64 = 2 ** i66, n74 = r59.neighborData.edgeResolutions[(e59 + 2) % 4] / s64;
      return Math.max(1, n74);
    }
    E13(!l48.isLeaf);
    let h44 = a58;
    return l48.forAllSubtreeOnSide(q3(n73), (e60) => e60 === s63 || (e60.isLoaded ? (h44 = Math.max(h44, 2 ** (e60.level - o61)), true) : (E13(!e60.isLeaf), false))), h44;
  }
  _updateNeighborData() {
    const e59 = this.tile, r59 = (t60) => t60.isLoaded || t60.level === e59.level, i66 = (e60) => e60.isLoaded, s63 = [null, null, null, null], a58 = [null, null, null, null];
    (() => {
      for (let t60 = 0; t60 < 4; ++t60) {
        const i67 = e59.findNeighborTile(Y2[t60], r59);
        s63[t60] = i67, a58[t60] = (i67 == null ? void 0 : i67.isLoaded) ? i67 : null;
      }
    })();
    const o61 = [null, null, null, null];
    (() => {
      for (let t60 = 0; t60 < 4; ++t60)
        o61[t60] = e59.findNeighborTile(Z2[t60], i66);
    })();
    const l48 = this.geometryState.neighborData;
    let h44 = false;
    (() => {
      for (let t60 = 0; t60 < 4; ++t60) {
        const r60 = l48.edgeResolutions[t60], i67 = s63[t60], a59 = this._calculateEdgeResolution(t60, i67);
        l48.edgeResolutions[t60] = a59, r60 !== a59 && (h44 = true, this._edgeResolutionChanged = true, i67 && i67 !== e59 && !i67.isLoaded && i67.level === e59.level && (l48.modifiedEdgeResolutions[t60] = true));
      }
    })();
    (() => {
      const r60 = (r61, i68) => {
        var _a, _b;
        const s65 = r61.reduce((e60, t60) => Math.min(e60, (t60 == null ? void 0 : t60.level) ?? 1 / 0), 1 / 0);
        for (let l49 = 0; l49 < 4; ++l49) {
          const s66 = r61[(l49 + 3) % 4], a60 = r61[l49];
          if (s66 && s66.level < e59.level && s66 === a60) {
            const r62 = s66, a61 = 1 == (1 & l49), o63 = (e59.getNeighborEdgeStartVertexIndex(l49, r62) + (0 === i68 || 1 === i68 && !a61 || 3 === i68 && a61 ? 1 : 0)) / 2 ** (e59.level - r62.level), h45 = a61 ? 0 === i68 || 1 === i68 ? r62.extent[0] : r62.extent[2] : s10(r62.extent[0], r62.extent[2], o63), d32 = a61 ? s10(r62.extent[1], r62.extent[3], o63) : 0 === i68 || 3 === i68 ? r62.extent[1] : r62.extent[3];
            return h36(h45, d32, r62.renderData.geometryState.samplerData);
          }
        }
        let a59 = 0, o62 = 0;
        for (let e60 = 0; e60 < 4; ++e60) {
          const t60 = r61[e60];
          if (t60 && t60.level === s65) {
            const r62 = 0 === e60 || 1 === e60, i69 = 0 === e60 || 3 === e60, s66 = t60.extent;
            o62 += h36(s66[r62 ? 0 : 2], s66[i69 ? 1 : 3], (_b = (_a = t60.renderData) == null ? void 0 : _a.geometryState) == null ? void 0 : _b.samplerData), a59++;
          }
        }
        return a59 ? o62 / a59 : 0;
      }, i67 = l48.cornerNeighborData, s64 = (t60, s65) => {
        var _a;
        const a59 = i67[t60], o62 = a59.cornerTiles;
        for (let r61 = 0; r61 < 4; ++r61) {
          const t61 = Z2[r61], i68 = (_a = s65[r61]) == null ? void 0 : _a.findCorner(P6(t61), (t62) => (t62 == null ? void 0 : t62.isLoaded) || t62 === e59);
          o62[r61] = i68;
        }
        const n73 = r60(o62, t60);
        return a59.elevation !== n73 && (a59.elevation = n73, true);
      };
      for (let t60 = 0; t60 < 4; ++t60) {
        const r61 = o61[t60], i68 = a58[t60], n73 = [r61, a58[(t60 + 1) % 4], e59, i68], l49 = n73.map((e60, r62) => n73[(r62 + 4 - t60) % 4]);
        s64(t60, l49) && (this._cornerElevationChanged = true, h44 = true);
      }
    })();
    return (() => {
      const t60 = (t61, r61) => {
        if (!(t61 == null ? void 0 : t61.isLoaded) || t61.lij[0] > e59.lij[0])
          return null;
        const i67 = t61.renderData.geometryState;
        return { neighborSamplerData: i67.samplerData, neighborEdgeOverlapResolution: i67.neighborData.edgeResolutions[r61 + 2], version: i67.samplerDataVersion, neighborVerticesPerSide: i67.numVerticesPerSide, neighborTile: t61 };
      }, r60 = l48.edgeNeighbours;
      for (let i67 = 0; i67 < 4; ++i67) {
        const s64 = a58[i67];
        s64 && (E13(s64 == null ? void 0 : s64.isLoaded), E13((s64 == null ? void 0 : s64.lij[0]) <= e59.lij[0]));
        const o62 = r60[i67], n73 = o62 == null ? void 0 : o62.version, l49 = t60(s64, i67), d32 = (l49 == null ? void 0 : l49.version) ?? null, u51 = null != o62 != (null != l49), g45 = o62 && l49 && n73 !== d32, c67 = o62 && l49 && (o62 == null ? void 0 : o62.neighborTile) !== (l49 == null ? void 0 : l49.neighborTile), p52 = u51 || g45 || c67;
        this._edgeNeighborChanged || (this._edgeNeighborChanged = p52), h44 || (h44 = p52), !p52 && n73 || (r60[i67] = l49);
      }
    })(), h44;
  }
  updateEdgeAfterResolutionChange(e59) {
    var _a;
    const t60 = this._calculateEdgeResolution(e59), r59 = this.geometryState.neighborData.edgeResolutions, i66 = r59[e59];
    E13((((_a = this.geometryState.neighborData.edgeNeighbours[e59]) == null ? void 0 : _a.neighborTile.level) ?? 0) <= this.tile.level), t60 !== i66 && (r59[e59] = t60, this._edgeResolutionChanged = true, T23.deferTileNeighborUpdate ? T23.neighborTilesToUpdate.add(this.tile) : this._updateGeometry(this.vao.context));
  }
  _updateGeometry(e59) {
    this.intersectionData = null;
    const t60 = this.tile, r59 = t60.lij, i66 = T23.updatedGeometryTiles.get(r59) || 0;
    T23.updatedGeometryTiles.set(r59, i66 + 1);
    const s63 = this._vao, a58 = this.geometryInfo.vertexAttributes, o61 = !s63 || !a58 || this._wireframeChanged || this._numVerticesPerSideChanged || this._samplerDataChanged || this._clippingAreaChanged || this._edgeResolutionChanged, n73 = !o61 && this._edgeNeighborChanged, l48 = !n73 && this._cornerElevationChanged;
    this._numVerticesPerSideChanged = false, this._samplerDataChanged = false, this._edgeResolutionChanged = false, this._edgeNeighborChanged = false, this._cornerElevationChanged = false, this._clippingAreaChanged = false, this._wireframeChanged = false, o61 ? (this._releaseGeometry(), this._createGeometry(e59)) : n73 ? t60.updateEdgeElevations() : l48 ? t60.updateCornerElevations() : console.warn("Update for no reason?");
  }
  releaseGeometry() {
    return this._releaseGeometry();
  }
  get hasGeometry() {
    return this._hasGeometry;
  }
  ensureTexture(e59, t60) {
    return r(this._texture) && this._texture.descriptor.width !== e59 && this.releaseTexture(), t(this._texture) && (this._texture = t60(), this.tile.setMemoryDirty()), this._texture;
  }
  releaseTexture() {
    r(this._texture) && (this._texture.release(), this._texture = null, this.tile.setMemoryDirty());
  }
  updateGeometryStateAndPrepareForGeometryGeneration(t60) {
    const r59 = this._getElevationInfo(), i66 = r59.samplerData ? this.tile.getElevationBasedVerticesPerSide(r59.maxTileLevel) : this.tile.getDefaultVerticesPerRowOnLevel(), s63 = Math.max(i66, 5);
    let a58 = this.tile.clippingArea;
    this.tile.intersectsClippingArea && !this.tile.isWithinClippingArea || (a58 = null);
    const o61 = this.geometryState;
    let n73 = false;
    return o61.numVerticesPerSide !== s63 && (this._numVerticesPerSideChanged = true, o61.numVerticesPerSide = s63, o61.samplerDataVersion++, n73 = true), r59.changed && (this._samplerDataChanged = true, o61.samplerData = r59.samplerData, o61.samplerDataVersion++, n73 = true), i(o61.clippingArea, a58) || (this._clippingAreaChanged = true, o61.clippingArea = a58, n73 = true), o61.wireframe !== t60 && (this._wireframeChanged = true, o61.wireframe = t60, n73 = true), this._geometryStateChangedSinceLastUpdate || (this._geometryStateChangedSinceLastUpdate = n73), this._hasGeometry = true, n73;
  }
  _createGeometry(e59) {
    this.tile.createGeometry();
    const t60 = this.geometryInfo.vertexAttributes, r59 = this.geometryInfo.indices, i66 = e59.gl;
    this._vao = new f11(e59, E7, { geometry: o7(t60.layout) }, { geometry: c10.createVertex(e59, i66.STATIC_DRAW, t60.buffer) }, c10.createIndex(e59, i66.STATIC_DRAW, r59)), this._hasGeometry = true;
  }
  _releaseGeometry() {
    return this._hasGeometry = false, !!this._vao && (this._vao.dispose(), this._vao = null, _23(this.geometryInfo), true);
  }
  get vao() {
    return this._vao;
  }
  setTextureReference(e59, t60 = s53.Immediate) {
    r(e59) && e59.texture !== this._texture && this.releaseTexture(), this._textureRef.push(e59, t60);
  }
  get textureReference() {
    return this._textureRef.current;
  }
  get nextTextureReference() {
    return this._textureRef.next;
  }
  get textureFadeFactor() {
    return this._textureRef.fadeFactor;
  }
  get textureIsFading() {
    return this._textureRef.isFading;
  }
  _getElevationInfo() {
    const e59 = this.geometryState.samplerData, t60 = this.tile.layerInfo[A34.ELEVATION], i66 = t60.length;
    let s63 = new Array(i66), a58 = 0, o61 = 0, n73 = false;
    for (let l48 = 0; l48 < i66; l48++) {
      const i67 = t60[l48];
      if (r(i67.upsampleInfo)) {
        const t61 = i67.upsampleInfo.tile, r59 = t61.layerInfo[A34.ELEVATION][l48].data, d32 = r59 && r59.samplerData;
        e59 && e59[a58] === d32 || (n73 = true), s63[a58++] = d32, o61 = Math.max(o61, t61.lij[0]);
      } else if (i67.data) {
        const t61 = this.tile.surface.layerViewByIndex(l48, A34.ELEVATION);
        if (u17(this.tile, t61.layer, false)) {
          const t62 = i67.data;
          e59 && e59[a58] === t62.samplerData || (n73 = true), s63[a58++] = t62.samplerData, o61 = this.tile.level;
        }
      }
    }
    return r(e59) && e59.length !== a58 && (n73 = true), a58 > 0 ? s63.length = a58 : s63 = null, { changed: n73, samplerData: s63, maxTileLevel: o61 };
  }
  get estimatedGeometryMemoryUsage() {
    const e59 = E(this.intersectionData, 0, (e60) => e60.estimatedMemoryUsage);
    return this.geometryInfo.indices.byteLength + this.geometryInfo.vertexAttributes.byteLength + e59;
  }
  get textureDescriptor() {
    return r(this._texture) ? this._texture.descriptor : null;
  }
  get test() {
    return { hasTexture: null != this._texture };
  }
  checkGeometryWaterproofness() {
  }
};
T23.updatedGeometryTiles = /* @__PURE__ */ new Map(), T23.deferTileNeighborUpdate = false, T23.neighborTilesToUpdate = /* @__PURE__ */ new Set();

// node_modules/@arcgis/core/views/3d/terrain/PatchGeometryFactory.js
var D16 = 65536;
function O27(e59, t60) {
  const n73 = e59.tile, { extent: s63, extentInRadians: l48, surface: u51 } = n73, d32 = e59.localOrigin, m40 = e59.geometryState, b23 = u51.isWebMercator, M22 = u51.shadingEnabled, v36 = m40.numVerticesPerSide, D21 = v36 - 1, O33 = (v36 - 2) ** 2, V17 = b23 && (t60 === O7.HAS_SOUTH_POLE || t60 === O7.HAS_BOTH_POLES), A39 = b23 && (t60 === O7.HAS_NORTH_POLE || t60 === O7.HAS_BOTH_POLES), P22 = 6, B18 = ((V17 ? 1 : 0) + (A39 ? 1 : 0)) * P22 * (D21 + 1), w25 = m40.neighborData, I27 = w25.edgeResolutions.reduce((e60, t61) => e60 + t61 + 1, 0), L31 = b18(O33 + B18 + I27), T29 = e59.geometryInfo;
  T29.numVerticesPerSide = m40.numVerticesPerSide, T29.vertexAttributes = L31, r8(T29.uvOffsetAndScale, 0, 0, 1, 1);
  const U26 = L31.position.typedBuffer, N23 = L31.uv0.typedBuffer, j36 = L31.normal.typedBuffer, Z11 = T29.boundingBox;
  B(Z11);
  const C25 = d32[0], H20 = d32[1], W16 = d32[2];
  ge5.update(D21, l48);
  let _30 = 0;
  const X9 = m40.samplerData, q18 = n73.ellipsoid.radius, k32 = ee4(e59), G21 = v36 - 2, z20 = s63[0], F21 = s63[2], J13 = s63[1], Q15 = s63[3];
  if ((() => {
    for (let e60 = 1; e60 <= G21; e60++) {
      const t61 = e60 / D21, n74 = J13 * (1 - t61) + Q15 * t61, o61 = k32(t61), r59 = Math.cos(o61), a58 = Math.sin(o61);
      for (let e61 = 1; e61 <= G21; e61++) {
        const o62 = e61 / D21, s64 = z20 * (1 - o62) + F21 * o62, i66 = ge5.sinLonLUT[e61], c67 = ge5.cosLonLUT[e61], l49 = q18 + h36(s64, n74, X9), u52 = c67 * r59 * l49 - C25, f37 = i66 * r59 * l49 - H20, g45 = a58 * l49 - W16;
        ue5(u52, f37, g45, Z11);
        const d33 = H5 * _30;
        U26[d33 + 0] = u52, U26[d33 + 1] = f37, U26[d33 + 2] = g45, N23[d33 + 0] = o62, N23[d33 + 1] = t61, ++_30;
      }
    }
  })(), M22) {
    (() => {
      const t61 = (e60) => (e7(xe3, e60, Se3), _(pe5, xe3, ye5), _(be2, pe5, xe3), be2), n74 = L31.position, s64 = L31.normal;
      _30 = 0;
      const l49 = (e60) => {
        n74.getVec(e60, he7), u3(ve3, ve3, t61(he7));
      }, u52 = (e60, n75) => {
        {
          const t62 = e60 / D21, r59 = z20 * (1 - t62) + F21 * t62, a58 = ge5.sinLonLUT[e60], s65 = ge5.cosLonLUT[e60], i66 = n75 / D21, c67 = J13 * (1 - i66) + Q15 * i66, l50 = k32(i66), u53 = Math.cos(l50), f38 = Math.sin(l50), g45 = q18 + h36(r59, c67, X9);
          o3(he7, s65 * u53 * g45 - C25, a58 * u53 * g45 - H20, f38 * g45 - W16);
        }
        u3(ve3, ve3, t61(he7));
      }, f37 = (e60, t62, n75) => {
        e60 > 1 && t62 > 1 && e60 < G21 && t62 < G21 ? l49(_30 + n75) : u52(e60, t62);
      };
      for (let i66 = 1; i66 <= G21; i66++)
        for (let t62 = 1; t62 <= G21; t62++)
          n74.getVec(_30, Se3), u3(Me3, Se3, e59.localOrigin), z2(ye5, Me3), o3(ve3, 0, 0, 0), f37(t62 - 1, i66, -1), f37(t62 + 1, i66, 1), f37(t62, i66 - 1, -G21), f37(t62, i66 + 1, +G21), z2(ve3, ve3), s64.setVec(_30, ve3), ++_30;
    })();
  }
  _30 = O33, E31(e59, O33), Y7(e59), _30 = O33 + I27;
  const $12 = [];
  (() => {
    const e60 = (e61, t61) => {
      const n74 = t61 * v36;
      ue5(-C25, -H20, e61 * q18 - W16, Z11), $12.push({ connectedRowOffset: n74, connectedOuterEdgeOffset: 1 === e61 ? 0 : 2, rowOffset: _30, latitudeResolution: P22 });
      const o61 = K9(-1 === e61 ? J13 : Q15, q18), r59 = e61 * Math.PI / 2 - o61, a58 = 0.99 * (1 === e61 ? 1 : -1), s64 = q18 + 0;
      for (let i66 = 1; i66 <= P22; ++i66) {
        const e62 = o61 + r59 * (i66 / P22), t62 = Math.cos(e62), n75 = Math.sin(e62);
        for (let o62 = 0; o62 <= D21; o62++) {
          const e63 = o62 / D21, r60 = ge5.sinLonLUT[o62], i67 = ge5.cosLonLUT[o62] * t62 * s64 - C25, c67 = r60 * t62 * s64 - H20, l49 = n75 * s64 - W16;
          ue5(i67, c67, l49, Z11);
          const u52 = H5 * _30;
          if (U26[u52 + 0] = i67, U26[u52 + 1] = c67, U26[u52 + 2] = l49, N23[u52 + 0] = e63, N23[u52 + 1] = a58, M22) {
            const e64 = 1 / Math.sqrt(i67 * i67 + c67 * c67 + l49 * l49);
            j36[u52 + 0] = e64 * i67, j36[u52 + 1] = e64 * c67, j36[u52 + 2] = e64 * l49;
          }
          ++_30;
        }
      }
    };
    V17 && e60(-1, 0), A39 && e60(1, D21);
  })(), R16(T29, m40.numVerticesPerSide, $12, [0, v36 - 1], [0, v36 - 1], m40.wireframe), e59.intersectionData = null;
  for (let o61 = 0; o61 < 4; ++o61)
    E13(T29.outerEdges[o61].count === w25.edgeResolutions[o61] + 1);
}
function V14(n73, o61) {
  const r59 = n73.tile, a58 = r59.extent, s63 = n73.localOrigin, i66 = n73.geometryState, c67 = r59.surface, l48 = c67.isWebMercatorOnPlateeCarree, u51 = c67.shadingEnabled, m40 = a58[0], x30 = a58[1], b23 = a58[2] - m40, M22 = a58[3] - x30, y33 = i66.clippingArea, v36 = r(y33) ? Math.max(0, (y33[0] - a58[0]) / b23) : 0, D21 = r(y33) ? Math.max(0, (y33[1] - a58[1]) / M22) : 0, O33 = r(y33) ? Math.min(1, (y33[2] - a58[0]) / b23) : 1, V17 = r(y33) ? Math.min(1, (y33[3] - a58[1]) / M22) : 1, A39 = O33 - v36, P22 = V17 - D21, B18 = A39 > 0 ? 1 / A39 : 1, w25 = P22 > 0 ? 1 / P22 : 1, L31 = -v36 * B18, T29 = -D21 * w25, U26 = i66.numVerticesPerSide, N23 = U26 - 1, Z11 = (U26 - 2) ** 2 + i66.neighborData.edgeResolutions.reduce((e59, t60) => e59 + t60 + 1, 0), C25 = b18(Z11), H20 = C25.position.typedBuffer, W16 = C25.uv0.typedBuffer, _30 = C25.normal.typedBuffer, X9 = n73.geometryInfo, Y8 = X9.boundingBox;
  B(Y8);
  let q18 = 0;
  const k32 = r59.ellipsoid.radius, G21 = i66.samplerData, z20 = r(y33) ? y33 : de5, F21 = o5(Math.max(a58[0], z20[0]), Math.max(a58[1], z20[1]), Math.min(a58[2], z20[2]), Math.min(a58[3], z20[3])), J13 = s63[0], K13 = s63[1], Q15 = s63[2], $12 = j33(l48, k32, o61);
  (() => {
    for (let t60 = 1; t60 <= N23 - 1; t60++) {
      const n74 = t60 / N23, r60 = T29 + n74 * w25, a59 = o4(x30 + n74 * M22, F21[1], F21[3]), s64 = o4(r60, 0, 1), i67 = $12(a59) - K13, c68 = b23 / N23;
      for (let t61 = 1; t61 <= N23 - 1; t61++) {
        const n75 = t61 / N23, r61 = L31 + n75 * B18, l49 = o4(m40 + n75 * b23, F21[0], F21[2]), f37 = o4(r61, 0, 1), g45 = h36(l49, a59, G21), d32 = l49 * o61 - J13, x31 = g45 - Q15;
        ue5(d32, i67, x31, Y8);
        const p52 = H5 * q18;
        if (H20[p52 + 0] = d32, H20[p52 + 1] = i67, H20[p52 + 2] = x31, W16[p52 + 0] = f37, W16[p52 + 1] = s64, u51) {
          const e59 = h36(l49 + c68, a59, G21), t62 = h36(l49 - c68, a59, G21), n76 = h36(l49, a59 + c68, G21), o62 = 0.25 * (t62 - e59), r62 = 0.25 * (h36(l49, a59 - c68, G21) - n76), s65 = c68, i68 = Math.sqrt(o62 * o62 + r62 * r62 + s65 * s65);
          _30[p52 + 0] = o62 / i68, _30[p52 + 1] = r62 / i68, _30[p52 + 2] = s65 / i68;
        }
        ++q18;
      }
    }
  })(), X9.numVerticesPerSide = i66.numVerticesPerSide, X9.vertexAttributes = C25, r8(n73.geometryInfo.uvOffsetAndScale, v36, D21, O33 - v36, V17 - D21), E31(n73, q18), I21(n73, o61), q18 = Z11, R16(X9, i66.numVerticesPerSide, [], [0, U26 - 1], [0, U26 - 1], i66.wireframe), n73.intersectionData = null;
}
function R16(e59, t60, n73, o61, r59, a58) {
  const s63 = t60 - 1, i66 = e59.vertexAttributes.count, c67 = 2 * (Math.min(t60 - 2, o61[1]) - Math.max(1, o61[0])) * (Math.min(t60 - 2, r59[1]) - Math.max(1, r59[0])), l48 = Y2.map((e60, n74) => 0 === n74 && r59[1] < t60 - 2 || 1 === n74 && o61[1] < t60 - 2 || 2 === n74 && r59[0] > 1 || 3 === n74 && o61[0] > 1), u51 = 3 * (c67 + e59.outerEdges.reduce((e60, t61, n74) => e60 + (l48[n74] ? 0 : s63 - 2 + t61.count - 1), 0) + n73.reduce((e60, t61) => e60 + s63 * (2 * (t61.latitudeResolution - 1) + 1), 0)) * (a58 ? 2 : 1), f37 = new (i66 > D16 ? Uint32Array : Uint16Array)(u51);
  let g45 = 0;
  const d32 = a58 ? (e60, t61, n74) => {
    f37[g45++] = e60, f37[g45++] = t61, f37[g45++] = t61, f37[g45++] = n74, f37[g45++] = n74, f37[g45++] = e60;
  } : (e60, t61, n74) => {
    f37[g45++] = e60, f37[g45++] = t61, f37[g45++] = n74;
  }, m40 = t60 - 2, h44 = s63 - 2;
  (() => {
    for (let e60 = Math.max(r59[0], 1) - 1; e60 < Math.min(r59[1], t60 - 2) - 1; ++e60)
      for (let n74 = Math.max(o61[0], 1) - 1; n74 < Math.min(o61[1], t60 - 2) - 1; ++n74) {
        const t61 = e60 * m40 + n74, o62 = t61 + 1, r60 = o62 + m40, a59 = r60 - 1;
        d32(t61, o62, r60), d32(r60, a59, t61);
      }
  })();
  (() => {
    for (let t61 = 0; t61 < 4; ++t61) {
      if (l48[t61])
        continue;
      const n74 = e59.outerEdges[t61], o62 = e59.innerEdges[t61];
      let r60 = 0, a59 = 0;
      const i67 = n74.count, c68 = o62.count;
      n74.count;
      const u52 = 1 === t61 || 2 === t61 ? (e60, t62, n75) => d32(e60, t62, n75) : (e60, t62, n75) => d32(e60, n75, t62);
      for (; r60 < i67 - 1 || a59 < c68 - 1; ) {
        const e60 = o62.getVertexOffset(a59), t62 = n74.getVertexOffset(r60), l49 = r60 < i67 - 1, f38 = a59 < c68 - 1, g46 = l49 ? 0 + s63 * (r60 + 0.5) / (i67 - 1) : 0, d33 = f38 ? 1 + h44 * (a59 + 0.5) / (c68 - 1) : 0;
        if (l49 && (!f38 || g46 <= d33)) {
          ++r60;
          u52(e60, t62, n74.getVertexOffset(r60));
        } else {
          ++a59;
          u52(e60, t62, o62.getVertexOffset(a59));
        }
      }
    }
  })();
  const x30 = (n74) => {
    let o62 = e59.outerEdges[n74.connectedOuterEdgeOffset].offset0;
    for (let e60 = 0; e60 < n74.latitudeResolution; ++e60) {
      const r60 = 0 === e60 ? n74.rowOffset : o62 + t60;
      for (let t61 = 0; t61 < s63; t61++)
        d32(o62, o62 + 1, r60 + t61), e60 < n74.latitudeResolution - 1 && d32(o62 + 1, r60 + t61 + 1, r60 + t61), ++o62;
      o62 = r60;
    }
  };
  (() => {
    n73.forEach(x30);
  })(), e59.indices = f37, e59.indexCount = u51;
}
function E31(e59, t60) {
  const n73 = e59.localOrigin, o61 = e59.geometryInfo, r59 = e59.geometryState.neighborData.edgeResolutions, a58 = o61.numVerticesPerSide - 2, s63 = o61.vertexAttributes.position.typedBuffer;
  let i66 = t60;
  for (let c67 = 0; c67 < 4; ++c67) {
    {
      const e60 = 0 === c67 || 2 === c67, t61 = (0 === c67 ? a58 - 1 : 0) * a58 + (1 === c67 ? a58 - 1 : 0), r60 = (e60 ? 0 : 1) * a58 + (e60 ? 1 : 0);
      o61.innerEdges[c67] = new n58(s63, n73, t61, r60, a58);
    }
    {
      const e60 = i66, t61 = r59[c67] + 1;
      o61.outerEdges[c67] = new n58(s63, n73, e60, 1, t61), i66 += t61;
    }
  }
}
function A35(e59) {
  var _a, _b;
  H17(e59), te4(e59);
  const t60 = e59.vao, n73 = e59.geometryInfo.vertexAttributes;
  (_b = (_a = t60 == null ? void 0 : t60.vertexBuffers) == null ? void 0 : _a.geometry) == null ? void 0 : _b.setSubData(n73.position.typedBuffer);
}
function P18(e59) {
  Y7(e59), X7(e59);
}
function B12(e59, t60) {
  W13(e59, t60), ne5(e59, t60), X7(e59);
}
function w21(e59, t60) {
  I21(e59, t60), X7(e59);
}
function I21(e59, t60) {
  W13(e59, t60), k28(e59, t60), ne5(e59, t60);
}
function L27(e59, t60, n73, o61, r59) {
  const a58 = Math.cos(n73), s63 = Math.sin(n73), i66 = Math.sin(t60), c67 = Math.cos(t60), l48 = r59 + o61;
  e59[0] = c67 * a58 * l48, e59[1] = i66 * a58 * l48, e59[2] = s63 * l48;
}
function T24(e59, t60, n73, o61, r59, a58) {
  const s63 = r59[0 === n73 ? 1 : 3];
  L27(e59, r59[0 === t60 ? 0 : 2], s63, o61, a58);
}
function U23(e59, t60) {
  return (Math.PI / 2 - 2 * Math.atan(Math.exp(-e59 / t60))) * t60;
}
function N16(e59, t60) {
  return e59 * t60;
}
function j33(e59, t60, n73) {
  return e59 ? (e60) => U23(e60, t60) : (e60) => N16(e60, n73);
}
function Z9(e59, t60, n73, o61, r59, a58, s63) {
  const i66 = 0 === t60 ? r59[0] : r59[2], c67 = 0 === n73 ? r59[1] : r59[3], l48 = o61;
  e59[0] = i66 * a58, e59[1] = s63(c67), e59[2] = l48;
}
function C21(o61, r59) {
  const a58 = o61.geometryState, s63 = o61.tile, i66 = s63.extent, c67 = c(a58.clippingArea, i66), l48 = o61.geometryInfo, u51 = l48.boundingBox, f37 = l48.outerEdges, g45 = a58.neighborData.cornerNeighborData, d32 = l48.uvOffsetAndScale[0], m40 = l48.uvOffsetAndScale[1], x30 = l48.uvOffsetAndScale[2], p52 = l48.uvOffsetAndScale[3], b23 = x30 > 0 ? 1 / x30 : 1, M22 = p52 > 0 ? 1 / p52 : 1, S25 = -d32 * b23, y33 = -m40 * M22, v36 = s63.surface.isWebMercatorOnPlateeCarree, D21 = j33(v36, v36 ? s63.ellipsoid.radius : 0, r59), O33 = a58.samplerData, V17 = a58.neighborData.edgeNeighbours, R21 = o61.localOrigin, E39 = (n73, o62, a59, l49, f38) => {
    const d33 = i66[0] * (1 - l49) + i66[2] * l49, m41 = i66[1] * (1 - f38) + i66[3] * f38, x31 = o4(d33, c67[0], c67[2]), p53 = o4(m41, c67[1], c67[3]), v37 = [p53 === i66[3], x31 === i66[2], p53 === i66[1], x31 === i66[0]], E40 = !v37[3] && !v37[1] || !v37[0] && !v37[2], A39 = E40 ? v37[0] && r(V17[0]) ? V17[0] : v37[1] && r(V17[1]) ? V17[1] : v37[2] && r(V17[2]) ? V17[2] : v37[3] && r(V17[3]) ? V17[3] : null : null, P22 = E40 ? A39 ? A39.neighborTile.level === s63.level ? 0.5 * (h36(x31, p53, O33) + h36(x31, p53, A39.neighborSamplerData)) : h36(x31, p53, A39.neighborSamplerData) : h36(x31, p53, O33) : g45[a59].elevation, B18 = x31 * r59 - R21[0], w25 = D21(p53) - R21[1], I27 = P22 - R21[2];
    ue5(B18, w25, I27, u51);
    const L31 = o4(S25 + l49 * b23, 0, 1), T29 = o4(y33 + f38 * M22, 0, 1);
    n73.setVertexRawXYZUV(o62, B18, w25, I27, L31, T29);
  };
  for (let e59 = 0; e59 < 4; ++e59) {
    const t60 = f37[e59];
    E39(t60, 0, 0 === e59 ? 3 : 1 === e59 ? 1 : 2, 1 === e59 ? 1 : 0, 0 === e59 ? 1 : 0);
    const n73 = 2 === e59 ? 1 : 3 === e59 ? 3 : 0, o62 = 3 === e59 ? 0 : 1, r60 = 2 === e59 ? 0 : 1;
    E39(t60, t60.count - 1, n73, o62, r60);
  }
}
function H17(e59) {
  _25(e59, (t60, n73, o61, r59) => T24(t60, n73, o61, r59, e59.tile.extentInRadians, e59.tile.ellipsoid.radius));
}
function W13(e59, n73) {
  const o61 = e59.tile;
  r(o61.renderData.geometryState.clippingArea) ? C21(e59, n73) : _25(e59, (t60, r59, a58, s63) => Z9(t60, r59, a58, s63, e59.tile.extent, n73, j33(o61.surface.isWebMercatorOnPlateeCarree, o61.ellipsoid.radius, n73)));
}
function _25(e59, t60) {
  const n73 = e59.geometryInfo, o61 = n73.outerEdges, r59 = e59.geometryState.neighborData.cornerNeighborData, a58 = n73.boundingBox, s63 = e59.localOrigin, i66 = (e60, n74, o62, i67, c67) => {
    t60(me5, o62, i67, r59[n74].elevation);
    for (let t61 = 0; t61 < 3; ++t61)
      me5[t61] -= s63[t61];
    ue5(me5[0], me5[1], me5[2], a58), e60.setVertexRawXYZUV(c67, me5[0], me5[1], me5[2], o62, i67);
  };
  for (let c67 = 0; c67 < 4; ++c67) {
    const e60 = o61[c67];
    i66(e60, 0 === c67 ? 3 : 1 === c67 ? 1 : 2, 1 === c67 ? 1 : 0, 0 === c67 ? 1 : 0, 0);
    i66(e60, 2 === c67 ? 1 : 3 === c67 ? 3 : 0, 3 === c67 ? 0 : 1, 2 === c67 ? 0 : 1, e60.count - 1);
  }
}
function X7(e59) {
  var _a, _b;
  const t60 = e59.vao, n73 = e59.geometryInfo.vertexAttributes;
  (_b = (_a = t60 == null ? void 0 : t60.vertexBuffers) == null ? void 0 : _a.geometry) == null ? void 0 : _b.setSubData(n73.position.typedBuffer);
}
function Y7(e59) {
  H17(e59);
  for (let t60 = 0; t60 < 4; ++t60)
    q14(e59, t60);
  te4(e59);
}
function q14(e59, t60) {
  var _a, _b;
  const n73 = e59.geometryState, c67 = n73.neighborData, l48 = e59.tile;
  l48.level;
  const f37 = l48.extent, g45 = f37[2] - f37[0], d32 = f37[3] - f37[1], m40 = l48.extentInRadians, x30 = m40[0];
  m40[1];
  const p52 = m40[2];
  m40[3];
  const b23 = l48.ellipsoid.radius, M22 = ee4(e59), y33 = (e60) => {
    if (!e60)
      return 0;
    const t61 = D21, n74 = O33 ? 0 : 1, o61 = e60.lij[n74 + 1] * L31, r59 = l48.lij[n74 + 1] - o61;
    return (O33 ? L31 - 1 - r59 : r59) * t61;
  }, v36 = c67.edgeNeighbours[t60], D21 = c67.edgeResolutions[t60], O33 = 1 === t60 || 3 === t60, V17 = 1 === t60 ? 1 : 0, R21 = 0 === t60 ? 1 : 0, E39 = f37[0] + V17 * g45, A39 = f37[1] + R21 * d32, P22 = x30 * (1 - V17) + p52 * V17, B18 = M22(R21), w25 = v36 == null ? void 0 : v36.neighborTile, I27 = l48.level - ((w25 == null ? void 0 : w25.level) ?? l48.level), L31 = 2 ** I27, T29 = D21 * L31, U26 = y33(w25), N23 = w25 == null ? void 0 : w25.extent, j36 = (t60 + 2) % 4, Z11 = n73.samplerData, C25 = (_b = (_a = w25 == null ? void 0 : w25.renderData) == null ? void 0 : _a.geometryState) == null ? void 0 : _b.samplerData, H20 = w25 && 0 === I27, W16 = (e60, t61, n74, o61) => 0.5 * (h36(e60, t61, C25) + h36(n74, o61, Z11)), _30 = (e60, t61) => h36(e60, t61, C25), X9 = H20 ? W16 : _30;
  let Y8 = N23 ? 1 === j36 ? N23[2] : N23[0] : E39, q18 = N23 ? 0 === j36 ? N23[3] : N23[1] : A39;
  const k32 = (e60, t61, n74) => {
    const o61 = (U26 + e60) / T29;
    return q18 = N23[1] * (1 - o61) + N23[3] * o61, X9(Y8, q18, t61, n74);
  }, G21 = (e60, t61, n74) => {
    const o61 = (U26 + e60) / T29;
    return Y8 = N23[0] * (1 - o61) + N23[2] * o61, X9(Y8, q18, t61, n74);
  }, z20 = w25 ? O33 ? k32 : G21 : (e60, t61, n74) => h36(t61, n74, Z11), F21 = (e60, t61, n74) => z20(e60, t61, n74);
  let J13 = V17, K13 = E39, Q15 = P22, $12 = R21, te6 = A39, ne7 = B18, oe10 = Math.sin(Q15), re5 = Math.cos(Q15), ae7 = Math.cos(ne7), se5 = Math.sin(ne7);
  const ie6 = O33 ? () => M22($12) : () => B18, ce10 = O33 ? (e60) => {
    $12 = e60, te6 = f37[1] * (1 - e60) + f37[3] * e60, ne7 = ie6(), ae7 = Math.cos(ne7), se5 = Math.sin(ne7);
  } : (e60) => {
    J13 = e60, K13 = f37[0] * (1 - e60) + f37[2] * e60, Q15 = x30 * (1 - J13) + p52 * J13, oe10 = Math.sin(Q15), re5 = Math.cos(Q15);
  }, le8 = e59.geometryInfo, fe6 = le8.boundingBox, ge8 = le8.vertexAttributes, de8 = ge8.position.typedBuffer, me8 = ge8.uv0.typedBuffer, Se4 = ge8.normal.typedBuffer, De3 = le8.outerEdges[t60];
  let Oe3 = De3.getVertexOffset(1);
  const Ve3 = D21 + 1, Re4 = e59.localOrigin, Ee2 = Re4[0], Ae3 = Re4[1], Pe3 = Re4[2], Be2 = l48.surface.shadingEnabled, we3 = 1 === t60 ? -1 : 3 === t60 ? 1 : 0, Ie2 = 0 === t60 ? -1 : 2 === t60 ? 1 : 0, Le2 = g45 / D21, Te3 = we3 * Le2, Ue2 = Ie2 * Le2, Ne2 = we3 * (1 / D21), je3 = Ie2 * (1 / D21), Ze3 = (e60) => {
    J(xe3, e60, Me3), _(pe5, xe3, ye5), _(be2, pe5, xe3), u3(ve3, ve3, be2);
  };
  for (let a58 = 1; a58 < Ve3 - 1; ++a58) {
    ce10(a58 / D21);
    const e60 = F21(a58, K13, te6), t61 = b23 + e60, n74 = re5 * ae7 * t61, s63 = oe10 * ae7 * t61, i66 = se5 * t61, c68 = n74 - Ee2, l49 = s63 - Ae3, f38 = i66 - Pe3;
    ue5(c68, l49, f38, fe6);
    const g46 = H5 * Oe3;
    if (de8[g46 + 0] = c68, de8[g46 + 1] = l49, de8[g46 + 2] = f38, me8[g46 + 0] = J13, me8[g46 + 1] = $12, Be2) {
      o3(ve3, 0, 0, 0), o3(Me3, n74, s63, i66), z2(ye5, Me3);
      const e61 = (e62, t62) => {
        const n75 = h36(K13 + e62 * Te3, te6 + e62 * Ue2, t62), o61 = b23 + n75, r59 = J13 + e62 * Ne2, a59 = x30 * (1 - r59) + p52 * r59, s64 = Math.sin(a59), i67 = Math.cos(a59), c69 = M22($12 + e62 * je3), l50 = Math.sin(c69), f39 = Math.cos(c69), g47 = r6(i67 * f39 * o61, s64 * f39 * o61, l50 * o61);
        Ze3(g47);
      };
      w25 && e61(-1, C25), w25 && !H20 || e61(1, Z11), Se4[g46 + 0] = ve3[0], Se4[g46 + 1] = ve3[1], Se4[g46 + 2] = ve3[2];
    }
    ++Oe3;
  }
  if (Be2)
    for (let o61 = 1; o61 < Ve3 - 1; ++o61)
      De3.getVertexRawNormal(ve3, o61), De3.getVertex(Me3, o61), z2(ye5, Me3), De3.getVertex(he7, o61 - 1), Ze3(he7), De3.getVertex(he7, o61 + 1), Ze3(he7), z2(ve3, ve3), De3.setVertexRawNormal(o61, ve3[0], ve3[1], ve3[2]);
}
function k28(e59, n73) {
  const o61 = e59.geometryState.clippingArea, r59 = e59.tile.extent, a58 = r(o61) && (r59[0] < o61[0] || r59[2] > o61[2] || r59[1] < o61[1] || r59[3] > o61[3]) ? J11 : F16;
  for (let t60 = 0; t60 < 4; ++t60)
    a58(e59, t60, n73);
}
function G17(e59, t60, n73, o61, r59, a58, s63) {
  return s63 === r59 ? !e59 || t60 ? (e60, t61) => h36(e60, t61, n73) : null : s63 === a58 ? e59 ? (e60, t61) => h36(e60, t61, o61) : null : null;
}
function z18(e59, t60, n73, o61) {
  if (t60 !== e59)
    return () => 0;
  const r59 = t60 ? 3 : 2, a58 = t60 ? 1 : 0, s63 = o61(r59, a58), i66 = o61(a58, r59), c67 = (null != s63 ? 1 : 0) + (null != i66 ? 1 : 0), l48 = t60 ? n73 : 0, u51 = t60 ? 0 : n73;
  return (e60, t61, n74) => ((null != s63 ? -(s63(e60 + l48, t61 + u51) - n74) : 0) + (null != i66 ? +(i66(e60 - l48, t61 - u51) - n74) : 0)) / c67;
}
function F16(e59, n73, o61) {
  const r59 = e59.geometryState.neighborData, a58 = r59.edgeNeighbours, s63 = e59.tile, i66 = s63.level, c67 = s63.surface, l48 = c67.shadingEnabled, u51 = a58[n73], f37 = r59.edgeResolutions[n73], g45 = f37, d32 = s63.extent, m40 = e59.geometryState, x30 = g45 + 1, p52 = u51, b23 = e59.localOrigin, M22 = m40.samplerData, S25 = (e60, t60) => h36(e60, t60, M22), y33 = (e60, t60) => 0.5 * (h36(e60, t60, p52.neighborSamplerData) + h36(e60, t60, M22)), v36 = (e60, t60) => h36(e60, t60, p52.neighborSamplerData), D21 = (p52 == null ? void 0 : p52.neighborTile.level) === i66, O33 = D21 ? y33 : v36, V17 = r(p52) ? O33 : S25, R21 = e59.geometryInfo, E39 = R21.outerEdges[n73], A39 = j33(c67.isWebMercatorOnPlateeCarree, s63.ellipsoid.radius, o61), P22 = R21.boundingBox, B18 = 1 === n73 || 3 === n73, w25 = 1 === n73 ? d32[2] : d32[0], I27 = 0 === n73 ? d32[3] : d32[1], L31 = 1 === n73 ? 1 : 0, T29 = 0 === n73 ? 1 : 0, U26 = (d32[2] - d32[0]) / f37, N23 = p52 == null ? void 0 : p52.neighborSamplerData, Z11 = r(p52), C25 = (e60, t60) => G17(Z11, D21, M22, N23, e60, t60, n73), H20 = z18(B18, true, U26, C25), W16 = z18(B18, false, U26, C25);
  for (let t60 = 1; t60 < x30 - 1; ++t60) {
    const e60 = t60 / g45, n74 = B18 ? w25 : d32[0] * (1 - e60) + d32[2] * e60, r60 = B18 ? d32[1] * (1 - e60) + d32[3] * e60 : I27, a59 = B18 ? L31 : e60, s64 = B18 ? e60 : T29, i67 = V17(n74, r60), c68 = n74 * o61 - b23[0], u52 = A39(r60) - b23[1], f38 = i67 - b23[2];
    if (ue5(c68, u52, f38, P22), l48) {
      const e61 = H20(n74, r60, i67), o62 = W16(n74, r60, i67), l49 = U26;
      E39.setVertexRawXYZUVN(t60, c68, u52, f38, a59, s64, e61, o62, l49);
    } else
      E39.setVertexRawXYZUV(t60, c68, u52, f38, a59, s64);
  }
  if (l48) {
    const e60 = B18 ? 0 : 1, t60 = B18 ? 1 : 0;
    for (let n74 = 1; n74 < x30 - 1; ++n74) {
      E39.getNormal(De2, n74);
      const o62 = E39.getVertexZ(n74 - 1) - E39.getVertexZ(n74 + 1), r60 = De2[0] + 0.5 * e60 * o62, a59 = De2[1] + 0.5 * t60 * o62, s64 = 2 * U26, i67 = 1 / Math.sqrt(r60 * r60 + a59 * a59 + s64 * s64);
      E39.setVertexRawNormal(n74, i67 * r60, i67 * a59, i67 * s64);
    }
  }
}
function J11(o61, r59, a58) {
  const s63 = o61.geometryState.neighborData, i66 = s63.edgeNeighbours, c67 = o61.tile, l48 = c67.level, u51 = c67.surface, f37 = u51.shadingEnabled, g45 = i66[r59], d32 = s63.edgeResolutions[r59], m40 = d32, x30 = c67.extent, p52 = o61.geometryState, b23 = c(p52.clippingArea, de5), M22 = o61.geometryInfo, S25 = M22.uvOffsetAndScale[0], y33 = M22.uvOffsetAndScale[1], v36 = S25 + M22.uvOffsetAndScale[2], D21 = y33 + M22.uvOffsetAndScale[3], O33 = v36 > S25 ? 1 / (v36 - S25) : 1, V17 = D21 > y33 ? 1 / (D21 - y33) : 1, R21 = -S25 * O33, E39 = -y33 * V17, A39 = m40 + 1, P22 = [x30[3] > b23[3], x30[2] > b23[2], x30[1] < b23[1], x30[0] < b23[0]], B18 = g45, w25 = p52.samplerData, I27 = (e59, t60) => h36(e59, t60, w25), L31 = (B18 == null ? void 0 : B18.neighborTile.level) === l48, T29 = (e59, t60) => {
    const n73 = h36(e59, t60, B18.neighborSamplerData);
    return L31 ? 0.5 * (n73 + h36(e59, t60, w25)) : n73;
  }, U26 = I27, N23 = r(B18) ? T29 : I27, Z11 = P22[r59] ? U26 : N23, C25 = M22.outerEdges[r59], H20 = M22.boundingBox, W16 = 1 === r59 || 3 === r59, _30 = o4(1 === r59 ? x30[2] : x30[0], b23[0], b23[2]), X9 = o4(0 === r59 ? x30[3] : x30[1], b23[1], b23[3]), Y8 = 1 === r59 ? 1 : 0, q18 = 0 === r59 ? 1 : 0, k32 = o61.localOrigin, F21 = j33(u51.isWebMercatorOnPlateeCarree, c67.ellipsoid.radius, a58), J13 = (x30[2] - x30[0]) / d32, K13 = B18 == null ? void 0 : B18.neighborSamplerData, Q15 = r(B18), $12 = (B18 == null ? void 0 : B18.neighborTile.level) === l48, ee6 = (e59, t60) => G17(Q15, $12, w25, K13, e59, t60, r59), te6 = z18(W16, true, J13, ee6), ne7 = z18(W16, false, J13, ee6);
  for (let t60 = 1; t60 < A39 - 1; ++t60) {
    const n73 = t60 / m40, o62 = W16 ? _30 : o4(x30[0] * (1 - n73) + x30[2] * n73, b23[0], b23[2]), r60 = W16 ? o4(x30[1] * (1 - n73) + x30[3] * n73, b23[1], b23[3]) : X9, s64 = W16 ? Y8 : o4(R21 + n73 * O33, 0, 1), i67 = W16 ? o4(E39 + n73 * V17, 0, 1) : q18, c68 = Z11(o62, r60), l49 = o62 * a58 - k32[0], u52 = F21(r60) - k32[1], g46 = c68 - k32[2];
    if (ue5(l49, u52, g46, H20), f37) {
      const e59 = te6(o62, r60, c68), n74 = ne7(o62, r60, c68), a59 = J13;
      C25.setVertexRawXYZUVN(t60, l49, u52, g46, s64, i67, e59, n74, a59);
    } else
      C25.setVertexRawXYZUV(t60, l49, u52, g46, s64, i67);
  }
  if (f37) {
    const e59 = W16 ? 0 : 1, t60 = W16 ? 1 : 0;
    for (let n73 = 1; n73 < A39 - 1; ++n73) {
      C25.getNormal(De2, n73);
      const o62 = C25.getVertexZ(n73 - 1) - C25.getVertexZ(n73 + 1), r60 = De2[0] + 0.5 * e59 * o62, a59 = De2[1] + 0.5 * t60 * o62, s64 = 2 * J13, i67 = 1 / Math.sqrt(r60 * r60 + a59 * a59 + s64 * s64);
      C25.setVertexRawNormal(n73, i67 * r60, i67 * a59, i67 * s64);
    }
  }
}
function K9(e59, t60) {
  return Math.PI / 2 - 2 * Math.atan(Math.exp(-e59 / t60));
}
function Q13(e59, t60, n73, o61) {
  return K9(e59 + o61 * (t60 - e59), n73);
}
function $10(e59, t60, n73) {
  return e59 * (1 - n73) + t60 * n73;
}
function ee4(e59) {
  const t60 = e59.tile;
  if (t60.surface.isWebMercator) {
    const e60 = t60.extent, n74 = t60.ellipsoid.radius;
    return (t61) => Q13(e60[1], e60[3], n74, t61);
  }
  const n73 = t60.extentInRadians;
  return (e60) => $10(n73[1], n73[3], e60);
}
function te4(e59) {
  e59.tile.surface.shadingEnabled && le5(e59, (e60, t60, n73, o61, r59, a58, s63) => oe5(t60, e60, n73, o61, r59, a58, s63));
}
function ne5(e59, t60) {
  e59.tile.surface.shadingEnabled && le5(e59, (n73, o61, r59, a58, s63, i66, c67) => re4(se4(e59, t60), n73, r59, s63, i66, c67));
}
function oe5(e59, t60, n73, o61, r59, a58, c67) {
  ae4(e59, he7, r59, a58, c67), J(xe3, he7, n73), _(pe5, xe3, o61), _(t60, pe5, xe3);
}
function re4(e59, t60, n73, o61, r59, a58) {
  e59(he7, o61, r59, a58);
  const s63 = he7[0] - n73[0], i66 = he7[1] - n73[1], c67 = he7[2] - n73[2];
  t60[0] = -s63 * c67, t60[1] = -i66 * c67, t60[2] = s63 * s63 + i66 * i66;
}
function ae4(e59, t60, n73, o61, r59) {
  const a58 = ee4(e59), s63 = e59.tile, i66 = s63.extent;
  E13(k3(i66, n73, o61, 1));
  const c67 = (n73 - i66[0]) / (i66[2] - i66[0]), l48 = (o61 - i66[1]) / (i66[3] - i66[1]), u51 = s63.extentInRadians;
  L27(t60, u51[0] * (1 - c67) + u51[2] * c67, a58(l48), r59, s63.ellipsoid.radius);
}
function se4(e59, t60) {
  return e59.tile.surface.isWebMercatorOnPlateeCarree ? (n73, o61, r59, a58) => ce6(t60, e59.tile.ellipsoid.radius, n73, o61, r59, a58) : (e60, n73, o61, r59) => ie4(t60, e60, n73, o61, r59);
}
function ie4(e59, t60, n73, o61, r59) {
  t60[0] = n73 * e59, t60[1] = o61 * e59, t60[2] = r59;
}
function ce6(e59, t60, n73, o61, r59, a58) {
  n73[0] = o61 * e59, n73[1] = (Math.PI / 2 - 2 * Math.atan(Math.exp(-r59 / t60))) * t60, n73[2] = a58;
}
function le5(e59, t60) {
  var _a;
  if (!e59.tile.surface.shadingEnabled)
    return;
  const n73 = e59.geometryState.neighborData.cornerNeighborData, s63 = e59.tile, i66 = s63.extent, c67 = "local" === ((_a = e59.tile.surface.view) == null ? void 0 : _a.viewingMode);
  c67 && o3(ye5, 0, 0, 1);
  {
    const l48 = (e60, n74, o61, r59) => {
      t60(be2, e60.renderData, Me3, ye5, n74, o61, r59), u3(ve3, ve3, be2);
    }, u51 = 1, f37 = (e60, t61, n74, o61, r59, a58) => {
      const s64 = 1 === a58 ? r59.extent[0] : 3 === a58 ? r59.extent[2] : e60, i67 = 0 === a58 ? r59.extent[1] : 2 === a58 ? r59.extent[3] : t61, c68 = s64 + fe4[n74][0] * o61, f38 = i67 + fe4[n74][1] * o61;
      E13(k3(r59.extent, c68, f38, u51));
      const g46 = h36(c68, f38, r59.renderData.geometryState.samplerData);
      l48(r59, c68, f38, g46);
    }, g45 = (e60, t61, n74) => e60.extent[0 === t61 || 1 === t61 ? 2 : 0] + n74, d32 = (e60, t61, n74) => e60.extent[0 === t61 || 3 === t61 ? 3 : 1] + n74, x30 = (e60, t61, n74, o61) => {
      const r59 = g45(n74, o61, fe4[e60][0] * t61), a58 = d32(n74, o61, fe4[e60][1] * t61);
      E13(k3(n74.extent, r59, a58, u51));
      const s64 = h36(r59, a58, n74.renderData.geometryState.samplerData);
      l48(n74, r59, a58, s64);
    }, p52 = (e60, t61, n74, o61, r59, a58) => {
      const s64 = fe4[e60][0] * t61, i67 = fe4[e60][1] * t61, c68 = g45(n74, o61, s64), f38 = d32(n74, o61, i67), x31 = g45(r59, a58, s64), p53 = d32(r59, a58, i67);
      E13(k3(n74.extent, c68, f38, u51)), E13(k3(r59.extent, x31, p53, u51));
      const b24 = h36(c68, f38, n74.renderData.geometryState.samplerData), M22 = h36(x31, p53, r59.renderData.geometryState.samplerData);
      l48(n74, c68, f38, 0.5 * (b24 + M22));
    }, b23 = (e60) => {
      const t61 = 0 === e60 || 1 === e60 ? i66[2] : i66[0], o61 = 0 === e60 || 3 === e60 ? i66[3] : i66[1], r59 = n73[e60].cornerTiles, a58 = r59.reduce((e61, t62) => Math.min(e61, (t62 == null ? void 0 : t62.level) ?? 1 / 0), 1 / 0);
      for (let n74 = 0; n74 < 4; ++n74) {
        const e61 = r59[n74];
        Ve2[n74] = (e61 == null ? void 0 : e61.level) === a58 ? e61 : null;
      }
      for (let n74 = 0; n74 < 4; ++n74) {
        const e61 = Ve2[(n74 + 3) % 4], r60 = Ve2[n74];
        if (null != e61 && e61 !== s63 && e61 === r60) {
          const r61 = e61, a59 = (n74 + 2) % 4, i67 = r61.renderData.geometryState.neighborData.edgeResolutions[a59], c68 = Math.max(i67, 2 ** (s63.level - r61.level)), l49 = (r61.extent[2] - r61.extent[0]) / c68, u52 = (n74 + 0) % 4, g46 = (n74 + 1) % 4;
          return f37(t61, o61, (n74 + 3) % 4, l49, r61, n74), f37(t61, o61, u52, l49, r61, n74), f37(t61, o61, g46, l49, r61, n74), ve3;
        }
      }
      {
        E13(Ve2.some((e62) => (e62 == null ? void 0 : e62.isLoaded) || e62 === s63));
        const e61 = Ve2.reduce((e62, t62) => t62 ? t62.extent[2] - t62.extent[0] : e62, 0) / Ve2.reduce((e62, t62) => Math.max(e62, (t62 == null ? void 0 : t62.renderData.geometryState.numVerticesPerSide) ?? 1), 1);
        for (let t62 = 0; t62 < 4; ++t62) {
          const n74 = Ve2[(t62 + 3) % 4], o62 = Ve2[(t62 + 0) % 4];
          if (!n74 && !o62)
            continue;
          const r60 = 0 === t62 ? 1 : 1 === t62 ? 2 : 2 === t62 ? 3 : 0, a59 = 0 === t62 ? 2 : 1 === t62 ? 3 : 2 === t62 ? 0 : 1;
          if (n74 && o62)
            p52(t62, e61, n74, r60, o62, a59);
          else {
            x30(t62, e61, n74 ?? o62, n74 ? r60 : a59);
          }
        }
      }
      return ve3;
    };
    for (let t61 = 0; t61 < 4; ++t61) {
      const n74 = e59.geometryInfo.outerEdges[t61], a58 = 1 === t61 || 2 === t61 ? 0 : n74.count - 1;
      n74.getVertex(Me3, a58), c67 || z2(ye5, Me3), o3(ve3, 0, 0, 0);
      const s64 = b23(t61);
      z2(Oe2[t61], s64);
    }
  }
  {
    const t61 = (e60, t62, n75, o61, r59) => {
      e60.setVertexRawNormal(r59, t62, n75, o61);
    }, n74 = e59.geometryInfo.outerEdges;
    for (let e60 = 0; e60 < 4; ++e60) {
      const o61 = n74[e60];
      {
        const n75 = Oe2[0 === e60 ? 3 : 1 === e60 ? 1 : 2];
        t61(o61, n75[0], n75[1], n75[2], 0);
      }
      {
        const n75 = Oe2[2 === e60 ? 1 : 3 === e60 ? 3 : 0];
        t61(o61, n75[0], n75[1], n75[2], o61.count - 1);
      }
    }
  }
}
function ue5(e59, t60, n73, o61) {
  e59 < o61[0] ? o61[0] = e59 : e59 > o61[3] && (o61[3] = e59), t60 < o61[1] ? o61[1] = t60 : t60 > o61[4] && (o61[4] = t60), n73 < o61[2] ? o61[2] = n73 : n73 > o61[5] && (o61[5] = n73);
}
var fe4 = [[0, 1], [1, 0], [0, -1], [-1, 0]];
var ge5 = new o52();
var de5 = o5(-1 / 0, -1 / 0, 1 / 0, 1 / 0);
var me5 = n7();
var he7 = n7();
var xe3 = n7();
var pe5 = n7();
var be2 = n7();
var Me3 = n7();
var Se3 = n7();
var ye5 = n7();
var ve3 = n7();
var De2 = n7();
var Oe2 = [n7(), n7(), n7(), n7()];
var Ve2 = [null, null, null, null];

// node_modules/@arcgis/core/views/3d/terrain/PlanarPatch.js
var f29 = class extends ae3 {
  constructor(e59, t60, r59) {
    super(), this.horizontalScaleFactor = 1, this.extentInRenderSR = u6(), void 0 !== e59 && this.init(e59, t60, r59);
  }
  init(r59, a58, o61) {
    super.init(r59, a58, o61);
    const n73 = o61.view.renderSpatialReference, c67 = o61.spatialReference, l48 = r(n73) && T(n73) && c67.isGeographic ? this.ellipsoid.radius * Math.PI / 180 : 1;
    this.horizontalScaleFactor = l48;
    const m40 = this.surface.isWebMercatorOnPlateeCarree, p52 = this.extentInRenderSR, d32 = this.extent;
    if (m40) {
      const e59 = r6(d32[0], d32[1], 0);
      Bn(e59, k2.WebMercator, e59, k2.PlateCarree);
      const r60 = r6(d32[2], d32[3], 0);
      Bn(r60, k2.WebMercator, r60, k2.PlateCarree), p52[0] = e59[0], p52[1] = e59[1], p52[2] = r60[0], p52[3] = r60[1];
    } else
      for (let e59 = 0; e59 < 4; ++e59)
        p52[e59] = d32[e59] * l48;
    this.centerAtSeaLevel[0] = 0.5 * (p52[0] + p52[2]), this.centerAtSeaLevel[1] = 0.5 * (p52[1] + p52[3]), this.centerAtSeaLevel[2] = 0, this._edgeLen = Math.max(p52[2] - p52[0], p52[3] - p52[1]), this._edgeLen2 = this._edgeLen * this._edgeLen, this.updateRadiusAndCenter();
  }
  updateRadiusAndCenter() {
    this._updateCenter();
    const e59 = this.extentInRenderSR, t60 = 0.5 * (e59[2] - e59[0]), r59 = 0.5 * (e59[3] - e59[1]), i66 = Math.sqrt(t60 * t60 + r59 * r59), s63 = 0.5 * (this.elevationBounds[0] - this.elevationBounds[1]), a58 = Math.max(i66, s63);
    this._center[ce5.MIDDLE][3] = a58;
  }
  _isVisible(e59) {
    return j10(e59, this._aabb());
  }
  _aabb() {
    const e59 = this.extentInRenderSR;
    return v4(e59[0], e59[1], this.elevationBounds[0], e59[2], e59[3], this.elevationBounds[1]);
  }
  intersectsRay(e59, t60, r59, i66) {
    return g34[0] = 1 / t60[0], g34[1] = 1 / t60[1], g34[2] = 1 / t60[2], V3(this._aabb(), e59, g34, r59, i66);
  }
  createGeometry() {
    V14(this.renderData, this.horizontalScaleFactor), this.setMemoryDirty();
  }
  getDefaultVerticesPerRowOnLevel() {
    return this.level < 9 ? 3 : 2;
  }
  updateCornerElevations() {
    B12(this.renderData, this.horizontalScaleFactor);
  }
  updateEdgeElevations() {
    w21(this.renderData, this.horizontalScaleFactor);
  }
};
var g34 = n7();

// node_modules/@arcgis/core/views/3d/terrain/RenderOrder.js
var O28;
!function(O33) {
  O33[O33.BACK_TO_FRONT = -1] = "BACK_TO_FRONT", O33[O33.NONE = 0] = "NONE", O33[O33.FRONT_TO_BACK = 1] = "FRONT_TO_BACK";
}(O28 || (O28 = {}));

// node_modules/@arcgis/core/views/3d/terrain/SphericalPatch.js
var D17 = class extends ae3 {
  constructor(t60, e59, i66) {
    super(), this.obb = new Array(8);
    for (let s63 = 0; s63 < 8; s63++)
      this.obb[s63] = n7();
    void 0 !== t60 && this.init(t60, e59, i66);
  }
  init(i66, s63, r59) {
    super.init(i66, s63, r59);
    const n73 = this.ellipsoid.radius, h44 = this.extentInRadians[0], l48 = this.extentInRadians[1], d32 = this.extentInRadians[2], c67 = this.extentInRadians[3], u51 = i66[0], p52 = s10(l48, c67, 0.5), m40 = s10(h44, d32, 0.5), _30 = 0 === u51 ? 0 : Math.min(Math.abs(l48), Math.abs(c67));
    this._edgeLen = (d32 - h44) * Math.cos(_30) * n73, this._edgeLen2 = this._edgeLen * this._edgeLen, this._curvatureHeight = n73 - Math.sqrt(n73 * n73 - this._edgeLen2 / 4), Re(this.centerAtSeaLevel, m40, p52, this.ellipsoid.radius);
    const f37 = e6(this.centerAtSeaLevel);
    z2(f37, f37), this.up = f37, this._updateOBB(), this.updateRadiusAndCenter();
  }
  updateRadiusAndCenter() {
    if (0 === this.lij[0])
      o3(this._center[E32.MIDDLE], 0, 0, 0), o3(this._center[E32.TOP], 0, 0, 0), o3(this._center[E32.BOTTOM], 0, 0, 0), this.ellipsoid || (this.ellipsoid = p3(this.surface.spatialReference)), this._center[E32.MIDDLE][3] = this.ellipsoid.radius + this.elevationBounds[1];
    else {
      this._updateCenter();
      const t60 = Math.max(p5(this._center[E32.MIDDLE], this.obb[0]), p5(this._center[E32.MIDDLE], this.obb[1]));
      this._center[E32.MIDDLE][3] = Math.sqrt(t60);
    }
  }
  _isVisible(t60) {
    if (!P5(t60, this._center[E32.MIDDLE]))
      return false;
    if (this.lij[0] < 10)
      return true;
    const e59 = this.obb;
    for (let i66 = 0; i66 < g6.NUM; i66++) {
      const s63 = i66 === k6.NEAR, r59 = t60[i66];
      s63 && (O29[0] = r59[0], O29[1] = r59[1], O29[2] = r59[2], O29[3] = r59[3] - this.surface.view.state.camera.near);
      const o61 = s63 ? O29 : r59;
      let a58;
      for (a58 = 0; a58 < 8; a58++) {
        const t61 = e59[a58];
        if (o61[0] * t61[0] + o61[1] * t61[1] + o61[2] * t61[2] + o61[3] < 0)
          break;
      }
      if (8 === a58)
        return false;
    }
    return true;
  }
  computeElevationBounds() {
    super.computeElevationBounds(), this._updateOBB();
  }
  createGeometry() {
    const t60 = this._getPatchType(this.lij[1], this.lij[0]);
    O27(this.renderData, t60), this.setMemoryDirty();
  }
  _updateOBB() {
    const t60 = this.extentInRadians, e59 = this.obb;
    for (let i66 = 0; i66 < 2; i66++) {
      const s63 = this.elevationBounds[i66];
      let r59 = 4 * i66;
      Re(e59[r59++], t60[0], t60[1], this.ellipsoid.radius + s63), Re(e59[r59++], t60[0], t60[3], this.ellipsoid.radius + s63), Re(e59[r59++], t60[2], t60[3], this.ellipsoid.radius + s63), Re(e59[r59++], t60[2], t60[1], this.ellipsoid.radius + s63);
    }
    if (this.surface.isWebMercator)
      switch (this._getPatchType(this.lij[1], this.lij[0])) {
        case O7.HAS_NORTH_POLE:
          o3(e59[1], 0, 0, this.ellipsoid.radius), o3(e59[2], 0, 0, this.ellipsoid.radius), o3(e59[5], 0, 0, this.ellipsoid.radius), o3(e59[6], 0, 0, this.ellipsoid.radius);
          break;
        case O7.HAS_SOUTH_POLE:
          o3(e59[0], 0, 0, -this.ellipsoid.radius), o3(e59[3], 0, 0, -this.ellipsoid.radius), o3(e59[4], 0, 0, -this.ellipsoid.radius), o3(e59[7], 0, 0, -this.ellipsoid.radius);
      }
  }
  _getPatchType(t60, e59) {
    return t60 === (1 << e59) - 1 ? 0 === t60 ? O7.HAS_BOTH_POLES : O7.HAS_SOUTH_POLE : 0 === t60 ? O7.HAS_NORTH_POLE : O7.REGULAR;
  }
  intersectsRay(t60, e59, i66, s63) {
    const r59 = this._center[E32.MIDDLE], o61 = r59[3] + i66, a58 = e59[0] * e59[0] + e59[1] * e59[1] + e59[2] * e59[2], n73 = r59[0] - t60[0], h44 = r59[1] - t60[1], l48 = r59[2] - t60[2], d32 = (n73 * e59[0] + h44 * e59[1] + l48 * e59[2]) / a58, c67 = e59[0] * d32 - n73, u51 = e59[1] * d32 - h44, p52 = e59[2] * d32 - l48;
    return c67 * c67 + u51 * u51 + p52 * p52 < o61 * o61;
  }
  getDefaultVerticesPerRowOnLevel() {
    return this.level < L28.length ? L28[this.level] + 1 : 2;
  }
  updateCornerElevations() {
    A35(this.renderData);
  }
  updateEdgeElevations() {
    P18(this.renderData);
  }
};
var L28 = [128, 64, 32, 16, 16, 8, 8, 4];
var O29 = p17();
var E32;
!function(t60) {
  t60[t60.TOP = 0] = "TOP", t60[t60.MIDDLE = 1] = "MIDDLE", t60[t60.BOTTOM = 2] = "BOTTOM";
}(E32 || (E32 = {}));

// node_modules/@arcgis/core/views/3d/terrain/ScaleRangeQueries.js
var r48 = class {
  constructor() {
    this.extent = n10(), this.minLevel = 0, this.maxLevel = 0, this.callback = null;
  }
};
var u43 = class {
  constructor() {
    this._queries = new n2({ initialSize: 10 }), this._queriesInvPtr = 0, this._queryQueue = new n2({ initialSize: 30 }), this._queryPool = new e3(r48);
  }
  queryVisibleLevelRange(e59, t60, i66, r59) {
    const u51 = this._queryPool.acquire();
    a3(u51.extent, e59), u51.minLevel = t60 || -Number.MAX_VALUE, u51.maxLevel = null != i66 ? i66 : Number.MAX_VALUE, u51.callback = r59, this._queryQueue.push(u51);
  }
  hasPendingQueries() {
    return 0 !== this._queryQueue.length;
  }
  prepareQueries() {
    for (; this._queries.length < this._queries.data.length && this._queryQueue.length > 0; ) {
      const e59 = this._queryQueue.pop();
      this._queries.push(e59);
    }
    this._queriesInvPtr = this._queries.length;
  }
  processQueries() {
    for (let e59 = 0; e59 < this._queries.length; e59++) {
      const t60 = this._queries.data[e59];
      this._queryPool.release(t60), t60.callback(e59 >= this._queriesInvPtr), t60.callback = null;
    }
    this._queries.clear();
  }
  scaleQueriesForTile(e59) {
    const t60 = e59.level;
    let s63 = 0;
    for (; s63 < this._queriesInvPtr; ) {
      const i66 = this._queries.data[s63], r59 = i66.extent;
      t60 >= i66.minLevel && t60 <= i66.maxLevel && r59[0] <= e59.extent[2] && r59[2] >= e59.extent[0] && r59[1] <= e59.extent[3] && r59[3] >= e59.extent[1] ? (this._queries.swapElements(s63, this._queriesInvPtr - 1), this._queriesInvPtr--) : s63++;
    }
  }
};

// node_modules/@arcgis/core/views/3d/terrain/BlendModeTechniqueConfiguration.js
var s55 = class extends t17 {
  constructor() {
    super(...arguments), this.blendMode = e31.Normal;
  }
};
e([e20({ count: e31.COUNT })], s55.prototype, "blendMode", void 0);

// node_modules/@arcgis/core/views/3d/terrain/BlendLayersTechnique.js
var f30 = class extends i29 {
  constructor() {
    super(...arguments), this.opacity = 1, this.baseOpacity = 1, this.texture = null, this.fboTexture = null, this.blendMode = e31.Normal, this.backgroundColor = f3;
  }
};
var j34 = class extends e18 {
  initializeProgram(e59) {
    const r59 = j34.shader.get().build(this.configuration);
    return new o20(e59.rctx, r59, E7);
  }
  initializePipeline() {
    return W({ blending: s14(R4.ONE, R4.ONE_MINUS_SRC_ALPHA), colorWrite: c11 });
  }
};
j34.shader = new t15(u18, () => import("./BlendLayers.glsl-CNY5PRJX.js"));
var w22 = class extends s55 {
  constructor() {
    super(...arguments), this.output = c25.Composite, this.baseOpacityMode = g13.One, this.premultipliedSource = false;
  }
};
e([e20({ count: c25.COUNT })], w22.prototype, "output", void 0), e([e20({ count: g13.COUNT })], w22.prototype, "baseOpacityMode", void 0), e([e20()], w22.prototype, "premultipliedSource", void 0);

// node_modules/@arcgis/core/views/3d/terrain/TextureReference.js
var e47 = class {
  constructor(e59, f37, o61, r59, c67, i66) {
    this.texture = e59, this.type = f37, e59.retain(), this.offsetAndScale = r10(o61.offset[0], o61.offset[1], o61.scale, o61.scale), this.opacities = r6(r59, i66, c67);
  }
  destroy() {
    this.texture.release();
  }
};

// node_modules/@arcgis/core/views/2d/engine/vectorTiles/VectorTileRendererHelper3D.js
var r49 = 0.125;
var s56 = class {
  constructor() {
    this._renderParams = { context: null, drawPhase: 1, state: new U9({ viewpoint: new u14({ targetGeometry: new j(0, 0), scale: 1, rotation: 0 }), size: [256, 256] }), stationary: true, pixelRatio: 1, displayLevel: -1, requiredLevel: -1, globalOpacity: 1, renderPass: "background", styleLayer: null, styleLayerUID: -1, painter: null, glyphMosaic: null, spriteMosaic: null, profiler: null, renderingOptions: null, requestRender: null, deltaTime: -1, timeline: null, time: 0, hasClipping: false, blendMode: null, dataUploadCounter: 0, effects: null, inFadeTransition: false, requireFBO: false };
  }
  dispose() {
    this._renderParams = null;
  }
  render(e59, t60, i66, s63, a58, l48, n73, o61, p52, d32) {
    const u51 = l48.adjustLevel(t60[0]), c67 = this._renderParams;
    c67.context = e59, c67.painter = s63, c67.glyphMosaic = s63.glyphMosaic, c67.spriteMosaic = s63.spriteMosaic, c67.pixelRatio = d32, c67.displayLevel = u51, c67.requiredLevel = u51;
    const m40 = l48.getScale(t60[0]), [g45, y33] = l48.getShift(t60, n73 * m40), h44 = r49 * n73 * m40 / p52, f37 = i66.transforms.dvs;
    f37[0] = h44, f37[4] = -h44, f37[6] = -1 - g45 - o61[0] * n73 * 2, f37[7] = 1 + y33 + (1 - o61[1]) * n73 * 2 - 2, c67.state.size[0] = p52, c67.state.size[1] = p52, i66.stage || i66.attachWithContext(e59), i66.triangleCount = 0, s63.drawTile(c67, i66, a58);
  }
};

// node_modules/@arcgis/core/views/3d/terrain/RasterColorizerTechnique.js
var b19 = class extends e18 {
  initializeProgram(e59) {
    const r59 = b19.shader.get().build(this.configuration);
    return new o20(e59.rctx, r59, E7);
  }
  initializePipeline() {
    return W({ blending: s14(R4.ONE, R4.ONE_MINUS_SRC_ALPHA), colorWrite: c11 });
  }
};
b19.shader = new t15(k7, () => import("./RasterColorizer.glsl-JJJSHFHE.js"));
var y27 = class extends s55 {
  constructor() {
    super(...arguments), this.colorizerType = t29.Stretch, this.stretchType = e30.Noop, this.tileBlendInput = o33.LayerOnly, this.baseOpacityMode = g13.One, this.applyColormap = true;
  }
};
e([e20({ count: t29.COUNT })], y27.prototype, "colorizerType", void 0), e([e20({ count: e30.COUNT })], y27.prototype, "stretchType", void 0), e([e20({ count: o33.COUNT })], y27.prototype, "tileBlendInput", void 0), e([e20({ count: g13.COUNT })], y27.prototype, "baseOpacityMode", void 0), e([e20()], y27.prototype, "applyColormap", void 0);

// node_modules/@arcgis/core/views/3d/terrain/support/FBOPool.js
var r50 = class {
  constructor(t60) {
    this._rctx = t60, this._pools = /* @__PURE__ */ new Map();
  }
  acquire(t60) {
    return this._getPool(t60).acquire();
  }
  clear() {
    this._pools.forEach((t60) => t60.destroy()), this._pools.clear();
  }
  _getPool(s63) {
    let r59 = this._pools.get(s63);
    if (!r59) {
      const l48 = i57.bind(i57, this._rctx, { colorTarget: Y.TEXTURE, depthStencilTarget: V2.DEPTH_RENDER_BUFFER, width: s63, height: s63 }, (t60) => this._getPool(t60.width).release(t60));
      r59 = new e3(l48, null, () => {
      }), this._pools.set(s63, r59);
    }
    return r59;
  }
};
var i57 = class extends D6 {
  constructor(t60, e59, o61) {
    super(t60, e59), this.release = () => o61(this);
  }
};

// node_modules/@arcgis/core/views/3d/terrain/TileCompositor.js
var F17 = class {
  constructor(e59, r59) {
    this._rctx = e59, this._techniqueRepository = r59, this._fboPools = [], this._doubleBufferFbo = [], this._vectorTileHelper = new s56(), this._bindParameters = new h15(null, null, null), this._blendLayersTechniqueConfig = new w22(), this._poolToWrite = 0, this._vaoQuad = u12(this._rctx, A9), this._fboPools.push(new r50(this._rctx)), this._fboPools.push(new r50(this._rctx));
  }
  dispose() {
    this._fboPools.forEach((e59) => {
      e59.clear(), e59 = null;
    }), this._fboPools = null, this._doubleBufferFbo.forEach((r59) => s(r59)), this._vaoQuad = s(this._vaoQuad), this._vectorTileHelper = s(this._vectorTileHelper), this._backgroundTechnique = p(this._backgroundTechnique), this._applyOpacityTechnique = p(this._applyOpacityTechnique), this._blendLayersTechnique = p(this._blendLayersTechnique);
  }
  _getBlendLayersTechnique(e59, r59, t60, i66 = false) {
    return this._blendLayersTechniqueConfig.output = r59, this._blendLayersTechniqueConfig.blendMode = e59, this._blendLayersTechniqueConfig.baseOpacityMode = t60 ? r59 === c25.Composite ? g13.OnBaseLayer : g13.OnBackground : g13.One, this._blendLayersTechniqueConfig.premultipliedSource = i66, this._blendLayersTechnique = this._techniqueRepository.releaseAndAcquire(j34, this._blendLayersTechniqueConfig, this._blendLayersTechnique), this._blendLayersTechnique;
  }
  drawBackground(e59, r59) {
    const t60 = this._getBlendLayersTechnique(e31.Normal, r59, false), i66 = this._rctx.bindTechnique(t60, e59, this._bindParameters);
    this._render(i66);
  }
  _render(e59) {
    this._rctx.bindVAO(this._vaoQuad), e59.assertCompatibleVertexAttributeLocations(this._vaoQuad), this._rctx.drawArrays(E5.TRIANGLE_STRIP, 0, n20(this._vaoQuad, "geometry"));
  }
  drawRasterData(e59, r59, i66 = false) {
    if (t(r59.texture))
      return;
    const o61 = r59.baseOpacity < 1;
    r59.blendMode !== e31.Normal || o61 || i66 ? (r59.fboTexture = this._currentFBO.colorTexture, this._switchPool(this._currentFBO.width)) : r59.fboTexture = null;
    const s63 = this._getBlendLayersTechnique(r59.blendMode, e59, o61, i66), l48 = this._rctx.bindTechnique(s63, r59, this._bindParameters);
    this._render(l48);
  }
  drawImageryTileData(e59, r59, t60) {
    const i66 = e59.sourceLayerInfo.data;
    if (!i66.source)
      return;
    e59.tile.surface.layerViewByIndex(e59.layerIndex, A34.MAP).ensureSymbolizerParameters(i66);
    const o61 = t60.baseOpacity < 1;
    t60.blendMode !== e31.Normal || o61 ? (t60.fboTexture = this._currentFBO.colorTexture, this._switchPool(this._currentFBO.width)) : t60.fboTexture = null;
    const s63 = this._getRasterColorizerTechnique(i66, r59, t60.blendMode, o61), l48 = this._rctx.bindTechnique(s63);
    if (!i66.bind(this._rctx))
      return;
    i66.opacity = t60.opacity;
    const n73 = i66.getUniforms();
    n73.scale = e59.scale, n73.offset = e59.offset, n73.backgroundColor = t60.backgroundColor, n73.fboTexture = t60.fboTexture, n73.baseOpacity = t60.baseOpacity, s63.bindPass(n73, null), this._render(l48);
  }
  _getRasterColorizerTechnique(e59, r59, i66, o61) {
    const l48 = e59.symbolizerParameters, n73 = ["stretch", "lut", "hillshade"].indexOf(l48.type);
    return t(this._rasterColorizerConfig) && (this._rasterColorizerConfig = new y27(), this._rctx.gl.getExtension("WEBGL_color_buffer_float"), this._rctx.gl.getExtension("OES_texture_float")), this._rasterColorizerConfig.tileBlendInput = r59 === c25.ColorComposite ? o33.ColorComposite : r59 === c25.GridComposite ? o33.GridComposite : o33.LayerOnly, this._rasterColorizerConfig.blendMode = i66, this._rasterColorizerConfig.baseOpacityMode = o61 ? r59 === c25.Composite ? g13.OnBaseLayer : g13.OnBackground : g13.One, this._rasterColorizerConfig.colorizerType = n73, this._rasterColorizerConfig.applyColormap = !!l48.colormap, this._rasterColorizerConfig.stretchType = e59.hasStretchTypeNone() ? e30.Noop : e30.PerBand, this._rasterColorizerTechnique = this._techniqueRepository.releaseAndAcquire(b19, this._rasterColorizerConfig, this._rasterColorizerTechnique), this._rasterColorizerTechnique;
  }
  drawVectorData(e59, r59, t60, s63, l48, n73, a58) {
    const u51 = this._rctx, c67 = r59.sourceLayerInfo.data, _30 = r59.tile.surface.layerViewByIndex(r59.layerIndex, A34.MAP), b23 = e59.baseOpacity < 1 || e59.opacity < 1 || e59.blendMode !== e31.Normal || a58 !== c25.Composite;
    let p52;
    return this._getBlendLayersTechnique(e59.blendMode, a58, e59.baseOpacity < 1, b23).bindPipelineState(u51), b23 ? (p52 = this._acquire(l48), u51.bindFramebuffer(p52), u51.setClearColor(0, 0, 0, 0), u51.clearSafe(_2.COLOR_BUFFER_BIT | _2.DEPTH_BUFFER_BIT)) : n73 && u51.clearSafe(_2.DEPTH_BUFFER_BIT), this._vectorTileHelper.render(u51, r59.sourceLod, c67, _30.painter, _30.layer.styleRepository, _30.schemaHelper, Math.round(1 / r59.scale), r59.offset, s63, t60), !r(p52) || (u51.bindFramebuffer(this._currentFBO), e59.texture = p52.colorTexture, e59.offset = f9, e59.scale = 1, this.drawRasterData(a58, e59, b23), p52.release(), n73);
  }
  copyFBOToTexture(e59) {
    const r59 = this._rctx, t60 = r59.bindTexture(e59.texture, u10.TEXTURE_UNIT_FOR_UPDATES), i66 = e59.descriptor;
    r59.gl.copyTexImage2D(M6.TEXTURE_2D, 0, i66.pixelFormat, 0, 0, i66.width, i66.height, 0), e59.generateMipmap(), r59.bindTexture(t60, u10.TEXTURE_UNIT_FOR_UPDATES);
  }
  _initFBO(e59, r59) {
    this._rctx.bindFramebuffer(e59), this._rctx.setViewport(0, 0, r59, r59), this._rctx.setClearColor(0, 0, 0, 0), this._rctx.setClearDepth(1), this._rctx.clearSafe(_2.COLOR_BUFFER_BIT | _2.DEPTH_BUFFER_BIT);
  }
  _acquire(e59) {
    return this._fboPools[this._poolToWrite].acquire(e59);
  }
  bindPool(e59, r59) {
    this._poolToWrite = e59, null == this._doubleBufferFbo[e59] && (this._doubleBufferFbo[e59] = this._acquire(r59), this._initFBO(this._doubleBufferFbo[e59], r59));
  }
  _switchPool(e59) {
    this._releaseCurrentFBO(), this._doubleBufferFbo[this._poolToWrite] = null, this._poolToWrite = 0 === this._poolToWrite ? 1 : 0, this.bindPool(this._poolToWrite, e59);
  }
  get _currentFBO() {
    return this._doubleBufferFbo[this._poolToWrite];
  }
  _releaseCurrentFBO() {
    this._doubleBufferFbo[this._poolToWrite].release(), this._doubleBufferFbo[this._poolToWrite] = null;
  }
  releasePool() {
    this._rctx.bindFramebuffer(null), this._releaseCurrentFBO();
  }
  cleanupFBOPool(e59, r59) {
    e59 === this._lastPixelRatio && r59 === this._lastNumLayers || (this._fboPools.forEach((e60) => e60.clear()), this._lastPixelRatio = e59, this._lastNumLayers = r59);
  }
};

// node_modules/@arcgis/core/views/3d/terrain/TileRenderer.js
var C22 = class {
  constructor(e59, t60, r59) {
    this._rctx = e59, this.tileSize = t60, this._techniqueRepository = r59, this._passParameters = new f30(), this._backgroundTexture = null, this._backgroundColor = null, this._backgroundDirty = false, this._blackTex = null, this._numTexturedLayer = 0, this._maxAnisotropy = this._rctx.parameters.maxMaxAnisotropy, this._composition = new F17(this._rctx, this._techniqueRepository), this._blackTex = new t53(A10(this._rctx, [0, 0, 0, 1])), this._ensureBackgroundTexture(this.tileSize);
  }
  dispose() {
    this._composition = s(this._composition), this._backgroundTexture = p(this._backgroundTexture), this._blackTex = p(this._blackTex);
  }
  get backgroundIsGrid() {
    return t(this._backgroundColor);
  }
  get backgroundColor() {
    return this._backgroundColor;
  }
  updateTileTexture(e59, t60) {
    if (!e59.renderData)
      return;
    const r59 = e59.surface, s63 = r59.baseOpacity;
    this._numTexturedLayer = 0;
    let o61 = 0, a58 = this.tileSize, i66 = false;
    const n73 = r59.view.state.pixelRatio;
    let c67 = false;
    const l48 = e59.layerInfo[A34.MAP];
    let p52 = l48.length, T29 = 0;
    for (; T29 < l48.length; T29++) {
      const t61 = r59.layerViewByIndex(T29, A34.MAP), f38 = t61.fullOpacity;
      if (G18[T29] = f38, i5(t61.layer) && p52 >= l48.length && (p52 = T29), 0 === f38) {
        l48[T29].pendingUpdates &= ~(E30.TEXTURE_NOFADING & E30.TEXTURE_FADING);
        continue;
      }
      ++o61;
      const x31 = F18(e59, T29);
      if (x31) {
        if (l48[T29].pendingUpdates &= ~(E30.TEXTURE_NOFADING & E30.TEXTURE_FADING), U10(t61)) {
          const e60 = R6(t61.layer.parent) ? "normal" : t61.layer.blendMode;
          S21[T29] = e60;
          const r60 = "normal" !== e60;
          r60 && (c67 = r60, i66 = false);
        }
        _6(t61) ? a58 = Math.max(a58, this.tileSize * n73) : 1 === s63 && 1 === f38 && (t61.isOpaque || this._dataToTexture(x31) && x31.sourceLayerInfo.data.descriptor.isOpaque) && (i66 = true), ++this._numTexturedLayer;
      }
    }
    this._composition.cleanupFBOPool(n73, l48.length), a58 = B13(a58);
    const f37 = a58 / this.tileSize, x30 = T29 - 1;
    this._ensureBackgroundTexture(this.tileSize), 0 !== this._numTexturedLayer ? 1 === this._numTexturedLayer && !c67 && this._useLayerTexture(e59, x30, p52, G18[x30]) || this._composeMapLayers(e59, t60, x30, p52, G18, S21, a58, f37, !i66 || c67) : this._useBackgroundTexture(e59, o61);
  }
  _ensureBackgroundTexture(e59) {
    t(this._backgroundTexture) && (this._backgroundTexture = this._buildTexture(e59), this._backgroundDirty = true), this._backgroundDirty && (this._composition.bindPool(0, e59), this._passParameters.offset = f9, this._passParameters.scale = 1, this._passParameters.opacity = 1, this._passParameters.blendMode = e31.Normal, r(this.backgroundColor) && (this._passParameters.backgroundColor = this.backgroundColor), this._composition.drawBackground(this._passParameters, r(this.backgroundColor) ? c25.ColorOnly : c25.GridOnly), this._composition.copyFBOToTexture(this._backgroundTexture), this._composition.releasePool(), this._backgroundDirty = false);
  }
  _useBackgroundTexture(e59, t60) {
    let r59 = s53.Immediate;
    (e59.surface.view.layerViewManager.updating || t60 > 0) && (r59 = s53.Delayed), this._backgroundTexture && t(e59.renderData.textureReference) && (r59 = s53.Immediate), e59.renderData.setTextureReference(r(this._backgroundTexture) ? new e47(this._backgroundTexture, A13.FADING, z19, e59.surface.baseOpacity, 1, 0) : null, r59);
  }
  _useLayerTexture(e59, t60, r59, s63) {
    const o61 = t60 < r59, a58 = o61 ? 1 : e59.surface.baseOpacity, i66 = o61 ? e59.surface.baseOpacity : 1, n73 = F18(e59, t60);
    return !!this._dataToTexture(n73) && (e59.renderData.setTextureReference(new e47(n73.sourceLayerInfo.data, A13.FADING, n73, a58, s63, i66)), true);
  }
  _composeMapLayers(e59, t60, r59, s63, o61, a58, i66, n73, u51) {
    this._composition.bindPool(0, i66);
    const c67 = e59.surface.baseOpacity;
    let l48 = false, p52 = L4.LINEAR_MIPMAP_LINEAR, d32 = false, h44 = 0;
    for (let _30 = r59; _30 >= 0; _30--) {
      const t61 = F18(e59, _30);
      if (!t61)
        continue;
      if (0 === o61[_30])
        continue;
      const r60 = _30 < s63 && c67 < 1 && !l48;
      this._passParameters.baseOpacity = r60 ? c67 : 1, r60 && (l48 = true);
      const m41 = 0 === h44, x30 = u51 && m41 ? this.backgroundIsGrid ? c25.GridComposite : c25.ColorComposite : c25.Composite;
      h13(t61) ? (this._passParameters.opacity = o61[_30], this._passParameters.blendMode = o32[a58[_30]], d32 = this._composition.drawVectorData(this._passParameters, t61, n73, this.tileSize, i66, d32, x30)) : b5(t61) ? (this._passParameters.opacity = o61[_30], this._passParameters.blendMode = o32[a58[_30]], this._composition.drawImageryTileData(t61, x30, this._passParameters), this._hasNearestInterpolation(t61) && (p52 = L4.NEAREST)) : this._dataToTexture(t61) && (this._passParameters.texture = t61.sourceLayerInfo.data.texture, this._passParameters.offset = t61.offset, this._passParameters.scale = t61.scale, this._passParameters.opacity = o61[_30], this._passParameters.blendMode = o32[a58[_30]], this._composition.drawRasterData(x30, this._passParameters)), h44++;
    }
    const m40 = e59.renderData.ensureTexture(i66, () => this._buildTexture(i66, p52));
    this._composition.copyFBOToTexture(m40), this._composition.releasePool(), e59.renderData.setTextureReference(new e47(m40, t60, z19, l48 ? 1 : c67, 1, 0));
  }
  _hasNearestInterpolation(e59) {
    const t60 = e59.sourceLayerInfo.data;
    return !!t60.source && "nearest" === t60.interpolation;
  }
  _dataToTexture(e59) {
    return w9(e59) && this._rasterDataToTexture(e59), A14(e59);
  }
  _rasterDataToTexture(e59) {
    const t60 = e59.sourceLayerInfo;
    t60.data = this._buildTexture(t60.data), e59.tile.setMemoryDirty();
  }
  setBackground(e59) {
    this._backgroundColor !== e59 && (this._backgroundColor = e59, this._backgroundDirty = true);
  }
  _buildTexture(e59, t60 = L4.LINEAR_MIPMAP_LINEAR) {
    if (t(e59))
      return null;
    const r59 = { target: M6.TEXTURE_2D, pixelFormat: P3.RGBA, dataType: G4.UNSIGNED_BYTE, wrapMode: D4.CLAMP_TO_EDGE, samplingMode: t60, maxAnisotropy: this._maxAnisotropy, flipped: true, hasMipmap: true }, o61 = this._rctx;
    let a58;
    if ("number" == typeof e59)
      r59.width = r59.height = e59, a58 = new t53(new u10(o61, r59));
    else if (e59 instanceof O6)
      r59.isOpaque = e59.isOpaque, a58 = new t53(new u10(o61, r59, e59.image)), e59.release();
    else
      try {
        a58 = new t53(new u10(o61, r59, e59));
      } catch (n73) {
        a58 = new t53(w5(o61)), console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.");
      }
    const i66 = o61.bindTexture(a58.texture, u10.TEXTURE_UNIT_FOR_UPDATES);
    return a58.generateMipmap(), o61.bindTexture(i66, u10.TEXTURE_UNIT_FOR_UPDATES), a58;
  }
  get test() {
    return { backgroundTexture: this._backgroundTexture };
  }
};
function B13(t60) {
  const r59 = a4(t60), s63 = r59 * r59, o61 = t60 * t60;
  if (s63 === o61)
    return t60;
  const a58 = r59 / 2;
  return s63 - o61 < o61 - a58 * a58 ? r59 : a58;
}
function F18(e59, t60) {
  q15.layerIndex = t60;
  const r59 = e59.layerInfo[A34.MAP][t60];
  if (r(r59.data))
    return r13(q15.offset, 0, 0), q15.tile = e59, q15.scale = 1, q15.sourceLod = e59.lij, q15.sourceLayerInfo = r59, q15;
  const s63 = r59.upsampleInfo;
  if (r(s63)) {
    const e60 = s63.tile.layerInfo[A34.MAP][t60];
    return q15.tile = s63.tile, a9(q15.offset, s63.offset), q15.scale = s63.scale, q15.sourceLod = s63.tile.lij, q15.sourceLayerInfo = e60, q15;
  }
  return null;
}
var G18 = new Array();
var S21 = new Array();
var q15 = { tile: null, sourceLayerInfo: null, sourceLod: null, offset: [0, 0], scale: 1, layerIndex: 0 };
var z19 = { offset: [0, 0], scale: 1 };

// node_modules/@arcgis/core/views/3d/webgl-engine/collections/Component/ComponentIntersectionData.js
var s57 = 200;
var o53 = 40;
var a47 = 0.8;
var c61 = 10;
var h40 = 1e-6;
function f31(t60, e59, i66) {
  const n73 = e59, r59 = i66;
  let s63 = 0, o61 = 1 / 0;
  for (let a58 = 0; a58 < 3; ++a58) {
    {
      const e60 = t60[a58];
      if (n73[a58] < e60) {
        if (r59[a58] <= h40)
          return false;
        const t61 = (e60 - n73[a58]) / r59[a58];
        s63 = Math.max(s63, t61);
      } else if (r59[a58] <= -h40) {
        const t61 = (e60 - n73[a58]) / r59[a58];
        o61 = Math.min(o61, t61);
      }
      if (s63 > o61)
        return false;
    }
    {
      const e60 = t60[a58 + 3];
      if (n73[a58] > e60) {
        if (r59[a58] >= -h40)
          return false;
        const t61 = (e60 - n73[a58]) / r59[a58];
        s63 = Math.max(s63, t61);
      } else if (r59[a58] >= h40) {
        const t61 = (e60 - n73[a58]) / r59[a58];
        o61 = Math.min(o61, t61);
      }
      if (s63 > o61)
        return false;
    }
  }
  return true;
}
var l43 = class {
  constructor(t60, e59, i66, n73, r59) {
    this.aabb = t60, this.axis = e59, this.d = i66, this.midStartIndex = n73, this.rightStartIndex = r59;
  }
};
var d28 = class {
  constructor(i66, n73, r59, s63) {
    this.globalTriangleVertexIndices = i66, this.firstTriangleIndex = n73, this.positionAttribute = s63, this.rayDirection = n7(), this.bspNodeTree = new Array(), this.vertexPositionBuffer = s63.data, this.vertexPositionStride = s63.stride;
    const h44 = r59 - n73, f37 = h44 <= I22 ? new Uint16Array(h44) : new Uint32Array(h44);
    this.indices = f37;
    for (let t60 = 0; t60 < h44; ++t60)
      f37[t60] = t60;
    {
      const e59 = b20(i66, n73, r59, s63.data, s63.stride), d32 = o4(Math.log2(h44 / o53), 2, c61), u51 = (t60, i67, n74) => {
        const r60 = y28(f37, e59, t60, i67), s64 = i67 - t60;
        if (s64 <= o53) {
          const e60 = new l43(r60, void 0, 0, t60, i67);
          return this.bspNodeTree.push(e60), e60;
        }
        const { axis: c67, midValue: h45 } = N17(r60), m40 = x25(f37, e59, t60, i67, c67, h45), g45 = (t61, e60) => {
          if (n74 > d32)
            return;
          const i68 = e60 - t61;
          return i68 < o53 || i68 >= a47 * s64 ? void 0 : u51(t61, e60, n74 + 1);
        }, b23 = new l43(r60, c67, h45, m40.next, m40.mid);
        return this.bspNodeTree.push(b23), b23.leftNode = g45(t60, m40.next), b23.rightNode = g45(m40.mid, i67), b23;
      };
      u51(0, h44, 0), this.triangleVertexIndices = p46(f37, i66, n73, r59);
    }
  }
  intersectRayTriangleRange(t60, e59) {
    {
      if (t60 >= e59)
        return;
      const i66 = this.triangleVertexIndices, n73 = this.positionAttribute.data, s63 = this.positionAttribute.stride, o61 = this.rayOrigin, a58 = o61[0], c67 = o61[1], h44 = o61[2], f37 = this.rayDirection, l48 = f37[0], d32 = f37[1], m40 = f37[2];
      for (let g45 = t60, x30 = 3 * t60; g45 < e59; ++g45) {
        const t61 = i66[x30] * s63, e60 = n73[t61], o62 = n73[t61 + 1], f38 = n73[t61 + 2], y33 = i66[x30 + 1] * s63, N23 = n73[y33], b23 = n73[y33 + 1], p52 = n73[y33 + 2], I27 = i66[x30 + 2] * s63, T29 = n73[I27], M22 = n73[I27 + 1], R21 = n73[I27 + 2];
        x30 += 3;
        const S25 = N23 - e60, A39 = b23 - o62, w25 = p52 - f38, V17 = T29 - e60, v36 = M22 - o62, B18 = R21 - f38, P22 = d32 * B18 - v36 * m40, U26 = m40 * V17 - B18 * l48, j36 = l48 * v36 - V17 * d32, D21 = S25 * P22 + A39 * U26 + w25 * j36;
        if (Math.abs(D21) <= Number.EPSILON)
          continue;
        const F21 = a58 - e60, O33 = c67 - o62, k32 = h44 - f38, L31 = F21 * P22 + O33 * U26 + k32 * j36;
        if (D21 > 0) {
          if (L31 < 0 || L31 > D21)
            continue;
        } else if (L31 > 0 || L31 < D21)
          continue;
        const E39 = O33 * w25 - A39 * k32, q18 = k32 * S25 - w25 * F21, z20 = F21 * A39 - S25 * O33, C25 = l48 * E39 + d32 * q18 + m40 * z20;
        if (D21 > 0) {
          if (C25 < 0 || L31 + C25 > D21)
            continue;
        } else if (C25 > 0 || L31 + C25 < D21)
          continue;
        const G21 = (V17 * E39 + v36 * q18 + B18 * z20) / D21;
        if (G21 >= 0) {
          const t62 = this.indices[g45] + this.firstTriangleIndex, e61 = A11(S25, A39, w25, V17, v36, B18, u44);
          this.callback(G21, e61, t62, false);
        }
      }
    }
    d28.numFacesTested += e59 - t60;
  }
  intersectRay(t60, e59) {
    d28.numFacesTested = 0;
    const n73 = r6(t60.r0[0], t60.r0[1], t60.r0[2]), r59 = r6(t60.r1[0], t60.r1[1], t60.r1[2]), s63 = r59[0] - n73[0], o61 = r59[1] - n73[1], a58 = r59[2] - n73[2];
    if (s63 * s63 + o61 * o61 + a58 * a58 < h40)
      return;
    this.rayOrigin = n73;
    const c67 = this.rayDirection;
    c67[0] = s63, c67[1] = o61, c67[2] = a58;
    const f37 = this.triangleVertexIndices.length / 3;
    this.callback = e59;
    const l48 = this.bspNodeTree[0];
    this.intersectRayBSP(l48, 0, f37);
  }
  intersectRayBSP(t60, e59, i66) {
    const n73 = this.rayOrigin, r59 = this.rayDirection;
    if (!f31(t60.aabb, n73, r59))
      return;
    const s63 = t60.axis, o61 = t60.d;
    if (n73[s63] < o61 || r59[s63] < 0) {
      const i67 = e59, n74 = t60.midStartIndex;
      if (i67 < n74) {
        const e60 = t60.leftNode;
        void 0 !== e60 ? this.intersectRayBSP(e60, i67, n74) : this.intersectRayTriangleRange(i67, n74);
      }
    }
    if (this.intersectRayTriangleRange(t60.midStartIndex, t60.rightStartIndex), n73[s63] > o61 || r59[s63] > 0) {
      const e60 = t60.rightStartIndex, n74 = i66;
      if (e60 < n74) {
        const i67 = t60.rightNode;
        void 0 !== i67 ? this.intersectRayBSP(i67, e60, n74) : this.intersectRayTriangleRange(e60, n74);
      }
    }
  }
  get estimatedMemoryUsage() {
    return this.triangleVertexIndices.byteLength + this.indices.byteLength;
  }
};
d28.numFacesTested = 0;
var u44 = n7();
var m32 = [1 / 0, 1 / 0, 1 / 0];
var g35 = [-1 / 0, -1 / 0, -1 / 0];
function x25(t60, e59, i66, n73, r59, s63) {
  let o61 = i66, a58 = n73;
  for (; o61 < a58; ) {
    const i67 = t60[o61];
    e59[6 * i67 + r59 + 3] <= s63 ? ++o61 : (--a58, t60[o61] = t60[a58], t60[a58] = i67);
  }
  let c67 = o61;
  for (a58 = n73; c67 < a58; ) {
    const i67 = t60[a58 - 1];
    e59[6 * i67 + r59] >= s63 ? --a58 : (t60[a58 - 1] = t60[c67], t60[c67] = i67, ++c67);
  }
  return { next: o61, mid: c67 };
}
function y28(t60, e59, i66, r59) {
  if (r59 <= i66)
    return u7(NaN, NaN, NaN, NaN, NaN, NaN);
  {
    const n73 = 6 * t60[i66];
    for (let t61 = 0; t61 < 3; ++t61)
      m32[t61] = e59[n73 + 0 + t61], g35[t61] = e59[n73 + 3 + t61];
  }
  for (let n73 = i66 + 1; n73 < r59; ++n73) {
    const i67 = 6 * t60[n73];
    for (let t61 = 0; t61 < 3; ++t61)
      m32[t61] = Math.min(m32[t61], e59[i67 + 0 + t61]), g35[t61] = Math.max(g35[t61], e59[i67 + 3 + t61]);
  }
  return u7(m32[0], m32[1], m32[2], g35[0], g35[1], g35[2]);
}
function N17(t60) {
  const e59 = t60[3] - t60[0], i66 = t60[4] - t60[1], n73 = t60[5] - t60[2], r59 = e59 > i66 ? e59 > n73 ? 0 : i66 > n73 ? 1 : 2 : i66 > n73 ? 1 : n73 > e59 ? 2 : 0;
  return { axis: r59, midValue: (t60[r59] + t60[r59 + 3]) / 2 };
}
function b20(t60, e59, i66, n73, r59) {
  const s63 = i66 - e59, o61 = new Float32Array(6 * s63);
  for (let a58 = 0; a58 < s63; ++a58) {
    const i67 = 3 * (a58 + e59), s64 = t60[i67 + 0] * r59, c67 = t60[i67 + 1] * r59, h44 = t60[i67 + 2] * r59;
    for (let t61 = 0; t61 < 3; ++t61) {
      const e60 = n73[s64 + t61], i68 = n73[c67 + t61], r60 = n73[h44 + t61];
      o61[6 * a58 + t61] = Math.min(e60, i68, r60), o61[6 * a58 + 3 + t61] = Math.max(e60, i68, r60);
    }
  }
  return o61;
}
function p46(t60, e59, i66, n73) {
  const r59 = n73 - i66;
  let s63 = 0;
  for (let a58 = i66; a58 < n73; ++a58)
    for (let t61 = 0; t61 < 3; ++t61)
      s63 = Math.max(e59[3 * a58 + t61], s63);
  const o61 = s63 <= I22 ? new Uint16Array(3 * r59) : new Uint32Array(3 * r59);
  for (let a58 = 0; a58 < r59; ++a58) {
    const n74 = 3 * (t60[a58] + i66);
    for (let t61 = 0; t61 < 3; ++t61) {
      const i67 = e59[n74 + t61];
      o61[3 * a58 + t61] = i67;
    }
  }
  return o61;
}
var I22 = 65535;

// node_modules/@arcgis/core/views/3d/webgl-engine/shaders/TerrainTechnique.js
var g36 = class extends e18 {
  constructor() {
    super(...arguments), this.useStencil = false;
  }
  initializeConfiguration(i66, r59) {
    r59.spherical = i66.viewingMode === l13.Global;
  }
  initializeProgram(e59) {
    const i66 = g36.shader.get().build(this.configuration);
    return new o20(e59.rctx, i66, E7);
  }
  initializePipeline() {
    return this._stencilPipelineState = this._createPipeline(true), this._createPipeline(false);
  }
  _createPipeline(e59) {
    const i66 = this.configuration, r59 = i66.backfaceCullingEnabled && !i66.renderOccluded;
    return W({ blending: i66.renderOccluded ? s14(R4.ONE, R4.ONE_MINUS_SRC_ALPHA) : null, culling: r59 && r22, depthTest: !i66.renderOccluded && { func: I4.LESS }, depthWrite: !i66.renderOccluded && a17, colorWrite: c11, stencilTest: e59 ? t16(a13.IntegratedMeshMaskExcluded) : null });
  }
  getPipelineState(e59, i66) {
    return this.useStencil ? this._stencilPipelineState : super.getPipelineState(e59, i66);
  }
};
g36.shader = new t15(A19, () => import("./Terrain.glsl-GCT6EMLA.js"));

// node_modules/@arcgis/core/views/3d/webgl-engine/shaders/TerrainTechniqueConfiguration.js
var n61 = class extends i13 {
  constructor() {
    super(...arguments), this.output = o18.Color, this.overlayMode = p21.Disabled, this.tileBlendInput = o33.LayerOnly, this.spherical = false, this.atmosphere = false, this.receiveShadows = false, this.hasSlicePlane = false, this.backfaceCullingEnabled = false, this.stencilEnabled = false, this.textureFadingEnabled = false, this.renderOccluded = false, this.hasScreenSpaceReflections = false, this.hasCloudsReflections = false, this.tileBorders = false, this.screenSizePerspective = false, this.receiveAmbientOcclusion = false, this.shading = a("enable-feature:terrain-shading");
  }
};
e([e20({ count: o18.COUNT })], n61.prototype, "output", void 0), e([e20({ count: p21.COUNT })], n61.prototype, "overlayMode", void 0), e([e20({ count: o33.COUNT })], n61.prototype, "tileBlendInput", void 0), e([e20()], n61.prototype, "spherical", void 0), e([e20()], n61.prototype, "atmosphere", void 0), e([e20()], n61.prototype, "receiveShadows", void 0), e([e20()], n61.prototype, "hasSlicePlane", void 0), e([e20()], n61.prototype, "backfaceCullingEnabled", void 0), e([e20()], n61.prototype, "stencilEnabled", void 0), e([e20()], n61.prototype, "textureFadingEnabled", void 0), e([e20()], n61.prototype, "renderOccluded", void 0), e([e20()], n61.prototype, "hasScreenSpaceReflections", void 0), e([e20()], n61.prototype, "hasCloudsReflections", void 0), e([e20()], n61.prototype, "tileBorders", void 0), e([e20()], n61.prototype, "screenSizePerspective", void 0), e([e20()], n61.prototype, "receiveAmbientOcclusion", void 0), e([e20()], n61.prototype, "shading", void 0), e([e20({ constValue: true })], n61.prototype, "isGround", void 0), e([e20({ constValue: l14.Disabled })], n61.prototype, "pbrMode", void 0), e([e20({ constValue: false })], n61.prototype, "highStepCount", void 0), e([e20({ constValue: false })], n61.prototype, "useCustomDTRExponentForWater", void 0), e([e20({ constValue: false })], n61.prototype, "useFillLights", void 0);

// node_modules/@arcgis/core/views/3d/terrain/TerrainRenderer.js
var ae5 = 7;
var oe6 = 10;
var le6 = a8();
var de6 = n10();
var he8 = class extends y {
  constructor(e59) {
    super(e59), this.type = i23.TERRAIN, this.isGround = true, this.tileSize = 256, this._techniqueConfiguration = new n61(), this._passParameters = new N5(), this.rctx = null, this._isTransparent = false, this._scaleRangeQueries = new u43(), this.renderDataPool = new e3(T23), this._patchGroups = /* @__PURE__ */ new Map(), this.patchGroupsDirty = true, this.tileIterator = new r34(), this.highestVisibleLODTile = null, this.visible = true, this._opaque = true, this._velvetOverground = true, this._castShadows = true, this.emptyTex = null, this.tileRenderer = null, this.stencilEnabledLayerExtents = [], this.numTilesRendered = 0, this.numTilesCulled = 0, this.numOriginsRendered = 0, this.needsHighlight = false, this.renderOccludedFlags = h10.Occlude;
  }
  get isGlobal() {
    return this.stage.viewingMode === l13.Global;
  }
  get shadingEnabled() {
    var _a;
    return (_a = this._techniqueConfiguration) == null ? void 0 : _a.shading;
  }
  initialize() {
    const e59 = [E9.OPAQUE_TERRAIN, E9.TRANSPARENT_TERRAIN, E9.OCCLUDED_TERRAIN];
    this.stage.addRenderPlugin(e59, this);
  }
  destroy() {
    this.stage.removeRenderPlugin(this), c60();
  }
  get canRender() {
    return this.visible && !!this._rootTiles && !this.renderingDisabled;
  }
  set renderingDisabled(e59) {
    this._set("renderingDisabled", !!e59), this.setNeedsRender();
  }
  set opaque(e59) {
    this._opaque !== e59 && (this._opaque = e59, this.setNeedsRender());
  }
  get opaque() {
    return this._opaque && !this._techniqueConfiguration.hasSlicePlane;
  }
  get needsLinearDepth() {
    return this.overlayRenderer.hasWater;
  }
  set isTransparent(e59) {
    this._isTransparent !== e59 && (this._isTransparent = e59, this.setNeedsRender());
  }
  get isTransparent() {
    return this._isTransparent;
  }
  get renderPatchBorders() {
    return !!this._techniqueConfiguration.tileBorders;
  }
  set renderPatchBorders(e59) {
    this._techniqueConfiguration.tileBorders !== e59 && (this._techniqueConfiguration.tileBorders = e59, this.setNeedsRender(), this.notifyChange("renderPatchBorders"));
  }
  get cullBackFaces() {
    return this._techniqueConfiguration.backfaceCullingEnabled;
  }
  set cullBackFaces(e59) {
    this._techniqueConfiguration.backfaceCullingEnabled !== e59 && (this._techniqueConfiguration.backfaceCullingEnabled = e59, this.notifyChange("cullBackFaces"), this.setNeedsRender());
  }
  set renderOrder(e59) {
    this._set("renderOrder", e59), this.setNeedsRender();
  }
  set velvetOverground(e59) {
    this._velvetOverground !== e59 && (this._velvetOverground = e59, this.setNeedsRender());
  }
  get layerUid() {
    return j8;
  }
  get slicePlaneEnabled() {
    return this._techniqueConfiguration.hasSlicePlane;
  }
  set slicePlaneEnabled(e59) {
    this._techniqueConfiguration.hasSlicePlane !== e59 && (this._techniqueConfiguration.hasSlicePlane = e59, this.setNeedsRender());
  }
  set textureFadingEnabled(e59) {
    this._techniqueConfiguration.textureFadingEnabled !== e59 && (this._techniqueConfiguration.textureFadingEnabled = e59, this.setNeedsRender());
  }
  setDebugScreenSizePerspective(e59) {
    this._techniqueConfiguration.screenSizePerspective !== e59 && (this._techniqueConfiguration.screenSizePerspective = e59, this.setNeedsRender());
  }
  toggleShading() {
    this._techniqueConfiguration.shading = !this._techniqueConfiguration.shading, this.setNeedsRender();
  }
  setRootTiles(e59) {
    this._rootTiles = e59, this.setNeedsRender();
  }
  setNeedsHighlight(e59) {
    this.needsHighlight = e59, this.setNeedsRender();
  }
  setRenderOccludedOverlay(e59) {
    this.renderOccludedFlags = e59 ? ge : h10.Occlude, this.setNeedsRender();
  }
  setStencilEnabledLayerExtents(e59) {
    this.stencilEnabledLayerExtents = e59, this.setNeedsRender();
  }
  setTileSize(e59) {
    this.tileSize = e59, r(this.tileRenderer) && (this.tileRenderer.tileSize = e59), this.setNeedsRender();
  }
  _prepareTileForLoading(e59) {
    e59.renderData || (e59.renderData = this.renderDataPool.acquire(), e59.renderData.init(e59), e59.renderData.localOrigin = this._getLocalOriginOfTile(e59));
  }
  loadTile(e59) {
    this._prepareTileForLoading(e59), this.updateTileGeometry(e59), this.updateTileTexture(e59, E30.TEXTURE_FADING);
  }
  queryVisibleLevelRange(e59, t60, i66, r59) {
    this._scaleRangeQueries.queryVisibleLevelRange(e59, t60, i66, r59), this.setNeedsRender();
  }
  updateTileTexture(e59, t60) {
    r(this.tileRenderer) && (this.tileRenderer.updateTileTexture(e59, t60 === E30.TEXTURE_FADING ? A13.FADING : A13.UNFADED), this.setNeedsRender(), e59.resetPendingUpdate(t60));
  }
  updateTileGeometryState(e59) {
    this._prepareTileForLoading(e59), e59.renderData.updateGeometryStateAndPrepareForGeometryGeneration(this.wireframe);
  }
  updateTileGeometry(e59) {
    for (const t60 of e59.layerInfo[A34.ELEVATION])
      t60.pendingUpdates &= ~E30.GEOMETRY;
    e59.resetPendingUpdate(E30.GEOMETRY);
    e59.renderData.updateGeometryIfChanged(this.rctx, this.wireframe) && this.setNeedsRender();
  }
  unloadTile(e59) {
    const t60 = e59.renderData;
    t60 && (t60.releaseGeometry(), this.renderDataPool.release(t60), t60.clear(), e59.renderData = null, e59.setMemoryDirty(), this.setNeedsRender());
  }
  _getLocalOriginOfTile(e59) {
    const t60 = oe6 - ae5, i66 = Math.max(0, Math.floor((e59.level - t60) / ae5) * ae5);
    if (this.isGlobal && 0 === i66)
      return f3;
    for (; e59.parent && e59.level > i66; )
      e59 = e59.parent;
    return e59.centerAtSeaLevel;
  }
  setVisibility(e59) {
    this.visible = e59, this.setNeedsRender();
  }
  getStats() {
    return { numTilesRendered: this.numTilesRendered, numTilesCulled: this.numTilesCulled, numOriginsRendered: this.numOriginsRendered };
  }
  set wireframe(e59) {
    this._get("wireframe") !== e59 && (this._set("wireframe", e59), this.allTiles.forAll((e60) => {
      e60.isLoaded && (this.updateTileGeometry(e60), e60.updateNeighborsAfterGeometryChange());
    }), this.setNeedsRender());
  }
  setNeedsRender(e59 = t12.UPDATE) {
    this.patchGroupsDirty = true, this._context.requestRender(e59);
  }
  initializeRenderContext(e59) {
    this._context = e59, this.rctx = e59.renderContext.rctx, this._techniqueRepository = e59.shaderTechniqueRepository, this.tileRenderer = new C22(this.rctx, this.tileSize, this._techniqueRepository), this.updateTileBackground(), this.emptyTex = w5(this.rctx);
  }
  uninitializeRenderContext() {
    this.emptyTex = s(this.emptyTex), this.tileRenderer = s(this.tileRenderer);
  }
  intersect(e59, t60, i66, s63) {
    if (!this._rootTiles || e59.options.selectOpaqueTerrainOnly && e59.options.selectionMode && !this._opaque)
      return;
    const a58 = pe6, o61 = fe5;
    e7(a58, s63, i66), o3(o61, 1 / a58[0], 1 / a58[1], 1 / a58[2]);
    const l48 = e59.results.min, p52 = e59.results.max, f37 = e59.results.ground, g45 = e59.options.store === t27.MIN, m40 = !!e59.results.ground.target, _30 = L6(e59.verticalOffset), T29 = e59.tolerance;
    let y33, A39 = g45 && r(l48.dist) ? l48.dist : 1 / 0;
    const O33 = (c67) => {
      const m41 = c67.renderData;
      if (!(m41 == null ? void 0 : m41.vao))
        return;
      const O34 = m41.geometryInfo;
      A5(le6, O34.boundingBox);
      const v37 = m41.localOrigin;
      r(_30) && (_30.localOrigin = v37, _30.applyToAabb(le6));
      const x30 = le6;
      if (ge6[0] = i66[0] - v37[0], ge6[1] = i66[1] - v37[1], ge6[2] = i66[2] - v37[2], !V3(x30, ge6, o61, T29, A39))
        return;
      const P22 = (e60, t61, i67) => {
        e60.set(this.type, c67, t61, i67, o9), A39 = g45 && r(l48.dist) ? l48.dist : 1 / 0;
      }, C25 = (o62, d32) => {
        if (r(d32) && o62 >= 0 && (e59.options.backfacesTerrain || P2(d32, a58) < 0) && (e59.options.invisibleTerrain || !e59.options.selectionMode || null == t60 || t60(i66, s63, o62))) {
          if ((null == f37.dist || o62 < f37.dist) && P22(f37, o62, d32), e59.options.isFiltered)
            return;
          e59.options.store === t27.ALL && (t(y33) ? (y33 = U12(e59.ray), P22(y33, o62, d32), e59.results.all.push(y33)) : o62 < y33.dist && P22(y33, o62, d32)), (null == l48.dist || o62 < l48.dist) && P22(l48, o62, d32), e59.options.store !== t27.MIN && (null == p52.dist || o62 > p52.dist) && P22(p52, o62, d32);
        }
      }, E39 = me6;
      e7(E39, s63, v37);
      const D21 = O34.indices, q18 = O34.vertexAttributes, S25 = { data: q18.getField(O3.POSITION, i4).typedBuffer, size: 3, stride: q18.stride / 4 }, N23 = O34.indexCount / 3;
      if (t(_30) && N23 > s57) {
        const e60 = c67.renderData;
        t(e60.intersectionData) && (e60.intersectionData = new d28(D21, 0, N23, S25)), e60.intersectionData.intersectRay({ r0: ge6, r1: E39 }, C25);
      } else
        v6(ge6, E39, 0, N23, D21, S25, null, _30, C25);
    }, v36 = this._rootTiles;
    if (r(v36)) {
      (() => {
        const t61 = this.tileIterator;
        t61.reset(v36);
        const s64 = e59.options.invisibleTerrain;
        for (; !t61.done; ) {
          const e60 = t61.next();
          !(e60.visible || s64 && e60.intersectsClippingArea) || !r(_30) && !e60.intersectsRay(i66, a58, T29, A39) || m40 && this._useStencilForTile(e60) ? t61.skipSubtree() : O33(e60);
        }
      })();
    }
  }
  prepareTechnique(e59) {
    if (e59.bindParameters.slot === E9.OCCLUDED_TERRAIN) {
      if (0 == (e59.renderOccludedMask & ge))
        return null;
    } else {
      const t60 = this.opaque ? E9.OPAQUE_TERRAIN : E9.TRANSPARENT_TERRAIN;
      if (e59.bindParameters.slot !== t60)
        return null;
    }
    switch (e59.pass) {
      case A12.MATERIAL: {
        this._techniqueConfiguration.hasScreenSpaceReflections = e59.bindParameters.ssr.enabled, this._techniqueConfiguration.hasCloudsReflections = r(e59.bindParameters.clouds.data), this._techniqueConfiguration.receiveShadows = e59.bindParameters.shadowMap.ready, this._techniqueConfiguration.receiveAmbientOcclusion = e59.bindParameters.ssaoHelper.ready, this._techniqueConfiguration.overlayMode = this.overlayRenderer.isEmpty() ? p21.Disabled : this.overlayRenderer.hasWater ? p21.EnabledWithWater : p21.Enabled;
        const t60 = e59.bindParameters.slot === E9.OCCLUDED_TERRAIN ? h14.Occluded : h14.ColorAndWater;
        return this._updateTechnique(o18.Color, t60 === h14.Occluded);
      }
      case A12.MATERIAL_DEPTH_SHADOWMAP_ALL:
      case A12.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:
        return this._castShadows && 1 === e59.bindParameters.lighting.globalFactor ? (this._techniqueConfiguration.receiveShadows = this._techniqueConfiguration.receiveAmbientOcclusion = false, this._updateTechnique(o18.Shadow, false)) : null;
      case A12.MATERIAL_DEPTH:
        return this.isTransparent && this.overlayRenderer.isEmpty() ? null : (this._techniqueConfiguration.receiveShadows = this._techniqueConfiguration.receiveAmbientOcclusion = false, this._updateTechnique(o18.Depth, false));
      case A12.MATERIAL_NORMAL:
        return this._techniqueConfiguration.receiveShadows = this._techniqueConfiguration.receiveAmbientOcclusion = false, this._updateTechnique(o18.Normal, false);
      case A12.MATERIAL_HIGHLIGHT:
        return this.needsHighlight ? (this._techniqueConfiguration.receiveShadows = this._techniqueConfiguration.receiveAmbientOcclusion = false, this._updateTechnique(o18.Highlight, false)) : null;
    }
    return null;
  }
  render(e59, t60) {
    const i66 = e59.pass, r59 = 1 === e59.bindParameters.lighting.globalFactor;
    switch (this._updatePatchGroups(), t60.useStencil = false, i66) {
      case A12.MATERIAL: {
        const i67 = e59.bindParameters.slot === E9.OCCLUDED_TERRAIN ? h14.Occluded : h14.ColorAndWater;
        this._renderMaterialPass(e59, t60, i67);
        break;
      }
      case A12.MATERIAL_DEPTH_SHADOWMAP_ALL:
      case A12.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:
        this._castShadows && r59 && this._renderAuxiliaryPass(e59, t60, h14.None);
        break;
      case A12.MATERIAL_DEPTH:
        this.isTransparent && this.overlayRenderer.isEmpty() || this._renderAuxiliaryPass(e59, t60, h14.None);
        break;
      case A12.MATERIAL_NORMAL:
        this._renderAuxiliaryPass(e59, t60, h14.None);
        break;
      case A12.MATERIAL_HIGHLIGHT:
        this.needsHighlight && (this._renderAuxiliaryPass(e59, t60, h14.Highlight), e59.rctx.clearSafe(_2.DEPTH_BUFFER_BIT));
    }
    this._scaleRangeQueries.hasPendingQueries() && this.setNeedsRender();
  }
  _renderMaterialPass(e59, t60, i66) {
    const { rctx: r59 } = e59;
    this._passParameters.overlaySource = i66, r59.bindTechnique(t60, this._passParameters, e59.bindParameters), this.numTilesRendered = 0, this.numTilesCulled = 0, this.numOriginsRendered = 0, this._scaleRangeQueries.prepareQueries(), this.opaque ? this._renderPatchGroups(e59, t60, i66) : e59.offscreenRenderingHelper.renderToTargets(() => this._renderPatchGroups(e59, t60, i66), e59.offscreenRenderingHelper.tmpColor, e59.offscreenRenderingHelper.mainDepth, [0, 0, 0, 0]), this._scaleRangeQueries.processQueries();
  }
  _renderAuxiliaryPass(e59, t60, i66) {
    const r59 = e59.rctx;
    this._passParameters.overlaySource = i66, r59.bindTechnique(t60, this._passParameters, e59.bindParameters), this._renderPatchGroupsAuxiliary(e59, t60, i66);
  }
  updateTileBackground(e59 = null) {
    if (t(this.tileRenderer))
      return;
    const i66 = this.tileRenderer;
    let s63 = null;
    if (r(e59)) {
      const i67 = l5.toUnitRGBA(e59);
      s63 = r6(i67[0] || 0, i67[1] || 0, i67[2] || 0);
    }
    i66.setBackground(s63), this.allTiles.forAll((e60) => i66.updateTileTexture(e60, A13.FADING)), this._techniqueConfiguration.tileBlendInput = i66.backgroundIsGrid ? o33.GridComposite : r(i66.backgroundColor) ? o33.ColorComposite : o33.LayerOnly, this.setNeedsRender();
  }
  _updatePatchGroups() {
    if (this.patchGroupsDirty) {
      if (this.highestVisibleLODTile = null, this._rebuildPatchGroups(), this.renderOrder !== O28.NONE) {
        const e59 = Array.from(this._patchGroups.values());
        e59.forEach((e60) => a26(this.renderOrder, e60)), e59.sort((e60, t60) => h16(e60[0], t60[0], this.renderOrder)), this._patchGroups = new Map(e59.map((e60) => [e60[0].renderData.localOrigin, e60]));
      }
      this.patchGroupsDirty = false;
    }
  }
  _rebuildPatchGroups() {
    var _a;
    const e59 = this._rootTiles;
    if (!t(e59)) {
      (_a = e59[0]) == null ? void 0 : _a.surface.checkAllTileWaterproofness(), this._patchGroups.clear();
      for (const t60 of e59)
        this._rebuildPatchGroupsForRootTile(t60);
    }
  }
  _rebuildPatchGroupsForRootTile(e59) {
    const t60 = this.tileIterator;
    for (t60.resetOne(e59); !t60.done; ) {
      const e60 = t60.next(), i66 = e60.renderData;
      if (!i66 || e60.visible)
        if (e60.rendered) {
          if (i66) {
            const r59 = this._patchGroups.get(i66.localOrigin) || new Array();
            this._patchGroups.set(i66.localOrigin, r59), r59.push(e60), (!this.highestVisibleLODTile || e60.vlevel > this.highestVisibleLODTile.vlevel) && (this.highestVisibleLODTile = e60), t60.skipSubtree();
          }
        } else
          this.numTilesCulled++;
      else
        this.numTilesCulled++, t60.skipSubtree();
    }
  }
  _useStencilForTile(e59) {
    for (const t60 of this.stencilEnabledLayerExtents)
      if (e59.intersectsExtent(t60))
        return true;
    return false;
  }
  _renderPatchGroupsAuxiliary(e59, t60, i66) {
    const r59 = this.stencilEnabledLayerExtents.length > 0;
    this._patchGroups.forEach((s63) => {
      const n73 = s63[0].renderData.localOrigin;
      t60.program.bindDraw(new i24(n73), e59.bindParameters);
      for (let a58 = 0; a58 < s63.length; a58++)
        this._renderPatch(e59, t60, s63[a58], E5.TRIANGLES, r59, i66);
    }), e59.rctx.bindVAO(null);
  }
  _renderPatchGroups(e59, t60, i66) {
    const s63 = e59.rctx, a58 = e59.bindParameters.camera, o61 = t60.program;
    if (this._techniqueConfiguration.screenSizePerspective && this.pointsOfInterest) {
      const e60 = r21(this.stage.viewingMode, this.ellipsoidRadius), t61 = this.pointsOfInterest.centerOnSurfaceFrequent.distance;
      e60.update({ distance: t61, fovY: a58.fovY });
    }
    const l48 = this.stencilEnabledLayerExtents.length > 0, d32 = i66 === h14.Occluded;
    d32 && (o61.bindTexture("tex", this.emptyTex), o61.setUniform1f("blend", 1), o61.setUniform4fv("texOffsetAndScale", l7));
    const h44 = r(this.tileRenderer) && r(this.tileRenderer.backgroundColor) ? this.tileRenderer.backgroundColor : f3;
    this._techniqueConfiguration.tileBlendInput === o33.ColorComposite && o61.setUniform3fv("backgroundColor", h44);
    const c67 = this.wireframe ? E5.LINES : E5.TRIANGLES;
    this._techniqueConfiguration.textureFadingEnabled && o61.bindTexture("texNext", this.emptyTex), this._patchGroups.forEach((s64) => {
      const a59 = s64[0].renderData.localOrigin;
      t60.program.bindDraw(new i24(a59), e59.bindParameters), this.numOriginsRendered++;
      for (let h45 = 0; h45 < s64.length; h45++) {
        const a60 = s64[h45], u51 = a60.renderData.textureReference;
        if (!t(u51)) {
          if (!d32) {
            this._scaleRangeQueries.scaleQueriesForTile(a60), ue6(a60.renderData.geometryInfo.uvOffsetAndScale, u51.offsetAndScale, de6), o61.setUniform4fv("texOffsetAndScale", de6), o61.bindTexture("tex", u51.texture.texture);
            const e60 = a60.renderData.textureFadeFactor, t61 = e60 < 1 ? a60.renderData.nextTextureReference : null;
            this._techniqueConfiguration.textureFadingEnabled && r(t61) && e60 < 1 ? (ue6(a60.renderData.geometryInfo.uvOffsetAndScale, t61.offsetAndScale, de6), o61.setUniform1f("fadeFactor", e60), o61.setUniform4fv("nextTexOffsetAndScale", de6), o61.setUniform3fv("nextTexOpacities", t61.opacities), o61.bindTexture("texNext", t61.texture.texture)) : o61.setUniform1f("fadeFactor", 1), a60.renderData.textureIsFading && this.setNeedsRender(), o61.setUniform3fv("textureOpacities", u51.opacities);
          }
          this._renderPatch(e59, t60, a60, c67, l48, i66), a60.renderOrder = this.numTilesRendered, this.numTilesRendered++;
        }
      }
    }), s63.bindVAO(null);
  }
  _renderPatch(e59, t60, i66, r59, s63, a58) {
    const o61 = i66.renderData, l48 = o61.vao, d32 = l48.indexBuffer;
    if (t(d32))
      return;
    const h44 = t60.program;
    a58 !== h14.None && this._bindOverlayPatchData(h44, o61.overlay), s63 && (t60.useStencil = this._useStencilForTile(i66), t60.bindPipelineState(e59.rctx, e59.bindParameters.slot));
    const c67 = o61.geometryInfo.indexCount;
    e59.rctx.bindVAO(l48), h44.assertCompatibleVertexAttributeLocations(l48), e59.rctx.drawElements(r59, c67, d32.indexType, 0);
  }
  _bindOverlayPatchData(e59, t60) {
    e59.setUniform4fv("overlayTexOffset", t60.offsets), e59.setUniform4fv("overlayTexScale", t60.scales);
  }
  _updateTechnique(e59, t60) {
    return this._techniqueConfiguration.output = e59, e59 === o18.Color && (this._techniqueConfiguration.atmosphere = this.isGlobal && this._velvetOverground), this._techniqueConfiguration.renderOccluded = t60, this._techniqueConfiguration.stencilEnabled = false, this._shaderTechnique = this._techniqueRepository.releaseAndAcquire(g36, this._techniqueConfiguration, this._shaderTechnique), this._shaderTechnique;
  }
  get test() {
    return { tileRenderer: this.tileRenderer };
  }
};
e([d({ constructOnly: true })], he8.prototype, "overlayRenderer", void 0), e([d({ constructOnly: true })], he8.prototype, "stage", void 0), e([d({ readOnly: true })], he8.prototype, "isGlobal", null), e([d({ constructOnly: true })], he8.prototype, "allTiles", void 0), e([d({ constructOnly: true })], he8.prototype, "ellipsoidRadius", void 0), e([d({ value: false })], he8.prototype, "renderingDisabled", null), e([d()], he8.prototype, "renderPatchBorders", null), e([d()], he8.prototype, "cullBackFaces", null), e([d({ value: O28.FRONT_TO_BACK })], he8.prototype, "renderOrder", null), e([d()], he8.prototype, "wireframe", null), he8 = e([n6("esri.views.3d.terrain.TerrainRenderer")], he8);
var ce7 = he8;
function ue6(e59, t60, i66) {
  i66[0] = e59[0] * t60[2] + t60[0], i66[1] = e59[1] * t60[3] + t60[1], i66[2] = e59[2] * t60[2], i66[3] = e59[3] * t60[3];
}
var pe6 = n7();
var fe5 = n7();
var ge6 = n7();
var me6 = n7();

// node_modules/@arcgis/core/views/3d/terrain/TerrainSurfacePerformanceInfo.js
var e48 = class {
  constructor() {
    this.numNodes = 0, this.numLeaves = 0, this.numVisible = 0, this.numRendered = 0, this.numSplit = 0, this.numMerged = 0, this.numRenderedPerLevel = new Array(), this.numLoadedPerLevel = new Array();
  }
};

// node_modules/@arcgis/core/views/3d/terrain/TilingSchemeLogic.js
var g37 = class extends y {
  constructor(e59) {
    super(e59), this._handles = new u4();
  }
  initialize() {
    this._handles.add(this.layers.on("change", () => this._update())), this._handles.add(l6(() => this.extentHelper.layerViewsExtent, () => this._setAdHocTilingScheme())), this._update(), this.tilingSchemeLocked || this._setAdHocTilingScheme();
  }
  destroy() {
    this._handles = l(this._handles), this._waitTask = null;
  }
  _update() {
    if (this._waitTask = null, this.tilingSchemeLocked)
      return;
    let e59;
    if (this.layers.some((t60) => !(!t10(t60) || t60.isRejected()) && (!(t60.isFulfilled() && !f32(t60, this.viewSpatialReference, this.viewingMode)) && (e59 = t60, !("vector-tile" === (t60 == null ? void 0 : t60.type) || H7(t60))))), e59)
      if (e59.isResolved()) {
        const t60 = C5(e59, this.viewSpatialReference, this.viewingMode);
        if (r(t60)) {
          const e60 = new M7(t60.tileInfo);
          this._lockTilingScheme(e60);
        }
      } else
        this._updateWhen(e59);
  }
  _updateWhen(e59) {
    const t60 = e59.when().catch(() => {
    }).then(() => {
      t60 !== this._waitTask || this.destroyed || this._update();
    });
    this._waitTask = t60;
  }
  _lockTilingScheme(e59) {
    if (this.viewingMode === l13.Global) {
      const t60 = e59.levels.length - 1;
      e59.spatialReference.isWebMercator ? e59 = M7.makeWebMercatorAuxiliarySphere(t60) : Ce(e59.spatialReference) && (e59 = M7.makeGCSWithTileSize(e59.spatialReference, e59.pixelSize, t60));
    }
    this.tilingSchemeLocked = true, this.tilingScheme = e59, this.extentHelper.tilingScheme = this.tilingScheme, this._updateTiledLayerExtent(), this._handles.removeAll(), this._handles.add(l6(() => this.extentHelper.tiledLayersExtent, () => this._updateTiledLayerExtent()));
  }
  _updateTiledLayerExtent() {
    this._set("extent", this.extentHelper.tiledLayersExtent);
  }
  _setAdHocTilingScheme() {
    if (this.viewingMode === l13.Global) {
      const e59 = this.extentHelper.viewSpatialReference, t60 = Ce(e59) || P(e59) || s5(e59);
      e59.isWebMercator ? this.tilingScheme = M7.WebMercatorAuxiliarySphere : t60 && (this.tilingScheme = M7.makeGCSWithTileSize(e59, 256)), this._set("extent", this.extentHelper.layerViewsExtent);
    } else {
      const e59 = this.extentHelper.layerViewsExtent;
      r(e59) && !I2(e59, this.extent) && (this.tilingScheme = M7.fromExtent(e59, this.extentHelper.viewSpatialReference), this._set("extent", e59));
    }
  }
  get test() {
    return { lockTilingScheme: (e59) => this._lockTilingScheme(e59), done: !this._waitTask };
  }
};
function f32(e59, t60, i66) {
  return r(C5(e59, t60, i66));
}
e([d()], g37.prototype, "tilingScheme", void 0), e([d({ readOnly: true })], g37.prototype, "extent", void 0), e([d({ value: false })], g37.prototype, "tilingSchemeLocked", void 0), e([d({ constructOnly: true })], g37.prototype, "viewSpatialReference", void 0), e([d({ constructOnly: true })], g37.prototype, "layers", void 0), e([d({ constructOnly: true })], g37.prototype, "extentHelper", void 0), e([d({ constructOnly: true })], g37.prototype, "viewingMode", void 0), g37 = e([n6("esri.views.3d.terrain.TilingSchemeLogic")], g37);

// node_modules/@arcgis/core/views/3d/terrain/UpsampleInfo.js
var t54 = class {
  constructor() {
    this.offset = n17(), this.scale = 0, this.tile = null;
  }
  init(s63, t60, i66, e59) {
    this.tile = s63, this.offset[0] = t60, this.offset[1] = i66, this.scale = e59;
  }
  dispose() {
    this.tile = null, this.offset[0] = 0, this.offset[1] = 0, this.scale = 0;
  }
};

// node_modules/@arcgis/core/views/3d/terrain/TerrainSurface.js
var Xe = s3.getLogger("esri.views.3d.terrain.TerrainSurface");
var ze2 = 0.25;
var Ye = class extends n8.EventedMixin(y) {
  constructor(e59) {
    var _a, _b;
    super(e59), this._elevationBounds = new s52(), this._iteratorPool = new e3(r34, (e60) => e60.remove = () => this._iteratorPool.release(e60)), this._postorderIterator = new i27(), this._hasPendingUpdates = false, this._pendingUpdates = 0, this._asyncWorkItems = 0, this._allTilesDirty = true, this._allTilesSorted = true, this._visible = false, this._usedMemory = null, this._performanceInfo = new e48(), this._viewChanged = false, this._inFrameTask = false, this._viewChangeUpdateDirty = false, this._eyePosRenderSR = n7(), this._eyePosSurfaceSR = n7(), this._splitLimits = new re3(), this._snapLevel = 1 / 0, this._frustum = H3(), this._viewProjectionMatrix = e12(), this._layerViews = [new Array(), new Array()], this._layerIndexByUid = [/* @__PURE__ */ new Map(), /* @__PURE__ */ new Map()], this._basemapLayerViewHandles = /* @__PURE__ */ new Map(), this._handles = new u4(), this._watchUpdatingTracking = new c7(), this._frameTask = Q2, this._allTiles = new n2(), this._upsampleInfoPool = new e3(t54), this._rootTilesExtent = u6(), this._maxNumUpdating = 1, this.maxTextureScale = 1.2, this.backgroundColor = null, this._updatingRootTiles = false, this.deferTileNeighborUpdate = false, this.neighborTilesToUpdate = /* @__PURE__ */ new Set(), this.totalGeometryUpdates = 0, this.totalTileUpdates = 0, this._layerViewsDirty = false, this._isGlobal = !((_b = (_a = e59.view) == null ? void 0 : _a.state) == null ? void 0 : _b.isLocal);
  }
  initialize() {
    this._lercDecoder = n18(this.view.resourceController), this._tilePool = this.view.state.isLocal ? new e3(f29) : new e3(D17);
    const e59 = this.view.resourceController.memoryController;
    this._upsampleMapCache = e59.newCache("esri.views.3d.terrain.upsample", (e60) => e60.unloadMapData()), this._elevationQueryCache = new t35(e59.newCache("elevation-query")), this._set("overlayManager", new le3({ surface: this })), this._handles.add([l6(() => this.overlayManager.hasHighlights, (e60) => this._renderer.setNeedsHighlight(e60)), l6(() => this.overlayManager.rendersOccluded, (e60) => this._renderer.setRenderOccludedOverlay(e60))], "overlayManager"), this._renderer = new ce7({ overlayRenderer: this.overlayManager.renderer, ellipsoidRadius: p3(this.view.spatialReference).radius, stage: this.view._stage, allTiles: this._allTiles }), this._handles.add([l6(() => this.baseOpacity, (e60) => {
      this._handleLayerViewChanges(), this._updateBaseOpacity(e60);
    }, w2), l6(() => this.hasCompositeBlendMode, () => {
      this._updateBaseOpacity(this.baseOpacity);
    }, w2), l6(() => this.renderingDisabled, () => this._updateTransparentTerrain(), U3), l6(() => this.backgroundColor, (e60) => {
      this._handleLayerViewChanges(), this._renderer.updateTileBackground(e60);
    }, w2), l6(() => this.view.pointsOfInterest, (e60) => {
      this._renderer.pointsOfInterest = e60, this._watchUpdatingTracking.removeAll(), e60 && this._watchUpdatingTracking.add(() => e60.focus.renderLocation, () => () => this._allTilesSorted = false);
    }), l6(() => t25.TERRAIN_TILE_TREE_SHOW_TILES, (e60) => {
      e60 && !this._treeDebugger ? import("./TerrainTileTree3DDebugger-MDXQ4SMQ.js").then(({ TerrainTileTree3DDebugger: e61 }) => {
        !this._treeDebugger && t25.TERRAIN_TILE_TREE_SHOW_TILES && (this._treeDebugger = new e61({ view: this.view }));
      }) : e60 || (this._treeDebugger = l(this._treeDebugger));
    }, h3)]), this._extentHelper = g33(this.viewingMode, { layers: this.view.map.allLayers, layerViews: this.view.allLayerViews, viewSpatialReference: this.view.spatialReference });
    const t60 = this.view.defaultsFromMap ? new p11({ getCollections: () => {
      var _a, _b, _c;
      return (_c = (_b = (_a = this.view) == null ? void 0 : _a.defaultsFromMap) == null ? void 0 : _b.mapCollections) == null ? void 0 : _c.map(({ layers: e60 }) => e60);
    }, getChildrenFunction: (e60) => e60 && "layers" in e60 ? e60.layers : null }) : this.view.map.allLayers, i66 = new g37({ layers: t60, extentHelper: this._extentHelper, viewingMode: this.viewingMode, viewSpatialReference: this.view.spatialReference });
    this._set("tilingSchemeLogic", i66), this._updateTilingScheme(), this._elevationDataRequester = this.view.resourceController.createStreamDataRequester(A16.ELEVATION), this._mapDataRequester = this.view.resourceController.createStreamDataRequester(A16.BASEMAP);
    const r59 = this.view.resourceController.scheduler;
    this._frameTask = r59.registerTask(L3.TERRAIN_SURFACE, this), this._handles.add([l6(() => this._extentHelper.stencilEnabledExtents, (e60) => this._renderer.setStencilEnabledLayerExtents(e60), h3), l6(() => this.tilingSchemeLogic.tilingScheme, () => this._updateTilingScheme(), U3), l6(() => this.extent, () => this._updateRootTiles(), h3), this.view.on("resize", () => this._viewChangeUpdate()), l6(() => {
      var _a, _b;
      const e60 = this.view, t61 = e60.state;
      return [this.lodBias, this.lodSnapping, (_b = (_a = e60.resourceController) == null ? void 0 : _a.memoryController) == null ? void 0 : _b.memoryFactor, t61.camera, t61.contentCamera, t61.fixedContentCamera];
    }, () => this._viewChangeUpdate(), w2), l6(() => {
      var _a, _b;
      return (_b = (_a = this.view.qualitySettings) == null ? void 0 : _a.tiledSurface) == null ? void 0 : _b.textureFadeDuration;
    }, (e60) => this._renderer.textureFadingEnabled = e60 > 0, h3), l6(() => this._userClippingExtent, () => this._updateClippingExtent(), U3)]), this._handles.add(this.view.allLayerViews.on("after-changes", () => this._layerViewsDirty = true)), this._layerViewsDirty = true, this._handleLayerViewChanges();
  }
  destroy() {
    this._frameTask.remove(), this._handles.destroy(), this._watchUpdatingTracking.destroy(), this._lercDecoder = p(this._lercDecoder), this._removeAllTiles(), this._upsampleMapCache = l(this._upsampleMapCache), this._elevationQueryCache = l(this._elevationQueryCache), this._set("tilingSchemeLogic", l(this.tilingSchemeLogic)), this._extentHelper = l(this._extentHelper), this._basemapLayerViewHandles.forEach((e59, t60) => this._unregisterTiledLayerView(t60)), this._elevationDataRequester = null, this._mapDataRequester = null, this._set("overlayManager", l(this.overlayManager)), this._tilePool = l(this._tilePool), ae3.prune(), this._treeDebugger && (this._treeDebugger.destroy(), this._treeDebugger = null), this._renderer = l(this._renderer), this._iteratorPool = l(this._iteratorPool), this._set("view", null), this._upsampleInfoPool = l(this._upsampleInfoPool), p19(), u42();
  }
  get renderer() {
    return this._renderer;
  }
  get frustum() {
    return this._frustum;
  }
  get snapLevel() {
    var _a, _b;
    const e59 = (_b = (_a = this.view.pointsOfInterest) == null ? void 0 : _a.contentCameraOnSurface) == null ? void 0 : _b.scale;
    if (e59) {
      const t60 = this.view.state.contentCamera;
      let i66 = re2(this.view, t60.eye, t60.viewForward, t60.up).tilt;
      i66 > 90 && (i66 = 180 - i66);
      const r59 = 2 * (i66 / 90) ** 2, s63 = xe(this.view, e59) - r59;
      Math.abs(this._snapLevel - s63) > ze2 && (Math.round(s63) !== Math.round(this._snapLevel) && (this._viewChanged = true), this._snapLevel = s63);
    }
    return Math.round(this._snapLevel);
  }
  get lodSnapping() {
    return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences ? S6.ON : S6.OFF;
  }
  get upsampleInfoPool() {
    return this._upsampleInfoPool;
  }
  get upsampleMapCache() {
    return this._upsampleMapCache;
  }
  get elevationQueryCache() {
    return this._elevationQueryCache;
  }
  get mapTileRequester() {
    return this._mapDataRequester;
  }
  get _userClippingExtent() {
    const { spatialReference: e59 } = this, { clippingArea: t60 } = this.view;
    if (t(t60) || t(e59))
      return null;
    const i66 = u6(), r59 = e24(t60, i66, e59) ? i66 : null, s63 = this._get("extent");
    return I2(r59, s63) ? s63 : r59;
  }
  get rootTilesExtent() {
    return this._rootTilesExtent;
  }
  get extent() {
    const e59 = U4(this.groundExtent, this._userClippingExtent, u6()), t60 = this._get("extent");
    return I2(e59, t60) ? t60 : e59;
  }
  get groundExtent() {
    return r(this._tilingSchemeExtent) ? this._tilingSchemeExtent : this._rootTilesExtent;
  }
  get _tilingSchemeExtent() {
    var _a;
    return (_a = this.tilingSchemeLogic) == null ? void 0 : _a.extent;
  }
  get updating() {
    return this._hasPendingUpdates || (this._maxNumUpdating = 1), !!((this._watchUpdatingTracking.updating || this._hasPendingUpdates || this._viewChanged || this._allTilesDirty || this._asyncWorkItems > 0 || !this._allTilesSorted || this._layerViewsDirty) && this.ready && !this.suspended || this.overlayManager.updating || this._frameTask.updating);
  }
  get updatingProgressValue() {
    return this._maxNumUpdating = Math.max(this._pendingUpdates, this._maxNumUpdating), 1 - this._pendingUpdates / this._maxNumUpdating;
  }
  get viewingMode() {
    return this.view.state.viewingMode;
  }
  get ready() {
    return r(this.rootTiles);
  }
  set renderOrder(e59) {
    this._renderer.renderOrder = e59, this._set("renderOrder", e59);
  }
  get spatialReference() {
    var _a;
    return ((_a = this.tilingScheme) == null ? void 0 : _a.spatialReference) ?? null;
  }
  set slicePlaneEnabled(e59) {
    this._renderer.slicePlaneEnabled = e59, this._set("slicePlaneEnabled", e59), this._updateTransparentTerrain();
  }
  _updateTransparentTerrain() {
    var _a, _b;
    const e59 = !this.renderingDisabled && !this.opaque;
    (_b = (_a = this.view) == null ? void 0 : _a._stage) == null ? void 0 : _b.renderView.setRenderParameters({ transparentTerrain: e59 });
  }
  set velvetOverground(e59) {
    e59 !== this.velvetOverground && (this._renderer.velvetOverground = e59), this._set("velvetOverground", e59);
  }
  set visible(e59) {
    e59 !== this._visible && (this._visible = e59, this._renderer.setVisibility(e59), this.suspended = !e59);
  }
  get opaque() {
    return this._renderer.opaque;
  }
  set suspended(e59) {
    this._set("suspended", e59), this._viewChangeUpdate();
  }
  intersect(e59, t60, i66, r59) {
    this._renderer.intersect(e59, t60, i66, r59);
  }
  getElevation(e59, t60, i66, r59) {
    const s63 = this.getTileWithElevation(e59, t60, i66, r59, et4);
    return t(s63) ? null : l39(et4[0], et4[1], s63.renderData.geometryState.samplerData);
  }
  getTileWithElevation(e59, t60, i66, r59, s63 = et4) {
    var _a;
    const a58 = this.rootTiles;
    if (t(a58) || !a58.length)
      return null;
    if (0 === a58[0].layerInfo[A34.ELEVATION].length)
      return null;
    if (s63[0] = e59, s63[1] = t60, s63[2] = i66, !Bn(s63, r59, s63, (_a = this.tilingScheme) == null ? void 0 : _a.spatialReference))
      return Xe.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"), null;
    for (let n73 of a58) {
      if (!n73.containsPoint(s63))
        continue;
      for (; n73 && !n73.rendered && !n73.isLeaf; ) {
        let e61 = 0;
        s63[0] > 0.5 * (n73.extent[0] + n73.extent[2]) && (e61 += 1), s63[1] < 0.5 * (n73.extent[1] + n73.extent[3]) && (e61 += 2), n73 = n73.children[e61];
      }
      const e60 = n73.renderData;
      return (e60 ? e60.geometryState.samplerData : null) ? n73 : null;
    }
    return null;
  }
  get elevationBounds() {
    return this._elevationBounds;
  }
  getScale(e59) {
    if (this.tilingScheme) {
      if (!Hn(e59, et4, this.spatialReference))
        return Xe.error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"), null;
      const t60 = this.rootTiles;
      if (r(t60)) {
        for (let e60 of t60)
          if (e60 == null ? void 0 : e60.containsPoint(et4)) {
            for (; !e60.isLeaf && !e60.rendered; ) {
              let t61 = 0;
              et4[0] > e60.children[0].extent[2] && (t61 += 1), et4[1] < e60.children[0].extent[1] && (t61 += 2), e60 = e60.children[t61];
            }
            return this._getLodBiasCorrectedScale(e60.level);
          }
      }
    }
    return 1e100;
  }
  getSphereElevationBounds(e59, t60, i66, r59, s63) {
    var _a;
    if (et4[0] = e59, et4[1] = t60, et4[2] = i66, et4[3] = r59, !Bn(et4, s63, et4, (_a = this.tilingScheme) == null ? void 0 : _a.spatialReference))
      return Xe.error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"), null;
    let a58 = 1 / 0, n73 = -1 / 0;
    const o61 = (e60) => {
      if (e60 && g3(e60.extent, et4))
        if (e60.isLeaf || e60.rendered)
          a58 = Math.min(a58, e60.elevationBounds[0]), n73 = Math.max(n73, e60.elevationBounds[1]);
        else
          for (const t61 of e60.children)
            o61(t61);
    }, l48 = this.rootTiles;
    if (r(l48))
      for (const h44 of l48)
        o61(h44);
    return { min: a58, max: n73 };
  }
  getSphereScale(e59, t60) {
    if (!this.tilingScheme)
      return null;
    if (!Hn(e59, et4, this.spatialReference))
      return Xe.error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"), null;
    et4[3] = t60;
    let i66 = null;
    const r59 = (e60) => {
      if (e60 && g3(e60.extent, et4))
        if (e60.isLeaf || e60.rendered) {
          const t61 = this._getLodBiasCorrectedScale(e60.level);
          i66 = null == i66 ? t61 : Math.min(i66, t61);
        } else
          for (const t61 of e60.children)
            r59(t61);
    }, s63 = this.rootTiles;
    if (r(s63))
      for (const a58 of s63)
        r59(a58);
    return i66;
  }
  queryVisibleScaleRange(e59, t60, i66, r59) {
    const s63 = t60 ? this.tilingScheme.levelAtScale(t60) : 0, a58 = i66 ? this.tilingScheme.levelAtScale(i66) : 1 / 0, n73 = this.lodBias;
    this._renderer.queryVisibleLevelRange(e59, s63 + n73, a58 + n73, r59);
  }
  _updateBaseOpacity(e59) {
    const t60 = this._renderer.opaque;
    this._renderer.opaque = e59 >= 1 && !this.hasCompositeBlendMode, this._renderer.isTransparent = this._allSurfaceLayersTransparent();
    const i66 = t60 !== this._renderer.opaque;
    i66 && this._updateTransparentTerrain(), this._updateTileTextures(i66 ? A13.UNFADED : A13.IMMEDIATE);
  }
  _updateTilingScheme() {
    var _a, _b;
    const e59 = this.tilingSchemeLogic.tilingScheme;
    e59 !== this.tilingScheme && (T9(!!e59, "tiling scheme cannot be reset to undefined"), this._isGlobal = !((_b = (_a = this.view) == null ? void 0 : _a.state) == null ? void 0 : _b.isLocal), this.tilingScheme && this._removeAllTiles(), this._set("tilingScheme", e59), this._updateClippingExtent(), e59 && (this._updateTiledLayers(), this._renderer.setTileSize(e59.pixelSize), this.overlayManager.setSpatialReference(e59.spatialReference), this._updateRootTiles()));
  }
  _acquireTile(e59, t60, i66, r59) {
    const s63 = this._tilePool.acquire();
    return it4[0] = e59, it4[1] = t60, it4[2] = i66, s63.init(it4, r59, this), s63;
  }
  get updatingRootTiles() {
    return this._updatingRootTiles;
  }
  _updateRootTiles() {
    const { extent: e59, tilingScheme: t60 } = this;
    if (!t60)
      return;
    const i66 = tt3;
    let s63 = t60.rootTilesInExtent(e59, i66, 5 * t23);
    if (r(this.rootTiles)) {
      if (s63.length > t23)
        return void Xe.warn(a23);
      const e60 = this.rootTiles.map((e61) => e61.lij), t61 = s2(e60, s63, Ke2);
      if (this._updatingRootTiles = true, t61.removed.length > 0 || t61.added.length > 0) {
        const e61 = this.rootTiles.filter((e62) => !(t61.removed.findIndex((t62) => Ke2(t62, e62.lij)) > -1) || (this._purgeTile(e62, true), false));
        t61.added.forEach((t62) => e61.push(this._newRootTile(t62))), this._setRootTiles(e61);
      }
    } else
      this._updatingRootTiles = true, s63.length > t23 && (Xe.warn(u16), s63 = t60.rootTilesInExtent(e59, i66, t23)), this._setRootTiles(s63.map((e60) => this._newRootTile(e60)));
    I2(i66, this._rootTilesExtent) || (this._rootTilesExtent = u6(i66)), this.visible = true, this._viewChangeUpdate(), this.overlayManager.setPlacementDirty(), this.notifyChange("ready"), this._allTiles.forEach((e60) => {
      e60.isLoaded && this._prepareToLoadTile(e60);
    }), this._allTiles.forAll((e60) => {
      e60.isLoaded && (this._updateTileGeometry(e60), this._updateTileNeighborsAfterGeometryChange(e60));
    }), this._updatingRootTiles = false, this.checkAllTileWaterproofness();
  }
  _newRootTile(e59) {
    const t60 = this._acquireTile(0, e59[1], e59[2], null);
    return t60.shouldSplit(this._splitLimits, this._eyePosRenderSR, this.lodSnapping) === E30.SPLIT && t60.setPendingUpdate(E30.SPLIT), this._loadTile(t60), this.deferTileNeighborUpdate || t60.checkGeometryWaterproofness(), t60;
  }
  _setRootTiles(e59) {
    if (this._set("rootTiles", e59), this._allTiles.clear(), r(e59)) {
      const t60 = this._iteratorPool.acquire();
      for (t60.reset(e59); !t60.done; )
        this._allTiles.push(t60.next());
      t60.remove();
    }
    this._renderer.setRootTiles(this.rootTiles), this._updateTilesVisibility(e59);
  }
  _runViewChangeUpdateIfDirty() {
    this._viewChangeUpdateDirty && (this._viewChangeUpdateDirty = false, this._viewChangeUpdate());
  }
  _viewChangeUpdate() {
    this.view && !this.suspended && this.tilingScheme && this._visible && (this._inFrameTask ? this._viewChangeUpdateDirty = true : (this._viewChangeUpdateDirty = false, this._updateViewDependentParameters(), this._updateTilesVisibility(this.rootTiles)));
  }
  _updateClippingStatus(e59) {
    e59.updateClippingStatus(this.extent) && e59.resetPendingUpdate(E30.GEOMETRY) && this._updateTileGeometry(e59);
  }
  _updateTilesVisibility(e59) {
    if (t(e59))
      return;
    const t60 = m12(e59);
    let i66 = t60 ? this._elevationBounds.min : 1 / 0, r59 = t60 ? this._elevationBounds.max : -1 / 0;
    const s63 = this.extent, a58 = this._viewProjectionMatrix;
    this.setTileTreeDirty();
    const n73 = this._iteratorPool.acquire();
    for (n73.reset(e59); !n73.done; ) {
      const e60 = n73.next();
      e60.updateClippingStatus(s63) && e60.resetPendingUpdate(E30.GEOMETRY) && this._updateTileGeometry(e60), e60.setPendingUpdate(E30.RENDERDATA), e60.computeVisibility(), e60.updateScreenDepth(a58), e60.renderData && (i66 = Math.min(e60.elevationBounds[0], i66), r59 = Math.max(e60.elevationBounds[1], r59));
    }
    n73.remove(), this._viewChanged = true, this._allTilesDirty = true, isFinite(i66) && isFinite(r59) && (this._elevationBounds.min === i66 && this._elevationBounds.max === r59 || (this._elevationBounds.min = i66, this._elevationBounds.max = r59, this.emit("elevation-bounds-change", null)));
  }
  _updateViewDependentParameters() {
    const e59 = this.view.state.camera, t60 = this.view.state.contentCamera, i66 = Math.tan(0.5 * t60.fovX), r59 = Math.tan(0.5 * t60.fovY), s63 = this.tilingScheme.pixelSize, a58 = 2 ** -this.lodBias * e59.pixelRatio;
    this._splitLimits.aboveGround = e59.aboveGround, this._splitLimits.fovX = i66, this._splitLimits.fovY = r59, this._splitLimits.relativeWidthLimit = s63 / e59.width * this.maxTextureScale * a58, this._splitLimits.relativeHeightLimit = s63 / e59.height * this.maxTextureScale * a58, this._splitLimits.maxLod = this.tilingScheme.getMaxLod(), this._splitLimits.angledSplitBias = this.view.qualitySettings.tiledSurface.angledSplitBias, this.view.state.fixedContentCamera ? (t(this._splitLimits.frustum) && (this._splitLimits.frustum = H3()), i15(this._splitLimits.frustum, t60.frustum)) : this._splitLimits.frustum = null, i15(this._frustum, e59.frustum), u5(this._viewProjectionMatrix, t60.projectionMatrix, t60.viewMatrix), r7(this._eyePosRenderSR, t60.eye), Bn(e59.eye, this.view.renderSpatialReference, this._eyePosSurfaceSR, this.spatialReference);
  }
  _updateRenderData(e59) {
    e59.rendered && !e59.shouldLoad && (Je2(e59) ? (this._loadChildren(e59), this.deferTileNeighborUpdate || (this._checkTileNeighborsWaterproofness(e59), e59.children.forEach((e60) => e60.checkGeometryWaterproofness()))) : Ze2(e59) && this._loadParent(e59));
  }
  _updateTileGeometry(e59) {
    e59.updateVisibility(), this._renderer.updateTileGeometry(e59), this._updateTileNeighborsAfterGeometryChange(e59), this._elevationUpdate(e59), this._usedMemory = null, this.deferTileNeighborUpdate && this.neighborTilesToUpdate.delete(e59);
  }
  _updateTileNeighborsAfterGeometryChange(e59, t60) {
    if (this.deferTileNeighborUpdate) {
      const t61 = this.neighborTilesToUpdate;
      e59.forEachLoadedNeighbor((e60) => {
        t61.add(e60);
      });
    } else
      e59.updateNeighborsAfterGeometryChange(t60);
  }
  _updateTileTexture(e59, t60) {
    const i66 = e59.resetPendingUpdate(E30.TEXTURE_FADING) ? E30.TEXTURE_FADING : !!e59.resetPendingUpdate(E30.TEXTURE_NOFADING) && E30.TEXTURE_NOFADING;
    i66 && (this._renderer.updateTileTexture(e59, i66), this._usedMemory = null, t60.madeProgress());
  }
  _elevationUpdate(e59) {
    st3.spatialReference = this.spatialReference, st3.tile = e59, st3.extent = e59.extent, this.emit("elevation-change", st3);
  }
  get running() {
    return this.updating && this.ready && !this.suspended;
  }
  runTask(e59) {
    this._handleLayerViewChanges(e59), this._frameTask.processQueue(e59), this._inFrameTask = true, this._pendingUpdates = 0, this._hasPendingUpdates = false, this._updateTileStatus(e59), this._sortTiles(e59);
    const t60 = !this.view.state.fixedContentCamera;
    this._mergeAndSplit(e59, t60), e59.run(() => this._updateElevation(e59)), e59.run(() => this._updateTextures(e59)), t60 || this._mergeAndSplit(e59, true), this._inFrameTask = false, this._runViewChangeUpdateIfDirty(), e59.done ? this.requestUpdate() : this._usedMemory = this._recalculateUsedMemory(), this.notifyChange("updatingProgressValue");
  }
  _updateTileStatus(e59) {
    if (!this._viewChanged || !this.rootTiles || e59.done)
      return;
    this._viewChanged = false;
    const t60 = this._iteratorPool.acquire();
    for (t60.reset(this.rootTiles); !t60.done; ) {
      const e60 = t60.next(), i66 = e60.shouldSplit(this._splitLimits, this._eyePosRenderSR, this.lodSnapping);
      if (i66 !== E30.SPLIT) {
        if (e60.resetPendingUpdate(E30.SPLIT) && e60.updateAgentSuspension(), i66 === E30.VSPLITMERGE && e60.updateAgents(A34.ELEVATION), t60.skipSubtree(), !e60.isLeaf) {
          e60.setPendingUpdate(E30.MERGE), e60.resetPendingUpdate(E30.SPLIT);
          const t61 = this._iteratorPool.acquire();
          t61.resetOne(e60);
          for (let e61 = t61.next(); !t61.done; e61 = t61.next())
            this._updateClippingStatus(e61), e61.updateVisibility(), e61.updateScreenDepth(this._viewProjectionMatrix);
          t61.remove();
        }
      } else
        e60.resetPendingUpdate(E30.MERGE), e60.isLeaf && (e60.setPendingUpdate(E30.SPLIT), t60.skipSubtree());
    }
    t60.remove(), this.requestUpdate(), e59.madeProgress();
  }
  _sortTiles(e59) {
    e59.done || this._allTilesSorted || (c24(this._allTiles, this.view.pointsOfInterest.focus.renderLocation), this._allTilesSorted = true, this._treeDebugger && this._treeDebugger.update(), e59.madeProgress());
  }
  _prepareBatchTileGeometryUpdate() {
    E13(0 === this.neighborTilesToUpdate.size), this.deferTileNeighborUpdate = true;
  }
  _batchUpdateUpdatedTileNeighbors() {
    this.deferTileNeighborUpdate = false;
    const e59 = this.neighborTilesToUpdate;
    (() => {
      const t60 = () => {
        for (const t61 of e59)
          t61.updateNeighborsWithChangedEdgeResolution();
      };
      (() => {
        for (const t61 of e59)
          t61.updateNeighborDataAndGeometryIfNeeded();
      })(), t60(), e59.clear();
    })();
  }
  _mergeAndSplit(e59, t60) {
    if (this.suspended || e59.done || !this._allTilesDirty)
      return;
    this._allTilesDirty = false, this.requestUpdate(), this._prepareBatchTileGeometryUpdate();
    let i66 = false, r59 = false;
    for (; !e59.done; ) {
      r59 = true;
      let s63 = false;
      const a58 = !this._allTiles.some((r60) => {
        if (!i66 && !r60.loadable)
          return e59.done;
        if (r60.resetPendingUpdate(E30.MERGE)) {
          if (!t60)
            return r60.setPendingUpdate(E30.MERGE), e59.done;
          this._mergeTile(r60), s63 = true, e59.madeProgress();
        } else
          r60.resetPendingUpdate(E30.SPLIT) && (this._splitTile(r60), s63 = true, e59.madeProgress());
        return !e59.done && r60.resetPendingUpdate(E30.RENDERDATA) && (this._updateRenderData(r60), e59.madeProgress()), e59.done;
      });
      if (s63 && (this._allTilesSorted = false, this._allTilesDirty = true), a58) {
        if (!i66) {
          i66 = true;
          continue;
        }
        if (!s63)
          break;
        this._updateTilesVisibility(this.rootTiles);
      } else
        this._allTilesDirty = true;
    }
    r59 || (this._allTilesDirty = true), this._batchUpdateUpdatedTileNeighbors(), this._sortTiles(e59);
  }
  _updateElevation(e59) {
    return this._prepareBatchTileGeometryUpdate(), this._allTiles.some((t60) => (t60.resetPendingUpdate(E30.GEOMETRY) && (this._updateTileGeometry(t60), this._updateTileTexture(t60, e59), e59.madeProgress()), e59.done)), this._batchUpdateUpdatedTileNeighbors(), e59.hasProgressed;
  }
  _updateTextures(e59) {
    return this._allTiles.some((t60) => (this._updateTileTexture(t60, e59), e59.done)), e59.hasProgressed;
  }
  _updateClippingExtent() {
    this.spatialReference && (this.updateTileOverlayParams(t12.UPDATE), this.overlayManager.setPlacementDirty(), this._updateRootTiles());
  }
  get lodBias() {
    const e59 = this.view.resourceController.memoryController.memoryFactor;
    return this.view.qualitySettings.tiledSurface.lodBias - (1 - e59) * e23;
  }
  _getLodBiasCorrectedScale(e59) {
    const t60 = this.tilingScheme.levels, i66 = o4(e59 - this.lodBias, 0, t60.length - 1), r59 = i66 - Math.floor(i66);
    return t60[Math.floor(i66)].scale * (1 - r59) + t60[Math.ceil(i66)].scale * r59;
  }
  _removeAllTiles() {
    r(this.rootTiles) && (this.rootTiles.forEach((e59) => this._purgeTile(e59, false)), this._setRootTiles(null), this.notifyChange("ready")), this._allTiles.clear(), this.visible = false;
  }
  _purgeDescendantTiles(e59) {
    if (e59.isLeaf)
      return false;
    let t60 = false;
    for (let i66 = 0; i66 < 4; ++i66)
      t60 = this._purgeTile(e59.children[i66], false) || t60;
    return e59.unsetChildren(), t60;
  }
  _purgeTile(e59, t60) {
    const i66 = this._purgeDescendantTiles(e59) || e59.rendered;
    return this._allTiles.removeUnordered(e59), this._unloadTile(e59), t60 && this._updateTileNeighborsAfterGeometryChange(e59), this._tilePool.release(e59), i66;
  }
  _unloadTile(e59) {
    this.deferTileNeighborUpdate && this.neighborTilesToUpdate.delete(e59), e59.unload(this._renderer);
  }
  _splitTile(e59) {
    T9(e59.isLeaf, "tile that is already split should not be split again!");
    const t60 = e59.level + 1, i66 = 2 * e59.lij[1], r59 = 2 * e59.lij[2];
    e59.setChildren(this._createTile(t60, i66, r59, e59), this._createTile(t60, i66, r59 + 1, e59), this._createTile(t60, i66 + 1, r59, e59), this._createTile(t60, i66 + 1, r59 + 1, e59)), e59.setPendingUpdate(E30.RENDERDATA), e59.updateAgentSuspension(), this._allTiles.pushArray(e59.children), this._allTilesDirty = true, this._emitTileScaleChange(e59, t60), ++this._performanceInfo.numSplit;
  }
  _emitTileScaleChange(e59, t60 = e59.level) {
    at3.spatialReference = this.spatialReference, at3.extent = e59.extent, at3.scale = this._getLodBiasCorrectedScale(t60), this.emit("scale-change", at3);
  }
  _createTile(e59, t60, i66, r59) {
    T9(!!r59, "_createTile sanity check");
    const s63 = this._acquireTile(e59, t60, i66, r59);
    return s63.updateClippingStatus(this.extent), s63.updateScreenDepth(this._viewProjectionMatrix), s63.shouldSplit(this._splitLimits, this._eyePosRenderSR, this.lodSnapping) === E30.SPLIT && s63.setPendingUpdate(E30.SPLIT), s63;
  }
  _mergeTile(e59) {
    T9(!e59.hasPendingUpdate(E30.SPLIT), "_mergeTile sanity check"), this._purgeDescendantTiles(e59) && (T9(!e59.renderData, "_mergeTile sanity check"), this._loadTile(e59), this._updateTileNeighborsAfterGeometryChange(e59), this.deferTileNeighborUpdate || this._checkTileAndNeighborsWaterproofness(e59)), this._allTilesDirty = true, ++this._performanceInfo.numMerged, this._emitTileScaleChange(e59);
  }
  _checkTileAndNeighborsWaterproofness(e59) {
    e59.checkGeometryWaterproofness(), this._checkTileNeighborsWaterproofness(e59);
  }
  _checkTileNeighborsWaterproofness(e59) {
    m10 && e59.forallNeighbors((e60) => !!e60.isLoaded && (e60.checkGeometryWaterproofness(), true));
  }
  _loadChildren(e59) {
    this.deferTileNeighborUpdate || this._checkTileAndNeighborsWaterproofness(e59), T9(e59.rendered, "parent should be rendered"), this._unloadTile(e59);
    const t60 = e59.children;
    t60.forEach((e60) => this._prepareToLoadTile(e60)), t60.forEach((e60) => this._loadTilePrepared(e60)), this._updateTileNeighborsAfterGeometryChange(e59, e59.level + 1), this.deferTileNeighborUpdate || (t60.forEach((e60) => e60.updateNeighborsWithChangedEdgeResolution()), t60.forEach((e60) => e60.checkGeometryWaterproofness()), this._checkTileNeighborsWaterproofness(e59));
  }
  _loadParent(e59) {
    this.deferTileNeighborUpdate || this._checkTileAndNeighborsWaterproofness(e59);
    const t60 = e59.parent;
    this._unloadChildren(t60), this._loadTile(t60), this._updateTileNeighborsAfterGeometryChange(t60), this.deferTileNeighborUpdate || this._checkTileAndNeighborsWaterproofness(t60);
  }
  _unloadChildren(e59) {
    if (!e59.isLeaf)
      for (let t60 = 0; t60 < 4; ++t60) {
        const i66 = e59.children[t60];
        this._unloadChildren(i66), this._unloadTile(i66);
      }
  }
  _postLoadTile(e59) {
    e59.setPendingUpdate(E30.RENDERDATA), this.requestUpdate(), this._allTilesDirty = true, this.overlayManager && this.overlayManager.hasOverlays && this.overlayManager.setTileParameters(e59), this._elevationUpdate(e59);
  }
  _loadTile(e59) {
    e59.load(this._renderer), this._postLoadTile(e59);
  }
  _loadTilePrepared(e59) {
    e59.loadPrepared(this._renderer), this._postLoadTile(e59);
  }
  _prepareToLoadTile(e59) {
    e59.prepareToLoad(this._renderer);
  }
  _elevationDataArrived(e59, t60, i66) {
    const r59 = new e44(e59.lij, e59.extent, i66);
    e59.dataArrived(t60, A34.ELEVATION, r59);
    const s63 = [e59], a58 = e59.level, n73 = this._iteratorPool.acquire();
    for (n73.reset(s63); !n73.done; ) {
      const e60 = n73.next();
      e60.findElevationBoundsForLayer(t60, a58), e60.computeElevationBounds();
    }
    n73.remove(), this._updateTilesVisibility(s63);
  }
  _handleLayerViewChanges(e59 = w3) {
    if (!this._layerViewsDirty)
      return;
    this._layerViewsDirty = false;
    let t60 = false;
    const i66 = /* @__PURE__ */ new Set();
    let r59 = -1;
    for (const s63 of this.view.allLayerViews.items)
      if (i66.add(s63.uid), x5(s63))
        if (this._basemapLayerViewHandles.has(s63.uid)) {
          const e60 = this._layerClassFromLayerView(s63), i67 = this._getLayerIdxByUID(e60, s63.uid);
          r(i67) && ((i67 < r59 || t(r59)) && (t60 = true), r59 = i67);
        } else
          this._registerTiledLayerView(s63), s63.layer.loaded && (t60 = true);
    this._basemapLayerViewHandles.forEach((e60, r60) => {
      i66.has(r60) || (this._unregisterTiledLayerView(r60), t60 = true);
    }), t60 && this._updateTiledLayers(), this._renderer.isTransparent = this._allSurfaceLayersTransparent(), this.hasCompositeBlendMode = this._hasCompositeBlendMode(), e59.madeProgress();
  }
  _allSurfaceLayersTransparent() {
    var _a, _b;
    let e59 = 0 === ((_b = (_a = this.view.map) == null ? void 0 : _a.ground) == null ? void 0 : _b.opacity);
    for (const t60 of this.view.allLayerViews.items)
      if (W4(t60) && !i5(t60.layer) && 0 !== t60.fullOpacity)
        return e59 = false, e59;
    return e59;
  }
  _hasCompositeBlendMode() {
    for (const e59 of this.view.allLayerViews.items)
      if (U10(e59)) {
        const t60 = R6(e59.layer.parent) ? "normal" : e59.layer.blendMode;
        if (i28(o32[t60]))
          return true;
      }
    return false;
  }
  _layerClassFromLayerView(e59) {
    return I6(e59) ? A34.ELEVATION : A34.MAP;
  }
  _registerTiledLayerView(e59) {
    const t60 = [], i66 = this._layerClassFromLayerView(e59);
    t60.push(l6(() => e59.suspended, () => this._updateTiledLayers())), t60.push(l6(() => e59.fullOpacity, () => this._updateTileTextures(A13.UNFADED))), t60.push(l6(() => "effectiveScaleRange" in e59.layer ? e59.layer.effectiveScaleRange : null, () => this._restartAllAgents(i66))), U10(e59) && t60.push(l6(() => e59.layer.blendMode, () => {
      this.hasCompositeBlendMode = this._hasCompositeBlendMode(), this._updateTileTextures(A13.UNFADED);
    })), e59.on("data-changed", () => {
      const t61 = this._getLayerIdxByUID(i66, e59.uid);
      r(t61) && this._invalidateLayerData(t61, i66);
    }), this._basemapLayerViewHandles.set(e59.uid, t60);
  }
  _unregisterTiledLayerView(e59) {
    const t60 = this._basemapLayerViewHandles.get(e59);
    if (t60) {
      for (let e60 = 0; e60 < t60.length; e60++)
        t60[e60].remove();
      this._basemapLayerViewHandles.delete(e59);
    }
  }
  _updateTiledLayers() {
    if (!this.tilingScheme || this.view.suspended)
      return;
    const e59 = this.view.allLayerViews, t60 = [[], []];
    let i66 = null;
    e59.forEach((e60) => {
      if (!e60.layer || e60.suspended || !x5(e60) || !e60.fullExtent)
        return;
      const r59 = this._layerClassFromLayerView(e60);
      if (r59 === A34.MAP) {
        const t61 = e60.displayLevelRange.maxLevel;
        t61 !== 1 / 0 && (null === i66 || t61 > i66) && (i66 = t61);
      }
      t60[r59].push(e60);
    });
    for (const r59 of E29) {
      const e60 = this._layerViews[r59], i67 = t60[r59];
      i67.reverse();
      const s63 = i67.length;
      let a58 = e60.length !== s63;
      const n73 = new Array(s63), o61 = new Array(e60.length);
      this._layerIndexByUid[r59].clear();
      for (let t61 = 0; t61 < s63; t61++) {
        const s64 = i67[t61].uid;
        this._layerIndexByUid[r59].set(s64, t61);
        const l48 = e60.indexOf(i67[t61]);
        n73[t61] = l48, t61 !== l48 && (a58 = true), l48 > -1 && (o61[l48] = t61);
      }
      if (a58) {
        const e61 = this._postorderIterator;
        for (e61.reset(this.rootTiles); !e61.done; )
          e61.next().modifyLayers(o61, n73, r59);
        this._layerViews[r59] = i67, this._restartAllAgents(r59), this._updateTilesVisibility(this.rootTiles);
      }
    }
    this.tilingScheme.ensureMaxLod(i66) && this._viewChangeUpdate();
  }
  _restartAllAgents(e59) {
    const t60 = this._postorderIterator;
    for (t60.reset(this.rootTiles); !t60.done; ) {
      const i66 = t60.next();
      i66.restartAgents(e59), e59 === A34.ELEVATION && i66.computeElevationBounds();
    }
  }
  layerViewByIndex(e59, t60) {
    return this._layerViews[t60][e59];
  }
  numLayers(e59) {
    return this._layerViews[e59].length;
  }
  _updateTileTextures(e59) {
    this._allTiles.forAll((t60) => {
      t60.updateAgents(A34.MAP), e59 === A13.IMMEDIATE ? this.renderer.updateTileTexture(t60, E30.TEXTURE_NOFADING) : t60.updateRenderData(A34.MAP, e59);
    }), this._renderer.isTransparent = this._allSurfaceLayersTransparent();
  }
  _invalidateLayerData(e59, t60) {
    this._allTiles.forAll((i66) => i66.removeLayerAgent(e59, t60)), this._allTiles.forAll((i66) => i66.invalidateLayerData(e59, t60));
  }
  setTileTreeDirty() {
    this._allTilesDirty = true;
  }
  requestRender(e59 = t12.UPDATE) {
    this.renderer.setNeedsRender(e59);
  }
  requestUpdate() {
    1 == ++this._pendingUpdates && (this._hasPendingUpdates = true);
  }
  requestTileData(e59, t60, i66, r59) {
    const s63 = this.layerViewByIndex(t60, i66), a58 = s63.layer;
    return !a58.tilemapCache || _6(s63) ? this._requestTileData(e59, i66, s63, r59) : (++this._asyncWorkItems, a58.tilemapCache.fetchAvailability(e59.lij[0], e59.lij[1], e59.lij[2], { ...r59, timeout: 6e3 }).then(() => --this._asyncWorkItems).catch((t61) => {
      throw --this._asyncWorkItems, g(t61) || this._dataMissing(e59, i66, s63, { notInTilemap: true }), t61;
    }).then(() => this._frameTask.schedule(() => this._requestTileData(e59, i66, s63, r59), r59.signal)));
  }
  _requestTileData(e59, t60, i66, r59) {
    return t60 === A34.ELEVATION ? I6(i66) ? this._requestElevationTileData(e59, i66, r59) : Promise.reject() : W4(i66) ? this._requestMapTileData(e59, i66, r59) : Promise.reject();
  }
  _requestElevationTileData(e59, t60, i66) {
    ++this._asyncWorkItems;
    const r59 = (r60) => {
      if (p2(i66))
        return;
      const s64 = this._layerIndexByUid[A34.ELEVATION].get(t60.uid);
      null != s64 ? (this._usedMemory = null, this.requestUpdate(), this._elevationDataArrived(e59, s64, r60)) : Xe.warn("TerrainSurface: received data from unknown layer %d %s", A34.ELEVATION, e59.lij.toString());
    }, s63 = (i67) => {
      g(i67) || (this._dataMissing(e59, A34.ELEVATION, t60, i67), this.requestUpdate());
    };
    if (v8(t60.layer))
      return t60.layer.fetchTile(e59.lij[0], e59.lij[1], e59.lij[2], { noDataValue: C4, signal: i66.signal }).then((e60) => {
        if (!p2(i66))
          return this._frameTask.schedule(() => r59(e60), i66.signal, s63);
        Xe.warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true.");
      }, s63).finally(() => {
        --this._asyncWorkItems;
      });
    const a58 = t60.getTileUrl(e59.lij[0], e59.lij[1], e59.lij[2]);
    return this._elevationDataRequester.request(a58, "binary", i66).then((e60) => this._lercDecoder.decode(e60, { noDataValue: C4 }, i66.signal)).then((e60) => {
      e60 ? r59({ values: e60.pixelData, width: e60.width, height: e60.height, noDataValue: e60.noDataValue, minValue: e60.minValue, maxValue: e60.maxValue }) : s63(new Error("LERC decoding failed"));
    }, s63).finally(() => {
      --this._asyncWorkItems;
    });
  }
  _requestMapTileData(e59, t60, i66) {
    ++this._asyncWorkItems;
    const r59 = (r60, s64) => {
      --this._asyncWorkItems, j11(s64), p2(i66) || (this._dataMissing(e59, A34.MAP, t60, r60), this.requestUpdate());
    }, s63 = (e60) => (t61) => r59(t61, e60), a58 = (r60) => this._frameTask.schedule(() => {
      --this._asyncWorkItems, this.requestUpdate(), p2(i66) ? j11(r60) : this._mapTileDataArrived(e59, t60, r60);
    }, i66.signal, s63(r60)).catch(s63(r60)), n73 = (e60, t61 = null) => this._frameTask.schedule(() => r59(e60, t61));
    if (_6(t60)) {
      const r60 = t60.schemaHelper.getLevelRowColumn(e59.lij);
      return t60.fetchTile(r60[0], r60[1], r60[2], i66).then(a58, n73);
    }
    if (O8(t60))
      return t60.fetchTile(e59.lij[0], e59.lij[1], e59.lij[2], i66).then(a58, n73);
    if (g10(t60) && v8(t60.layer))
      return t60.layer.fetchTile(e59.lij[0], e59.lij[1], e59.lij[2], i66).then((e60) => {
        if (p2(i66))
          return Xe.warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."), void n73(m3());
        a58(e60);
      }, n73);
    let o61 = t60.getTileUrl(e59.lij[0], e59.lij[1], e59.lij[2]);
    p12(t60.layer) && t60.layer.refreshTimestamp && (o61 += `${o61.includes("?") ? "&" : "?"}_ts=${t60.layer.refreshTimestamp}`);
    const l48 = t60.hasMixedImageFormats ? "image+type" : "image";
    return this._mapDataRequester.request(o61, l48, i66).then(a58, n73);
  }
  _mapTileDataArrived(e59, t60, i66) {
    const r59 = this._getLayerIdxByUID(A34.MAP, t60.uid);
    r(r59) ? e59.dataArrived(r59, A34.MAP, i66) : (j11(i66), Xe.warn("TerrainSurface: received data from unknown layer"));
  }
  _getLayerIdxByUID(e59, t60) {
    return this._layerIndexByUid[e59].get(t60);
  }
  _dataMissing(e59, t60, i66, r59) {
    const s63 = this._getLayerIdxByUID(t60, i66.uid);
    r(s63) ? e59.dataMissing(s63, t60, r59) : Xe.warn("TerrainSurface: received data from unknown layer");
  }
  updateTileOverlayParams(e59) {
    this.rootTiles && this.overlayManager && (this._allTiles.forAll((e60) => {
      e60.renderData && this.overlayManager.setTileParameters(e60);
    }), this._renderer.setNeedsRender(e59));
  }
  get performanceInfo() {
    const e59 = this._performanceInfo;
    return e59.numNodes = this._allTiles.length, e59.numLeaves = e59.numVisible = e59.numRendered = e59.numLoadedPerLevel.length = e59.numRenderedPerLevel.length = 0, this._allTiles.forAll((t60) => {
      t60.isLeaf && e59.numLeaves++;
      const i66 = t60.level;
      t60.renderData && (e59.numLoadedPerLevel[i66] = (e59.numLoadedPerLevel[i66] || 0) + 1), t60.visible && (e59.numVisible++, t60.rendered && (e59.numRenderedPerLevel[i66] = (e59.numRenderedPerLevel[i66] || 0) + 1, e59.numRendered++));
    }), e59;
  }
  getUsedMemory() {
    return this.tilingScheme ? (t(this._usedMemory) && (this._usedMemory = this._recalculateUsedMemory()), r(this._usedMemory) ? this._usedMemory : 0) : 0;
  }
  _recalculateUsedMemory() {
    return this.tilingScheme ? this._allTiles.reduce((e59, t60) => e59 + t60.usedMemory, 0) : null;
  }
  getUsedMemoryForLayerView(e59) {
    let t60 = 0;
    const i66 = this._layerClassFromLayerView(e59), r59 = this._getLayerIdxByUID(i66, e59.uid);
    return r(r59) && this._allTiles.forAll((e60) => t60 += e60.getUsedMemoryForLayer(i66, r59)), t60;
  }
  getTile(e59) {
    if (t(e59) || t(this.rootTiles))
      return null;
    const t60 = e59.split("/").map((e60) => +e60);
    if (0 === t60[0])
      return this.rootTiles.find((e60) => e60.lij[1] === t60[1] && e60.lij[2] === t60[2]);
    const i66 = 2 ** t60[0], r59 = Math.floor(t60[1] / i66), s63 = Math.floor(t60[2] / i66);
    let a58;
    if (this.rootTiles.some((e60) => e60.lij[1] === r59 && e60.lij[2] === s63 && (a58 = e60, true)), a58) {
      let e60 = 1 << t60[0] - 1;
      for (; a58.lij[0] < t60[0]; ) {
        let i67 = t60[1] & e60 ? 2 : 0;
        if ((t60[2] & e60) > 0 && i67++, !a58.children[i67])
          return null;
        a58 = a58.children[i67], e60 >>= 1;
      }
      return T9(a58.lij[0] === t60[0] && a58.lij[1] === t60[1] && a58.lij[2] === t60[2], "not the right tile?"), a58;
    }
    return null;
  }
  get test() {
    const e59 = this;
    return { renderer: e59._renderer, lercDecoder: e59._lercDecoder, forceReload: () => {
      r(e59.rootTiles) && (e59._mergeTile(e59.rootTiles[0]), e59._viewChangeUpdate());
    }, getTiles: () => e59._allTiles.toArray(), getRenderedTiles() {
      rt3.clear(), e59._allTiles.forAll((e60) => {
        e60.visible && e60.rendered && rt3.push(e60);
      });
      const t60 = rt3.toArray();
      return a26(e59.renderOrder, t60), t60;
    }, lockTilingScheme(t60, i66) {
      e59._extentHelper.defaultTiledLayersExtent = i66, e59.tilingSchemeLogic.test.lockTilingScheme(t60);
    } };
  }
  checkAllTileWaterproofness() {
    if (!m10)
      return;
    const e59 = this.rootTiles;
    if (t(e59))
      return;
    const t60 = (e60) => {
      var _a, _b, _c;
      return ((_c = (_b = (_a = e60 == null ? void 0 : e60.renderData) == null ? void 0 : _a.geometryInfo) == null ? void 0 : _b.indices) == null ? void 0 : _c.length) > 0;
    }, i66 = (e60, i67) => {
      t60(e60) && console.error("Tile[", e60.lij, "] has geometry although parent[", i67.lij, "] has geom");
    }, r59 = (e60) => {
      var _a, _b;
      if (e60.renderData && !e60.renderData.geometryState && console.error("Tile[", e60.lij, "] has renderData but not geometryState"), e60.renderData && !e60.renderData.geometryInfo && console.error("Tile[", e60.lij, "] has renderData but not geometryInfo"), !((_a = e60.renderData) == null ? void 0 : _a.geometryInfo) || (((_b = e60.renderData.geometryInfo.indices) == null ? void 0 : _b.length) ?? 0) > 0 || console.error("Tile[", e60.lij, "] has renderData but no indices - geometryInfo: ", e60.renderData.geometryInfo), t60(e60)) {
        e60.checkGeometryWaterproofness();
        for (const t61 of e60.children)
          i66(t61, e60);
      } else if (e60.isLeaf)
        console.error("Tile[", e60.lij, "] has no geometry and no children, from root to leaf");
      else
        for (const t61 of e60.children)
          r59(t61);
    }, s63 = (e60) => {
      var _a;
      const t61 = ((_a = e60.parent) == null ? void 0 : _a.visible) ?? true, i67 = e60.visible;
      e60.computeVisibility();
      const r60 = e60.visible;
      if (i67 !== r60 && t61 && console.error(" Tile[", e60.lij, "] has out of date visibility: ", i67, " instead of ", r60), !e60.isLeaf)
        for (const a58 of e60.children)
          s63(a58);
    };
    for (const a58 of e59)
      r59(a58), s63(a58);
  }
  get isGlobal() {
    return this._isGlobal;
  }
  get shadingEnabled() {
    return this._renderer.shadingEnabled;
  }
  get isWebMercator() {
    var _a;
    return !!((_a = this.tilingScheme) == null ? void 0 : _a.spatialReference.isWebMercator);
  }
  get isWebMercatorOnPlateeCarree() {
    var _a;
    return this.isWebMercator && T((_a = this.view) == null ? void 0 : _a.renderSpatialReference);
  }
  isEastEndWrap(e59) {
    return this.isGlobal && e59[2] === this.lijEastEnd(e59[0]) - 1;
  }
  isWestEndWrap(e59) {
    return this.isGlobal && 0 === e59[2];
  }
  lijEastEnd(e59) {
    return 2 ** (e59 + (this.spatialReference.isGeographic ? 1 : 0));
  }
  wrapEastWest(e59) {
    const t60 = this.lijEastEnd(e59[0]), i66 = e59[2];
    if (0 <= i66 && i66 < t60)
      return e59;
    if (!this.isGlobal)
      return null;
    const r59 = (i66 + (i66 < 0 ? t60 : 0)) % t60;
    return [e59[0], e59[1], r59];
  }
};
e([d()], Ye.prototype, "_renderer", void 0), e([d()], Ye.prototype, "_hasPendingUpdates", void 0), e([d()], Ye.prototype, "_asyncWorkItems", void 0), e([d()], Ye.prototype, "_allTilesDirty", void 0), e([d()], Ye.prototype, "_allTilesSorted", void 0), e([d()], Ye.prototype, "_viewChanged", void 0), e([d({ readOnly: true })], Ye.prototype, "_watchUpdatingTracking", void 0), e([d()], Ye.prototype, "_frameTask", void 0), e([d({ readOnly: true })], Ye.prototype, "snapLevel", null), e([d({ readOnly: true })], Ye.prototype, "lodSnapping", null), e([d({ constructOnly: true })], Ye.prototype, "view", void 0), e([d()], Ye.prototype, "_userClippingExtent", null), e([d()], Ye.prototype, "_rootTilesExtent", void 0), e([d({ readOnly: true })], Ye.prototype, "extent", null), e([d({ readOnly: true })], Ye.prototype, "groundExtent", null), e([d({ readOnly: true })], Ye.prototype, "_tilingSchemeExtent", null), e([d({ readOnly: true })], Ye.prototype, "updating", null), e([d(t24)], Ye.prototype, "updatingProgress", void 0), e([d({ readOnly: true })], Ye.prototype, "updatingProgressValue", null), e([d()], Ye.prototype, "_maxNumUpdating", void 0), e([d({ aliasOf: "view.map.ground.opacity" })], Ye.prototype, "baseOpacity", void 0), e([d()], Ye.prototype, "hasCompositeBlendMode", void 0), e([d({ readOnly: true })], Ye.prototype, "overlayManager", void 0), e([d({ readOnly: true })], Ye.prototype, "viewingMode", null), e([d()], Ye.prototype, "maxTextureScale", void 0), e([d({ readOnly: true })], Ye.prototype, "ready", null), e([d({ value: O28.FRONT_TO_BACK })], Ye.prototype, "renderOrder", null), e([d({ readOnly: true })], Ye.prototype, "rootTiles", void 0), e([d({ readOnly: true })], Ye.prototype, "spatialReference", null), e([d({ type: l5, aliasOf: "view.map.ground.surfaceColor" })], Ye.prototype, "backgroundColor", void 0), e([d({ value: false })], Ye.prototype, "slicePlaneEnabled", null), e([d({ readOnly: true })], Ye.prototype, "tilingScheme", void 0), e([d({ readOnly: true, aliasOf: "tilingSchemeLogic.tilingSchemeLocked" })], Ye.prototype, "tilingSchemeLocked", void 0), e([d({ readOnly: true })], Ye.prototype, "tilingSchemeLogic", void 0), e([d({ value: true })], Ye.prototype, "velvetOverground", null), e([o15("_renderer.wireframe")], Ye.prototype, "wireframe", void 0), e([d({ value: false })], Ye.prototype, "suspended", null), e([d({ readOnly: true, aliasOf: "view.qualitySettings.tiledSurface.textureFadeDuration" })], Ye.prototype, "textureFadeDuration", void 0), e([d()], Ye.prototype, "_layerViewsDirty", void 0), e([o15("_renderer.renderPatchBorders")], Ye.prototype, "renderPatchBorders", void 0), e([o15("_renderer.renderingDisabled")], Ye.prototype, "renderingDisabled", void 0), Ye = e([n6("esri.views.3d.terrain.TerrainSurface")], Ye);
var $e = Ye;
function Ke2(e59, t60) {
  return e59[0] === t60[0] && e59[1] === t60[1] && e59[2] === t60[2];
}
function Je2(e59) {
  return !e59.isLeaf && (e59.children.some((e60) => e60.shouldLoad) || e59.children.some((e60) => Je2(e60)));
}
function Ze2(e59) {
  return e59.isLeaf && e59.parent && e59.parent.shouldLoad;
}
var et4 = n10();
var tt3 = u6();
var it4 = [0, 0, 0];
var rt3 = new n2();
var st3 = { spatialReference: null, tile: null, extent: null, context: "ground" };
var at3 = { spatialReference: null, extent: null, scale: 0 };

// node_modules/@arcgis/core/views/3d/webgl-engine/lib/ModelDirtySet.js
var y29 = class extends y {
  constructor(e59) {
    super(e59), this._residentGeomRecords = /* @__PURE__ */ new Map(), this._dirtyGeomRecords = /* @__PURE__ */ new Map(), this.dirty = false;
  }
  commit(e59) {
    this.dirty = false, this._dirtyGeomRecords.forEach((t60, r59) => this.commitLayer(r59, e59));
  }
  commitLayer(e59, t60) {
    const r59 = this._dirtyGeomRecords.get(e59);
    r59 && (r59.forEach((r60, s63) => {
      const d32 = this._ensureGeomRecord(e59, s63);
      r60.forEach((e60, r61) => {
        const i66 = e60[0], c67 = e60[1], y33 = e60[2];
        let h44 = false;
        if (c67 & E14.Geometry.UPDATE) {
          const e61 = d32.get(r61);
          if (e61) {
            const r62 = e61[1];
            if (y33 & E14.State.TRANSFORMATION) {
              const e62 = this.model.getObject(s63);
              this.model.updateRenderGeometryTransformation(e62, i66, r62) && (h44 = true);
            }
            h44 || t60.updates.push({ renderGeometry: r62, updateType: y33 });
          } else
            e16(false, "ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update");
        }
        if (c67 & E14.Geometry.REMOVE || h44) {
          const e61 = d32.get(r61);
          e61 ? (t60.removes.push(e61[1]), d32.delete(r61), e61[0].disposed && o27.pool.release(e61[0])) : c67 === E14.Geometry.REMOVE && e16(false, "ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove");
        }
        if (c67 & E14.Geometry.ADD || h44) {
          const e61 = this.model.getObject(s63);
          if (r(e61)) {
            const o61 = this.model.getRenderGeometry(e61, i66), s64 = [i66, o61];
            t60.adds.push(o61), d32.set(r61, s64);
          }
        }
      }), 0 === d32.size && this._residentGeomRecords.get(e59).delete(s63);
    }), 0 === this._residentGeomRecords.get(e59).size && this._residentGeomRecords.delete(e59), this._dirtyGeomRecords.delete(e59));
  }
  getResidentRenderGeometries(e59, t60) {
    const r59 = this._residentGeomRecords.get(e59);
    r59 && r59.forEach((e60) => e60.forEach((e61) => t60.push(e61[1])));
  }
  _objectStateChanged(e59, t60) {
    for (const r59 of t60.geometryRecords)
      this._updateOrCreateDirtyRecord(t60, r59, null, E14.Geometry.UPDATE, 0, 0, E14.Geometry.UPDATE, E14.Geometry.ADD | E14.Geometry.REMOVE, e59);
  }
  visibilityChanged(e59) {
    this._objectStateChanged(E14.State.VISIBILITIES, e59);
  }
  highlightChanged(e59) {
    this._objectStateChanged(E14.State.HIGHLIGHTS, e59);
  }
  occlusionChanged(e59) {
    this._objectStateChanged(E14.State.OCCLUDEES, e59);
  }
  vertexAttrsUpdated(e59) {
    this._updateOrCreateDirtyRecord(e59.object, e59.record, null, E14.Geometry.UPDATE, 0, 0, E14.Geometry.UPDATE, E14.Geometry.ADD | E14.Geometry.REMOVE, E14.State.VERTEXATTRS);
  }
  layerAdded(e59) {
    e59.objects.forAll((t60) => this._layerObjectAdded(e59, t60));
  }
  layerRemoved(e59) {
    e59.objects.forAll((t60) => this._layerObjectRemoved(e59, t60));
  }
  layerObjectAdded(e59) {
    this._layerObjectAdded(e59.layer, e59.object);
  }
  _layerObjectAdded(e59, t60) {
    const r59 = e59.id;
    for (const o61 of t60.geometryRecords)
      this._objectGeometryAdded(t60, o61, r59);
  }
  layerObjectRemoved(e59) {
    this._layerObjectRemoved(e59.layer, e59.object);
  }
  layerObjectsAdded(e59) {
    for (const t60 of e59.objects)
      this._layerObjectAdded(e59.layer, t60);
  }
  layerObjectsRemoved(e59) {
    for (const t60 of e59.objects)
      this._layerObjectRemoved(e59.layer, t60);
  }
  _layerObjectRemoved(e59, t60) {
    const r59 = e59.id;
    for (const o61 of t60.geometryRecords)
      this._objectGeometryRemoved(t60, o61, r59);
  }
  shaderTransformationChanged(e59) {
    const t60 = this._residentGeomRecords.get(e59.id);
    t60 && t60.forEach((e60, t61) => {
      const r59 = this.model.getObject(t61);
      r59 && r59.hasVolativeTransformation() && e60.forEach((e61) => {
        e61[1].shaderTransformationChanged();
      });
    });
  }
  objectTransformation(e59) {
    const t60 = this._getParentLayerId(e59), r59 = e59.id;
    this._ensureGeomRecord(t60, r59).forEach((r60) => {
      this._updateOrCreateDirtyRecord(e59, r60[0], t60, E14.Geometry.UPDATE, 0, 0, E14.Geometry.UPDATE, E14.Geometry.ADD | E14.Geometry.REMOVE, E14.State.TRANSFORMATION);
    });
  }
  objectGeometryAdded(e59) {
    this._objectGeometryAdded(e59.object, e59.record);
  }
  _objectGeometryAdded(e59, t60, r59 = null) {
    this._updateOrCreateDirtyRecord(e59, t60, r59, E14.Geometry.ADD, E14.Geometry.REMOVE, 0, 0, 0);
  }
  objectGeometryRemoved(e59) {
    this._objectGeometryRemoved(e59.object, e59.record);
  }
  _objectGeometryRemoved(e59, t60, r59 = null) {
    this._updateOrCreateDirtyRecord(e59, t60, r59, E14.Geometry.REMOVE, E14.Geometry.ADD, E14.Geometry.UPDATE, 0, 0);
  }
  _updateOrCreateDirtyRecord(e59, t60, r59, o61, d32, i66, c67, m40, y33) {
    r59 = c(r59, this._getParentLayerId(e59));
    const h44 = e59.id, l48 = t60.id, R21 = this._ensureDirtyRecord(r59, h44), G21 = R21.get(l48);
    if (G21) {
      const e60 = G21[1];
      e60 & d32 ? (R21.delete(l48), G21[0].disposed && o27.pool.release(G21[0])) : e60 & i66 ? (G21[1] = o61, G21[2] = y33) : e60 & c67 ? G21[2] |= y33 : e60 & m40 || e16(false, "ModelDirtySet.objectGeometryAdded: inconsistent state");
    } else
      R21.set(l48, [t60, o61, y33]);
    this.dirty = this._hasDirtyGeometryRecords;
  }
  _ensureGeomRecord(e59, t60) {
    let r59 = this._residentGeomRecords.get(e59);
    r59 || (r59 = /* @__PURE__ */ new Map(), this._residentGeomRecords.set(e59, r59));
    let o61 = r59.get(t60);
    return o61 || (o61 = /* @__PURE__ */ new Map(), r59.set(t60, o61)), o61;
  }
  get _hasDirtyGeometryRecords() {
    return n5(this._dirtyGeomRecords, (e59) => n5(e59, (e60) => e60 && e60.size > 0));
  }
  _ensureDirtyRecord(e59, t60) {
    let r59 = this._dirtyGeomRecords.get(e59);
    r59 || (r59 = /* @__PURE__ */ new Map(), this._dirtyGeomRecords.set(e59, r59));
    let o61 = r59.get(t60);
    return o61 || (o61 = /* @__PURE__ */ new Map(), r59.set(t60, o61)), o61;
  }
  _getParentLayerId(e59) {
    return r(e59.parentLayer) ? e59.parentLayer.id : n4;
  }
  formatDebugInfo() {
    const e59 = ["ADD", "UPD", void 0, "REM"];
    let t60 = "";
    return this._dirtyGeomRecords.forEach((r59, o61) => {
      r59.forEach((r60, s63) => {
        t60.length > 0 && (t60 += "\n"), t60 += o61 + "." + s63;
        const d32 = [];
        r60.forEach((e60) => {
          const t61 = e60[1];
          d32[t61] || (d32[t61] = []), d32[t61].push(e60[0].geometry.id);
        });
        for (let o62 = 0; o62 < d32.length; o62++)
          if (d32[o62]) {
            t60 += " " + e59[o62 - 1] + ": ";
            for (let e60 = 0; e60 < d32[o62].length; e60++)
              t60 += d32[o62][e60] + ", ";
          }
      });
    }), t60;
  }
  get test() {
    const e59 = this;
    return { get residentLayerCount() {
      return e59._residentGeomRecords.size;
    }, get residentObjectCount() {
      return Array.from(e59._residentGeomRecords.values()).reduce((e60, t60) => e60 + t60.size, 0);
    } };
  }
};
e([d({ constructOnly: true })], y29.prototype, "model", void 0), e([d()], y29.prototype, "dirty", void 0), y29 = e([n6("esri.views.3d.webgl-engine.lib.ModelDirtySet")], y29);
var h41 = y29;

// node_modules/@arcgis/core/views/3d/webgl-engine/parts/Model.js
var h42 = class extends y {
  constructor() {
    super(...arguments), this.dirtySet = new h41({ model: this }), this._content = /* @__PURE__ */ new Map(), this._originFactory = new j12(null, 75e4);
  }
  getObject(t60) {
    return this._content.get(t60);
  }
  add(t60) {
    const e59 = t60.id;
    e16(!this._content.has(e59), "Model/Stage already contains object to be added"), this._content.set(e59, t60), y8(t60) && this.dirtySet.layerAdded(t60);
  }
  remove(t60) {
    e16(this._content.has(t60.id), "Model/Stage doesn't contain object to be removed"), this._content.delete(t60.id), t60.unload(), y8(t60) && this.dirtySet.layerRemoved(t60);
  }
  addMany(t60) {
    for (const e59 of t60)
      r(e59) && (e16(!this._content.has(e59.id), "Model/Stage already contains object to be added"), this._content.set(e59.id, e59));
  }
  removeMany(t60) {
    for (const e59 of t60)
      e16(this._content.has(e59.id), "Model/Stage doesn't contain object to be removed"), this._content.delete(e59.id), e59.unload();
  }
  has(t60) {
    return this._content.has(t60.id);
  }
  forEachOfType(t60, e59) {
    this._content.forEach((o61) => {
      o61.type === t60 && e59(o61);
    });
  }
  getRenderGeometry(t60, e59) {
    const { geometry: o61, material: r59, id: n73, shaderTransformation: i66, origin: s63, instanceParameters: a58 } = e59, c67 = new T11(o61, r59, { id: n73, boundingInfo: o61.boundingInfo, calculateShaderTransformation: i66, castShadow: t60.castShadow });
    return c67.updateTransformation((o62) => t60.getCombinedStaticTransformation(e59, o62)), c67.origin = s63 || this._originFactory.getOrigin(c67.boundingSphere), c67.instanceParameters = a58, c67;
  }
  updateRenderGeometryTransformation(t60, e59, o61) {
    if (t(t60))
      return false;
    o61.updateTransformation((o62) => t60.getCombinedStaticTransformation(e59, o62));
    const n73 = this._originFactory.getOrigin(o61.boundingSphere);
    return o61.origin !== n73;
  }
  getStats() {
    const t60 = {}, e59 = Array.from(this._content.values());
    for (let o61 = 0; o61 < e17.COUNT; ++o61)
      t60[o61] = e59.filter((t61) => t61.type === o61).length;
    return { contentTypes: t60, dirtySet: this.dirtySet.formatDebugInfo() };
  }
  get test() {
    return { content: Array.from(this._content.values()) };
  }
};
e([d({ constructOnly: true })], h42.prototype, "dirtySet", void 0), h42 = e([n6("esri.views.3d.webgl-engine.parts.Model")], h42);

// node_modules/@arcgis/core/views/3d/webgl-engine/collections/Component/IndexRange/ComponentRangeRunLengthEncoded.js
var t55 = class {
  constructor(t60) {
    this._totalCount = t60, this._indexRanges = [0, t60];
  }
  allVisible() {
    return this.componentCount() === this._totalCount;
  }
  allInvisible() {
    return 0 === this._indexRanges.length;
  }
  componentCount() {
    const t60 = this._indexRanges;
    let n73 = 0;
    for (let e59 = 0; e59 < t60.length; e59 += 2)
      n73 += t60[e59 + 1];
    return n73;
  }
  reset(t60) {
    "all" === t60 || t60.length === this._totalCount ? this._indexRanges = [0, this._totalCount] : this._indexRanges = n62(t60);
  }
  forEachComponent(t60) {
    const n73 = this._indexRanges;
    for (let e59 = 0; e59 < n73.length; e59 += 2) {
      const s63 = n73[e59], o61 = s63 + n73[e59 + 1];
      for (let n74 = s63; n74 < o61; n74++)
        if (!t60(n74))
          return false;
    }
    return true;
  }
  forEachComponentRange(t60) {
    const n73 = this._indexRanges;
    for (let e59 = 0; e59 < n73.length; e59 += 2) {
      const s63 = n73[e59];
      if (!t60(s63, s63 + n73[e59 + 1]))
        return false;
    }
    return true;
  }
  computeOffsetRanges(t60) {
    const n73 = new Array(this._indexRanges.length), e59 = this._indexRanges;
    for (let s63 = 0; s63 < e59.length; s63 += 2) {
      const o61 = e59[s63], r59 = o61 + e59[s63 + 1], i66 = t60[o61], l48 = t60[r59];
      n73[s63] = i66, n73[s63 + 1] = l48 - i66;
    }
    return n73;
  }
};
function n62(t60) {
  const n73 = new Array();
  if (0 === t60.length)
    return n73;
  let e59 = t60[0], s63 = 1;
  for (let o61 = 1; o61 < t60.length; o61++) {
    const r59 = t60[o61];
    e59 + s63 === r59 ? s63 += 1 : (n73.push(e59), n73.push(s63), e59 = r59, s63 = 1);
  }
  return n73.push(e59), n73.push(s63), n73;
}

// node_modules/@arcgis/core/views/3d/webgl-engine/collections/Component/ComponentData.js
var a48 = class extends e26 {
  constructor(t60, e59) {
    super(), this.pickability = null, this.highlightCounts = null, this.verticalOffsets = null, this.cachedGeometryRanges = null, this.cachedHighlightRanges = null, this.cachedDefaultRanges = null, this.offsets = t2(e59);
    const s63 = this.count;
    this.visibility = new t55(s63), this.materialDataBuffer = t60.getBuffer(s63), this.materialDataIndices = new Uint16Array(s63);
    for (let h44 = 0; h44 < s63; h44++)
      this.materialDataIndices[h44] = this.materialDataBuffer.acquireIndex();
  }
  dispose() {
    super.dispose();
    for (let t60 = 0; t60 < this.count; t60++)
      this.materialDataBuffer.releaseIndex(this.materialDataIndices[t60]);
  }
  get count() {
    return this.offsets.length - 1;
  }
  get geometryRanges() {
    return t(this.cachedGeometryRanges) && (this.cachedGeometryRanges = this.visibility.computeOffsetRanges(this.offsets)), this.cachedGeometryRanges;
  }
  get highlightRanges() {
    return t(this.highlightCounts) ? null : (this._updateCachedHighlightRanges(), this.cachedHighlightRanges);
  }
  get defaultShadowMapRanges() {
    return t(this.highlightCounts) ? this.geometryRanges : (this._updateCachedHighlightRanges(), this.cachedDefaultRanges);
  }
  highlightsDirty() {
    this.cachedHighlightRanges = null, this.cachedDefaultRanges = null;
  }
  visibilityDirty() {
    this.cachedGeometryRanges = null, this.highlightsDirty();
  }
  _updateCachedHighlightRanges() {
    if ((t(this.cachedHighlightRanges) || t(this.cachedDefaultRanges)) && r(this.highlightCounts)) {
      const { highlightRanges: t60, defaultRanges: e59 } = n63(this.highlightCounts, this.visibility, this.offsets);
      this.cachedHighlightRanges = t60, this.cachedDefaultRanges = e59;
    }
  }
};
function n63(t60, e59, h44) {
  const i66 = [], s63 = [];
  let a58 = h44.length, n73 = h44.length;
  return e59.forEachComponent((e60) => (t60[e60] > 0 ? (a58 !== e60 - 1 && (i66.length && i66.push(h44[a58 + 1] - i66[i66.length - 1]), i66.push(h44[e60])), a58 = e60) : (n73 !== e60 - 1 && (s63.length && s63.push(h44[n73 + 1] - s63[s63.length - 1]), s63.push(h44[e60])), n73 = e60), true)), i66.length && i66.push(h44[a58 + 1] - i66[i66.length - 1]), s63.length && s63.push(h44[n73 + 1] - s63[s63.length - 1]), { highlightRanges: i66, defaultRanges: s63 };
}

// node_modules/@arcgis/core/views/3d/webgl-engine/lib/ComponentUtils.js
function t56(t60, n73, e59, l48) {
  if (e59 >= n73)
    return t60;
  null == t60 && (t60 = i58());
  const s63 = t60.isVisibleBit;
  let a58 = t60.data;
  const c67 = r51(a58), o61 = e59 / c67 | 0, f37 = e59 - c67 * o61, h44 = (n73 - 1) / c67 | 0, B18 = a58, E39 = l48 === s63;
  if (!(e59 < B18.length * c67) && E39) {
    const t61 = 1.5, n74 = o61 + 1, i66 = Math.ceil(B18.length * t61), e60 = h44 + 1;
    let r59 = Math.max(n74, i66);
    r59 = Math.min(r59, e60), a58 = new Uint32Array(r59), a58.set(B18);
  }
  return o61 < a58.length && (a58[o61] = u45(a58[o61], f37, E39)), t60.data = a58, t60;
}
function n64(t60, n73) {
  if (null == t60)
    return true;
  const { isVisibleBit: i66, data: u51 } = t60, l48 = r51(u51);
  return n73 < u51.length * l48 ? e49(i66, u51, n73, l48) : !t60.isVisibleBit;
}
function i58(t60 = true) {
  return { isVisibleBit: !t60, data: new Uint32Array(0) };
}
function e49(t60, n73, i66, e59) {
  const r59 = i66 / e59 | 0, u51 = i66 - r59 * e59;
  return l44(n73[r59], u51) === t60;
}
function r51(t60) {
  const n73 = 8;
  return t60.BYTES_PER_ELEMENT * n73;
}
function u45(t60, n73, i66) {
  return t60 & ~(1 << n73) | (i66 ? 1 : 0) << n73;
}
function l44(t60, n73) {
  return 0 != (t60 & 1 << n73);
}

// node_modules/@arcgis/core/views/3d/webgl-engine/collections/Component/IntersectionGeometry.js
var _26 = class {
  constructor(o61, s63) {
    this._indices = r(o61.indices) ? o61.indices : l11(o61.positions.length / 3), this._positions = new i4(o61.positions), this._components = s63, this._componentIntersectionData = new Array(s63.count);
  }
  getComponentAabb(o61, s63) {
    if (r(this._perComponentAabbs)) {
      for (let t60 = 0; t60 < 6; t60++)
        s63[t60] = this._perComponentAabbs[6 * o61 + t60];
      return s63;
    }
    return this._computePerComponentAabbs(), this.getComponentAabb(o61, s63);
  }
  getComponentPositions(t60, o61) {
    o61.indices = this._indices, o61.data = this._positions.typedBuffer, o61.stride = this._positions.typedBufferStride, o61.startIndex = this._components.offsets[t60], o61.endIndex = this._components.offsets[t60 + 1];
  }
  intersect(e59, n73, i66, a58, _30, u51, l48) {
    const C25 = { data: this._positions.typedBuffer, stride: this._positions.typedBufferStride, size: 3 }, A39 = this._indices, y33 = this._components.offsets, g45 = N4(e59, n73, b21), j36 = e59[2], B18 = n73[2];
    this._components.visibility.forEachComponent((c67) => {
      if (!n64(this._components.pickability, c67))
        return true;
      const b23 = this.getComponentAabb(c67, d29);
      if (r(u51)) {
        const o61 = u51[c67];
        r(_30) ? _30.componentOffset = o61 : (e59[2] = j36 - o61, n73[2] = B18 - o61);
      }
      if (r(_30) && _30.applyToAabb(b23), !O5(b23, e59, g45, i66))
        return true;
      const x30 = y33[c67] / 3, I27 = y33[c67 + 1] / 3, M22 = (t60, o61, e60) => {
        l48(c67, t60, O2(o61, o61, a58), e60);
      }, D21 = I27 - x30;
      return t(_30) && D21 > s57 ? (null == this._componentIntersectionData[c67] && (this._componentIntersectionData[c67] = new d28(this._indices, x30, I27, C25)), this._componentIntersectionData[c67].intersectRay({ r0: e59, r1: n73 }, M22)) : v6(e59, n73, x30, I27, A39, C25, void 0, _30, M22), true;
    });
  }
  _computePerComponentAabbs() {
    const t60 = this._components.count;
    this._perComponentAabbs = new Float32Array(6 * t60);
    const o61 = this._indices, s63 = this._positions.typedBuffer, e59 = this._positions.typedBufferStride, n73 = this._components.offsets;
    let i66 = 0;
    for (let r59 = 0; r59 < t60; r59++) {
      const t61 = n73[r59], p52 = n73[r59 + 1];
      let m40 = 1 / 0, a58 = 1 / 0, c67 = 1 / 0, h44 = -1 / 0, f37 = -1 / 0, _30 = -1 / 0;
      for (let n74 = t61; n74 < p52; n74++) {
        const t62 = o61[n74] * e59, i67 = s63[t62], r60 = s63[t62 + 1], p53 = s63[t62 + 2];
        m40 = Math.min(m40, i67), a58 = Math.min(a58, r60), c67 = Math.min(c67, p53), h44 = Math.max(h44, i67), f37 = Math.max(f37, r60), _30 = Math.max(_30, p53);
      }
      this._perComponentAabbs[i66++] = m40, this._perComponentAabbs[i66++] = a58, this._perComponentAabbs[i66++] = c67, this._perComponentAabbs[i66++] = h44, this._perComponentAabbs[i66++] = f37, this._perComponentAabbs[i66++] = _30;
    }
  }
  get positions() {
    return this._positions;
  }
  get indices() {
    return this._indices;
  }
};
var b21 = n7();
var d29 = a8();

// node_modules/@arcgis/core/views/3d/webgl-engine/collections/Component/Renderable.js
var s58 = class {
  constructor(s63, t60, e59) {
    this.material = s63, this.geometry = t60, this.meta = e59;
  }
  dispose() {
    this.material.dispose(), this.geometry.dispose();
  }
};

// node_modules/@arcgis/core/views/3d/webgl-engine/collections/Component/RenderGeometry.js
var o54 = class extends e26 {
  constructor(s63, t60, i66, o61) {
    super(), this.primitiveType = t60, this.parameters = i66, this.indexed = o61, this.vao = s63;
  }
};
e([i22()], o54.prototype, "vao", void 0);

// node_modules/@arcgis/core/views/3d/webgl-engine/lib/depthRange.js
function r52(r59, n73) {
  return { near: r59, far: n73 };
}
function n65(n73) {
  return n73 ? a49(n73, 1 / 0, -1 / 0) : r52(1 / 0, -1 / 0);
}
function a49(r59, n73, a58) {
  return r59.near = n73, r59.far = a58, r59;
}
function t57(r59, n73, a58 = r59) {
  return a58.near = Math.min(r59.near, n73.near), a58.far = Math.max(r59.far, n73.far), a58;
}
function e50(r59, n73) {
  return r59.near <= n73 && n73 <= r59.far;
}
var f33 = { near: 0, far: 0 };

// node_modules/@arcgis/core/views/3d/webgl-engine/collections/Component/DepthRange.js
function S22(n73, o61) {
  const e59 = n65(), { eye: r59, frustum: a58, viewForward: s63 } = n73;
  o61.forAll((n74) => {
    const o62 = r(n74.offsetObb) ? n74.offsetObb : n74.obb, l48 = P2(J(E33, o62.center, r59), s63), u51 = U11(o62, s63);
    if (e50(e59, l48 - u51) && e50(e59, l48 + u51))
      return;
    const i66 = R17(o62, a58);
    if (-1 === i66)
      return;
    if (0 === i66)
      return v33.far = l48 + u51, v33.near = l48 - u51, void t57(e59, v33);
    const h44 = q16.pushNew();
    h44.near = l48 - u51, h44.far = l48 + u51, h44.mask = i66, h44.object = n74;
  });
  for (let l48 = 0; l48 < q16.length; l48++) {
    const n74 = q16.data[l48];
    if (e50(e59, n74.near) && e50(e59, n74.far))
      continue;
    v33.far = n74.far, v33.near = 1 / 0;
    const o62 = M19(r(n74.object.offsetObb) ? n74.object.offsetObb : n74.object.obb, r59, A36, (t60) => {
      let o63 = x26;
      for (let e60 = 0; e60 < P19 && t60.length > 0; e60++) {
        if (0 == (n74.mask & 1 << e60))
          continue;
        B14(a58[e60], t60, o63);
        const r60 = t60;
        t60 = o63, o63 = r60;
      }
      for (let n75 = 0; n75 < t60.length; n75 += 3) {
        o3(y30, t60.data[n75 + 0], t60.data[n75 + 1], t60.data[n75 + 2]);
        const o64 = P2(J(y30, y30, r59), s63);
        v33.near = Math.min(v33.near, o64);
      }
    });
    0 === o62 && (v33.near = 0), t57(e59, v33);
  }
  return q16.length = 0, e59;
}
var q16 = new n2({ allocator: (t60) => t60 || { near: 1 / 0, far: -1 / 0, mask: 0, object: null }, deallocator: (t60) => (t60.object = null, t60) });
var v33 = n65();
var y30 = n7();
var O30 = n7();
var A36 = new n2({ deallocator: null });
var x26 = new n2({ deallocator: null });
function B14(t60, n73, o61) {
  o61.length = 0;
  const e59 = n73.length - 3;
  F19(y30, n73, e59);
  const r59 = W3(t60, y30);
  r59 <= 0 && (o61.push(y30[0]), o61.push(y30[1]), o61.push(y30[2]));
  let a58 = 0, s63 = r59;
  for (; a58 < e59; a58 += 3) {
    F19(O30, n73, a58);
    const e60 = W3(t60, O30);
    if (s63 * e60 < 0) {
      A4(y30, O30, y30, e60 / (e60 - s63)), I23(o61, y30);
    }
    e60 <= 0 && I23(o61, O30), s63 = e60, r7(y30, O30);
  }
  if (s63 * r59 < 0) {
    F19(O30, n73, e59);
    A4(y30, O30, y30, r59 / (r59 - s63)), I23(o61, y30);
  }
}
function F19(t60, n73, o61) {
  return o3(t60, n73.data[o61 + 0], n73.data[o61 + 1], n73.data[o61 + 2]);
}
function I23(t60, n73) {
  t60.push(n73[0]), t60.push(n73[1]), t60.push(n73[2]);
}
function M19(t60, n73, r59, s63) {
  S3(D18, t60.quaternion), J(E33, n73, t60.center), S(E33, E33, D18);
  const f37 = 8 * ((E33[0] < -t60.halfSize[0] ? -1 : E33[0] > t60.halfSize[0] ? 1 : 0) + 3 * (E33[1] < -t60.halfSize[1] ? -1 : E33[1] > t60.halfSize[1] ? 1 : 0) + 9 * (E33[2] < -t60.halfSize[2] ? -1 : E33[2] > t60.halfSize[2] ? 1 : 0) + 13), h44 = N18[f37];
  if (0 === h44)
    return h44;
  p10(C23, t60.quaternion), f8(C23, C23, t60.halfSize);
  const m40 = (n74, o61) => {
    const e59 = N18[f37 + o61 + 1];
    return o3(n74, ((1 & e59) << 1) - 1, (2 & e59) - 1, ((4 & e59) >> 1) - 1), O2(n74, n74, C23), u3(n74, t60.center, n74);
  };
  return r59.length = 0, I23(r59, m40(G19, 0)), I23(r59, m40(H18, 1)), I23(r59, m40(E33, 2)), I23(r59, m40(J12, 3)), s63(r59), 1 === h44 ? h44 : (r59.length = 0, I23(r59, G19), I23(r59, J12), I23(r59, m40(E33, 4)), I23(r59, m40(K10, 5)), s63(r59), 2 === h44 || (r59.length = 0, I23(r59, G19), I23(r59, K10), I23(r59, m40(E33, 6)), I23(r59, H18), s63(r59)), h44);
}
var N18 = (() => {
  const t60 = new Int8Array(216);
  let n73 = 0;
  const o61 = (o62) => {
    for (let e59 = 0; e59 < o62.length; e59++)
      t60[n73 + e59] = o62[e59];
    n73 += 8;
  };
  return o61([3, 0, 6, 2, 3, 1, 5, 4]), o61([2, 0, 2, 3, 1, 5, 4, 0]), o61([3, 1, 0, 2, 3, 7, 5, 4]), o61([2, 0, 1, 3, 2, 6, 4, 0]), o61([1, 0, 1, 3, 2, 0, 0, 0]), o61([2, 1, 5, 7, 3, 2, 0, 0]), o61([3, 2, 0, 1, 3, 7, 6, 4]), o61([2, 2, 0, 1, 3, 7, 6, 0]), o61([3, 3, 0, 1, 5, 7, 6, 2]), o61([2, 0, 1, 5, 4, 6, 2, 0]), o61([1, 0, 1, 5, 4, 0, 0, 0]), o61([2, 1, 3, 7, 5, 4, 0, 0]), o61([1, 0, 2, 6, 4, 0, 0, 0]), o61([0, 0, 0, 0, 0, 0, 0, 0]), o61([1, 1, 3, 7, 5, 0, 0, 0]), o61([2, 2, 3, 7, 6, 4, 0, 0]), o61([1, 2, 3, 7, 6, 0, 0, 0]), o61([2, 3, 1, 5, 7, 6, 2, 0]), o61([3, 4, 0, 1, 5, 7, 6, 2]), o61([2, 5, 7, 6, 4, 0, 1, 0]), o61([3, 5, 0, 1, 3, 7, 6, 4]), o61([2, 4, 5, 7, 6, 2, 0, 0]), o61([1, 4, 5, 7, 6, 0, 0, 0]), o61([2, 5, 1, 3, 7, 6, 4, 0]), o61([3, 6, 0, 2, 3, 7, 5, 4]), o61([2, 6, 2, 3, 7, 5, 4, 0]), o61([3, 7, 6, 2, 3, 1, 5, 4]), t60;
})();
var P19 = 4;
function R17(t60, n73) {
  let o61 = 0;
  for (let e59 = 0; e59 < P19; e59++) {
    const r59 = J3(t60, n73[e59]);
    if (r59 > 0)
      return -1;
    0 === r59 && (o61 |= 1 << e59);
  }
  return o61;
}
var C23 = e11();
var D18 = e13();
var E33 = n7();
var G19 = n7();
var H18 = n7();
var J12 = n7();
var K10 = n7();

// node_modules/@arcgis/core/views/3d/webgl-engine/collections/Component/RenderSubmitSystem.js
var e51 = class {
  constructor(t60) {
    this._objects = t60;
  }
  submit(t60, e59) {
    this._objects.preSubmit(e59), this._objects.visibleObjects.forAll((s63) => s63.renderable.material.submit(t60, e59, s63));
  }
  queryShadowCasterDepthRange(e59) {
    return this._objects.visibleObjects.length ? S22(e59, this._objects.visibleObjects) : null;
  }
};

// node_modules/@arcgis/core/views/3d/webgl-engine/collections/Component/Material/ComponentTechnique.js
var x27 = class extends e18 {
  bindDraw(e59, r59) {
    const o61 = this.program;
    o61.bindDraw(e59, r59), o61.rebindTextures(), e59.componentParameters.type === m15.Varying && e59.componentParameters.texture.bind(o61, "componentColorTex", "componentColorTexInvDim");
  }
  initializeConfiguration(r59, t60) {
    t60.spherical = r59.viewingMode === l13.Global, t60.doublePrecisionRequiresObfuscation = r23(r59.rctx);
  }
  initializeProgram(e59) {
    const r59 = x27.shader.get(), t60 = r59.build(this.configuration);
    return new o20(e59.rctx, t60, r59.attributeLocations);
  }
  _setPipelineState(e59) {
    const t60 = this.configuration, o61 = t60.integratedMeshMode !== T12.None, n73 = e59 === O4.NONE, s63 = e59 === O4.FrontFace;
    return W({ blending: t60.output !== o18.Color && t60.output !== o18.Alpha || !t60.blendingEnabled ? null : n73 ? c12 : E8(e59), culling: h11(t60.cullFace), depthTest: { func: l16(e59) }, depthWrite: n73 || s63 ? a17 : null, colorWrite: c11, stencilWrite: o61 || t60.hasOccludees ? e19 : null, stencilTest: o61 ? u13(a13.IntegratedMeshMaskExcluded) : t60.hasOccludees ? f14 : null, polygonOffset: n73 || s63 ? t60.hasPolygonOffset ? { factor: 2, units: 2 } : null : f13 });
  }
  initializePipeline() {
    return this._setPipelineState(this.configuration.transparencyPassType);
  }
};
x27.shader = new t15(k8, () => import("./ComponentShader.glsl-DLMYHGTW.js"));

// node_modules/@arcgis/core/views/3d/webgl-engine/core/material/MaterialBase.js
var e52 = class extends t14 {
  constructor() {
    super(...arguments), this._dirty = true;
  }
  _setDirty() {
    this._dirty = true;
  }
  _setClean() {
    if (this._dirty = false, null != this._parameterBlocks)
      for (const t60 of this._parameterBlocks)
        this[t60]._setClean();
  }
  get dirty() {
    return this._dirty || this._checkParameterBlocksDirty();
  }
  _checkParameterBlocksDirty() {
    if (null == this._parameterBlocks)
      return false;
    for (const t60 of this._parameterBlocks)
      if (this[t60].dirty)
        return true;
    return false;
  }
};
var r53 = class {
  constructor() {
    this._dirty = true;
  }
  _setDirty() {
    this._dirty = true;
  }
  _setClean() {
    this._dirty = false;
  }
  get dirty() {
    return this._dirty;
  }
};
function s59(t60 = {}) {
  return (e59, r59) => {
    const s63 = e59._parameterCount ?? 0;
    if (e59._parameterCount = s63 + 1, t60.vectorOps) {
      const i66 = t60.vectorOps;
      Object.defineProperty(e59, r59, { get() {
        return this[s63];
      }, set(t61) {
        const e60 = this[s63];
        if (null == e60)
          this[s63] = t61;
        else {
          if (i66.equals(e60, t61))
            return;
          i66.copy(e60, t61);
        }
        this._setDirty();
      } });
    } else
      Object.defineProperty(e59, r59, { get() {
        return this[s63];
      }, set(e60) {
        this[s63] !== e60 && (t60.dispose && this[s63] && this[s63].dispose(), this[s63] = e60, this._setDirty());
      } });
  };
}
function i59() {
  return (t60, e59) => {
    const r59 = t60._parameterCount ?? 0;
    t60._parameterCount = r59 + 1, t60._parameterBlocks = t60._parameterBlocks || [], t60._parameterBlocks.push(r59), Object.defineProperty(t60, e59, { get() {
      return this[r59];
    }, set(t61) {
      this[r59] !== t61 && (this[r59] = t61, this._setDirty());
    } });
  };
}

// node_modules/@arcgis/core/views/3d/webgl-engine/core/util/TwoVectorPosition.js
var c62 = class {
  constructor(s63) {
    this._low = n22(), this._high = n22(), s63 && this.set(s63);
  }
  get low() {
    return this._low;
  }
  get high() {
    return this._high;
  }
  set(h44) {
    const e59 = this._low, i66 = this._high;
    r7(e59, h44), J(i66, h44, e59);
  }
  setElements(s63, t60, e59) {
    o3(n66, s63, t60, e59), this.set(n66);
  }
  get(s63) {
    return u3(s63, this._low, this._high);
  }
  getLowScaled(s63) {
    return q(s63, this._low, 1);
  }
};
var n66 = n7();

// node_modules/@arcgis/core/views/3d/webgl-engine/collections/Component/Material/ComponentMaterial.js
var _27 = class extends e52 {
  constructor(e59, t60) {
    super(), this.toMapSpace = t60, this.baseColor = r28(1, 1, 1, 1), this.usePBR = false, this.hasParametersFromSource = false, this.mrrFactors = r20(1, 1, 0.5), this.emissiveFactor = r20(0, 0, 0), this.baseColorTexture = null, this.metallicRoughnessTexture = null, this.emissionTexture = null, this.occlusionTexture = null, this.normalTexture = null, this.objectOpacity = 1, this.commonMaterialParameters = new B15(), this.componentParameters = new L29(), this.textureAlphaCutoff = o19, this.alphaDiscardMode = C3.Opaque, this.isIntegratedMesh = false, this.polygonOffsetEnabled = false, this.ellipsoidMode = t26.Earth, this.hasOccludees = false, this._techniqueConfiguration = new m16();
    const r59 = new c62(e59.position), s63 = r27(e59.rotationScale);
    u9(s63, s63), this.transformNormalGlobalFromModel = o10(s63, s63), this.transformWorldFromModelTL = r59.low, this.transformWorldFromModelTH = r59.high, this.transformWorldFromModelRS = e59.rotationScale;
  }
  dispose() {
    this._technique = p(this._technique), this.baseColorTexture = null, this.metallicRoughnessTexture = null, this.emissionTexture = null, this.occlusionTexture = null, this.normalTexture = null;
  }
  get texture() {
    return r(this.baseColorTexture) ? this.baseColorTexture.glTexture : null;
  }
  get textureMetallicRoughness() {
    return r(this.metallicRoughnessTexture) ? this.metallicRoughnessTexture.glTexture : null;
  }
  get textureEmissive() {
    return r(this.emissionTexture) ? this.emissionTexture.glTexture : null;
  }
  get textureOcclusion() {
    return r(this.occlusionTexture) ? this.occlusionTexture.glTexture : null;
  }
  get textureNormal() {
    return r(this.normalTexture) ? this.normalTexture.glTexture : null;
  }
  prepareTechnique(e59, t60, o61, a58) {
    const i66 = this._techniqueConfiguration;
    i66.hasVertexColors = a58.colors, i66.hasNormals = a58.normals, i66.textureCoordinateType = a58.textureCoordinates, i66.hasMetalnessAndRoughnessTexture = r(this.metallicRoughnessTexture), i66.hasEmissionTexture = r(this.emissionTexture), i66.hasOcclusionTexture = r(this.occlusionTexture), i66.hasNormalTexture = r(this.normalTexture), i66.transparencyPassType = t60.identifier === a27.Material && null != o61.transparencyPassType ? o61.transparencyPassType : O4.NONE, i66.hasMultipassTerrain = t60.identifier === a27.Material && null != o61.multipassTerrain && o61.multipassTerrain.enabled, i66.cullAboveGround = t60.identifier === a27.Material && null != o61.multipassTerrain && o61.multipassTerrain.cullAboveGround, i66.ellipsoidMode = this.ellipsoidMode, i66.componentData = this.componentParameters.type, i66.cullFace = this.commonMaterialParameters.cullFace, i66.doubleSidedMode = this.commonMaterialParameters.doubleSided ? i9.View : i9.None, i66.hasBaseColorTexture = r(this.baseColorTexture);
    const n73 = this._computeWhichMaterialPass();
    i66.blendingEnabled = n73 === V15.Transparent || n73 === V15.OpaqueAndTransparent, i66.alphaDiscardMode = this.alphaDiscardMode, i66.integratedMeshMode = this.isIntegratedMesh ? X8(o61) ? U13(o61) ? T12.ColorOverlayWithWater : T12.ColorOverlay : T12.NoOverlay : T12.None, i66.isGround = this.isIntegratedMesh, i66.hasPolygonOffset = this.polygonOffsetEnabled;
    const l48 = this.hasParametersFromSource && t(this.baseColorTexture);
    return i66.pbrMode = i66.integratedMeshMode === T12.ColorOverlayWithWater ? l14.WaterOnIntegratedMesh : this.usePBR ? l48 ? l14.Schematic : l14.Normal : l14.Disabled, i66.normalType = i66.integratedMeshMode === T12.None ? i66.hasNormals ? i8.CompressedAttribute : i8.ScreenDerivative : i8.Ground, i66.hasSlicePlane = r(o61.slicePlane) && this.commonMaterialParameters.hasSlicePlane, t60.identifier === a27.ShadowMap ? (i66.output = o18.Shadow, i66.vertexDiscardMode = a28.None) : t60.identifier === a27.Highlight ? (i66.output = o18.Highlight, i66.vertexDiscardMode = a28.None) : (this._computeWhichMaterialPass() === V15.OpaqueAndTransparent ? i66.vertexDiscardMode = t60.transparent ? a28.Opaque : a28.Transparent : i66.vertexDiscardMode = a28.None, i66.output = H19(t60.subPass), t60.subPass === o34.Alpha && (i66.hasOccludees = o61.hasOccludees), t60.subPass === o34.Color ? (i66.receiveAmbientOcclusion = o61.ssaoHelper.ready, i66.hasOccludees = o61.hasOccludees, i66.receiveShadows = o61.shadowMap.ready, i66.hasScreenSpaceReflections = o61.ssr.enabled, i66.hasCloudsReflections = r(o61.clouds.data)) : (i66.receiveAmbientOcclusion = false, i66.receiveShadows = false), i66.snowCover = this.hasSnowCover(o61)), this._technique = e59.releaseAndAcquire(x27, i66, this._technique), this._setClean(), this._technique;
  }
  hasSnowCover(e59) {
    return r(e59.weather) && e59.weatherVisible && "snowy" === e59.weather.type && "enabled" === e59.weather.snowCover;
  }
  submit(e59, t60, s63) {
    if (0 === this.objectOpacity)
      return;
    const o61 = s63.renderable.geometry, a58 = s63.components, i66 = s63.renderable.meta.cameraDepthSquared, n73 = a58.geometryRanges, l48 = a58.highlightRanges, h44 = a58.defaultShadowMapRanges;
    switch (this._computeWhichMaterialPass()) {
      case V15.Opaque:
        e59.materialOpaque.submitDraw(this, o61, n73, i66);
        break;
      case V15.Transparent:
        e59.materialTransparent.submitDraw(this, o61, n73, i66);
        break;
      case V15.OpaqueAndTransparent:
        e59.materialOpaque.submitDraw(this, o61, n73, i66), e59.materialTransparent.submitDraw(this, o61, n73, i66);
        break;
      case V15.IntegratedMesh:
        e59.materialIntegratedMesh.submitDraw(this, o61, n73, i66), U24(t60) && e59.highlightIntegratedMesh.submitDraw(this, o61, n73, i66);
    }
    const u51 = this.componentParameters.castShadows !== W14.None;
    u51 && e59.shadowMap.submitDraw(this, o61, n73, i66), r(l48) && (e59.highlight.submitDraw(this, o61, l48, i66), u51 && e59.highlightShadowMap.submitDraw(this, o61, l48, i66)), u51 && r(h44) && e59.defaultShadowMap.submitDraw(this, o61, h44, i66);
  }
  get attributeLocations() {
    return I8;
  }
  _computeWhichMaterialPass() {
    return this.isIntegratedMesh ? V15.IntegratedMesh : this.objectOpacity < 1 ? V15.Transparent : this.componentParameters.opaqueOverride === W14.All ? V15.Opaque : this.baseColor[3] < 1 || this.alphaDiscardMode === C3.Blend || this.alphaDiscardMode === C3.MaskBlend ? V15.Transparent : this.componentParameters.transparent === W14.None ? V15.Opaque : this.componentParameters.transparent === W14.All ? V15.Transparent : V15.OpaqueAndTransparent;
  }
};
var k29;
var V15;
var W14;
e([s59({ vectorOps: G2 })], _27.prototype, "baseColor", void 0), e([s59()], _27.prototype, "usePBR", void 0), e([s59()], _27.prototype, "hasParametersFromSource", void 0), e([s59({ vectorOps: V })], _27.prototype, "mrrFactors", void 0), e([s59({ vectorOps: V })], _27.prototype, "emissiveFactor", void 0), e([s59({ dispose: true })], _27.prototype, "baseColorTexture", void 0), e([s59({ dispose: true })], _27.prototype, "metallicRoughnessTexture", void 0), e([s59({ dispose: true })], _27.prototype, "emissionTexture", void 0), e([s59({ dispose: true })], _27.prototype, "occlusionTexture", void 0), e([s59({ dispose: true })], _27.prototype, "normalTexture", void 0), e([s59()], _27.prototype, "objectOpacity", void 0), e([i59()], _27.prototype, "commonMaterialParameters", void 0), e([i59()], _27.prototype, "componentParameters", void 0), e([s59()], _27.prototype, "textureAlphaCutoff", void 0), e([s59()], _27.prototype, "alphaDiscardMode", void 0), e([s59()], _27.prototype, "isIntegratedMesh", void 0), e([s59()], _27.prototype, "polygonOffsetEnabled", void 0), e([s59()], _27.prototype, "ellipsoidMode", void 0), e([s59()], _27.prototype, "hasOccludees", void 0), function(e59) {
  e59[e59.VERTEX = 0] = "VERTEX", e59[e59.GROUND = 1] = "GROUND", e59[e59.SCREEN_DERIVATIVE = 2] = "SCREEN_DERIVATIVE";
}(k29 || (k29 = {})), function(e59) {
  e59[e59.Opaque = 0] = "Opaque", e59[e59.Transparent = 1] = "Transparent", e59[e59.OpaqueAndTransparent = 2] = "OpaqueAndTransparent", e59[e59.IntegratedMesh = 3] = "IntegratedMesh";
}(V15 || (V15 = {}));
var B15 = class extends r53 {
  constructor() {
    super(...arguments), this.doubleSided = false, this.cullFace = n19.Back, this.hasSlicePlane = true;
  }
};
e([s59()], B15.prototype, "doubleSided", void 0), e([s59()], B15.prototype, "cullFace", void 0), e([s59()], B15.prototype, "hasSlicePlane", void 0);
var L29 = class extends r53 {
  constructor() {
    super(...arguments), this.externalColor = r28(1, 1, 1, 1), this.externalColorMixMode = r24.Multiply, this.castShadows = W14.All;
  }
  get transparent() {
    return this.externalColor[3] < 1 ? W14.All : W14.None;
  }
  get opaqueOverride() {
    return this.externalColorMixMode === r24.Replace && 1 === this.externalColor[3] ? W14.All : W14.None;
  }
  get visible() {
    return this.externalColor[3] > 0 ? W14.All : W14.None;
  }
  get type() {
    return m15.Uniform;
  }
};
e([s59({ vectorOps: G2 })], L29.prototype, "externalColor", void 0), e([s59()], L29.prototype, "externalColorMixMode", void 0), e([s59()], L29.prototype, "castShadows", void 0), function(e59) {
  e59[e59.All = 0] = "All", e59[e59.Some = 1] = "Some", e59[e59.None = 2] = "None";
}(W14 || (W14 = {}));
var G20 = class extends r53 {
  constructor() {
    super(...arguments), this.texture = null, this.transparent = W14.None, this.opaqueOverride = W14.None, this.castShadows = W14.None;
  }
  get type() {
    return m15.Varying;
  }
};
function H19(e59) {
  switch (e59) {
    case o34.Color:
      return o18.Color;
    case o34.Alpha:
      return o18.Alpha;
    case o34.Depth:
      return o18.Depth;
    case o34.Normal:
      return o18.Normal;
  }
}
function U24(e59) {
  return 0 !== e59.overlays.length && r(e59.overlays[T8.INNER].getValidTexture(H6.Highlight));
}
function X8(e59) {
  return 0 !== e59.overlays.length && r(e59.overlays[T8.INNER].getColorTextureNoRasterImage());
}
e([s59()], G20.prototype, "texture", void 0), e([s59()], G20.prototype, "transparent", void 0), e([s59()], G20.prototype, "opaqueOverride", void 0), e([s59()], G20.prototype, "castShadows", void 0);

// node_modules/@arcgis/core/views/3d/webgl-engine/lib/TextureBackedBuffer/SimpleIndexManager.js
var e53 = class {
  constructor(e59) {
    this.maxCount = e59, this._nextIndex = 0, this.recycledIndices = [];
  }
  get activeCount() {
    return this._nextIndex - this.recycledIndices.length;
  }
  get availableCount() {
    return this.recycledIndices.length + this.maxCount - this._nextIndex;
  }
  acquire() {
    return this.recycledIndices.length > 0 ? this.recycledIndices.pop() : this.availableCount ? this._nextIndex++ : void 0;
  }
  release(e59) {
    this.recycledIndices.push(e59);
  }
};

// node_modules/@arcgis/core/views/3d/webgl-engine/lib/TextureBackedBuffer/TextureBackedBuffer.js
var a50 = class {
  constructor(a58, u51 = 1) {
    this.rctx = a58, this.fieldCount = u51, this.textureWidth = 4096, this.dirty = true, this.texture = new u10(this.rctx, { target: M6.TEXTURE_2D, pixelFormat: P3.RGBA, dataType: G4.UNSIGNED_BYTE, samplingMode: L4.NEAREST, wrapMode: D4.CLAMP_TO_EDGE, width: this.textureWidth, height: 1, flipped: false }), this.data = new x3(new ArrayBuffer(4 * this.textureWidth));
  }
  dispose() {
    this.texture.dispose(), this.texture = void 0, this.data = void 0;
  }
  setData(t60, e59, i66, s63, r59, h44) {
    const d32 = t60 * this.fieldCount + e59;
    this.dirty = true, this.data.set(d32, 0, i66), this.data.set(d32, 1, s63), this.data.set(d32, 2, r59), this.data.set(d32, 3, h44);
  }
  setDataElement(t60, e59, i66, s63) {
    const r59 = t60 * this.fieldCount + e59;
    this.dirty = true, this.data.set(r59, i66, s63);
  }
  resizeToFit(e59) {
    const i66 = e59 * this.fieldCount;
    if (i66 >= this.data.count) {
      const e60 = Math.ceil((i66 + 1) / this.textureWidth) * this.textureWidth, s63 = new x3(new ArrayBuffer(4 * e60));
      s63.typedBuffer.set(this.data.typedBuffer), this.data = s63;
    }
  }
  updateTexture() {
    if (!this.dirty)
      return;
    const t60 = this.texture.descriptor.width, e59 = this.texture.descriptor.height;
    this.data.count > t60 * e59 && this.texture.resize(t60, this.data.count / t60), this.texture.setData(this.data.typedBuffer), this.dirty = false;
  }
  bind(t60, e59, i66) {
    t60.bindTexture(e59, this.texture), t60.setUniform2f(i66, 1 / this.texture.descriptor.width, 1 / this.texture.descriptor.height);
  }
};

// node_modules/@arcgis/core/views/3d/webgl-engine/lib/TextureBackedBuffer/ManagedTextureBackedBuffer.js
var r54 = 65536;
var i60 = class {
  constructor(i66, a58 = 1) {
    this.textureBuffer = new a50(i66, a58), this.indexManager = new e53(r54);
  }
  dispose() {
    this.textureBuffer.dispose(), this.textureBuffer = void 0;
  }
  get availableCount() {
    return this.indexManager.availableCount;
  }
  get activeCount() {
    return this.indexManager.activeCount;
  }
  acquireIndex() {
    const e59 = this.indexManager.acquire();
    return this.textureBuffer.resizeToFit(e59), e59;
  }
  releaseIndex(e59) {
    this.indexManager.release(e59);
  }
};

// node_modules/@arcgis/core/views/3d/webgl-engine/lib/TextureBackedBuffer/BufferManager.js
var r55 = class {
  constructor(t60, e59 = 1) {
    this.rctx = t60, this.fieldCount = e59, this.buffers = [];
  }
  garbageCollect() {
    this.buffers = this.buffers.filter((t60) => 0 !== t60.activeCount || (t60.dispose(), false));
  }
  destroy() {
    this.buffers.forEach((t60) => t60.dispose()), this.buffers = [];
  }
  getBuffer(r59) {
    for (const t60 of this.buffers)
      if (t60.availableCount >= r59)
        return t60;
    if (r59 > r54)
      return null;
    const s63 = new i60(this.rctx, this.fieldCount);
    return this.buffers.push(s63), s63;
  }
  updateTextures() {
    for (const t60 of this.buffers)
      t60.textureBuffer.updateTexture();
  }
};

// node_modules/@arcgis/core/views/3d/webgl-engine/collections/Component/ComponentObjectCollection.js
var K11 = s3.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");
var Q14 = class {
  constructor(e59, t60) {
    this._renderManager = e59, this._viewingMode = t60, this._objects = [new n2(), new n2()], this._renderSubmit = new e51(this), this._renderManager.register(this._renderSubmit), this._componentBufferManager = new r55(e59.rctx, 2);
  }
  dispose() {
    e16(0 === this._objects[t28.Hidden].length && 0 === this._objects[t28.Visible].length, "ObjectCollection should be empty upon disposal"), this._componentBufferManager.destroy();
  }
  createObject(e59) {
    const t60 = new s29();
    return t60.toMapSpace = e59.toMapSpace, t60.transform = e59.transform, t60.obb = F6(e59.obb), t60.components = new a48(this._componentBufferManager, e59.geometry.componentOffsets), t60.renderable = this._createRenderable(e59, t60.components), t60.intersectionGeometry = new _26(e59.geometry.positionData, t60.components), this._objects[t60.visible].push(t60), t60;
  }
  destroyObject(e59) {
    const t60 = e59;
    this._objects[t60.visible].removeUnordered(t60), t60.dispose(), this._notifyDirty();
  }
  setObjectVisibility(e59, t60) {
    const o61 = e59;
    t60 !== o61.visible && (this._objects[o61.visible].removeUnordered(o61), this._objects[t60].push(o61), o61.visible = t60, this._notifyDirty());
  }
  preSubmit(e59) {
    const t60 = e59.camera.eye;
    this.visibleObjects.forAll((e60) => e60.renderable.meta.cameraDepthSquared = p5(t60, e60.obb.center));
  }
  getMaterial(e59) {
    return e59.renderable.material;
  }
  updateMaterial(e59, t60) {
    const o61 = e59.renderable.material;
    t60(o61), o61.dirty && this._notifyDirty();
  }
  setAllComponentVisibilities(e59, t60) {
    const o61 = e59;
    o61.components.visibility.reset(t60), o61.components.visibilityDirty(), this._notifyDirty();
  }
  forEachVisibleComponent(e59, t60) {
    return e59.components.visibility.forEachComponent(t60);
  }
  getComponentCount(e59) {
    const t60 = e59, o61 = t60.components.visibility.componentCount();
    return { visible: o61, invisible: t60.components.count - o61 };
  }
  setComponentData(e59, n73) {
    const r59 = e59, i66 = r59.renderable.material, s63 = r59.components, a58 = s63.materialDataBuffer, c67 = s63.materialDataIndices, m40 = { castShadows: true, pickable: true, externalColor: n30(), externalColorMixMode: r24.Multiply, elevationOffset: 0 }, l48 = a58.textureBuffer, f37 = new Uint8Array(4), p52 = new Uint32Array(f37.buffer);
    let h44 = 0, b23 = 0, g45 = 0, d32 = s63.verticalOffsets, _30 = 1 / 0, w25 = -1 / 0, M22 = false, x30 = false, O33 = 0;
    for (let u51 = 0; u51 < s63.count; u51++)
      n73(u51, m40), h44 += +(m40.externalColor[3] < 1), b23 += +(m40.externalColorMixMode === r24.Replace && 1 === m40.externalColor[3]), g45 += +m40.castShadows, o21(m40.externalColor, m40.externalColorMixMode, f37), f37[2] = 254 & f37[2] | +m40.castShadows, l48.setData(c67[u51], 0, f37[0], f37[1], f37[2], f37[3]), M22 || (M22 = u51 > 0 && O33 !== p52[0]), O33 = p52[0], x30 || (x30 = 0 !== m40.elevationOffset), x30 && t(d32) && (d32 = new Array(u51).fill(0)), r(d32) && (d32[u51] = m40.elevationOffset), _30 = Math.min(_30, m40.elevationOffset), w25 = Math.max(w25, m40.elevationOffset), s34(m40.elevationOffset, f37), l48.setData(c67[u51], 1, f37[0], f37[1], f37[2], f37[3]), m40.pickable !== n64(s63.pickability, u51) && (s63.pickability = t56(s63.pickability, s63.count, u51, m40.pickable));
    s63.verticalOffsets = x30 ? d32 : null, r59.offsetObb = x30 ? Pe(r59.obb, _30, w25, this._viewingMode, r(r59.offsetObb) ? r59.offsetObb : F6(r59.obb)) : null, M22 || x30 ? (i66.componentParameters = new G20(), i66.componentParameters.castShadows = $11(g45, s63.count), i66.componentParameters.transparent = $11(h44, s63.count), i66.componentParameters.opaqueOverride = $11(b23, s63.count), i66.componentParameters.texture = l48, l48.updateTexture()) : (i66.componentParameters = new L29(), i66.componentParameters.castShadows = m40.castShadows ? W14.All : W14.None, i66.componentParameters.externalColor = m40.externalColor, i66.componentParameters.externalColorMixMode = m40.externalColorMixMode), this._notifyDirty();
  }
  getComponentAabb(e59, o61, r59, i66 = false) {
    e59.intersectionGeometry.getComponentAabb(o61, r59);
    const s63 = e59, a58 = s63.components.verticalOffsets;
    if (i66 || t(a58))
      return r59;
    const c67 = a58[o61];
    if (this._viewingMode === l13.Local || 0 === c67)
      return r59[2] += c67, r59[5] += c67, r59;
    const m40 = e2(V4(c67));
    return m40.localOrigin = s63.transform.position, m40.applyToAabb(r59);
  }
  getComponentObb(e59) {
    return e59.obb;
  }
  getObjectTransform(e59) {
    return e59.transform;
  }
  getComponentPositions(e59, t60, o61) {
    return e59.intersectionGeometry.getComponentPositions(t60, o61);
  }
  intersect(e59, t60, n73, r59, i66, c67) {
    const m40 = e59;
    r(i66) && (i66.localOrigin = m40.transform.position);
    const p52 = u9(ee5, m40.transform.rotationScale);
    J(te5, t60, m40.transform.position), J(oe7, n73, m40.transform.position), O2(te5, te5, p52), O2(oe7, oe7, p52);
    const h44 = o10(ee5, p52);
    return m40.intersectionGeometry.intersect(te5, oe7, r59, h44, i66, m40.components.verticalOffsets, c67);
  }
  addEdges(e59, t60, o61, n73) {
    const r59 = e59, { indices: i66, positions: s63 } = r59.intersectionGeometry, a58 = r59.components.offsets;
    return t60.addComponentObject(e59, r59.transform, { center: r59.obb.center, radius: W5(r59.obb) }, s63, i66, a58, o61, n73);
  }
  async extractEdgeInformation(e59, t60, o61) {
    const n73 = e59, r59 = n73.components.visibility;
    if (r59.allInvisible())
      return { buffer: y3.createBuffer(0), origin: [0, 0, 0] };
    const { indices: i66, positions: s63 } = n73.intersectionGeometry, a58 = n73.components.offsets, c67 = A7.createBuffer(s63.count);
    e14(c67.position, s63), r14(c67.position, c67.position, n73.transform.rotationScale), this._setComponentIndices(c67.componentIndex, i66, a58);
    const m40 = c67.count, l48 = this._computeVisibilityIndices(i66, r59, a58, m40);
    return { origin: t5(n73.transform.position), buffer: await t60.extractComponentsEdgeLocations({ indices: l48, indicesLength: l48.length, skipDeduplicate: true, data: c67, writerSettings: { reducedPrecision: false, variants: 0 } }, o61) };
  }
  _setComponentIndices(e59, t60, o61) {
    let n73 = 0;
    for (let r59 = 0; r59 < o61.length - 1; r59++) {
      const i66 = o61[r59], s63 = o61[r59 + 1];
      for (let o62 = i66; o62 < s63; o62++) {
        const r60 = t60 ? t60[o62] : o62;
        e59.set(r60, n73);
      }
      n73++;
    }
  }
  _computeVisibilityIndices(e59, t60, o61, n73) {
    if (e59 && t60.allVisible())
      return e59;
    let r59 = 0;
    t60.forEachComponentRange((e60, t61) => (r59 += o61[t61] - o61[e60], true));
    const i66 = 2 === (e59 == null ? void 0 : e59.BYTES_PER_ELEMENT) || n73 <= 65536 ? new Uint16Array(r59) : new Uint32Array(r59);
    let s63 = 0;
    return t60.forEachComponentRange((t61, n74) => {
      const r60 = o61[t61], a58 = o61[n74];
      for (let o62 = r60; o62 < a58; o62++)
        i66[s63++] = e59 ? e59[o62] : o62;
      return true;
    }), i66;
  }
  addComponentHighlight(e59, o61) {
    const n73 = e59.components;
    t(n73.highlightCounts) && (n73.highlightCounts = new Uint32Array(n73.count + 1));
    0 === n73.highlightCounts[o61]++ && (n73.highlightsDirty(), this._notifyDirty()), n73.highlightCounts[n73.count]++;
  }
  removeComponentHighlight(e59, o61) {
    const n73 = e59.components;
    if (t(n73.highlightCounts))
      return void K11.warn("Removing non-existing highlight.");
    const r59 = n73.highlightCounts[o61], i66 = n73.highlightCounts[n73.count];
    if (0 !== r59) {
      if (r59 > 1)
        return n73.highlightCounts[o61] = r59 - 1, void (n73.highlightCounts[n73.count] = i66 - 1);
      n73.highlightCounts[o61] = 0, n73.highlightsDirty(), this._notifyDirty(), 1 === i66 ? n73.highlightCounts = null : n73.highlightCounts[n73.count] = i66 - 1;
    } else
      K11.warn("Removing non-existing highlight.");
  }
  clearHighlights(e59) {
    const t60 = e59.components;
    r(t60.highlightCounts) && (t60.highlightCounts = null, t60.highlightsDirty(), this._notifyDirty());
  }
  getObjectGPUMemoryUsage(e59) {
    return e59.renderable.meta.gpuMemoryEstimate;
  }
  get visibleObjects() {
    return this._objects[t28.Visible];
  }
  _createRenderable(e59, t60) {
    const i66 = this._renderManager.rctx, s63 = e59.geometry, a58 = s63.vertices.layoutParameters, c67 = c10.createVertex(i66, F4.STATIC_DRAW, s63.vertices.data), m40 = o(s63.indices, (e60) => c10.createIndex(i66, F4.STATIC_DRAW, e60)), l48 = o7(o31(a58)), f37 = new Uint16Array(s63.vertices.count);
    for (let n73 = 0; n73 < t60.count; n73++) {
      const e60 = t60.offsets[n73], r59 = t60.offsets[n73 + 1], i67 = t60.materialDataIndices[n73];
      if (r(s63.indices))
        for (let t61 = e60; t61 < r59; t61++) {
          f37[s63.indices[t61]] = i67;
        }
      else
        for (let t61 = e60; t61 < r59; t61++)
          f37[t61] = i67;
    }
    const p52 = c10.createVertex(i66, F4.STATIC_DRAW, f37.buffer), h44 = new _27(e59.transform, e59.toMapSpace), u51 = new f11(i66, h44.attributeLocations, { data: l48, componentIndices: Z10 }, { data: c67, componentIndices: p52 }, e2(m40)), b23 = new o54(u51, E5.TRIANGLES, a58, r(m40)), g45 = { cameraDepthSquared: 0.5, gpuMemoryEstimate: c67.byteSize + p52.byteSize + (r(m40) ? m40.byteSize : 0) };
    return new s58(h44, b23, g45);
  }
  _notifyDirty() {
    this._renderManager.notifyDirty();
  }
};
var Z10 = o7(T2().u16(O3.COMPONENTINDEX));
function $11(e59, t60) {
  return e59 === t60 ? W14.All : 0 === e59 ? W14.None : W14.Some;
}
var ee5 = e21();
var te5 = n7();
var oe7 = n7();

// node_modules/@arcgis/core/views/3d/webgl-engine/shaders/CompositingTechnique.js
var g38 = class extends e18 {
  initializeProgram(r59) {
    const i66 = g38.shader.get().build(this.configuration);
    return new o20(r59.rctx, i66, E7);
  }
  initializePipeline() {
    if (this.configuration.function === n33.TransparentToHUDVisibility)
      return W({ colorWrite: { r: false, g: true, b: false, a: false } });
    switch (this.configuration.alphaMode) {
      case o30.None:
        return W({ colorWrite: c11 });
      case o30.Alpha:
        return W({ blending: l15(R4.SRC_ALPHA, R4.ONE, R4.ONE_MINUS_SRC_ALPHA, R4.ONE_MINUS_SRC_ALPHA), colorWrite: c11 });
      default:
        return W({ blending: s14(R4.ONE, R4.ONE_MINUS_SRC_ALPHA), colorWrite: c11 });
    }
  }
};
g38.shader = new t15(l21, () => import("./Compositing.glsl-I3CEVGAI.js"));

// node_modules/@arcgis/core/views/3d/webgl-engine/lib/CompositingHelper.js
var _28 = class {
  constructor(s63, t60) {
    this._rctx = s63, this._techniqueRepository = t60, this._configuration = new i26(), this._passParameters = new d10();
  }
  dispose() {
    this._vao = s(this._vao);
  }
  compositeTransparent(s63, t60, i66, r59, e59 = 1) {
    this._configuration.alphaMode = o30.Alpha, this._configuration.function = n33.Transparency, this._configuration.hasOpacityFactor = 1 !== e59, this._passParameters.colorTexture = t60, this._passParameters.alphaTexture = i66, this._passParameters.frontFaceTexture = r59;
    const o61 = this._rctx, _30 = this._techniqueRepository.acquire(g38, this._configuration);
    o61.bindTechnique(_30, this._passParameters, s63);
    const m40 = this._ensureVAO();
    o61.bindVAO(m40), o61.drawArrays(E5.TRIANGLE_STRIP, 0, n20(m40, "geometry")), _30.release();
  }
  composite(s63, t60, r59 = o30.None, e59 = 1, o61 = n33.Standard, _30 = T8.INNER) {
    const m40 = this._rctx;
    this._configuration.alphaMode = r59, this._configuration.function = o61, this._configuration.hasOpacityFactor = 1 !== e59, this._passParameters.overlayIndex = _30, this._passParameters.texture = t60, this._passParameters.opacity = e59;
    const u51 = this._techniqueRepository.acquire(g38, this._configuration);
    m40.bindTechnique(u51, this._passParameters, s63);
    const f37 = this._ensureVAO();
    m40.bindVAO(f37), m40.drawArrays(E5.TRIANGLE_STRIP, 0, n20(f37, "geometry")), u51.release();
  }
  _ensureVAO() {
    return t(this._vao) && (this._vao = u12(this._rctx)), this._vao;
  }
};

// node_modules/@arcgis/core/views/3d/webgl-engine/lib/depthRangeUtils.js
var R18 = 1e4;
var B16 = 100;
var v34 = 500;
var j35 = 500;
var C24 = 0.1;
function A37(t60, r59, i66) {
  return r15(r59, t60) * (i66[1] - i66[0]) + i66[0];
}
function M20(e59, t60, r59) {
  if (t60.size < R18)
    return K12.compute(e59, t60);
  const i66 = n65();
  return r59.forAll((t61) => {
    t61.isVisible && t57(i66, O31(e59, t61));
  }), i66;
}
function O31(e59, r59) {
  if (!r59.isVisible)
    return;
  const i66 = n65(), n73 = r59.getSpatialQueryAccelerator();
  return r(n73) ? T25(i66, e59, n73) : D19(i66, e59, r59.objects), i66;
}
function T25(e59, t60, r59) {
  const i66 = t60.eye, n73 = t60.viewForward, s63 = t60.frustum, a58 = (e60) => e60.isVisible, o61 = r59.objectCount;
  if (o61 < v34)
    a49(W15, t60.near, Math.min(e59.near, t60.far)), r59.forEachInDepthRange(i66, n73, G6.DepthOrder.FRONT_TO_BACK, W15, (r60, i67) => {
      S23(e59, t60, r60), W15.far = e59.near, i67.setRange(W15);
    }, s63, a58), a49(W15, Math.max(e59.far, t60.near), t60.far), r59.forEachInDepthRange(i66, n73, G6.DepthOrder.BACK_TO_FRONT, W15, (r60, i67) => {
      S23(e59, t60, r60), W15.near = e59.far, i67.setRange(W15);
    }, s63, a58);
  else {
    const i67 = Math.max(Math.min(o61, j35), Math.ceil(o61 * C24)), h44 = r59.findClosest(n73, G6.DepthOrder.FRONT_TO_BACK, s63, a58, i67), f37 = r59.findClosest(n73, G6.DepthOrder.BACK_TO_FRONT, s63, a58, i67);
    h44 && f37 && (F20(e59, t60, h44.boundingVolumeWorldSpace.bounds), F20(e59, t60, f37.boundingVolumeWorldSpace.bounds));
  }
}
function D19(e59, t60, r59) {
  k30.clear(), r59.forAll((e60) => {
    e60.isVisible && 0 !== e60.geometryRecords.length && k30.add(e60);
  }), k30.empty || (k30.sort(t60), a49(W15, t60.near, Math.min(e59.near, t60.far)), k30.forEachInDepthRange(W15, G6.DepthOrder.FRONT_TO_BACK, (r60, i66) => {
    i66 < e59.near && S23(e59, t60, r60);
  }), a49(W15, Math.max(e59.far, t60.near), t60.far), k30.forEachInDepthRange(W15, G6.DepthOrder.BACK_TO_FRONT, (t61, r60, i66) => {
    e59.far = Math.max(e59.far, i66);
  }));
}
function S23(e59, t60, r59) {
  if (!r59.isVisible)
    return;
  if (!P5(t60.frustum, r59.boundingVolumeWorldSpace.bounds))
    return;
  const i66 = r59.transformation, s63 = E34;
  r59.geometryRecords.forEach((r60) => {
    u5(s63, i66, r60.getShaderTransformation());
    const a58 = l17(s63);
    y31(e59, t60, r60.geometry.boundingInfo, s63, a58);
  });
}
function y31(e59, t60, i66, n73, s63) {
  if (t(i66))
    return;
  const a58 = t60.eye, h44 = t60.viewForward;
  L2(V16, i66.center, n73);
  const f37 = h44[0] * (V16[0] - a58[0]) + h44[1] * (V16[1] - a58[1]) + h44[2] * (V16[2] - a58[2]);
  if (V16[3] = i66.radius * s63, !(f37 - V16[3] > e59.near && f37 + V16[3] < e59.far) && P5(t60.frustum, V16))
    if (i66.radius > B16 && i66.getChildren()) {
      const r59 = i66.getChildren();
      for (let i67 = 0; i67 < 8; ++i67)
        r59[i67] && y31(e59, t60, r59[i67], n73, s63);
    } else
      U25.unionDepthRangeWithAABB(e59, t60.viewProjectionMatrix, n73, i66.bbMin, i66.bbMax);
}
function F20(e59, t60, r59) {
  const i66 = t60.eye, n73 = t60.viewForward, s63 = (r59[0] - i66[0]) * n73[0] + (r59[1] - i66[1]) * n73[1] + (r59[2] - i66[2]) * n73[2];
  e59.near = Math.min(e59.near, s63 - r59[3]), e59.far = Math.max(e59.far, s63 + r59[3]);
}
var I24 = class {
  constructor() {
    this._items = new n2({ allocator: (e59) => e59 || { obj: null, distance: 0, near: 0, far: 0 }, deallocator: (e59) => (e59.obj = null, e59.distance = 0, e59.near = 0, e59.far = 0, e59) });
  }
  get length() {
    return this._items.length;
  }
  get empty() {
    return 0 === this._items.length;
  }
  clear() {
    this._items.clear();
  }
  add(e59) {
    this._items.pushNew().obj = e59;
  }
  sort(e59) {
    const t60 = e59.eye, r59 = e59.viewForward;
    this._items.forAll((e60) => {
      const i66 = e60.obj.boundingVolumeWorldSpace.bounds, n73 = (i66[0] - t60[0]) * r59[0] + (i66[1] - t60[1]) * r59[1] + (i66[2] - t60[2]) * r59[2];
      e60.distance = n73, e60.near = n73 - i66[3], e60.far = n73 + i66[3];
    }), this._items.sort((e60, t61) => e60.distance - t61.distance);
  }
  forEachInDepthRange(e59, t60, r59) {
    if (t60 === G6.DepthOrder.FRONT_TO_BACK)
      for (let i66 = 0; i66 < this._items.length; ++i66) {
        const t61 = this._items.data[i66];
        t61.far < e59.near || t61.near > e59.far || r59(t61.obj, t61.near, t61.far);
      }
    else
      for (let i66 = this._items.length - 1; i66 >= 0; --i66) {
        const t61 = this._items.data[i66];
        t61.far < e59.near || t61.near > e59.far || r59(t61.obj, t61.near, t61.far);
      }
  }
};
var P20 = class {
  constructor() {
    this.view = e12(), this.viewProj = e12(), this.frustum = H3(), this.geometries = [], this.near = [], this.far = [], this.nearCandidates = [], this.farCandidates = [], this.range = { near: 0, far: 0 }, this.looseRange = { near: 0, far: 0 };
  }
  compute(e59, t60) {
    this._reset(), n11(this.view, e59.viewMatrix), u5(this.viewProj, e59.projectionMatrix, this.view), i15(this.frustum, e59.frustum);
    const r59 = this.view, i66 = r59[2], a58 = r59[6], o61 = r59[10], h44 = r59[14], f37 = this.range;
    let c67 = 0;
    if (t60.forEach((e60) => {
      if (!e60.instanceParameters.visible)
        return;
      if (!e60.castShadow)
        return;
      let t61;
      e60.hasShaderTransformation ? (e60.computeBoundingSphere(e60.getShaderTransformation(), V16, 1), t61 = V16) : t61 = e60.boundingSphere;
      const r60 = i66 * t61[0] + a58 * t61[1] + o61 * t61[2] + h44, n73 = r60 - t61[3], s63 = r60 + t61[3];
      this.geometries[c67] = e60, this.near[c67] = -s63, this.far[c67] = -n73, ++c67;
    }), 0 === this.geometries.length)
      return f37;
    for (let n73 = 0; n73 < this.geometries.length; ++n73)
      this.near[n73] > f37.far && (f37.far = this.near[n73]), this.near[n73] > 2 && this.far[n73] < f37.near && (f37.near = this.far[n73]);
    const l48 = this.looseRange;
    l48.near = Math.max(0.5 * f37.near, 2), l48.far = 2 * f37.far;
    let d32 = 0, g45 = 0;
    for (let n73 = 0; n73 < this.geometries.length; ++n73)
      this.near[n73] < f37.near && (this.near[n73] >= l48.near ? f37.near = this.near[n73] : this.nearCandidates[d32++] = n73), this.far[n73] > f37.far && (this.far[n73] <= l48.far ? f37.far = this.far[n73] : this.farCandidates[g45++] = n73);
    if (0 === this.nearCandidates.length && 0 === this.farCandidates.length)
      return f37;
    this.nearCandidates.sort((e60, t61) => this.near[e60] < this.near[t61] ? -1 : this.near[e60] > this.near[t61] ? 1 : 0), this.farCandidates.sort((e60, t61) => this.far[e60] < this.far[t61] ? 1 : this.far[e60] > this.far[t61] ? -1 : 0);
    for (let n73 = 0; n73 < this.nearCandidates.length; ++n73) {
      const e60 = this.nearCandidates[n73];
      if (this.near[e60] < f37.near) {
        const t61 = this.geometries[e60], r60 = t61.boundingInfo;
        this._includeNearBoundingInfoRec(r60, t61.getShaderTransformation());
      }
    }
    for (let n73 = 0; n73 < this.farCandidates.length; ++n73) {
      const e60 = this.farCandidates[n73];
      if (this.far[e60] > f37.far) {
        const t61 = this.geometries[e60], r60 = t61.boundingInfo;
        this._includeFarBoundingInfoRec(r60, t61.getShaderTransformation());
      }
    }
    return f37;
  }
  _reset() {
    this.geometries.length = 0, this.near.length = 0, this.far.length = 0, this.nearCandidates.length = 0, this.farCandidates.length = 0, this.range.near = Number.MAX_VALUE, this.range.far = -Number.MAX_VALUE;
  }
  _includeNearBoundingInfoRec(e59, t60) {
    if (t(e59))
      return;
    const i66 = e59.getCenter();
    L2(V16, i66, t60);
    const n73 = l17(t60), s63 = V16[0], a58 = V16[1], h44 = V16[2], f37 = e59.getBSRadius() * n73, c67 = this.frustum;
    if (c67[0][0] * s63 + c67[0][1] * a58 + c67[0][2] * h44 + c67[0][3] > f37 || c67[1][0] * s63 + c67[1][1] * a58 + c67[1][2] * h44 + c67[1][3] > f37 || c67[2][0] * s63 + c67[2][1] * a58 + c67[2][2] * h44 + c67[2][3] > f37 || c67[3][0] * s63 + c67[3][1] * a58 + c67[3][2] * h44 + c67[3][3] > f37)
      return;
    const l48 = this.view[2] * s63 + this.view[6] * a58 + this.view[10] * h44 + this.view[14], u51 = l48 + f37;
    if (!(-(l48 - f37) < 2 || -u51 >= this.range.near))
      if (-u51 > this.looseRange.near)
        this.range.near = -u51;
      else {
        if (f37 > B16) {
          const r59 = e59.getChildren();
          if (void 0 !== r59) {
            for (let e60 = 0; e60 < 8; ++e60)
              void 0 !== r59[e60] && this._includeNearBoundingInfoRec(r59[e60], t60);
            return;
          }
        }
        U25.unionDepthRangeWithAABB(this.range, this.viewProj, t60, e59.getBBMin(), e59.getBBMax());
      }
  }
  _includeFarBoundingInfoRec(e59, t60) {
    if (t(e59))
      return;
    let i66 = e59.getBSRadius();
    const n73 = e59.getCenter();
    L2(V16, n73, t60);
    const s63 = l17(t60), a58 = V16[0], h44 = V16[1], f37 = V16[2];
    i66 *= s63;
    const c67 = this.frustum;
    if (c67[0][0] * a58 + c67[0][1] * h44 + c67[0][2] * f37 + c67[0][3] > i66 || c67[1][0] * a58 + c67[1][1] * h44 + c67[1][2] * f37 + c67[1][3] > i66 || c67[2][0] * a58 + c67[2][1] * h44 + c67[2][2] * f37 + c67[2][3] > i66 || c67[3][0] * a58 + c67[3][1] * h44 + c67[3][2] * f37 + c67[3][3] > i66)
      return;
    const l48 = this.view[2] * a58 + this.view[6] * h44 + this.view[10] * f37 + this.view[14] - i66;
    if (!(-l48 <= this.range.far))
      if (-l48 < this.looseRange.far)
        this.range.far = -l48;
      else {
        if (i66 > B16) {
          const r59 = e59.getChildren();
          if (void 0 !== r59) {
            for (let e60 = 0; e60 < 8; ++e60)
              void 0 !== r59[e60] && this._includeFarBoundingInfoRec(r59[e60], t60);
            return;
          }
        }
        U25.unionDepthRangeWithAABB(this.range, this.viewProj, t60, e59.getBBMin(), e59.getBBMax());
      }
  }
};
var x28 = class {
  constructor() {
    this.modelViewProj = e12(), this.clipPosition = [n10(), n10(), n10(), n10(), n10(), n10(), n10(), n10()];
  }
  unionDepthRangeWithAABB(e59, t60, r59, i66, s63) {
    const a58 = this.modelViewProj;
    u5(a58, t60, r59);
    let o61 = false;
    for (let n73 = 0; n73 < 8; ++n73) {
      const e60 = this.clipPosition[n73], t61 = 0 === n73 || 3 === n73 || 4 === n73 || 7 === n73 ? i66[0] : s63[0], r60 = 0 === n73 || 1 === n73 || 4 === n73 || 5 === n73 ? i66[1] : s63[1], o62 = n73 < 4 ? i66[2] : s63[2];
      e60[0] = a58[0] * t61 + a58[4] * r60 + a58[8] * o62 + a58[12], e60[1] = a58[1] * t61 + a58[5] * r60 + a58[9] * o62 + a58[13], e60[2] = a58[2] * t61 + a58[6] * r60 + a58[10] * o62 + a58[14], e60[3] = a58[3] * t61 + a58[7] * r60 + a58[11] * o62 + a58[15];
    }
    for (let n73 = 0; n73 < 12; ++n73) {
      const t61 = this.clipPosition[N19[n73][0]], r60 = this.clipPosition[N19[n73][1]], i67 = this.clipPosition[N19[n73][2]], s64 = this._clipTriangle(t61, r60, i67);
      let a59 = true;
      for (let e60 = 0; e60 < s64.length; ++e60) {
        if (s64[e60][3] >= 2) {
          a59 = false;
          break;
        }
      }
      if (!a59) {
        o61 = true;
        for (let t62 = 0; t62 < s64.length; ++t62) {
          const r61 = s64[t62][3];
          r61 < e59.near && (e59.near = r61), r61 > e59.far && (e59.far = r61);
        }
      }
    }
    return o61;
  }
  _inside(e59, t60) {
    return 0 === t60 ? e59[0] >= -e59[3] : 1 === t60 ? e59[1] >= -e59[3] : 2 === t60 ? e59[0] <= e59[3] : 3 === t60 ? e59[1] <= e59[3] : void e16(false);
  }
  _intersect(e59, t60, r59) {
    let i66 = 0;
    return 0 === r59 ? i66 = (-e59[3] - e59[0]) / (t60[0] - e59[0] + t60[3] - e59[3]) : 1 === r59 ? i66 = (-e59[3] - e59[1]) / (t60[1] - e59[1] + t60[3] - e59[3]) : 2 === r59 ? i66 = (e59[3] - e59[0]) / (t60[0] - e59[0] - t60[3] + e59[3]) : 3 === r59 && (i66 = (e59[3] - e59[1]) / (t60[1] - e59[1] - t60[3] + e59[3])), j3(n10(), e59, t60, i66);
  }
  _clipTriangle(e59, t60, r59) {
    let i66 = [e59, t60, r59];
    for (let n73 = 0; n73 < 4; ++n73) {
      const e60 = i66;
      i66 = [];
      for (let t61 = 0; t61 < e60.length; ++t61) {
        const r60 = e60[t61], s63 = e60[(t61 + 1) % e60.length];
        this._inside(s63, n73) ? (this._inside(r60, n73) || i66.push(this._intersect(r60, s63, n73)), i66.push(s63)) : this._inside(r60, n73) && i66.push(this._intersect(r60, s63, n73));
      }
    }
    return i66;
  }
};
var N19 = [[0, 1, 3], [2, 3, 1], [1, 5, 2], [6, 2, 5], [5, 4, 6], [7, 6, 4], [4, 0, 7], [3, 7, 0], [3, 2, 7], [6, 7, 2], [4, 5, 0], [1, 0, 5]];
var V16 = _3();
var E34 = e12();
var W15 = n65();
var k30 = new I24();
var K12 = new P20();
var U25 = new x28();

// node_modules/@arcgis/core/views/3d/webgl-engine/shaders/Magnifier.glsl.js
var d30 = class extends t14 {
  constructor() {
    super(...arguments), this.maskEnabled = false, this.overlayEnabled = false;
  }
};
function i61() {
  const o61 = new i12();
  return o61.attributes.add(O3.POSITION, "vec2"), o61.vertex.uniforms.add(new o29("drawPosition")), o61.varyings.add("vUV", "vec2"), o61.vertex.code.add(n21`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`), o61.fragment.uniforms.add(new s24("textureInput")), o61.fragment.uniforms.add(new s24("textureMask")), o61.fragment.uniforms.add(new s24("textureOverlay")), o61.fragment.uniforms.add(new s15("maskEnabled", (e59) => e59.maskEnabled)), o61.fragment.uniforms.add(new s15("overlayEnabled", (e59) => e59.overlayEnabled)), o61.fragment.code.add(n21`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture2D(textureMask, vUV).a : 1.0;
vec4 inputColor = texture2D(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture2D(textureOverlay, vUV) : vec4(0);
gl_FragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`), o61;
}

// node_modules/@arcgis/core/views/3d/webgl-engine/lib/MagnifierHelper.js
var N20 = class extends y {
  constructor() {
    super(...arguments), this._handles = new u4(), this._magnifier = null, this._imageSources = null, this._imageLoadTask = null, this._resources = null, this._passParameters = new d30(), this.events = new n8(), this.attributeLocations = /* @__PURE__ */ new Map([[O3.POSITION, 0]]), this.tmpScreenPoint = i3(), this.tmpRenderPoint = s11();
  }
  get updating() {
    return t(this._imageSources) && r(this._imageLoadTask) && !this._imageLoadTask.task.finished;
  }
  get magnifier() {
    return this._magnifier;
  }
  set magnifier(e59) {
    if (e59 === this._magnifier)
      return;
    this._handles.removeAll(), this._magnifier = e59;
    const s63 = () => {
      this._updateResourceLoading(), this.events.emit("request-render");
    };
    r(this._magnifier) && this._handles.add(l6(() => o(this._magnifier, (e60) => e60.version), s63)), s63();
  }
  get enabled() {
    return r(this._validMagnifier);
  }
  get _validMagnifier() {
    return r(this._magnifier) && this._magnifier.visible && r(this._magnifier.position) && this._magnifier.size > 0 ? this._magnifier : null;
  }
  get factor() {
    return r(this._magnifier) && this._magnifier.factor || 1;
  }
  dispose() {
    this._magnifier = null, this._handles.destroy(), r(this._imageLoadTask) && (this._imageLoadTask.task.abort(), this._imageLoadTask = null), this._disposeResources();
  }
  render(e59, s63) {
    const r59 = this._validMagnifier;
    if (t(r59))
      return;
    const t60 = s63.camera.pixelRatio, o61 = Math.ceil(t60 * r59.size);
    if (this._updateResources(e59, o61), t(this._resources))
      return;
    this._passParameters.maskEnabled = r59.maskEnabled, this._passParameters.overlayEnabled = r59.overlayEnabled;
    const n73 = this._resources.program;
    e59.useProgram(n73), n73.bindPass(this._passParameters, s63);
    const m40 = this._resources.textures, u51 = Math.ceil(1 / this.factor * o61);
    m40.input.resize(u51, u51);
    const l48 = s63.camera.fullWidth, p52 = s63.camera.fullHeight;
    d2(r59.position, this.tmpScreenPoint);
    const c67 = s63.camera.screenToRender(this.tmpScreenPoint, this.tmpRenderPoint), _30 = 0.5 * u51, d32 = 0.5 * u51;
    c67[0] = o4(c67[0], _30, l48 - _30 - 1), c67[1] = o4(c67[1], d32, p52 - d32 - 1);
    const g45 = Math.floor(c67[0] - _30), f37 = Math.floor(c67[1] - d32);
    n73.bindTexture("textureInput", m40.input), e59.gl.copyTexImage2D(m40.input.descriptor.target, 0, m40.input.descriptor.pixelFormat, g45, f37, u51, u51, 0);
    const T29 = r59.offset.x * t60, v36 = r59.offset.y * t60, y33 = (c67[0] + T29) / l48 * 2 - 1, k32 = (c67[1] - v36) / p52 * 2 - 1, R21 = o61 / l48 * 2, L31 = o61 / p52 * 2;
    e59.bindVAO(this._resources.vao), n73.bindTexture("textureOverlay", m40.overlay), n73.bindTexture("textureMask", m40.mask), n73.setUniform4f("drawPosition", y33, k32, R21, L31), e59.setPipelineState(this._resources.pipelineState), e59.drawArrays(E5.TRIANGLE_STRIP, 0, 4);
  }
  _updateResourceLoading() {
    const e59 = this._validMagnifier;
    if (t(e59))
      return;
    const s63 = e59.maskUrl, r59 = e59.overlayUrl;
    !r(this._imageLoadTask) || this._imageLoadTask.maskUrl === s63 && this._imageLoadTask.overlayUrl === r59 || (this._imageLoadTask.task.abort(), this._imageLoadTask = null, this._imageSources = null), r(this._imageSources) || r(this._imageLoadTask) || (this._imageLoadTask = { maskUrl: s63, overlayUrl: r59, task: O(async (e60) => {
      const t60 = t(s63) || t(r59) ? s18(e60) : null, i66 = r(s63) ? t11(s63, { signal: e60 }) : t60.then((e61) => e61.mask), n73 = r(r59) ? t11(r59, { signal: e60 }) : t60.then((e61) => e61.overlay);
      this._imageSources = { mask: await i66, overlay: await n73 }, this._disposeResources(), this.events.emit("request-render");
    }) }, this._imageLoadTask.task.promise.then(() => this.notifyChange("updating"), () => this.notifyChange("updating")));
  }
  _updateResources(e59, s63) {
    if (!this.enabled)
      return void this._disposeResources();
    if (r(this._resources)) {
      if (this._resources.textures.size !== s63) {
        const r60 = this._createTextureResources(e59, s63);
        if (t(r60))
          return void this._disposeResources();
        this._disposeTextureResources(this._resources.textures), this._resources.textures = r60;
      }
      return;
    }
    const r59 = this._createTextureResources(e59, s63);
    t(r59) || (this._resources = { textures: r59, program: this._createProgram(e59), vao: u12(e59, t13, this.attributeLocations, 0, 1), pipelineState: W({ blending: s14(R4.ONE, R4.ONE_MINUS_SRC_ALPHA), depthTest: null, depthWrite: null, colorWrite: c11 }) });
  }
  _disposeResources() {
    t(this._resources) || (this._disposeTextureResources(this._resources.textures), this._resources.program.dispose(), this._resources.vao.dispose(), this._resources = null);
  }
  _disposeTextureResources(e59) {
    e59.mask.dispose(), e59.overlay.dispose(), e59.input.dispose();
  }
  _createTextureResources(e59, s63) {
    if (t(this._imageSources))
      return null;
    this._imageSources.overlay.width = s63, this._imageSources.overlay.height = s63, this._imageSources.mask.width = s63, this._imageSources.mask.height = s63;
    const r59 = new u10(e59, { target: M6.TEXTURE_2D, pixelFormat: P3.RGBA, internalFormat: P3.RGBA, dataType: G4.UNSIGNED_BYTE, wrapMode: D4.CLAMP_TO_EDGE, samplingMode: L4.LINEAR, flipped: true, preMultiplyAlpha: !It(this._imageSources.overlay.src) || !e59.driverTest.svgAlwaysPremultipliesAlpha }, this._imageSources.overlay), t60 = new u10(e59, { target: M6.TEXTURE_2D, pixelFormat: P3.ALPHA, internalFormat: P3.ALPHA, dataType: G4.UNSIGNED_BYTE, wrapMode: D4.CLAMP_TO_EDGE, samplingMode: L4.LINEAR, flipped: true }, this._imageSources.mask);
    return { input: new u10(e59, { target: M6.TEXTURE_2D, pixelFormat: P3.RGBA, internalFormat: P3.RGBA, dataType: G4.UNSIGNED_BYTE, wrapMode: D4.CLAMP_TO_EDGE, samplingMode: L4.LINEAR, flipped: false }), mask: t60, overlay: r59, size: s63 };
  }
  _createProgram(e59) {
    return new o20(e59, i61(), this.attributeLocations);
  }
};
e([d()], N20.prototype, "_imageSources", void 0), e([d()], N20.prototype, "_imageLoadTask", void 0), e([d({ readOnly: true })], N20.prototype, "updating", null), N20 = e([n6("esri/views/3d/webgl-engine/lib/MagnifierHelper")], N20);

// node_modules/@arcgis/core/views/3d/support/animationUtils.js
var e54 = 0.5;
var r56 = n3(1e3 / 30);

// node_modules/@arcgis/core/views/3d/webgl-engine/core/renderPasses/RenderPass.js
var s60;
!function(e59) {
  e59[e59.FrontToBack = 0] = "FrontToBack", e59[e59.BackToFront = 1] = "BackToFront";
}(s60 || (s60 = {}));
var o55 = class {
  constructor(e59, r59, i66 = s60.FrontToBack) {
    this._rctx = e59, this._techniqueRepository = r59, this._sorting = i66, this._draws = new n2({ initialSize: 32, allocator: (e60) => e60 || { material: null, geometry: null, geometryRanges: null, bindDrawParams: null, depthSquaredHint: 0, indexType: 0 } }), this._previouslyBoundDraw = /* @__PURE__ */ new Map();
  }
  submitDraw(t60, r59, i66, s63) {
    const o61 = this._draws.pushNew();
    o61.geometry = r59, o61.geometryRanges = i66, o61.material = t60, o61.depthSquaredHint = s63, o61.indexType = r59.indexed ? e2(r59.vao.indexBuffer).indexType : 0;
  }
  dispatch(e59, t60) {
    const i66 = this._rctx;
    this._previouslyBoundDraw.clear();
    let s63 = null;
    const o61 = this._draws.map((r59) => r59.material.prepareTechnique(this._techniqueRepository, e59, t60, r59.geometry.parameters)), n73 = this._draws.length;
    for (let c67 = 0; c67 < n73; c67++) {
      const n74 = o61[c67];
      n74 === s63 && n74.configuration.transparencyPassType === O4.NONE || (i66.bindTechnique(n74, e59, t60), s63 = n74);
      const d32 = this._draws.data[c67], l48 = d32.geometry;
      i66.bindVAO(l48.vao), this._previouslyBoundDraw.get(n74) !== d32.material && (n74.bindDraw(d32.material, t60), this._previouslyBoundDraw.set(n74, d32.material));
      const p52 = d32.geometryRanges, m40 = p52.length;
      if (0 !== d32.indexType) {
        const e60 = a51.get(d32.indexType);
        for (let t61 = 0; t61 < m40; t61 += 2) {
          const r59 = p52[t61], s64 = p52[t61 + 1];
          i66.drawElements(l48.primitiveType, s64, d32.indexType, r59 * e60);
        }
      } else
        for (let e60 = 0; e60 < m40; e60 += 2) {
          const t61 = p52[e60], r59 = p52[e60 + 1];
          i66.drawArrays(l48.primitiveType, t61, r59);
        }
    }
  }
  prepareSubmit() {
    this._draws.clear();
  }
  finishSubmit() {
    const e59 = this._sorting === s60.FrontToBack ? 1 : -1;
    this._draws.sort((t60, r59) => {
      const i66 = e59 * (t60.depthSquaredHint - r59.depthSquaredHint);
      return 0 !== i66 ? i66 : t60.geometry.vao.size - r59.geometry.vao.size;
    });
  }
  get count() {
    return this._draws.length;
  }
};
var a51 = /* @__PURE__ */ new Map();
a51.set(C2.UNSIGNED_BYTE, 1), a51.set(C2.UNSIGNED_SHORT, 2), a51.set(C2.UNSIGNED_INT, 4);

// node_modules/@arcgis/core/views/3d/webgl-engine/core/renderPasses/RenderPassManager.js
var M21 = class {
  constructor(s63, a58) {
    this.rctx = s63, this.shaderTechniqueRepository = a58, this.canRender = true, this._materialPassParameters = new l20(), this._shadowPassParameters = new n37(), this._highlightPassParameters = new h19(), this._systems = /* @__PURE__ */ new Set(), this._passes = { materialOpaque: new o55(s63, a58), materialTransparent: new o55(s63, a58, s60.BackToFront), materialIntegratedMesh: new o55(s63, a58), shadowMap: new o55(s63, a58), highlight: new o55(s63, a58), highlightIntegratedMesh: new o55(s63, a58), highlightShadowMap: new o55(s63, a58), defaultShadowMap: new o55(s63, a58) };
  }
  register(s63) {
    this._systems.add(s63);
  }
  prepareRender(s63) {
    if (0 !== this._systems.size) {
      for (const s64 of Object.values(this._passes))
        s64.prepareSubmit();
      this._systems.forEach((a58) => a58.submit(this._passes, s63.bindParameters));
      for (const s64 of Object.values(this._passes))
        s64.finishSubmit();
      this.shaderTechniqueRepository.frameUpdate();
    }
  }
  render(s63) {
    if (0 !== this._systems.size)
      switch (this._configure(s63), s63.bindParameters.slot) {
        case E9.OPAQUE_MATERIAL:
          switch (s63.pass) {
            case A12.MATERIAL:
              return this._materialPassParameters.subPass = o34.Color, this._passes.materialOpaque.dispatch(this._materialPassParameters, s63.bindParameters);
            case A12.MATERIAL_DEPTH:
              return this._materialPassParameters.subPass = o34.Depth, this._passes.materialOpaque.dispatch(this._materialPassParameters, s63.bindParameters);
            case A12.MATERIAL_NORMAL:
              return this._materialPassParameters.subPass = o34.Normal, this._passes.materialOpaque.dispatch(this._materialPassParameters, s63.bindParameters);
            case A12.MATERIAL_HIGHLIGHT:
              return this._passes.highlight.dispatch(this._highlightPassParameters, s63.bindParameters);
            case A12.MATERIAL_DEPTH_SHADOWMAP_ALL:
              return this._passes.shadowMap.dispatch(this._shadowPassParameters, s63.bindParameters);
            case A12.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT:
              return this._passes.highlightShadowMap.dispatch(this._shadowPassParameters, s63.bindParameters);
            case A12.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:
              return this._passes.defaultShadowMap.dispatch(this._shadowPassParameters, s63.bindParameters);
          }
          return;
        case E9.TRANSPARENT_MATERIAL:
          switch (s63.pass) {
            case A12.MATERIAL:
              return this._materialPassParameters.subPass = o34.Color, this._passes.materialTransparent.dispatch(this._materialPassParameters, s63.bindParameters);
            case A12.MATERIAL_ALPHA:
              return this._materialPassParameters.subPass = o34.Alpha, this._passes.materialTransparent.dispatch(this._materialPassParameters, s63.bindParameters);
            case A12.MATERIAL_DEPTH:
              return this._materialPassParameters.subPass = o34.Depth, this._passes.materialTransparent.dispatch(this._materialPassParameters, s63.bindParameters);
            case A12.MATERIAL_NORMAL:
              return this._materialPassParameters.subPass = o34.Normal, this._passes.materialTransparent.dispatch(this._materialPassParameters, s63.bindParameters);
          }
          return;
        case E9.INTEGRATED_MESH:
          switch (s63.pass) {
            case A12.MATERIAL:
              return this._materialPassParameters.subPass = o34.Color, this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters, s63.bindParameters);
            case A12.MATERIAL_DEPTH:
              return this._materialPassParameters.subPass = o34.Depth, this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters, s63.bindParameters);
            case A12.MATERIAL_NORMAL:
              return this._materialPassParameters.subPass = o34.Normal, this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters, s63.bindParameters);
            case A12.MATERIAL_HIGHLIGHT:
              return this._passes.highlightIntegratedMesh.dispatch(this._highlightPassParameters, s63.bindParameters);
          }
          return;
      }
  }
  notifyDirty() {
    this._context.requestRender();
  }
  slots() {
    return [E9.OPAQUE_MATERIAL, E9.TRANSPARENT_MATERIAL, E9.INTEGRATED_MESH];
  }
  initializeRenderContext(s63) {
    this._context = s63;
  }
  uninitializeRenderContext() {
  }
  queryDepthRange(a58) {
    const e59 = { near: 1 / 0, far: -1 / 0 };
    return this._systems.forEach((t60) => {
      const r59 = t60.queryShadowCasterDepthRange(a58);
      r(r59) && t57(e59, r59, e59);
    }), e59;
  }
  _configure(s63) {
    const a58 = s63.pass === A12.MATERIAL_DEPTH_SHADOWMAP_ALL || s63.pass === A12.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT || s63.pass === A12.MATERIAL_DEPTH_SHADOWMAP_DEFAULT ? this._shadowPassParameters : s63.pass === A12.MATERIAL_HIGHLIGHT ? this._highlightPassParameters : this._materialPassParameters;
    this._updateParameters(s63, a58);
  }
  _updateParameters(s63, r59) {
    const n73 = s63.bindParameters.camera, P22 = n73.viewInverseTransposeMatrix;
    o3(E35, P22[3], P22[7], P22[11]), g39.set(E35), r7(r59.transformWorldFromViewTH, g39.high), r7(r59.transformWorldFromViewTL, g39.low), r7(r59.slicePlaneLocalOrigin, E35), a10(r59.transformViewFromCameraRelativeRS, n73.viewMatrix), n11(r59.transformProjFromView, n73.projectionMatrix), r59.identifier === a27.Material && (this._materialPassParameters.transparent = s63.bindParameters.slot === E9.TRANSPARENT_MATERIAL, this._materialPassParameters.integratedMesh = s63.bindParameters.slot === E9.INTEGRATED_MESH, o10(I25, r59.transformViewFromCameraRelativeRS), u9(r59.transformNormalViewFromGlobal, I25));
  }
  get needsHighlight() {
    return this._passes.highlight.count > 0 || this._passes.highlightIntegratedMesh.count > 0;
  }
  get needsTransparentPass() {
    return this._passes.materialTransparent.count > 0;
  }
};
var E35 = n7();
var I25 = e11();
var g39 = new c62();

// node_modules/@arcgis/core/views/3d/webgl-engine/shaders/HighlightApplyTechnique.js
var a52 = class extends e18 {
  initializeProgram(e59) {
    const r59 = a52.shader.get().build();
    return new o20(e59.rctx, r59, E7);
  }
  initializePipeline() {
    return W({ blending: l15(R4.SRC_ALPHA, R4.ONE, R4.ONE_MINUS_SRC_ALPHA, R4.ONE_MINUS_SRC_ALPHA), colorWrite: c11 });
  }
};
a52.shader = new t15(c28, () => import("./HighlightApply.glsl-NLUJQ3SI.js"));

// node_modules/@arcgis/core/views/3d/webgl-engine/shaders/HighlightBlurTechnique.js
var a53 = class extends e18 {
  initializeProgram(r59) {
    const e59 = a53.shader.get().build();
    return new o20(r59.rctx, e59, E7);
  }
  initializePipeline() {
    return W({ colorWrite: c11 });
  }
};
a53.shader = new t15(l22, () => import("./HighlightBlur.glsl-EOJI7HAK.js"));

// node_modules/@arcgis/core/views/3d/webgl-engine/shaders/HighlightDownsampleTechnique.js
var a54 = class extends e18 {
  initializeProgram(e59) {
    const r59 = a54.shader.get().build();
    return new o20(e59.rctx, r59, E7);
  }
  initializePipeline() {
    return W({ colorWrite: c11 });
  }
};
a54.shader = new t15(m17, () => import("./HighlightDownsample.glsl-YUA66AFN.js"));

// node_modules/@arcgis/core/views/3d/webgl-engine/shaders/HighlightPassParameters.js
var c63 = class extends t14 {
  constructor() {
    super(...arguments), this.color = r28(1, 0, 1, 1), this.haloColor = r28(1, 0, 1, 1), this.haloOpacity = 1, this.haloOpacityOccluded = 0.25, this.fillOpacity = 0.2, this.fillOpacityOccluded = 0.05, this.shadowColor = r10(1, 0, 1, 1), this.shadowOpacity = 0.15, this.occludedShadowOpacity = 0.075;
  }
};

// node_modules/@arcgis/core/views/3d/webgl-engine/lib/Highlight.js
var D20 = 32;
var O32 = class {
  constructor(e59, t60) {
    this._techniqueRep = e59, this._rctx = t60, this.viewportToRestore = n10(), this._passParameters = new c63(), this._downsampleDrawParameters = new s35(), this._blurDrawParameters = new a29(), this._grid = { coverageMipmap: null, vao: null, verticalCellCount: 0, horizontalCellCount: 0, cellPixelSize: 0, mipmapLevels: 0, viewportWidth: 0, viewportHeight: 0 };
  }
  _assertResources() {
    if (this.quadVAO)
      return;
    this.quadVAO = u12(this._rctx);
    const e59 = { colorTarget: Y.TEXTURE, depthStencilTarget: V2.NONE, width: 0, height: 0 }, t60 = { target: M6.TEXTURE_2D, pixelFormat: P3.RGBA, dataType: G4.UNSIGNED_BYTE, samplingMode: L4.LINEAR, wrapMode: D4.CLAMP_TO_EDGE, width: 0, height: 0 };
    this.blur0Fbo = new D6(this._rctx, e59, t60), this.blur1Fbo = new D6(this._rctx, e59, t60);
    const i66 = new t17();
    this._blurTechnique = this._techniqueRep.acquire(a53, i66), this._downsampleTechnique = this._techniqueRep.acquire(a54, i66), this._applyTechnique = this._techniqueRep.acquire(a52, i66);
  }
  dispose() {
    if (this._blurTechnique = p(this._blurTechnique), this._downsampleTechnique = p(this._downsampleTechnique), this._applyTechnique = p(this._applyTechnique), this._grid.coverageMipmap)
      for (let e59 = 1; e59 < this._grid.coverageMipmap.length; e59++)
        this._grid.coverageMipmap[e59].dispose();
    this._grid.vao && this._grid.vao.dispose(true), this.quadVAO && (this.quadVAO.dispose(true), this.quadVAO = null), this.blur0Fbo = s(this.blur0Fbo), this.blur1Fbo = s(this.blur1Fbo);
  }
  setDefaultOptions(e59) {
    this._passParameters = { ...new c63(), ...e59 };
  }
  render(e59, t60, i66) {
    this._passParameters.highlightColorTexture = t60.colorTexture, this._assertResources();
    const a58 = e59.camera;
    a3(this.viewportToRestore, a58.fullViewport);
    const o61 = a58.fullWidth, h44 = a58.fullHeight, l48 = a58.pixelRatio, p52 = Math.ceil(o61 / l48), u51 = Math.ceil(h44 / l48);
    this.blur0Fbo.resize(p52, u51), this.blur1Fbo.resize(p52, u51);
    const m40 = this._rctx;
    m40.bindVAO(this.quadVAO);
    let c67 = null;
    this._gridUpdateResources(t60, D20), this._gridComputeMipmap(e59), this._passParameters.coverageTexture = this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture, c67 = this._grid.vao;
    const n73 = m40.bindTechnique(this._blurTechnique, this._passParameters, e59);
    m40.bindVAO(c67), m40.bindFramebuffer(this.blur0Fbo), m40.setViewport(0, 0, p52, u51), m40.setClearColor(0, 0, 0, 0), m40.clear(_2.COLOR_BUFFER_BIT), this._blurDrawParameters.blurInputTexture = t60.colorTexture, r13(this._blurDrawParameters.blurSize, 1 / p52, 0), n73.bindDraw(this._blurDrawParameters, e59), m40.drawArrays(this._blurTechnique.primitiveType, 0, n20(c67, "geometry")), m40.bindFramebuffer(this.blur1Fbo), m40.clear(_2.COLOR_BUFFER_BIT), this._blurDrawParameters.blurInputTexture = this.blur0Fbo.colorTexture, r13(this._blurDrawParameters.blurSize, 0, 1 / u51), n73.bindDraw(this._blurDrawParameters, e59), m40.drawArrays(this._blurTechnique.primitiveType, 0, n20(c67, "geometry")), m40.bindFramebuffer(i66), m40.setViewport(this.viewportToRestore[0], this.viewportToRestore[1], this.viewportToRestore[2], this.viewportToRestore[3]), this._passParameters.blurColorTexture = this.blur1Fbo.colorTexture, m40.bindTechnique(this._applyTechnique, this._passParameters, e59), m40.drawArrays(this._applyTechnique.primitiveType, 0, n20(c67, "geometry")), m40.bindVAO(null);
  }
  _gridUpdateResources(e59, t60) {
    const i66 = this._rctx, r59 = this._grid;
    let s63 = false;
    if (null === r59.coverageMipmap && (r59.coverageMipmap = [e59], s63 = true), r59.viewportWidth === e59.width && r59.viewportHeight === e59.height || (s63 = true, r59.viewportWidth = e59.width, r59.viewportHeight = e59.height), r59.coverageMipmap[0] = e59, r59.cellPixelSize !== t60 && (r59.cellPixelSize = t60, s63 = true), s63) {
      for (let e60 = 1; e60 < r59.coverageMipmap.length; e60++)
        r59.coverageMipmap[e60].dispose();
      r59.mipmapLevels = Math.ceil(Math.log(r59.cellPixelSize) * Math.LOG2E), r59.coverageMipmap.length = r59.mipmapLevels + 1;
      for (let e60 = 0; e60 < r59.mipmapLevels; e60++) {
        const t61 = r59.coverageMipmap[e60], s64 = { target: M6.TEXTURE_2D, pixelFormat: P3.RGB, dataType: G4.UNSIGNED_SHORT_5_6_5, samplingMode: L4.LINEAR, wrapMode: D4.CLAMP_TO_EDGE, width: Math.ceil(t61.width / 2), height: Math.ceil(t61.height / 2) }, a59 = { colorTarget: Y.TEXTURE, depthStencilTarget: V2.NONE, width: Math.ceil(t61.width / 2), height: Math.ceil(t61.height / 2) };
        r59.coverageMipmap[e60 + 1] = new D6(i66, a59, s64);
      }
    }
    const a58 = Math.ceil(e59.height / r59.cellPixelSize), o61 = Math.ceil(e59.width / r59.cellPixelSize);
    if (!r59.vao || r59.verticalCellCount !== a58 || r59.horizontalCellCount !== o61) {
      r59.verticalCellCount = a58, r59.horizontalCellCount = o61;
      const e60 = a58 + 1, t61 = o61 + 1, s64 = 1 / a58, p52 = 1 / o61, u51 = 6, m40 = 4, c67 = new Float32Array(u51 * m40 * e60 * t61);
      let n73 = 0;
      for (let i67 = 0; i67 < e60; i67++)
        for (let e61 = 0; e61 < t61; e61++)
          c67[n73 + 0] = (e61 - 0.5) * p52 * 2 - 1, c67[n73 + 1] = (i67 - 0.5) * s64 * 2 - 1, c67[n73 + 2] = e61 * p52, c67[n73 + 3] = i67 * s64, c67[n73 + 4] = (e61 + 0.5) * p52 * 2 - 1, c67[n73 + 5] = (i67 - 0.5) * s64 * 2 - 1, c67[n73 + 6] = e61 * p52, c67[n73 + 7] = i67 * s64, c67[n73 + 8] = (e61 - 0.5) * p52 * 2 - 1, c67[n73 + 9] = (i67 + 0.5) * s64 * 2 - 1, c67[n73 + 10] = e61 * p52, c67[n73 + 11] = i67 * s64, c67[n73 + 12] = (e61 - 0.5) * p52 * 2 - 1, c67[n73 + 13] = (i67 + 0.5) * s64 * 2 - 1, c67[n73 + 14] = e61 * p52, c67[n73 + 15] = i67 * s64, c67[n73 + 16] = (e61 + 0.5) * p52 * 2 - 1, c67[n73 + 17] = (i67 - 0.5) * s64 * 2 - 1, c67[n73 + 18] = e61 * p52, c67[n73 + 19] = i67 * s64, c67[n73 + 20] = (e61 + 0.5) * p52 * 2 - 1, c67[n73 + 21] = (i67 + 0.5) * s64 * 2 - 1, c67[n73 + 22] = e61 * p52, c67[n73 + 23] = i67 * s64, n73 += u51 * m40;
      r59.vao && r59.vao.dispose(true), r59.vao = new f11(i66, E7, { geometry: A9 }, { geometry: c10.createVertex(i66, F4.STATIC_DRAW, c67) });
    }
  }
  _gridComputeMipmap(e59) {
    const t60 = this._rctx, i66 = this._grid, s63 = t60.bindTechnique(this._downsampleTechnique, this._passParameters, e59);
    t60.bindVAO(this.quadVAO);
    for (let a58 = 0; a58 < i66.mipmapLevels; a58++) {
      t60.bindFramebuffer(i66.coverageMipmap[a58 + 1]);
      const o61 = i66.coverageMipmap[a58 + 1].width, h44 = i66.coverageMipmap[a58 + 1].height;
      this._downsampleDrawParameters.inputTexture = i66.coverageMipmap[a58].colorTexture, r13(this._downsampleDrawParameters.invFramebufferDim, 1 / o61, 1 / h44), s63.bindDraw(this._downsampleDrawParameters, e59), t60.setViewport(0, 0, o61, h44), t60.drawArrays(E5.TRIANGLE_STRIP, 0, n20(this.quadVAO, "geometry"));
    }
  }
  get gpuMemoryUsage() {
    let e59 = (r(this.blur0Fbo) ? this.blur0Fbo.gpuMemoryUsage : 0) + (r(this.blur1Fbo) ? this.blur1Fbo.gpuMemoryUsage : 0);
    if (this._grid.coverageMipmap)
      for (const t60 of this._grid.coverageMipmap)
        e59 += t60.gpuMemoryUsage;
    return e59;
  }
  get test() {
    return { coverage: this._grid.coverageMipmap, blur: [this.blur0Fbo, this.blur1Fbo] };
  }
};

// node_modules/@arcgis/core/views/3d/webgl-engine/lib/RenderTargetHelper.js
var l45 = { dataType: G4.UNSIGNED_BYTE, internalFormat: P3.RGBA };
var g40 = {};
var n67 = class {
  constructor(e59) {
    this.rctx = e59, this._activeTargets = /* @__PURE__ */ new Set(), this._depthTextures = /* @__PURE__ */ new Map(), this._depthBuffers = /* @__PURE__ */ new Map(), this._colorTextures = /* @__PURE__ */ new Map(), this._framebuffers = /* @__PURE__ */ new Map(), this.depthTextureSupported = e59.capabilities.depthTexture;
  }
  dispose() {
    this._depthBuffers.forEach((e59) => e59.dispose()), this._depthBuffers.clear(), this._depthTextures.forEach((e59) => e59.dispose()), this._depthTextures.clear(), this._colorTextures.forEach((e59) => e59.dispose()), this._colorTextures.clear(), this._framebuffers.forEach((e59) => e59.dispose()), this._framebuffers.clear(), this._activeTargets.clear();
  }
  disposeTargetResource(e59) {
    const t60 = e59.id;
    this._activeTargets.has(t60) && (this._activeTargets.delete(t60), this._disposeWithFramebuffers(this._depthTextures, t60), this._disposeWithFramebuffers(this._depthBuffers, t60), this._disposeWithFramebuffers(this._colorTextures, t60));
  }
  _disposeWithFramebuffers(e59, t60) {
    const r59 = e59.get(t60);
    r59 && (this._framebuffers.forEach((e60, t61) => {
      e60.colorAttachment !== r59 && e60.depthStencilAttachment !== r59 || (e60.detachAll(), e60.dispose(), this._framebuffers.delete(t61));
    }), r59.dispose(), e59.delete(t60));
  }
  getDepthTexture(e59, t60) {
    if (!this.depthTextureSupported)
      return null;
    let d32 = this._depthTextures.get(e59.id);
    return !d32 || d32.descriptor.width === t60.width && d32.descriptor.height === t60.height || (d32.dispose(), d32 = null), d32 || (d32 = new u10(this.rctx, { target: M6.TEXTURE_2D, pixelFormat: P3.DEPTH_STENCIL, dataType: G4.UNSIGNED_INT_24_8, samplingMode: L4.NEAREST, wrapMode: D4.CLAMP_TO_EDGE, width: t60.width, height: t60.height }), this._depthTextures.set(e59.id, d32), this._activeTargets.add(e59.id)), d32;
  }
  getAllocatedDepthTexture(e59) {
    return this._depthTextures.get(e59.id);
  }
  getDepthBuffer(e59, t60) {
    if (this.depthTextureSupported)
      return null;
    let r59 = this._depthBuffers.get(e59.id);
    return r59 ? r59.descriptor.width === t60.width && r59.descriptor.height === t60.height || r59.resize(t60.width, t60.height) : (r59 = new r19(this.rctx, { internalFormat: B2.DEPTH_STENCIL, ...t60 }), this._depthBuffers.set(e59.id, r59), this._activeTargets.add(e59.id)), r59;
  }
  getColorTexture(e59, t60) {
    let r59 = this._colorTextures.get(e59.id);
    return r59 && (r59.descriptor.width === t60.width && r59.descriptor.height === t60.height || (r59.dispose(), r59 = null)), r59 || (r59 = new u10(this.rctx, { target: M6.TEXTURE_2D, pixelFormat: P3.RGBA, internalFormat: e59.internalFormat, dataType: e59.dataType, samplingMode: null != e59.samplingMode ? e59.samplingMode : L4.LINEAR, wrapMode: D4.CLAMP_TO_EDGE, width: t60.width, height: t60.height }), this._colorTextures.set(e59.id, r59), this._activeTargets.add(e59.id)), r59;
  }
  getAllocatedColorTexture(e59) {
    return this._colorTextures.get(e59.id);
  }
  registerDepthTarget(e59 = {}) {
    return { id: e5(), ...g40, ...e59 };
  }
  registerColorTarget(e59 = {}) {
    return { id: e5(), ...l45, ...e59 };
  }
  getFramebuffer(t60, r59, i66) {
    const s63 = this._getKey(r59, i66);
    let h44 = this._framebuffers.get(s63);
    const o61 = this.getColorTexture(r59, t60);
    if (this.depthTextureSupported) {
      const r60 = i66 ? this.getDepthTexture(i66, t60) : void 0;
      if (!h44)
        return h44 = r(i66) ? new D6(this.rctx, { colorTarget: Y.TEXTURE, depthStencilTarget: V2.DEPTH_STENCIL_TEXTURE }, o61, r60) : new D6(this.rctx, { colorTarget: Y.TEXTURE, depthStencilTarget: V2.NONE }, o61), this._framebuffers.set(s63, h44), h44;
      return (h44.width !== t60.width || h44.height !== t60.height || h44.colorTexture !== o61 || h44.depthStencilTexture !== r60) && (h44.detachAll(), h44.resize(t60.width, t60.height), h44.attachColorTexture(o61), h44.attachDepthStencilTexture(r60)), h44;
    }
    const d32 = i66 ? this.getDepthBuffer(i66, t60) : void 0;
    if (!h44)
      return h44 = new D6(this.rctx, { colorTarget: Y.TEXTURE, depthStencilTarget: i66 ? V2.DEPTH_STENCIL_RENDER_BUFFER : V2.NONE }, o61, d32), this._framebuffers.set(s63, h44), h44;
    return (h44.width !== t60.width || h44.height !== t60.height || h44.colorTexture !== o61) && (h44.detachAll(), h44.resize(t60.width, t60.height), h44.attachColorTexture(o61), h44.attachDepthStencilBuffer(d32)), h44;
  }
  _getKey(e59, t60) {
    return `${e59.id}_${t60 ? t60.id : "X"}_${e59.name}${t60 ? "_" + t60.name : ""}`;
  }
  get gpuMemoryUsage() {
    let e59 = 0;
    const t60 = /* @__PURE__ */ new Set(), r59 = (r60) => {
      t60.has(r60) || (t60.add(r60), e59 += u11(r60));
    };
    return this._depthTextures.forEach(r59), this._colorTextures.forEach(r59), this._depthBuffers.forEach(r59), e59;
  }
};

// node_modules/@arcgis/core/views/3d/webgl-engine/lib/OffscreenRendering.js
var T26 = class {
  constructor(e59, t60) {
    this._rctx = e59, this._compositingHelper = t60, this._mainColorTarget = 0, this._dimensions = { width: 4, height: 4 }, this._needLastFrameColorTexture = false, this._background = { type: "color", color: [0, 0, 0, 1] };
    const i66 = e59.type === o12.WEBGL2;
    this._renderTargetHelper = new n67(e59);
    const o61 = this._renderTargetHelper;
    this.mainColorTargets = [o61.registerColorTarget({ name: "mainColorTarget0" }), o61.registerColorTarget({ name: "mainColorTarget1" })], this.frontFaceTarget = o61.registerColorTarget({ name: "frontFaceTarget" });
    const g45 = (e60) => o61.registerColorTarget({ name: e60, dataType: G4.FLOAT, internalFormat: i66 ? U5.RGBA32F : P3.RGBA, samplingMode: L4.NEAREST });
    this.colorFloatTarget = g45("colorFloatTarget"), this.alphaFloatTarget = g45("alphaFloatTarget"), this.mainDepth = o61.registerDepthTarget({ name: "mainDepth" }), this.linearDepth = o61.registerColorTarget({ name: "linearDepth", samplingMode: L4.NEAREST }), this.terrainLinearDepth = o61.registerColorTarget({ name: "terrainLinearDepth" }), this.geometryLinearDepth = o61.registerColorTarget({ name: "geometryLinearDepth" }), this.normal = o61.registerColorTarget({ name: "normal" }), this.highlight = o61.registerColorTarget({ name: "highlight", internalFormat: i66 ? U5.RGBA4 : P3.RGBA, dataType: G4.UNSIGNED_SHORT_4_4_4_4 }), this.hudVisibility = o61.registerColorTarget({ name: "hudVisibility", internalFormat: i66 ? U5.RGBA4 : P3.RGBA, dataType: G4.UNSIGNED_SHORT_4_4_4_4 }), this.tmpColor = o61.registerColorTarget({ name: "tmpColor" }), this.tmpDepth = o61.registerDepthTarget({ name: "tmpDepth" }), this.hudColor = o61.registerColorTarget({ name: "hudColor" });
  }
  dispose() {
    this._renderTargetHelper.dispose();
  }
  get width() {
    return this._dimensions.width;
  }
  get height() {
    return this._dimensions.height;
  }
  set background(e59) {
    this._background = e59;
  }
  get background() {
    return this._background;
  }
  get currentColorTarget() {
    return this.mainColorTargets[this._mainColorTarget];
  }
  get previousColorTarget() {
    return this.mainColorTargets[1 - this._mainColorTarget];
  }
  get framebuffer() {
    return this.getFramebuffer(this.currentColorTarget, this.mainDepth);
  }
  getFramebuffer(e59, t60) {
    return this._renderTargetHelper.getFramebuffer(this._dimensions, e59, t60);
  }
  get colorTexture() {
    return this._renderTargetHelper.getAllocatedColorTexture(this.currentColorTarget);
  }
  get depthTexture() {
    return this._renderTargetHelper.getAllocatedDepthTexture(this.mainDepth);
  }
  get linearDepthTexture() {
    return this._renderTargetHelper.getAllocatedColorTexture(this.linearDepth);
  }
  get terrainLinearDepthTexture() {
    return this._renderTargetHelper.getAllocatedColorTexture(this.terrainLinearDepth);
  }
  get geometryLinearDepthTexture() {
    return this._renderTargetHelper.getAllocatedColorTexture(this.geometryLinearDepth);
  }
  get lastFrameColorTexture() {
    return this._renderTargetHelper.getAllocatedColorTexture(this.previousColorTarget);
  }
  get normalTexture() {
    return this._renderTargetHelper.getAllocatedColorTexture(this.normal);
  }
  get highlightTexture() {
    return this._renderTargetHelper.getAllocatedColorTexture(this.highlight);
  }
  get hudVisibilityTexture() {
    return this._getColorTexture(this.hudVisibility);
  }
  get tmpColorTexture() {
    return this._getColorTexture(this.tmpColor);
  }
  get hudColorTexture() {
    return this._getColorTexture(this.hudColor);
  }
  get mainColorTexture() {
    return this._getColorTexture(this.currentColorTarget);
  }
  advanceCurrentRenderTarget() {
    this._mainColorTarget = 0 === this._mainColorTarget && this._needLastFrameColorTexture ? 1 : 0;
  }
  initializeFrame(e59) {
    const t60 = this._rctx;
    this._dimensions.width = e59.fullWidth, this._dimensions.height = e59.fullHeight, this.bindTarget(this.currentColorTarget, this.mainDepth), t60.setClearStencil(0);
    const r59 = this._background.color;
    t60.setClearColor(r59[0] * r59[3], r59[1] * r59[3], r59[2] * r59[3], r59[3]), t60.clearSafe(_2.COLOR_BUFFER_BIT | _2.DEPTH_BUFFER_BIT | _2.STENCIL_BUFFER_BIT);
  }
  composite(t60) {
    r(this.colorTexture) && this._compositingHelper.composite(t60, this.colorTexture, o30.None);
  }
  renderTmpAndCompositeToMain(e59, t60, r59, i66 = false) {
    this.renderToTargets(e59, this.tmpColor, i66 ? this.tmpDepth : this.mainDepth, m33), this._compositingHelper.composite(t60, this._getColorTexture(this.tmpColor), r59);
  }
  renderHUDVisibility(e59, t60 = false) {
    this.renderToTargets(e59, this.hudVisibility, t60 ? this.tmpDepth : this.mainDepth, p47);
  }
  compositeTransparentTerrainOntoHUDVisibility(e59) {
    this.renderToTargets(() => this._compositingHelper.composite(e59, this._getColorTexture(this.tmpColor), o30.None, 1, n33.TransparentToHUDVisibility), this.hudVisibility, this.tmpDepth);
  }
  renderOITPass(e59, r59, i66) {
    let o61, s63;
    switch (r59) {
      case O4.Color:
        o61 = this.colorFloatTarget, s63 = [0, 0, 0, 0];
        break;
      case O4.Alpha:
        o61 = this.alphaFloatTarget, s63 = [1, 1, 1, 1];
        break;
      case O4.FrontFace:
        o61 = this.frontFaceTarget, s63 = [0, 0, 0, 0];
    }
    i66 ? this.renderToTargets(e59, o61, this.tmpDepth, s63, true, true) : this.renderToTargets(e59, o61, this.mainDepth, s63, false);
  }
  compositeTransparentTerrainOntoMain(e59) {
    this.bindFramebuffer(), this._compositingHelper.composite(e59, this._getColorTexture(this.tmpColor), o30.PremultipliedAlpha);
  }
  compositeOccludedOntoMain(e59, t60) {
    this.bindFramebuffer(), this._compositingHelper.composite(e59, this._getColorTexture(this.tmpColor), o30.PremultipliedAlpha, t60);
  }
  compositeTransparentOntoOpaque(e59, t60) {
    t60 ? (this.bindTarget(this.hudColor, this.tmpDepth), this._rctx.setClearColor(0, 0, 0, 1e-13), this._rctx.clearSafe(_2.COLOR_BUFFER_BIT)) : this.bindFramebuffer(), this._compositingHelper.compositeTransparent(e59, this._getColorTexture(this.colorFloatTarget), this._getColorTexture(this.alphaFloatTarget), this._getColorTexture(this.frontFaceTarget));
  }
  bindFramebuffer() {
    this._rctx.bindFramebuffer(this.framebuffer);
  }
  renderDepthDetached(e59) {
    this.bindTarget(this.currentColorTarget), e59(), this.bindTarget(this.currentColorTarget, this.mainDepth);
  }
  disposeTarget(e59) {
    this._renderTargetHelper.disposeTargetResource(e59);
  }
  set needLastFrameColorTexture(e59) {
    !e59 && this._needLastFrameColorTexture && (this._mainColorTarget = 0, this.disposeTarget(this.mainColorTargets[1])), this._needLastFrameColorTexture = e59;
  }
  get needLastFrameColorTexture() {
    return this._needLastFrameColorTexture;
  }
  renderToTargets(e59, t60, r59, i66, o61 = false, s63 = false) {
    const a58 = this._rctx, h44 = this.bindTarget(t60, r59);
    let n73 = 0;
    if (i66) {
      const e60 = 1e-13, t61 = Math.max(e60, i66[3]);
      a58.setClearColor(i66[0], i66[1], i66[2], t61), n73 |= _2.COLOR_BUFFER_BIT;
    }
    return o61 && (n73 |= _2.DEPTH_BUFFER_BIT), false === s63 ? s63 = 0 : (true === s63 && (s63 = 255), n73 |= _2.STENCIL_BUFFER_BIT), n73 && a58.clearSafe(n73, s63), e59(), a58.gl.flush(), this.bindTarget(this.currentColorTarget, this.mainDepth), h44;
  }
  bindTarget(e59, t60) {
    const r59 = this._renderTargetHelper.getFramebuffer(this._dimensions, e59, t60);
    return this._rctx.bindFramebuffer(r59), r59;
  }
  _getColorTexture(e59) {
    return this._renderTargetHelper.getColorTexture(e59, this._dimensions);
  }
  get gpuMemoryUsage() {
    let e59 = 0;
    return this._renderTargetHelper && (e59 += this._renderTargetHelper.gpuMemoryUsage), e59;
  }
};
var m33 = [0, 0, 0, 0];
var p47 = [0, 1, 0, 1];

// node_modules/@arcgis/core/views/3d/webgl-engine/lib/RenderPluginManager.js
var i62 = class {
  constructor(t60) {
    this.context = t60, this._renderPlugins = new n2(), this.slots = [];
    for (let e59 = 0; e59 < E9.MAX_SLOTS; ++e59)
      this.slots[e59] = [];
  }
  add(e59, n73, s63) {
    const i66 = () => {
      if (s63 == null ? void 0 : s63.aborted)
        throw n73.uninitializeRenderContext(), m3();
      this._renderPlugins.push(n73);
      for (const t60 of e59)
        this.slots[t60].push(n73);
      this.context.requestRender();
    }, o61 = n73.initializeRenderContext(this.context, s63);
    if (k(o61))
      return o61.then(i66);
    i66();
  }
  remove(e59) {
    if (null != this._renderPlugins.removeUnordered(e59)) {
      for (let t60 = 0; t60 < this.slots.length; ++t60)
        this.slots[t60] = this.slots[t60].filter((t61) => t61 !== e59);
      e59.uninitializeRenderContext(), this.context.requestRender();
    }
  }
  prepareRender() {
    this._renderPlugins.forAll((e59) => {
      e59.prepareRender && e59.prepareRender(this.context.renderContext);
    });
  }
  updateAnimation(e59) {
    let t60 = false;
    return this._renderPlugins.forAll((r59) => {
      r59.updateAnimation && (t60 = r59.updateAnimation(e59) || t60);
    }), t60;
  }
  render() {
    const e59 = this.slots[this.context.renderContext.bindParameters.slot], t60 = new Array();
    e59.filter((e60) => {
      if (!e60.canRender)
        return false;
      if (o56(e60)) {
        const r59 = e60.prepareTechnique(this.context.renderContext);
        return !!r59 && (t60.push(r59), true);
      }
      return t60.push(null), true;
    }).forEach((e60, r59) => e60.render(this.context.renderContext, t60[r59]));
  }
  queryDepthRange(e59) {
    const t60 = d31;
    return t60.near = 1 / 0, t60.far = -1 / 0, this._renderPlugins.forAll((r59) => {
      if (r59.queryDepthRange) {
        const s63 = r59.queryDepthRange(e59);
        s63 && t57(t60, s63, t60);
      }
    }), t60;
  }
  get needsTransparentPass() {
    return this._renderPlugins.some((e59) => e59.needsTransparentPass);
  }
  get needsHighlight() {
    return this._renderPlugins.some((e59) => e59.needsHighlight);
  }
  get needsLinearDepth() {
    return this._renderPlugins.some((e59) => e59.needsLinearDepth);
  }
  get needsLaserlineWithContrastControl() {
    const e59 = this.slots[E9.LASERLINES_CONTRAST_CONTROL];
    return !!e59 && e59.length > 0;
  }
  get renderOccludedFlags() {
    return this._renderPlugins.reduce((e59, t60) => e59 | t60.renderOccludedFlags, 0);
  }
};
function o56(e59) {
  return "prepareTechnique" in e59;
}
var d31 = { near: 0, far: 0 };

// node_modules/@arcgis/core/views/3d/webgl-engine/shaders/ShadowCastVisualizeTechnique.js
var m34 = class extends e18 {
  constructor(e59, r59) {
    super(e59, r59, () => this.destroy());
  }
  initializeProgram(e59) {
    const r59 = m34.shader.get().build(this.configuration);
    return new o20(e59.rctx, r59, E7);
  }
  initializePipeline() {
    return W({ blending: c12, colorWrite: c11, depthTest: null, depthWrite: null });
  }
  get primitiveType() {
    return E5.TRIANGLE_STRIP;
  }
};
m34.shader = new t15(g14, () => import("./ShadowCastVisualize.glsl-JBDWIK3U.js"));

// node_modules/@arcgis/core/views/3d/webgl-engine/lib/ShadowCastRenderer.js
var c64 = r10(0.01, 0, 0.25, 1);
var p48 = 4e4;
var m35 = 5e4;
var b22 = 1 / 512;
var q17 = class extends y {
  constructor(e59, t60, s63, i66) {
    super({}), this._techniqueRepository = e59, this._rctx = t60, this._shadowAccumulator = s63, this._requestRender = i66, this._passParameters = { shadowCastMap: this._shadowCastTexture, sampleScale: 0, color: c64, threshold: 0.5, bandSize: 0.1, opacityFromElevation: 1, __tagStrict: "NoParameters" }, this._techniqueConfig = new r37(), this._enabled = false, this._vao = u12(t60), this._techniqueConfig.visualization = t36.Gradient;
  }
  normalizeCtorArgs() {
    return {};
  }
  dispose() {
    this._stop(), this._vao = s(this._vao), this._techniqueRepository.release(this._technique), this._technique = null, this._shadowAccumulator = null;
  }
  get visualizeShadowCastTechnique() {
    return this._technique = this._techniqueRepository.releaseAndAcquire(m34, this._techniqueConfig, this._technique), this._technique;
  }
  render(e59) {
    if (!this._isRenderingVisualization)
      return;
    this._passParameters.sampleScale = 1 / this._computedSamples;
    const t60 = this.visualizeShadowCastTechnique;
    this._rctx.bindVAO(this._vao), this._rctx.bindTechnique(t60, this._passParameters, e59), this._rctx.drawArrays(t60.primitiveType, 0, n20(this._vao, "geometry"));
  }
  setOptions(e59) {
    void 0 !== e59.enabled && this._setEnabled(e59.enabled), void 0 !== e59.color && this._setColor(e59.color), void 0 !== e59.threshold && (this._threshold = e59.threshold), void 0 !== e59.visualization && (this._visualization = e59.visualization), void 0 !== e59.bandSize && (this._bandSize = e59.bandSize), void 0 !== e59.bandsEnabled && (this._bandsEnabled = e59.bandsEnabled);
  }
  get opacityFromElevation() {
    return this._passParameters.opacityFromElevation;
  }
  set opacityFromElevation(e59) {
    this._passParameters.opacityFromElevation !== e59 && (this._passParameters.opacityFromElevation = e59, this.notifyChange("opacityFromElevation"));
  }
  get _isRenderingVisualization() {
    return this._enabled && this._computedSamples > 0 && this.opacityFromElevation > b22;
  }
  get _computedSamples() {
    return this._shadowAccumulator.computedSamples;
  }
  get _shadowCastTexture() {
    return this._shadowAccumulator.shadowCastTexture;
  }
  get _threshold() {
    return this._passParameters.threshold;
  }
  set _threshold(e59) {
    this._threshold !== e59 && (this._passParameters.threshold = e59, this._requestRenderIfRunning());
  }
  get _visualization() {
    return this._techniqueConfig.visualization;
  }
  set _visualization(e59) {
    e59 !== this._visualization && (this._techniqueConfig.visualization = e59, this._techniqueRepository.release(this._technique), this._technique = null, this._requestRenderIfRunning());
  }
  get _bandSize() {
    return this._passParameters.bandSize;
  }
  set _bandSize(e59) {
    e59 !== this._bandSize && (this._passParameters.bandSize = e59, this._requestRenderIfRunning());
  }
  get _bandsEnabled() {
    return this._techniqueConfig.bandsEnabled;
  }
  set _bandsEnabled(e59) {
    e59 !== this._bandsEnabled && (this._techniqueConfig.bandsEnabled = e59, this._techniqueRepository.release(this._technique), this._technique = null, this._requestRenderIfRunning());
  }
  _setColor(e59) {
    const t60 = this._passParameters.color;
    D2(e59, t60) || (a3(this._passParameters.color, e59), this._requestRenderIfRunning());
  }
  _setEnabled(e59) {
    e59 !== this._enabled && (e59 ? this._start() : this._stop());
  }
  _requestRenderIfRunning() {
    this._enabled && this._requestRender();
  }
  _start() {
    this._enabled = true, this._requestRender();
  }
  _stop() {
    this._enabled = false, this._requestRender();
  }
};
e([d()], q17.prototype, "opacityFromElevation", null), q17 = e([n6("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")], q17);

// node_modules/@arcgis/core/views/3d/webgl-engine/shaders/ShadowCastAccumulateTechnique.js
var u46 = class extends e18 {
  constructor(e59, r59) {
    super(e59, r59, () => this.destroy());
  }
  initializeProgram(e59) {
    const r59 = u46.shader.get().build();
    return new o20(e59.rctx, r59, E7);
  }
  initializePipeline() {
    return W({ blending: l15(R4.ONE, R4.ONE, R4.ONE, R4.ONE), colorWrite: c11, depthTest: null, depthWrite: null });
  }
  get primitiveType() {
    return E5.TRIANGLE_STRIP;
  }
};
u46.shader = new t15(x10, () => import("./ShadowCastAccumulate.glsl-SV5JC225.js"));

// node_modules/@arcgis/core/views/3d/webgl-engine/lib/ShadowAccumulator.js
var I26;
var N21 = I26 = class extends y {
  constructor(e59, t60, i66, s63, a58, n73) {
    super({}), this._rctx = e59, this._stage = i66, this._prepareForShadowMapPass = s63, this._renderToShadowMap = a58, this._requestRender = n73, this._progress = 0, this._sampleCount = 0, this._passParameters = new w10(), this._enabled = false, this._cachedLightDirections = [], this._depthRange = f33, this._previewing = false, this._handles = new u4(), this._cameraForcedForScreenshot = false, this._bindParameters = new h15(new Q5(e59, i66.viewingMode), null, null), this._bindParameters.shadowMap.enabled = true, this._bindParameters.camera = new K3(), this._vao = u12(e59);
    const _30 = { colorTarget: Y.TEXTURE, depthStencilTarget: V2.NONE, width: 0, height: 0 }, u51 = { target: M6.TEXTURE_2D, pixelFormat: P3.RGBA, dataType: G4.UNSIGNED_BYTE, samplingMode: L4.LINEAR, wrapMode: D4.CLAMP_TO_EDGE, width: 0, height: 0 };
    this._fbo = new D6(e59, _30, u51), this._accumulationRenderer = new q17(t60, e59, this, n73);
    const l48 = this._stage.resourceController.scheduler;
    this._handles.add(l48.registerTask(L3.SHADOW_ACCUMULATOR, this)), this._handles.add(l6(() => i66.renderView, (e60) => {
      this._handles.remove(I26.renderViewHandleKey), t(e60) || this._handles.add(e60.events.on("force-camera-for-screenshot", () => this._cameraForcedForScreenshot = true), I26.renderViewHandleKey);
    }, w2));
  }
  normalizeCtorArgs() {
    return {};
  }
  get computedSamples() {
    return this._progress;
  }
  get shadowCastTexture() {
    return this._fbo.colorTexture;
  }
  get isAccumulating() {
    return this._isPreviewing || this._isRefining;
  }
  get accumulationTechnique() {
    if (t(this._accumulationTechnique)) {
      const e59 = { rctx: this._rctx, viewingMode: this._stage.viewingMode };
      this._accumulationTechnique = new u46(e59, new t17());
    }
    return this._accumulationTechnique;
  }
  get _isRefining() {
    return this._isActive && !this._isDoneAccumulating && !this._previewing;
  }
  get _isPreviewing() {
    return this._isActive && this._previewing;
  }
  get _isActive() {
    return this._enabled && this._sampleCount > 0;
  }
  get canAccumulate() {
    return null !== this._passParameters.linearDepthTexture && this._depthRange !== f33 && this._opacityFromElevation > b22;
  }
  get _isDoneAccumulating() {
    return this._progress >= this._sampleCount;
  }
  get _lightDirections() {
    return this._cachedLightDirections;
  }
  set _lightDirections(e59) {
    const t60 = this._cachedLightDirections;
    if (i(t60, e59, G))
      return;
    const r59 = e59.length;
    t60.length = r59, this._sampleCount = Math.min(u20, r59);
    for (let i66 = 0; i66 < r59; ++i66) {
      const r60 = e59[i66], s63 = t60[i66] || n7();
      r7(s63, r60), t60[i66] = s63;
    }
    this._invalidate();
  }
  get _opacityFromElevation() {
    return this._accumulationRenderer.opacityFromElevation;
  }
  set _opacityFromElevation(e59) {
    this._accumulationRenderer.opacityFromElevation = e59;
  }
  get running() {
    return this._isRefining && this.canAccumulate && this._progress > 0;
  }
  runTask(e59) {
    for (this._prepareForShadowMapPass(this._bindParameters); !e59.done && !this._isDoneAccumulating; )
      this._accumulateShadow(), e59.madeProgress();
    this._requestRender();
  }
  renderAccumulation(e59, t60, i66, r59) {
    if (this._passParameters.linearDepthTexture = e59, this._depthRange = t60, this._updateCamera(i66), this._bindParameters.contentCamera = r59, this.notifyChange("canAccumulate"), !this.isAccumulating || !this.canAccumulate)
      return;
    (this._previewing || 0 === this._progress || this._cameraForcedForScreenshot) && this._clear();
    const s63 = this._cameraForcedForScreenshot ? this._sampleCount : Math.min(I26.previewSamples, this._sampleCount - this._progress);
    for (let o61 = 0; o61 < s63; ++o61)
      this._accumulateShadow();
    this._cameraForcedForScreenshot = false;
  }
  render(e59) {
    this._accumulationRenderer.render(e59);
  }
  dispose() {
    this._stop(), this._handles.destroy(), this._accumulationRenderer = s(this._accumulationRenderer), this._bindParameters.shadowMap.dispose(), this._fbo = s(this._fbo), this._vao = s(this._vao), this._accumulationTechnique = p(this._accumulationTechnique), this._cachedLightDirections.length = 0, this._sampleCount = 0;
  }
  setOptions(e59) {
    void 0 !== e59.enabled && (this.enabled = e59.enabled), void 0 !== e59.previewing && (this.previewing = e59.previewing), void 0 !== e59.lightDirections && (this.lightDirections = e59.lightDirections), this._accumulationRenderer.setOptions(e59);
  }
  set previewing(e59) {
    this._previewing !== e59 && (this._previewing = e59, this._requestRenderIfEnabled());
  }
  set lightDirections(e59) {
    this._lightDirections = e59;
  }
  readAccumulatedShadow(e59, t60) {
    if (!this._isActive || this._progress < 1 || e59 < 0 || e59 > this._fbo.width || t60 < 0 || t60 > this._fbo.height)
      return 0;
    const i66 = k31;
    return this._fbo.readPixels(e59, t60, 1, 1, P3.RGBA, G4.UNSIGNED_BYTE, i66), i66[0] / this._progress;
  }
  _start() {
    this._progress = 0, this._enabled = true;
  }
  _stop() {
    this._enabled = false;
  }
  _invalidate() {
    this._progress = 0, this._requestRenderIfEnabled();
  }
  _clear() {
    this._rctx.bindFramebuffer(this._fbo), this._rctx.setClearColor(0, 0, 0, 0), this._rctx.clearSafe(_2.COLOR_BUFFER_BIT), this._progress = 0;
  }
  _accumulateShadow() {
    const e59 = this._lightDirections[this._progress];
    this._renderToShadowMap(this._bindParameters, e59, this._depthRange), this._passParameters.origin = this._bindParameters.camera.center, this._rctx.bindFramebuffer(this._fbo);
    const t60 = this.accumulationTechnique;
    this._rctx.bindTechnique(t60, this._passParameters, this._bindParameters), this._rctx.bindVAO(this._vao), this._rctx.drawArrays(t60.primitiveType, 0, n20(this._vao, "geometry")), this._progress++;
  }
  _updateCamera(e59) {
    e59.equals(this._bindParameters.camera) || (this._bindParameters.camera.copyFrom(e59), this._fbo.resize(e59.fullWidth, e59.fullHeight), this._opacityFromElevation = 1 - I(p48, m35, e59.relativeElevation));
  }
  set enabled(e59) {
    e59 !== this._enabled && (e59 ? this._start() : this._stop());
  }
  _requestRenderIfEnabled() {
    this._enabled && this._requestRender();
  }
  get test() {
    const e59 = this;
    return { lightDirections: this._lightDirections, get isDone() {
      return e59._isDoneAccumulating;
    }, get isActive() {
      return e59._isActive;
    } };
  }
};
N21.previewSamples = 6, N21.renderViewHandleKey = "renderView", e([d()], N21.prototype, "_progress", void 0), e([d()], N21.prototype, "_sampleCount", void 0), e([d()], N21.prototype, "_enabled", void 0), e([d()], N21.prototype, "_depthRange", void 0), e([d()], N21.prototype, "_previewing", void 0), e([d()], N21.prototype, "_accumulationRenderer", void 0), e([d()], N21.prototype, "_isRefining", null), e([d()], N21.prototype, "_isActive", null), e([d()], N21.prototype, "canAccumulate", null), e([d()], N21.prototype, "_isDoneAccumulating", null), e([d()], N21.prototype, "_opacityFromElevation", null), e([d()], N21.prototype, "running", null), N21 = I26 = e([n6("esri.views.3d.webgl-engine.lib.ShadowAccumulator")], N21);
var k31 = new Uint8Array(4);

// node_modules/@arcgis/core/views/3d/webgl-engine/shaders/ShadowHighlightTechnique.js
var m36 = class extends t14 {
  constructor() {
    super(...arguments), this.shadowColor = r10(1, 0, 1, 1), this.shadowOpacity = 0.2, this.occludedShadowOpacity = 0.1, this.opacityElevation = 1, this.dayNightTerminator = 1;
  }
};
var u47 = class extends e18 {
  constructor(e59) {
    super(e59, null, () => this.destroy());
  }
  initializeProgram(e59) {
    const r59 = u47.shader.get().build();
    return new o20(e59.rctx, r59, E7);
  }
  initializePipeline() {
    return W({ blending: l15(R4.SRC_ALPHA, R4.ONE, R4.ONE_MINUS_SRC_ALPHA, R4.ONE_MINUS_SRC_ALPHA), colorWrite: c11, depthTest: null, depthWrite: null });
  }
  get primitiveType() {
    return E5.TRIANGLE_STRIP;
  }
};
u47.shader = new t15(C7, () => import("./ShadowHighlight.glsl-JFF2ACKN.js"));

// node_modules/@arcgis/core/views/3d/webgl-engine/lib/ShadowHighlight.js
var l46 = 1953125e-9;
var g41 = 4e4;
var w23 = 5e4;
var v35 = class {
  constructor(t60, s63) {
    this._rctx = t60, this._viewingMode = s63, this._maxOpacity = 1, this._passParameters = new m36(), this._drawParameters = new n25(), this._vao = u12(this._rctx);
  }
  get technique() {
    return t(this._technique) && (this._technique = new u47({ rctx: this._rctx, viewingMode: this._viewingMode })), this._technique;
  }
  render(t60, s63) {
    if (!t60.shadowMap.enabled || !t60.linearDepthTexture || !this.isVisible)
      return;
    const e59 = this.technique;
    this._drawParameters.origin = t60.camera.center, this._rctx.bindFramebuffer(s63), this._rctx.bindTechnique(e59, this._passParameters, t60).bindDraw(this._drawParameters, t60), this._rctx.bindVAO(this._vao), this._rctx.drawArrays(e59.primitiveType, 0, n20(this._vao, "geometry"));
  }
  get gpuMemoryUsage() {
    var _a;
    return ((_a = this._vao) == null ? void 0 : _a.size) ?? 0;
  }
  setDefaultOptions(t60) {
    this._passParameters = { ...this._passParameters, ...t60 }, this._updateMaxOpacity();
  }
  updateParameters(e59, i66) {
    this._passParameters.opacityElevation = 1 - I(g41, w23, e59.relativeElevation);
    const a58 = this._viewingMode === l13.Global ? z2(y32, e59.center) : o3(y32, 0, 0, 1), c67 = P2(a58, i66);
    this._passParameters.dayNightTerminator = I(0, 1, o4(30 * c67, 0, 1));
  }
  dispose() {
    this._vao = s(this._vao), this._technique = p(this._technique);
  }
  get isVisible() {
    const { opacityElevation: t60, dayNightTerminator: s63 } = this._passParameters;
    return this._maxOpacity * t60 * s63 >= l46;
  }
  _updateMaxOpacity() {
    const t60 = Math.max(this._passParameters.shadowOpacity, this._passParameters.occludedShadowOpacity);
    this._maxOpacity = t60 * this._passParameters.shadowColor[3];
  }
};
var y32 = n7();

// node_modules/@arcgis/core/views/3d/webgl-engine/lib/SliceHelper.js
var t58 = G8();
var n68 = class {
  constructor() {
    this._plane = G8();
  }
  get isEnabled() {
    return !fs(this.plane, t58);
  }
  get plane() {
    return this._plane;
  }
  set plane(e59) {
    X2(e59 || t58, this._plane);
  }
};

// node_modules/@arcgis/core/views/3d/webgl-engine/lib/SMAATechnique.js
var n69 = class extends e18 {
  initializeProgram(e59) {
    const r59 = n69.shader.get().build(this.configuration);
    return new o20(e59.rctx, r59, E7);
  }
  initializePipeline() {
    return W({ colorWrite: c11 });
  }
};
n69.shader = new t15(c29, () => import("./SMAA.glsl-KJC3AAWG.js"));

// node_modules/@arcgis/core/views/3d/webgl-engine/lib/SmaaRenderPass.js
var R19 = class extends y {
  constructor(e59, t60) {
    super({}), this.rctx = e59, this._techniqueRep = t60, this._isEnabled = false;
  }
  normalizeCtorArgs() {
    return {};
  }
  dispose() {
    this._abortController = h(this._abortController), this.disable();
  }
  _loadResources(e59) {
    if (r(this._abortController))
      return false;
    if (r(this._searchTexture))
      return true;
    this._abortController = new AbortController();
    const t60 = this._abortController.signal;
    return import("./SmaaRenderPassData-EOPMLXRR.js").then((e60) => this._loadTextures(e60, t60)).then(() => e59()).finally(() => this._abortController = null), false;
  }
  _loadTextures(e59, t60) {
    return f(t60), Promise.all([this._loadTextureFromBase64(e59.areaTexture, L4.LINEAR, P3.RGB), this._loadTextureFromBase64(e59.searchTexure, L4.NEAREST, P3.LUMINANCE)]).then(([e60, r59]) => {
      p2(t60) ? (e60.dispose(), r59.dispose(), f(t60)) : (this._areaTexture = e60, this._searchTexture = r59);
    });
  }
  get updating() {
    return r(this._abortController);
  }
  enable(e59) {
    if (this._isEnabled)
      return true;
    if (!this._edgeDetectTechnique || !this._blendWeightsTechnique || !this._blurTechnique) {
      const e60 = new u21(), t60 = (e61, t61) => this._techniqueRep.releaseAndAcquire(n69, e61, t61);
      e60.output = r38.EdgeDetector, this._edgeDetectTechnique = t60(e60, this._edgeDetectTechnique), e60.output = r38.BlendWeight, this._blendWeightsTechnique = t60(e60, this._blendWeightsTechnique), e60.output = r38.Blur, this._blurTechnique = t60(e60, this._blurTechnique);
    }
    return !!this._loadResources(e59) && (this._vao = g4(this.rctx), this._edges = new D6(this.rctx, { colorTarget: Y.TEXTURE, depthStencilTarget: V2.NONE }, { target: M6.TEXTURE_2D, pixelFormat: P3.RGB, dataType: G4.UNSIGNED_BYTE, samplingMode: L4.LINEAR, wrapMode: D4.CLAMP_TO_EDGE, width: 4, height: 4 }), this._blend = new D6(this.rctx, { colorTarget: Y.TEXTURE, depthStencilTarget: V2.NONE }, { target: M6.TEXTURE_2D, pixelFormat: P3.RGBA, dataType: G4.UNSIGNED_BYTE, samplingMode: L4.LINEAR, wrapMode: D4.CLAMP_TO_EDGE, width: 4, height: 4 }), this._isEnabled = true, true);
  }
  disable() {
    this._isEnabled && (this._vao = s(this._vao), this._areaTexture = s(this._areaTexture), this._searchTexture = s(this._searchTexture), this._blend = s(this._blend), this._edges = s(this._edges), this._isEnabled = false);
  }
  render(e59) {
    if (!this._isEnabled)
      return;
    const t60 = this.rctx, r59 = t60.getBoundFramebufferObject(), i66 = { x: 0, y: 0, width: e59.descriptor.width, height: e59.descriptor.height };
    t60.bindVAO(this._vao), t60.setViewport(i66.x, i66.y, i66.width, i66.height), this._edges.resize(i66.width, i66.height), t60.bindFramebuffer(this._edges), t60.setClearColor(0, 0, 0, 1), t60.clear(_2.COLOR_BUFFER_BIT);
    const s63 = t60.bindTechnique(this._edgeDetectTechnique);
    s63.bindTexture("tColor", e59), s63.setUniform4f("resolution", 1 / i66.width, 1 / i66.height, i66.width, i66.height), t60.drawArrays(E5.TRIANGLES, 0, 3), this._blend.resize(i66.width, i66.height), t60.bindFramebuffer(this._blend), t60.setClearColor(0, 0, 1, 1), t60.clear(_2.COLOR_BUFFER_BIT);
    const o61 = t60.bindTechnique(this._blendWeightsTechnique);
    o61.setUniform4f("resolution", 1 / i66.width, 1 / i66.height, i66.width, i66.height), o61.bindTexture("tSearch", this._searchTexture), o61.bindTexture("tArea", this._areaTexture), o61.bindTexture("tEdges", this._edges.colorTexture), t60.drawArrays(E5.TRIANGLES, 0, 3), t60.bindFramebuffer(r59), t60.setClearColor(0, 1, 0, 1), t60.clear(_2.COLOR_BUFFER_BIT);
    const h44 = t60.bindTechnique(this._blurTechnique);
    h44.setUniform4f("resolution", 1 / i66.width, 1 / i66.height, i66.width, i66.height), h44.bindTexture("tColor", e59), h44.bindTexture("tBlendWeights", this._blend.colorTexture), t60.drawArrays(E5.TRIANGLES, 0, 3);
  }
  _loadTextureFromBase64(e59, t60, r59) {
    return t11(e59).then((e60) => new u10(this.rctx, { pixelFormat: r59, dataType: G4.UNSIGNED_BYTE, wrapMode: D4.CLAMP_TO_EDGE, width: e60.width, height: e60.height, samplingMode: t60 }, e60));
  }
};
e([d()], R19.prototype, "_abortController", void 0), e([d({ readOnly: true })], R19.prototype, "updating", null), R19 = e([n6("esri.views.3d.webgl-engine.lib.SmaaRenderPass")], R19);

// node_modules/@arcgis/core/views/3d/webgl-engine/lib/localOriginHelper.js
function n70(n73, o61) {
  const t60 = o61, c67 = -n73[0], f37 = -n73[1], i66 = -n73[2], s63 = t60[3], u51 = t60[7], e59 = t60[11], p52 = t60[15];
  t60[0] += s63 * c67, t60[1] += s63 * f37, t60[2] += s63 * i66, t60[4] += u51 * c67, t60[5] += u51 * f37, t60[6] += u51 * i66, t60[8] += e59 * c67, t60[9] += e59 * f37, t60[10] += e59 * i66, t60[12] += p52 * c67, t60[13] += p52 * f37, t60[14] += p52 * i66;
}
function o57(n73, o61) {
  const t60 = o61, c67 = n73[0], f37 = n73[1], i66 = n73[2];
  t60[12] += c67 * t60[0] + f37 * t60[4] + i66 * t60[8], t60[13] += c67 * t60[1] + f37 * t60[5] + i66 * t60[9], t60[14] += c67 * t60[2] + f37 * t60[6] + i66 * t60[10], t60[14] += c67 * t60[3] + f37 * t60[7] + i66 * t60[11];
}

// node_modules/@arcgis/core/views/3d/webgl-engine/lib/LocalOriginManager.js
var e55 = class {
  constructor(i66) {
    this.factory = i66, this.originData = /* @__PURE__ */ new Map();
  }
  acquire(i66) {
    return this.register(this.factory.getOrigin(i66));
  }
  register(i66) {
    const r59 = this.originData.get(i66.id);
    return r59 ? (r59.refCount++, r59.origin) : (this.originData.set(i66.id, { refCount: 1, viewMatrix: e12(), origin: i66 }), i66);
  }
  release(i66) {
    const t60 = this.originData.get(i66.id);
    t60 && (t60.refCount--, 0 === t60.refCount && this.originData.delete(i66.id));
  }
  updateViewMatrices(t60) {
    this.originData.forEach((e59) => {
      n11(e59.viewMatrix, t60), o57(e59.origin.vec3, e59.viewMatrix);
    });
  }
  getViewMatrix(i66) {
    return this.originData.get(i66.id).viewMatrix;
  }
};

// node_modules/@arcgis/core/views/3d/webgl-engine/lib/edgeRendering/EdgeShaderParameters.js
var a55 = class extends c13 {
  constructor(s63, o61, t60) {
    super(), this.distanceFalloffFactor = s63, this.minimumEdgeLength = o61, this.transparency = t60, this.transformNormalViewFromGlobal = e11();
  }
};
var e56 = class extends W2 {
  constructor() {
    super(...arguments), this.transformNormalViewFromGlobal = e11(), this.slicePlaneLocalOrigin = n7(), this.transformNormalGlobalFromModel = e11();
  }
};

// node_modules/@arcgis/core/views/3d/webgl-engine/lib/edgeRendering/EdgeShaderTechnique.js
var c65 = class extends e18 {
  initializeProgram(e59) {
    const r59 = c65.shader.get().build(this.configuration);
    return new o20(e59.rctx, r59, o8);
  }
  initializePipeline(e59) {
    return e59.blendMinMax ? W({ blending: l15(R4.ONE, R4.ONE, R4.ZERO, R4.ONE, T3.ADD, e59.blendMinMax.MAX), depthTest: { func: I4.LEQUAL }, colorWrite: c11 }) : W({ depthTest: { func: I4.LEQUAL }, depthWrite: a17, colorWrite: c11 });
  }
};
c65.shader = new t15(A20, () => import("./EdgeShader.glsl-CYUVLTDJ.js"));

// node_modules/@arcgis/core/views/3d/webgl-engine/lib/edgeRendering/EdgeShaderTechniqueConfiguration.js
var s61 = class extends i13 {
  constructor() {
    super(...arguments), this.mode = x11.SOLID, this.hasSlicePlane = false, this.silhouette = false, this.legacy = false, this.antialiasing = false, this.doublePrecisionRequiresObfuscation = false, this.hasMultipassTerrain = false, this.cullAboveGround = false, this.spherical = false;
  }
};
e([e20({ count: x11.COUNT })], s61.prototype, "mode", void 0), e([e20()], s61.prototype, "hasSlicePlane", void 0), e([e20()], s61.prototype, "silhouette", void 0), e([e20()], s61.prototype, "legacy", void 0), e([e20()], s61.prototype, "antialiasing", void 0), e([e20()], s61.prototype, "doublePrecisionRequiresObfuscation", void 0), e([e20()], s61.prototype, "hasMultipassTerrain", void 0), e([e20()], s61.prototype, "cullAboveGround", void 0), e([e20()], s61.prototype, "spherical", void 0);

// node_modules/@arcgis/core/views/3d/webgl-engine/lib/edgeRendering/EdgeRenderer.js
var T27 = 8;
var _29 = 128;
var R20 = { type: "uber", hasSlicePlane: false, strokesTexture: null, legacy: true, spherical: true };
var p49 = class {
  constructor() {
    this._value = 0;
  }
  get value() {
    return this._value;
  }
  increment() {
    this._value++;
  }
  decrement() {
    this._value--;
  }
};
var A38 = { solid: x11.SOLID, sketch: x11.SKETCH, uber: x11.MIXED };
var P21 = class {
  constructor(e59, r59, s63) {
    this.rctx = e59, this.shaderTechniqueRepository = r59, this._configuration = new s61(), this.refCount = new p49(), this.renderables = /* @__PURE__ */ new Set(), this.sortedRenderables = { [A15.TRANSPARENT]: { [A15.TRANSPARENT]: new n2(), [A15.OPAQUE]: new n2() }, [A15.OPAQUE]: { [A15.TRANSPARENT]: new n2(), [A15.OPAQUE]: new n2() } }, this._renderablesDirty = false, this._drawParameters = new e56(), this._settings = { ...R20, ...s63 }, this.key = P21.getKey(this._settings.type, this._settings.hasSlicePlane, this._settings.legacy);
    const i66 = this._settings.strokesTexture.variants;
    this.writerSettings = { variants: i66, reducedPrecision: t25.TESTS_DISABLE_OPTIMIZATIONS }, this._configuration.legacy = this._settings.legacy, this._configuration.mode = A38[this._settings.type], this._configuration.silhouette = false, this._configuration.antialiasing = !!this.rctx.capabilities.blendMinMax, this._configuration.hasSlicePlane = this._settings.hasSlicePlane, this._configuration.doublePrecisionRequiresObfuscation = r23(e59), this._configuration.spherical = s63.spherical;
  }
  dispose() {
    this._technique = p(this._technique);
  }
  addRenderable(e59) {
    this.renderables.add(e59), this._renderablesDirty = true;
  }
  removeRenderable(e59) {
    this.renderables.delete(e59), this._renderablesDirty = true;
  }
  setRenderablesDirty() {
    this._renderablesDirty = true;
  }
  forEachRenderable(e59, r59) {
    this._renderablesDirty && this._sortRenderables(), this.sortedRenderables[r59][A15.TRANSPARENT].forAll(e59), this.sortedRenderables[r59][A15.OPAQUE].forAll(e59);
  }
  updateTechnique(e59, r59) {
    return this._configuration.hasMultipassTerrain = !!e59.multipassTerrain.enabled, this._configuration.cullAboveGround = !!e59.multipassTerrain.cullAboveGround, this._configuration.silhouette = r59, this._technique = this.shaderTechniqueRepository.releaseAndAcquire(c65, this._configuration, this._technique), this._technique;
  }
  bindRegularEdges(e59, r59) {
    return this.rctx.bindTechnique(this.updateTechnique(r59, false), e59, r59);
  }
  bindSilhouetteEdges(e59, r59) {
    return this.rctx.bindTechnique(this.updateTechnique(r59, true), e59, r59);
  }
  renderRegularEdges(e59, r59, t60, s63, i66) {
    this._render(e59, r59, r59.regular.vao, t60, s63, i66);
  }
  renderSilhouetteEdges(e59, r59, t60, s63, i66) {
    this._render(e59, r59, r59.silhouette.vao, t60, s63, i66);
  }
  _render(e59, r59, t60, s63, i66, n73) {
    this._bindDraw(e59, r59, s63, n73), this.rctx.bindVAO(t60), this.rctx.capabilities.instancing.drawArraysInstanced(E5.TRIANGLE_FAN, 0, 4, i66);
  }
  _bindDraw(e59, r59, t60, n73) {
    if (r59.components.buffer.textureBuffer.bind(e59, E36, S24), "origin" in r59.transform)
      e59.setUniformMatrix4fv("localView", n73), e59.setUniformMatrix4fv("model", r59.transform.modelMatrix), r7(this._drawParameters.slicePlaneLocalOrigin, r59.transform.origin.vec3);
    else {
      const e60 = new c62(r59.transform.position), n74 = o10(N22, u9(N22, r59.transform.rotationScale));
      this._drawParameters.transformWorldFromModelTL = e60.low, this._drawParameters.transformWorldFromModelTH = e60.high, this._drawParameters.transformWorldFromModelRS = r59.transform.rotationScale, this._drawParameters.transformNormalGlobalFromModel = n74;
      const o61 = t60.camera.viewInverseTransposeMatrix;
      o3(this._drawParameters.slicePlaneLocalOrigin, o61[3], o61[7], o61[11]);
    }
    e59.bindDraw(this._drawParameters, t60), "uber" !== this._settings.type && "sketch" !== this._settings.type || this._setSketchUniforms(e59);
  }
  _setSketchUniforms(e59) {
    const t60 = this._settings.strokesTexture, s63 = t60.texture;
    t(s63) || (e59.bindTexture("strokesTexture", s63), e59.setUniform2f("strokesTextureScale", 1 / s63.descriptor.width, 1 / s63.descriptor.height), e59.setUniform1f("strokesLog2Resolution", Math.log2(t60.resolution)), e59.setUniform1f("strokesNormalizationScale", t60.normalizationScale), e59.setUniform1f("strokesAmplitude", t60.amplitude), e59.setUniform1f("strokeVariants", t60.variants));
  }
  _sortRenderables() {
    this._renderablesDirty = false, this.sortedRenderables[A15.TRANSPARENT][A15.TRANSPARENT].clear(), this.sortedRenderables[A15.TRANSPARENT][A15.OPAQUE].clear(), this.sortedRenderables[A15.OPAQUE][A15.TRANSPARENT].clear(), this.sortedRenderables[A15.OPAQUE][A15.OPAQUE].clear(), this.renderables.forEach((e60) => {
      e60.objectTransparency !== A15.INVISIBLE && e60.edgeTransparency !== A15.INVISIBLE && this.sortedRenderables[e60.objectTransparency][e60.edgeTransparency].push(e60);
    });
    const e59 = (e60, r59) => "origin" in e60.transform && "origin" in r59.transform ? e60.transform.origin.id < r59.transform.origin.id ? -1 : e60.transform.origin.id > r59.transform.origin.id ? 1 : 0 : 0;
    this.sortedRenderables[A15.TRANSPARENT][A15.TRANSPARENT].sort(e59), this.sortedRenderables[A15.TRANSPARENT][A15.OPAQUE].sort(e59), this.sortedRenderables[A15.OPAQUE][A15.TRANSPARENT].sort(e59), this.sortedRenderables[A15.OPAQUE][A15.OPAQUE].sort(e59);
  }
  static getKey(e59, r59, t60) {
    return `edges-t:${e59}:${r59}:${t60}`;
  }
};
var E36 = "componentDataTex";
var S24 = "componentDataTexInvDim";
var N22 = e21();

// node_modules/@arcgis/core/views/3d/webgl-engine/lib/edgeRendering/strokes.js
function a56(e59) {
  const r59 = 4, a58 = E37.resolution, c67 = a58 / 2, h44 = new Uint8Array(r59 * a58 * a58), m40 = r59 * a58 * c67, d32 = E37.amplitude, S25 = 2 * d32, g45 = r59 * a58, R21 = Math.log2(a58) + 1, A39 = E37.strokes.length;
  let w25 = (R21 - 1) * A39 * g45;
  for (const { distance: s63, pressure: o61 } of E37.strokes) {
    let e60 = s63, n73 = o61, i66 = w25;
    for (let s64 = 0; s64 < R21; s64++) {
      0 !== s64 && (e60 = u48(e60, p50.DISTANCE), n73 = u48(n73, p50.PRESSURE));
      for (let s65 = 0; s65 < E37.resolution; s65++) {
        const o62 = 0.5 + (e60 ? e60[s65 % e60.length] / S25 : 0), l48 = n73 ? n73[s65 % n73.length] : 1;
        o13(o62, h44, i66), o13(l48, h44, i66 + m40), i66 += r59;
      }
      i66 -= g45 * (A39 + 1);
    }
    w25 += g45;
  }
  const M22 = new u10(e59, { pixelFormat: P3.RGBA, dataType: G4.UNSIGNED_BYTE, hasMipmap: false, samplingMode: L4.LINEAR, width: a58, height: a58, wrapMode: D4.REPEAT }, h44);
  return new f34(a58, S25, d32, A39, M22);
}
function u48(t60, e59) {
  if (!t60)
    return null;
  const r59 = t60.length / 2, s63 = h43 * r59, o61 = new Array(r59);
  let n73 = 0;
  const i66 = e59 === p50.PRESSURE;
  for (let l48 = 0; l48 < t60.length; l48 += 2) {
    const e60 = (t60[l48] + t60[l48 + 1]) / 2;
    o61[n73++] = i66 ? Math.min(s63, 1 - (1 - e60) * m37) : Math.min(s63, e60 * m37);
  }
  return o61;
}
var p50;
!function(t60) {
  t60[t60.DISTANCE = 0] = "DISTANCE", t60[t60.PRESSURE = 1] = "PRESSURE";
}(p50 || (p50 = {}));
var h43 = 0.1;
var m37 = 0.5;
var f34 = class {
  constructor(t60, e59, r59, s63, o61) {
    this.resolution = t60, this.normalizationScale = e59, this.amplitude = r59, this.variants = s63, this.texture = o61;
  }
  dispose() {
    this.texture = s(this.texture);
  }
};
var E37 = { amplitude: 8, resolution: 256, strokes: [{ distance: [-1.59027, -1.59426, -1.59674, -1.59766, -1.59702, -1.59479, -1.59095, -1.5855, -1.57843, -1.56973, -1.55942, -1.5475, -1.53398, -1.5189, -1.50226, -1.4841, -1.46446, -1.44337, -1.42088, -1.39703, -1.37188, -1.34547, -1.31786, -1.28912, -1.2593, -1.22847, -1.19668, -1.16402, -1.13053, -1.09629, -1.06137, -1.02582, -0.98972, -0.95313, -0.91611, -0.87872, -0.84102, -0.80306, -0.76488, -0.72654, -0.68807, -0.64952, -0.61092, -0.57232, -0.53375, -0.49527, -0.45692, -0.41874, -0.38078, -0.34309, -0.3057, -0.26867, -0.23204, -0.19585, -0.16015, -0.12497, -0.09036, -0.05634, -0.02296, 977e-5, 0.04183, 0.07321, 0.10389, 0.13386, 0.16313, 0.19169, 0.21956, 0.24672, 0.27321, 0.299, 0.32413, 0.34858, 0.37237, 0.3955, 0.41798, 0.43981, 0.461, 0.48154, 0.50145, 0.52073, 0.53939, 0.55744, 0.57488, 0.5917, 0.6079, 0.62347, 0.63837, 0.65259, 0.66609, 0.67885, 0.69083, 0.70201, 0.71235, 0.72183, 0.73042, 0.73812, 0.7449, 0.75076, 0.7557, 0.75973, 0.76284, 0.76507, 0.76642, 0.76692, 0.76659, 0.76545, 0.76352, 0.76083, 0.7574, 0.75324, 0.74837, 0.74279, 0.73652, 0.72959, 0.72199, 0.71377, 0.70493, 0.69553, 0.68558, 0.67515, 0.66426, 0.65298, 0.64135, 0.62944, 0.6173, 0.60499, 0.59257, 0.58008, 0.56759, 0.55513, 0.54275, 0.5305, 0.51842, 0.50654, 0.4949, 0.48353, 0.47246, 0.4617, 0.45128, 0.44121, 0.43149, 0.42213, 0.41313, 0.40448, 0.39617, 0.38818, 0.3805, 0.37309, 0.36594, 0.35902, 0.35229, 0.34572, 0.33927, 0.33292, 0.32663, 0.32035, 0.31407, 0.30774, 0.30135, 0.29486, 0.28824, 0.28148, 0.27454, 0.26739, 0.26002, 0.25241, 0.24454, 0.23639, 0.22796, 0.21922, 0.21016, 0.20076, 0.19098, 0.18082, 0.17023, 0.1592, 0.14768, 0.13566, 0.1231, 0.10996, 0.09624, 0.08188, 0.06688, 0.05121, 0.03485, 0.01778, 0, -0.0185, -0.03771, -0.05763, -0.07824, -0.09952, -0.12144, -0.14396, -0.16706, -0.19069, -0.21481, -0.23938, -0.26436, -0.28971, -0.31539, -0.34136, -0.36759, -0.39404, -0.42067, -0.44746, -0.47437, -0.50136, -0.52839, -0.55544, -0.58248, -0.60948, -0.63642, -0.66329, -0.6901, -0.71684, -0.74352, -0.77015, -0.79675, -0.82332, -0.84988, -0.87644, -0.90301, -0.92958, -0.95615, -0.98272, -1.00926, -1.03575, -1.06217, -1.08847, -1.11463, -1.1406, -1.16633, -1.19178, -1.2169, -1.24164, -1.26595, -1.28979, -1.31312, -1.3359, -1.35809, -1.37963, -1.4005, -1.42064, -1.44, -1.45853, -1.47616, -1.49285, -1.50853, -1.52313, -1.53659, -1.54886, -1.55986, -1.56955, -1.57788, -1.5848], pressure: [-0.01365, -206e-5, 0.01025, 0.02327, 0.03696, 0.05129, 0.06619, 0.08163, 0.09755, 0.11393, 0.1307, 0.14784, 0.16531, 0.18308, 0.20111, 0.21938, 0.23786, 0.25651, 0.2753, 0.29419, 0.31315, 0.33215, 0.35115, 0.37015, 0.38913, 0.40806, 0.42694, 0.44576, 0.46449, 0.48313, 0.50167, 0.5201, 0.53839, 0.55653, 0.57448, 0.59222, 0.60971, 0.62692, 0.6438, 0.66033, 0.67648, 0.69221, 0.70753, 0.72242, 0.73688, 0.75093, 0.76456, 0.77779, 0.79063, 0.80309, 0.81517, 0.82686, 0.83817, 0.84911, 0.85967, 0.86987, 0.87972, 0.88924, 0.89845, 0.90734, 0.91594, 0.92425, 0.93229, 0.94005, 0.94754, 0.95475, 0.96166, 0.96826, 0.97451, 0.9804, 0.98588, 0.99092, 0.99549, 0.99957, 0.99685, 0.99381, 0.99131, 0.98936, 0.98796, 0.98711, 0.98681, 0.98706, 0.98787, 0.98923, 0.99113, 0.99357, 0.99654, 1, 0.99607, 0.99171, 0.98695, 0.98181, 0.97634, 0.97057, 0.96452, 0.95824, 0.95175, 0.94506, 0.93818, 0.93113, 0.92389, 0.91647, 0.90887, 0.90109, 0.89314, 0.88501, 0.87672, 0.86831, 0.85978, 0.85119, 0.84256, 0.83393, 0.82533, 0.8168, 0.80836, 0.80002, 0.79181, 0.78374, 0.77582, 0.7681, 0.76059, 0.75331, 0.74629, 0.73955, 0.73311, 0.72697, 0.72116, 0.71568, 0.71054, 0.70572, 0.70121, 0.697, 0.69304, 0.68931, 0.68576, 0.68236, 0.67905, 0.67582, 0.67262, 0.66941, 0.66619, 0.66291, 0.65957, 0.65613, 0.65259, 0.64892, 0.6451, 0.6411, 0.6369, 0.63248, 0.62783, 0.62295, 0.61783, 0.61247, 0.60688, 0.60104, 0.59498, 0.58868, 0.58216, 0.57542, 0.56845, 0.56125, 0.5538, 0.5461, 0.53813, 0.52986, 0.52129, 0.51239, 0.50316, 0.49359, 0.4837, 0.47349, 0.46299, 0.45223, 0.44124, 0.43005, 0.41869, 0.40719, 0.39557, 0.38386, 0.37207, 0.36023, 0.34836, 0.33648, 0.32464, 0.31287, 0.30119, 0.28963, 0.27822, 0.26698, 0.25594, 0.2451, 0.23448, 0.22409, 0.21391, 0.20394, 0.19415, 0.18452, 0.17503, 0.16565, 0.15636, 0.14713, 0.13794, 0.1288, 0.11968, 0.11058, 0.10151, 0.09247, 0.08346, 0.07447, 0.06552, 0.05659, 0.0477, 0.03885, 0.03007, 0.02137, 0.01278, 433e-5, -393e-5, -0.012, -0.01983, -0.02738, -0.03463, -0.04155, -0.0481, -0.05429, -0.0601, -0.06553, -0.07057, -0.07524, -0.07954, -0.08347, -0.08703, -0.09022, -0.09303, -0.09544, -0.09744, -0.09898, -0.10004, -0.10059, -0.1006, -0.10005, -0.09892, -0.0972, -0.09487, -0.09192, -0.08833, -0.08409, -0.07918, -0.07357, -0.06724, -0.06019, -0.0524, -0.04386, -0.03455, -0.02448] }, { distance: [-3.46259, -3.47131, -3.47668, -3.47863, -3.47712, -3.4721, -3.46352, -3.45138, -3.43566, -3.41635, -3.39347, -3.36704, -3.33709, -3.30368, -3.26684, -3.22667, -3.18322, -3.1366, -3.08689, -3.0342, -2.97865, -2.92036, -2.85946, -2.79607, -2.73034, -2.66241, -2.59242, -2.52052, -2.44686, -2.37159, -2.29485, -2.2168, -2.13757, -2.05731, -1.97616, -1.89426, -1.81174, -1.72875, -1.64543, -1.56191, -1.47833, -1.39483, -1.3115, -1.22847, -1.14581, -1.06361, -0.98193, -0.90083, -0.82036, -0.74054, -0.66141, -0.583, -0.50532, -0.4284, -0.35228, -0.277, -0.20261, -0.12916, -0.05672, 0.01463, 0.08485, 0.15384, 0.22153, 0.28784, 0.35269, 0.41602, 0.47776, 0.53787, 0.59629, 0.653, 0.70799, 0.76123, 0.81274, 0.86253, 0.9106, 0.95698, 1.0017, 1.04477, 1.0862, 1.126, 1.16415, 1.20065, 1.23546, 1.26857, 1.29994, 1.32953, 1.35731, 1.38321, 1.40719, 1.42921, 1.44922, 1.46719, 1.48309, 1.49691, 1.50862, 1.51825, 1.52581, 1.53133, 1.53486, 1.53644, 1.53616, 1.53409, 1.53031, 1.52493, 1.51803, 1.50972, 1.50009, 1.48924, 1.47725, 1.46421, 1.45019, 1.43527, 1.4195, 1.40295, 1.38568, 1.36778, 1.34929, 1.3303, 1.31087, 1.29108, 1.27099, 1.25066, 1.23018, 1.2096, 1.18898, 1.16838, 1.14785, 1.12745, 1.10721, 1.08719, 1.06741, 1.04791, 1.02871, 1.00986, 0.99136, 0.97324, 0.95551, 0.93819, 0.92127, 0.90476, 0.88866, 0.87296, 0.85767, 0.84277, 0.82823, 0.81406, 0.80022, 0.7867, 0.77346, 0.76049, 0.74774, 0.73519, 0.72278, 0.71049, 0.69827, 0.68606, 0.67381, 0.66145, 0.64893, 0.63618, 0.62313, 0.60973, 0.5959, 0.5816, 0.56675, 0.5513, 0.53516, 0.51826, 0.50053, 0.4819, 0.46231, 0.44169, 0.42002, 0.39725, 0.37336, 0.34834, 0.32219, 0.2949, 0.2665, 0.23698, 0.20638, 0.17469, 0.14193, 0.10809, 0.07316, 0.03714, 0, -0.03827, -0.07772, -0.11836, -0.16022, -0.20332, -0.24768, -0.29332, -0.34024, -0.38844, -0.43788, -0.48854, -0.54036, -0.59329, -0.64724, -0.70211, -0.75782, -0.81425, -0.87128, -0.92881, -0.98674, -1.04498, -1.10346, -1.1621, -1.22086, -1.27969, -1.33854, -1.3974, -1.45625, -1.51511, -1.57396, -1.63283, -1.69173, -1.75067, -1.80968, -1.86875, -1.9279, -1.98712, -2.04639, -2.10568, -2.16495, -2.22416, -2.28322, -2.34208, -2.40063, -2.4588, -2.51647, -2.57354, -2.62989, -2.68543, -2.74002, -2.79357, -2.84597, -2.89711, -2.94689, -2.99521, -3.04195, -3.087, -3.13023, -3.17152, -3.21075, -3.24779, -3.28252, -3.3148, -3.34451, -3.37154, -3.39577, -3.41709, -3.43539, -3.45059], pressure: [0.87183, 0.87151, 0.87129, 0.87118, 0.87117, 0.87128, 0.87149, 0.87182, 0.87225, 0.8728, 0.87347, 0.87424, 0.87513, 0.87613, 0.87723, 0.87845, 0.87978, 0.88122, 0.88276, 0.88441, 0.88616, 0.88801, 0.88996, 0.892, 0.89414, 0.89637, 0.89868, 0.90108, 0.90356, 0.90611, 0.90874, 0.91144, 0.91421, 0.91704, 0.91993, 0.92287, 0.92587, 0.92892, 0.93201, 0.93514, 0.93831, 0.94151, 0.94474, 0.94799, 0.95126, 0.95456, 0.95786, 0.96118, 0.9645, 0.96783, 0.97116, 0.97448, 0.9778, 0.98111, 0.98441, 0.9877, 0.99096, 0.99421, 0.99742, 0.99938, 0.99622, 0.9931, 0.99001, 0.98697, 0.98397, 0.98101, 0.97811, 0.97526, 0.97246, 0.96972, 0.96703, 0.96441, 0.96185, 0.95935, 0.95691, 0.95455, 0.95225, 0.95002, 0.94786, 0.94577, 0.94376, 0.94182, 0.93995, 0.93817, 0.93646, 0.93483, 0.93328, 0.93181, 0.93042, 0.92911, 0.92788, 0.92673, 0.92566, 0.92467, 0.92376, 0.92293, 0.92217, 0.92149, 0.92088, 0.92034, 0.91987, 0.91947, 0.91913, 0.91886, 0.91864, 0.91849, 0.91838, 0.91833, 0.91834, 0.91839, 0.91849, 0.91863, 0.91883, 0.91907, 0.91935, 0.91968, 0.92005, 0.92046, 0.92092, 0.92142, 0.92195, 0.92253, 0.92314, 0.9238, 0.92449, 0.92521, 0.92598, 0.92677, 0.9276, 0.92847, 0.92936, 0.93029, 0.93125, 0.93224, 0.93325, 0.9343, 0.93537, 0.93646, 0.93758, 0.93872, 0.93988, 0.94106, 0.94225, 0.94346, 0.94469, 0.94593, 0.94718, 0.94844, 0.94971, 0.95098, 0.95226, 0.95354, 0.95482, 0.9561, 0.95738, 0.95867, 0.95995, 0.96122, 0.9625, 0.96377, 0.96504, 0.9663, 0.96757, 0.96883, 0.97009, 0.97135, 0.97261, 0.97387, 0.97513, 0.9764, 0.97767, 0.97895, 0.98023, 0.98153, 0.98284, 0.98416, 0.98549, 0.98684, 0.98821, 0.9896, 0.99101, 0.99244, 0.99389, 0.99537, 0.99688, 0.99842, 1, 0.99839, 0.99675, 0.99508, 0.99336, 0.99161, 0.98982, 0.98799, 0.98613, 0.98422, 0.98228, 0.98029, 0.97827, 0.97622, 0.97414, 0.97202, 0.96987, 0.9677, 0.96551, 0.9633, 0.96107, 0.95882, 0.95656, 0.9543, 0.95202, 0.94975, 0.94747, 0.94519, 0.94292, 0.94065, 0.93838, 0.93613, 0.93388, 0.93164, 0.92941, 0.9272, 0.92499, 0.9228, 0.92062, 0.91846, 0.91631, 0.91418, 0.91207, 0.90998, 0.90792, 0.90588, 0.90387, 0.90189, 0.89995, 0.89804, 0.89617, 0.89434, 0.89256, 0.89083, 0.88914, 0.88752, 0.88595, 0.88443, 0.88299, 0.88161, 0.8803, 0.87907, 0.87791, 0.87683, 0.87584, 0.87494, 0.87412, 0.8734, 0.87278, 0.87225] }, { distance: [0.39335, 0.43437, 0.47737, 0.52234, 0.56923, 0.61801, 0.66864, 0.72109, 0.7753, 0.83123, 0.88882, 0.94801, 1.00875, 1.07097, 1.13461, 1.1996, 1.26586, 1.33333, 1.40193, 1.47158, 1.54221, 1.61373, 1.68607, 1.75913, 1.83284, 1.90711, 1.98186, 2.05699, 2.13243, 2.20809, 2.28387, 2.35971, 2.4355, 2.51117, 2.58663, 2.66179, 2.73658, 2.81092, 2.88473, 2.95792, 3.03043, 3.10217, 3.17308, 3.24309, 3.31211, 3.3801, 3.44697, 3.51267, 3.57712, 3.64028, 3.70208, 3.76247, 3.8214, 3.87881, 3.93467, 3.98892, 4.04152, 4.09244, 4.14164, 4.18908, 4.23474, 4.27859, 4.32061, 4.36077, 4.39905, 4.43544, 4.46992, 4.50249, 4.53314, 4.56185, 4.58864, 4.61349, 4.63642, 4.65745, 4.67657, 4.69381, 4.7092, 4.72274, 4.73447, 4.74441, 4.75259, 4.75903, 4.76376, 4.76682, 4.76822, 4.768, 4.76618, 4.76279, 4.75786, 4.75142, 4.74348, 4.73409, 4.72326, 4.71102, 4.69739, 4.68241, 4.6661, 4.64849, 4.6296, 4.60948, 4.58816, 4.56567, 4.54204, 4.51732, 4.49154, 4.46473, 4.43694, 4.4082, 4.37854, 4.348, 4.31662, 4.28443, 4.25145, 4.21773, 4.1833, 4.14819, 4.11243, 4.07606, 4.03912, 4.00162, 3.96361, 3.92512, 3.88618, 3.84683, 3.80708, 3.76697, 3.72653, 3.68579, 3.64478, 3.60351, 3.56202, 3.52033, 3.47845, 3.43642, 3.39425, 3.35196, 3.30957, 3.2671, 3.22455, 3.18196, 3.13933, 3.09668, 3.05402, 3.01136, 2.96873, 2.92613, 2.88357, 2.84108, 2.79865, 2.75631, 2.71407, 2.67195, 2.62994, 2.58807, 2.54634, 2.50477, 2.46338, 2.42216, 2.38114, 2.34032, 2.29971, 2.25933, 2.21916, 2.17923, 2.13954, 2.10008, 2.06087, 2.02189, 1.98316, 1.94468, 1.90644, 1.86845, 1.83069, 1.79316, 1.75586, 1.71877, 1.68189, 1.6452, 1.60868, 1.57232, 1.53611, 1.50004, 1.46407, 1.4282, 1.39241, 1.35668, 1.321, 1.28535, 1.24972, 1.2141, 1.17849, 1.14286, 1.10723, 1.07158, 1.03593, 1.00028, 0.96464, 0.92902, 0.89344, 0.85793, 0.8225, 0.78719, 0.75203, 0.71705, 0.68231, 0.64784, 0.61369, 0.57991, 0.54656, 0.51368, 0.48134, 0.44959, 0.41849, 0.3881, 0.35848, 0.32967, 0.30174, 0.27474, 0.24872, 0.22373, 0.19982, 0.17702, 0.15539, 0.13497, 0.11579, 0.09791, 0.08137, 0.06621, 0.05248, 0.04022, 0.02948, 0.02029, 0.01271, 677e-5, 252e-5, 0, -76e-5, 27e-5, 314e-5, 788e-5, 0.01451, 0.02307, 0.03357, 0.04604, 0.0605, 0.07697, 0.09546, 0.11599, 0.13858, 0.16322, 0.18992, 0.21869, 0.24952, 0.28241, 0.31735, 0.35434], pressure: [0.95248, 0.95236, 0.95228, 0.95223, 0.95222, 0.95224, 0.95231, 0.95241, 0.95256, 0.95274, 0.95296, 0.95322, 0.95352, 0.95385, 0.95423, 0.95465, 0.9551, 0.9556, 0.95613, 0.9567, 0.95731, 0.95796, 0.95864, 0.95936, 0.96012, 0.96091, 0.96173, 0.96259, 0.96348, 0.9644, 0.96535, 0.96633, 0.96734, 0.96838, 0.96944, 0.97053, 0.97164, 0.97277, 0.97393, 0.9751, 0.97629, 0.9775, 0.97873, 0.97997, 0.98122, 0.98249, 0.98376, 0.98505, 0.98634, 0.98763, 0.98893, 0.99023, 0.99154, 0.99284, 0.99414, 0.99544, 0.99673, 0.99802, 0.9993, 0.99942, 0.99816, 0.99691, 0.99568, 0.99445, 0.99324, 0.99205, 0.99087, 0.98972, 0.98858, 0.98746, 0.98636, 0.98528, 0.98423, 0.9832, 0.98219, 0.98121, 0.98025, 0.97931, 0.9784, 0.97752, 0.97666, 0.97582, 0.97501, 0.97423, 0.97347, 0.97274, 0.97203, 0.97135, 0.9707, 0.97007, 0.96948, 0.9689, 0.96836, 0.96784, 0.96735, 0.96689, 0.96646, 0.96605, 0.96567, 0.96533, 0.965, 0.96471, 0.96445, 0.96421, 0.964, 0.96382, 0.96367, 0.96355, 0.96346, 0.96339, 0.96335, 0.96334, 0.96336, 0.9634, 0.96348, 0.96358, 0.9637, 0.96385, 0.96403, 0.96423, 0.96446, 0.96471, 0.96499, 0.96529, 0.96561, 0.96595, 0.96631, 0.96669, 0.96709, 0.96751, 0.96795, 0.9684, 0.96887, 0.96935, 0.96984, 0.97035, 0.97087, 0.9714, 0.97194, 0.97249, 0.97304, 0.97361, 0.97418, 0.97476, 0.97534, 0.97592, 0.97651, 0.97711, 0.9777, 0.9783, 0.9789, 0.9795, 0.9801, 0.9807, 0.9813, 0.9819, 0.9825, 0.98309, 0.98369, 0.98428, 0.98486, 0.98545, 0.98603, 0.98661, 0.98718, 0.98775, 0.98832, 0.98888, 0.98944, 0.99, 0.99056, 0.99112, 0.99167, 0.99223, 0.99279, 0.99335, 0.99392, 0.99449, 0.99507, 0.99565, 0.99624, 0.99684, 0.99745, 0.99807, 0.9987, 0.99934, 1, 0.99933, 0.99866, 0.99797, 0.99727, 0.99656, 0.99583, 0.9951, 0.99435, 0.99359, 0.99283, 0.99205, 0.99126, 0.99046, 0.98966, 0.98885, 0.98803, 0.9872, 0.98637, 0.98554, 0.9847, 0.98387, 0.98303, 0.98219, 0.98134, 0.9805, 0.97967, 0.97883, 0.978, 0.97717, 0.97634, 0.97552, 0.97471, 0.97389, 0.97309, 0.97229, 0.9715, 0.97071, 0.96993, 0.96915, 0.96838, 0.96762, 0.96687, 0.96612, 0.96539, 0.96466, 0.96395, 0.96324, 0.96255, 0.96187, 0.9612, 0.96055, 0.95991, 0.95929, 0.95869, 0.95811, 0.95754, 0.957, 0.95648, 0.95599, 0.95552, 0.95508, 0.95467, 0.95428, 0.95393, 0.9536, 0.95331, 0.95305, 0.95283, 0.95264] }, { distance: [2.85606, 2.86149, 2.86432, 2.8645, 2.862, 2.85686, 2.84912, 2.83886, 2.82618, 2.81117, 2.79393, 2.77456, 2.75314, 2.72975, 2.70447, 2.67734, 2.64844, 2.61784, 2.58564, 2.55196, 2.5169, 2.48057, 2.44305, 2.40438, 2.36462, 2.32383, 2.28208, 2.23943, 2.19591, 2.15153, 2.10628, 2.06016, 2.01321, 1.96548, 1.91702, 1.86793, 1.8183, 1.76829, 1.71803, 1.66767, 1.61737, 1.56726, 1.51746, 1.46803, 1.41902, 1.37044, 1.32228, 1.27452, 1.22716, 1.18023, 1.13376, 1.08781, 1.04244, 0.99769, 0.95357, 0.91003, 0.86701, 0.82447, 0.78238, 0.74069, 0.69938, 0.65836, 0.61758, 0.57699, 0.53656, 0.49627, 0.45611, 0.41611, 0.37632, 0.33683, 0.29776, 0.25924, 0.22141, 0.18441, 0.14839, 0.11346, 0.07972, 0.04727, 0.01619, -0.01348, -0.0417, -0.0684, -0.09351, -0.11698, -0.13875, -0.1588, -0.17713, -0.19381, -0.20889, -0.22242, -0.23444, -0.24501, -0.25421, -0.26216, -0.26897, -0.27473, -0.27951, -0.28336, -0.28631, -0.28836, -0.28948, -0.28963, -0.28873, -0.28673, -0.28355, -0.27916, -0.27354, -0.26673, -0.25878, -0.2498, -0.23992, -0.22929, -0.21802, -0.20623, -0.19398, -0.18134, -0.16836, -0.1551, -0.14163, -0.12809, -0.11461, -0.1013, -0.08826, -0.07557, -0.06335, -0.0517, -0.04077, -0.03065, -0.02143, -0.01321, -606e-5, 0, 496e-5, 888e-5, 0.01181, 0.01385, 0.01511, 0.0157, 0.01574, 0.01533, 0.01458, 0.01358, 0.0124, 0.01112, 979e-5, 851e-5, 738e-5, 65e-4, 6e-3, 596e-5, 646e-5, 754e-5, 924e-5, 0.01161, 0.01471, 0.01858, 0.02323, 0.02865, 0.03481, 0.04169, 0.0493, 0.05765, 0.06677, 0.07671, 0.08754, 0.09934, 0.11222, 0.12628, 0.14159, 0.15823, 0.17624, 0.19561, 0.21632, 0.23828, 0.26142, 0.28563, 0.31083, 0.33696, 0.36397, 0.39185, 0.42057, 0.4501, 0.48036, 0.51125, 0.54264, 0.5744, 0.60646, 0.63871, 0.67105, 0.70337, 0.73556, 0.76751, 0.79918, 0.83048, 0.86139, 0.8919, 0.92202, 0.95184, 0.98144, 1.01094, 1.04045, 1.0701, 1.10002, 1.13029, 1.16103, 1.1923, 1.22416, 1.25664, 1.28979, 1.32364, 1.35824, 1.39363, 1.42985, 1.4669, 1.50475, 1.54332, 1.58252, 1.62227, 1.6625, 1.70312, 1.744, 1.78501, 1.82598, 1.8668, 1.90734, 1.94754, 1.98732, 2.02666, 2.06555, 2.10402, 2.1421, 2.17985, 2.2173, 2.25448, 2.29139, 2.328, 2.36424, 2.4, 2.43515, 2.46955, 2.50309, 2.53565, 2.56717, 2.59761, 2.62692, 2.65505, 2.68191, 2.7074, 2.73138, 2.75375, 2.7744, 2.79324, 2.81017, 2.82504, 2.83772, 2.8481], pressure: [0.22758, 0.23641, 0.24578, 0.25568, 0.26609, 0.27699, 0.28835, 0.30016, 0.31237, 0.32495, 0.33789, 0.35113, 0.36466, 0.37843, 0.39241, 0.40658, 0.4209, 0.43535, 0.44989, 0.4645, 0.47916, 0.49385, 0.50853, 0.5232, 0.53784, 0.55243, 0.56696, 0.58141, 0.59578, 0.61004, 0.62419, 0.63821, 0.65209, 0.6658, 0.67934, 0.69268, 0.70582, 0.71873, 0.73139, 0.7438, 0.75594, 0.76779, 0.77935, 0.79061, 0.80156, 0.81221, 0.82254, 0.83258, 0.84231, 0.85176, 0.86091, 0.86978, 0.87837, 0.88669, 0.89473, 0.9025, 0.91, 0.91725, 0.92425, 0.931, 0.93752, 0.9438, 0.94985, 0.95566, 0.96124, 0.96658, 0.97168, 0.97652, 0.98109, 0.98539, 0.98939, 0.99309, 0.99646, 0.99949, 0.99783, 0.99552, 0.99361, 0.99209, 0.99098, 0.99029, 0.99003, 0.99019, 0.99079, 0.99181, 0.99324, 0.9951, 0.99735, 1, 0.99698, 0.99361, 0.98992, 0.98592, 0.98163, 0.97709, 0.97231, 0.96731, 0.96212, 0.95676, 0.95122, 0.94554, 0.93973, 0.93378, 0.92773, 0.92157, 0.91532, 0.90899, 0.90258, 0.89612, 0.88961, 0.88308, 0.87653, 0.87, 0.8635, 0.85705, 0.85068, 0.8444, 0.83823, 0.83219, 0.82628, 0.82052, 0.81493, 0.80952, 0.8043, 0.79929, 0.7945, 0.78994, 0.78561, 0.78151, 0.77765, 0.77402, 0.77062, 0.76742, 0.76443, 0.76161, 0.75896, 0.75645, 0.75406, 0.75175, 0.74951, 0.7473, 0.74511, 0.74289, 0.74064, 0.73833, 0.73592, 0.73341, 0.73078, 0.728, 0.72507, 0.72197, 0.71869, 0.71522, 0.71156, 0.70769, 0.70363, 0.69936, 0.69489, 0.69021, 0.68533, 0.68023, 0.67492, 0.66939, 0.66363, 0.65765, 0.65145, 0.64501, 0.63833, 0.63143, 0.62428, 0.61691, 0.60931, 0.60148, 0.59344, 0.58521, 0.57679, 0.5682, 0.55948, 0.55063, 0.54167, 0.53264, 0.52354, 0.51439, 0.50522, 0.49603, 0.48686, 0.47773, 0.46865, 0.45964, 0.45072, 0.44192, 0.43324, 0.42469, 0.41629, 0.40804, 0.39994, 0.392, 0.3842, 0.37655, 0.36903, 0.36164, 0.35437, 0.3472, 0.34012, 0.33312, 0.3262, 0.31933, 0.31251, 0.30574, 0.299, 0.2923, 0.28563, 0.27899, 0.27239, 0.26583, 0.25933, 0.25288, 0.24652, 0.24025, 0.2341, 0.22808, 0.22221, 0.21653, 0.21104, 0.20576, 0.20072, 0.19592, 0.19138, 0.18712, 0.18313, 0.17943, 0.17602, 0.17292, 0.17013, 0.16766, 0.16551, 0.16369, 0.16222, 0.1611, 0.16036, 0.16001, 0.16007, 0.16055, 0.16148, 0.16286, 0.16471, 0.16705, 0.16988, 0.17321, 0.17706, 0.18144, 0.18636, 0.19182, 0.19785, 0.20443, 0.21158, 0.2193] }, { distance: [-2.31317, -2.3191, -2.32189, -2.32154, -2.31811, -2.31174, -2.30254, -2.29062, -2.27609, -2.25904, -2.23954, -2.21767, -2.19355, -2.16732, -2.13907, -2.10885, -2.07672, -2.04268, -2.00677, -1.96911, -1.92985, -1.88914, -1.84713, -1.80397, -1.75979, -1.71467, -1.66864, -1.62171, -1.57395, -1.52546, -1.47625, -1.42628, -1.3755, -1.32384, -1.27131, -1.218, -1.16408, -1.10972, -1.05508, -1.00031, -0.94551, -0.89077, -0.83615, -0.7817, -0.72757, -0.6739, -0.62076, -0.56821, -0.51625, -0.46484, -0.41397, -0.36366, -0.314, -0.26506, -0.21689, -0.16957, -0.12316, -0.07766, -0.03301, 0.01085, 0.05399, 0.09643, 0.13827, 0.17967, 0.22079, 0.26176, 0.30265, 0.34342, 0.38397, 0.42414, 0.46381, 0.50285, 0.54115, 0.57863, 0.61524, 0.65093, 0.6856, 0.71914, 0.75153, 0.78275, 0.81283, 0.84182, 0.86972, 0.89651, 0.92208, 0.94634, 0.96919, 0.99052, 1.01025, 1.02835, 1.04484, 1.05976, 1.07309, 1.08479, 1.09492, 1.1036, 1.11096, 1.11714, 1.12224, 1.12627, 1.12916, 1.13083, 1.13125, 1.13036, 1.12816, 1.12466, 1.11992, 1.11397, 1.10677, 1.09827, 1.08849, 1.07746, 1.06527, 1.05203, 1.03786, 1.02283, 1.00695, 0.99025, 0.97279, 0.9546, 0.93573, 0.9163, 0.8965, 0.8765, 0.85647, 0.83652, 0.81687, 0.79775, 0.77939, 0.76199, 0.74568, 0.73049, 0.71635, 0.70316, 0.69082, 0.67925, 0.66834, 0.65804, 0.64831, 0.63911, 0.63032, 0.62184, 0.61363, 0.60564, 0.59788, 0.59036, 0.58308, 0.57597, 0.5689, 0.56177, 0.55447, 0.5469, 0.53896, 0.53062, 0.5219, 0.51283, 0.5034, 0.49355, 0.48335, 0.47287, 0.46223, 0.45154, 0.44085, 0.43012, 0.41923, 0.40805, 0.39648, 0.38441, 0.37176, 0.35849, 0.34458, 0.32999, 0.31461, 0.29833, 0.28109, 0.26288, 0.2437, 0.22361, 0.20265, 0.18082, 0.15807, 0.13434, 0.1096, 0.0838, 0.0569, 0.02894, 0, -0.0298, -0.0604, -0.09173, -0.12364, -0.15594, -0.18843, -0.22092, -0.25331, -0.28559, -0.31781, -0.35006, -0.38244, -0.41502, -0.44785, -0.48098, -0.5144, -0.54811, -0.58218, -0.61666, -0.65153, -0.68677, -0.72232, -0.75807, -0.79397, -0.83002, -0.86628, -0.90281, -0.93968, -0.97693, -1.01465, -1.05282, -1.09139, -1.13031, -1.16956, -1.20917, -1.24905, -1.28907, -1.32908, -1.36891, -1.40844, -1.44765, -1.48658, -1.52527, -1.56376, -1.60206, -1.64016, -1.67801, -1.71552, -1.75264, -1.78936, -1.8257, -1.86161, -1.89702, -1.93182, -1.96584, -1.99894, -2.03102, -2.06203, -2.0919, -2.12056, -2.14794, -2.17397, -2.19852, -2.22138, -2.24235, -2.26129, -2.27805, -2.29243, -2.30422], pressure: [0.9681, 0.97424, 0.98046, 0.98674, 0.99309, 0.9995, 0.99404, 0.98754, 0.981, 0.97444, 0.96785, 0.96124, 0.95462, 0.94801, 0.94139, 0.93479, 0.92822, 0.92167, 0.91515, 0.90868, 0.90225, 0.89589, 0.88959, 0.88336, 0.87722, 0.87115, 0.86519, 0.85932, 0.85356, 0.84792, 0.84239, 0.83699, 0.83173, 0.8266, 0.82162, 0.81679, 0.81211, 0.80759, 0.80324, 0.79906, 0.79505, 0.79121, 0.78756, 0.78409, 0.78081, 0.77771, 0.77481, 0.77211, 0.76959, 0.76728, 0.76516, 0.76324, 0.76153, 0.76001, 0.75869, 0.75757, 0.75665, 0.75593, 0.7554, 0.75507, 0.75493, 0.75498, 0.75523, 0.75565, 0.75627, 0.75706, 0.75803, 0.75917, 0.76049, 0.76197, 0.76361, 0.76541, 0.76737, 0.76947, 0.77172, 0.77409, 0.7766, 0.77923, 0.78198, 0.78484, 0.7878, 0.79086, 0.79401, 0.79724, 0.80055, 0.80394, 0.8074, 0.81092, 0.8145, 0.81813, 0.82182, 0.82556, 0.82934, 0.83317, 0.83703, 0.84093, 0.84487, 0.84884, 0.85284, 0.85687, 0.86094, 0.86503, 0.86915, 0.87329, 0.87746, 0.88166, 0.88587, 0.89011, 0.89436, 0.89863, 0.90291, 0.9072, 0.91149, 0.91579, 0.92009, 0.92438, 0.92867, 0.93295, 0.9372, 0.94144, 0.94566, 0.94985, 0.954, 0.95812, 0.96219, 0.96623, 0.97021, 0.97415, 0.97802, 0.98184, 0.9856, 0.9893, 0.99293, 0.9965, 1, 0.99657, 0.9932, 0.98991, 0.98668, 0.98352, 0.98042, 0.97738, 0.9744, 0.97148, 0.9686, 0.96577, 0.96298, 0.96023, 0.95751, 0.95482, 0.95214, 0.94949, 0.94684, 0.9442, 0.94156, 0.93892, 0.93627, 0.93361, 0.93094, 0.92825, 0.92555, 0.92284, 0.9201, 0.91735, 0.91458, 0.91179, 0.90899, 0.90616, 0.90332, 0.90047, 0.8976, 0.89472, 0.89183, 0.88893, 0.88603, 0.88314, 0.88024, 0.87735, 0.87448, 0.87162, 0.86878, 0.86597, 0.86319, 0.86044, 0.85774, 0.85508, 0.85247, 0.84993, 0.84744, 0.84503, 0.84269, 0.84042, 0.83825, 0.83616, 0.83417, 0.83227, 0.83048, 0.8288, 0.82724, 0.82578, 0.82445, 0.82324, 0.82215, 0.82119, 0.82037, 0.81967, 0.81911, 0.81868, 0.81839, 0.81824, 0.81823, 0.81835, 0.81862, 0.81903, 0.81957, 0.82026, 0.82109, 0.82206, 0.82317, 0.82443, 0.82583, 0.82737, 0.82906, 0.83089, 0.83287, 0.83499, 0.83726, 0.83968, 0.84223, 0.84494, 0.84778, 0.85077, 0.8539, 0.85717, 0.86058, 0.86412, 0.86781, 0.87163, 0.87559, 0.87968, 0.88391, 0.88826, 0.89275, 0.89737, 0.90211, 0.90698, 0.91198, 0.91709, 0.92233, 0.92768, 0.93315, 0.93873, 0.94441, 0.95019, 0.95607, 0.96205] }, { distance: [4.72925, 4.81721, 4.9037, 4.98859, 5.07177, 5.15311, 5.23249, 5.3098, 5.38491, 5.45772, 5.52811, 5.59598, 5.66122, 5.72375, 5.78346, 5.84028, 5.8941, 5.94486, 5.99248, 6.03689, 6.07803, 6.11584, 6.15028, 6.18128, 6.20882, 6.23285, 6.25336, 6.27031, 6.28369, 6.29348, 6.29969, 6.3023, 6.30133, 6.29678, 6.28867, 6.27703, 6.26187, 6.24324, 6.22116, 6.19567, 6.16683, 6.13468, 6.09928, 6.06068, 6.01896, 5.97417, 5.92639, 5.87569, 5.82217, 5.76589, 5.70696, 5.64545, 5.58147, 5.5151, 5.44644, 5.37559, 5.30265, 5.2277, 5.15085, 5.0722, 4.99184, 4.90987, 4.82639, 4.74151, 4.65533, 4.56794, 4.47945, 4.38996, 4.29959, 4.20843, 4.11658, 4.02416, 3.93125, 3.83796, 3.74437, 3.65057, 3.55666, 3.46272, 3.36884, 3.27509, 3.18155, 3.08831, 2.99545, 2.90303, 2.81114, 2.71984, 2.62922, 2.53933, 2.45026, 2.36207, 2.27484, 2.18862, 2.10349, 2.01951, 1.93675, 1.85528, 1.77515, 1.69644, 1.61919, 1.54348, 1.46935, 1.39685, 1.32605, 1.25698, 1.18967, 1.12417, 1.06049, 0.99863, 0.93862, 0.88044, 0.82408, 0.76953, 0.71676, 0.66574, 0.61644, 0.56882, 0.52282, 0.47841, 0.43553, 0.39413, 0.35414, 0.31551, 0.27817, 0.24206, 0.20712, 0.17328, 0.14048, 0.10866, 0.07776, 0.04772, 0.01848, -999e-5, -0.03776, -0.06487, -0.09134, -0.11721, -0.14251, -0.16725, -0.19144, -0.21509, -0.2382, -0.26076, -0.28275, -0.30416, -0.32496, -0.34511, -0.36459, -0.38334, -0.40134, -0.41852, -0.43485, -0.45026, -0.46471, -0.47815, -0.49052, -0.50179, -0.51189, -0.52081, -0.52849, -0.5349, -0.54003, -0.54383, -0.54627, -0.54734, -0.54702, -0.54528, -0.54211, -0.53752, -0.53149, -0.52403, -0.51515, -0.50487, -0.4932, -0.48015, -0.46575, -0.45001, -0.43297, -0.41463, -0.39503, -0.37419, -0.35213, -0.32887, -0.30443, -0.27885, -0.25214, -0.22432, -0.19541, -0.16544, -0.13442, -0.10235, -0.06926, -0.03514, 0, 0.03616, 0.07336, 0.11159, 0.15088, 0.19125, 0.23272, 0.27531, 0.31906, 0.36401, 0.41019, 0.45764, 0.5064, 0.55651, 0.60802, 0.66096, 0.71538, 0.77129, 0.82874, 0.88776, 0.94836, 1.01056, 1.07438, 1.13982, 1.20687, 1.27554, 1.34581, 1.41766, 1.49107, 1.56599, 1.64239, 1.72025, 1.79951, 1.88013, 1.96209, 2.04532, 2.12979, 2.21546, 2.30226, 2.39017, 2.47911, 2.56905, 2.65991, 2.75164, 2.84416, 2.93742, 3.03133, 3.12582, 3.2208, 3.31619, 3.41191, 3.50785, 3.60393, 3.70006, 3.79612, 3.89202, 3.98765, 4.08291, 4.17767, 4.27182, 4.36525, 4.45783, 4.54944, 4.63995], pressure: [0.30942, 0.30838, 0.30765, 0.30724, 0.30715, 0.30738, 0.30795, 0.30884, 0.31007, 0.31164, 0.31354, 0.31578, 0.31837, 0.32129, 0.32455, 0.32815, 0.33209, 0.33636, 0.34097, 0.34591, 0.35117, 0.35675, 0.36265, 0.36887, 0.37539, 0.38221, 0.38933, 0.39674, 0.40442, 0.41238, 0.4206, 0.42907, 0.43779, 0.44675, 0.45593, 0.46533, 0.47493, 0.48473, 0.49471, 0.50486, 0.51517, 0.52563, 0.53623, 0.54694, 0.55777, 0.5687, 0.57971, 0.59079, 0.60194, 0.61313, 0.62435, 0.6356, 0.64686, 0.65811, 0.66935, 0.68056, 0.69174, 0.70286, 0.71391, 0.72489, 0.73579, 0.74659, 0.75728, 0.76785, 0.7783, 0.7886, 0.79876, 0.80877, 0.81861, 0.82827, 0.83776, 0.84706, 0.85617, 0.86507, 0.87378, 0.88227, 0.89056, 0.89863, 0.90649, 0.91412, 0.92153, 0.92872, 0.93568, 0.94241, 0.94892, 0.95519, 0.96122, 0.96702, 0.97258, 0.97791, 0.98299, 0.98783, 0.99242, 0.99677, 0.99911, 0.99525, 0.99164, 0.98827, 0.98515, 0.98228, 0.97966, 0.97728, 0.97514, 0.97324, 0.97159, 0.97017, 0.96898, 0.96801, 0.96727, 0.96674, 0.96641, 0.96629, 0.96635, 0.96661, 0.96703, 0.96762, 0.96838, 0.96928, 0.97032, 0.97149, 0.97279, 0.9742, 0.97572, 0.97734, 0.97905, 0.98085, 0.98273, 0.98468, 0.98669, 0.98877, 0.99091, 0.99311, 0.99535, 0.99765, 1, 0.9976, 0.99516, 0.99267, 0.99014, 0.98755, 0.98491, 0.98222, 0.97947, 0.97666, 0.97378, 0.97083, 0.96781, 0.96471, 0.96153, 0.95826, 0.9549, 0.95144, 0.94787, 0.9442, 0.94042, 0.93651, 0.93249, 0.92834, 0.92407, 0.91966, 0.91512, 0.91045, 0.90564, 0.90069, 0.8956, 0.89037, 0.885, 0.87949, 0.87384, 0.86806, 0.86214, 0.85608, 0.84988, 0.84356, 0.83711, 0.83053, 0.82383, 0.81702, 0.81009, 0.80306, 0.79594, 0.78872, 0.78141, 0.77403, 0.76657, 0.75905, 0.75148, 0.74385, 0.73619, 0.72849, 0.72076, 0.71302, 0.70526, 0.69749, 0.68972, 0.68195, 0.67419, 0.66644, 0.65871, 0.65099, 0.64329, 0.63561, 0.62795, 0.62032, 0.61271, 0.60512, 0.59755, 0.59001, 0.58248, 0.57497, 0.56749, 0.56002, 0.55256, 0.54512, 0.5377, 0.5303, 0.52291, 0.51554, 0.50819, 0.50087, 0.49358, 0.48632, 0.4791, 0.47192, 0.4648, 0.45773, 0.45072, 0.44378, 0.43692, 0.43015, 0.42346, 0.41687, 0.41039, 0.40403, 0.39779, 0.39168, 0.38571, 0.37989, 0.37423, 0.36873, 0.36342, 0.35828, 0.35335, 0.34862, 0.34409, 0.3398, 0.33573, 0.3319, 0.32831, 0.32498, 0.32192, 0.31912, 0.3166, 0.31436, 0.31242, 0.31077] }] };

// node_modules/@arcgis/core/views/3d/webgl-engine/lib/edgeRendering/util.js
function o58(t60) {
  let n73 = null;
  for (const e59 of t60) {
    const t61 = e59.type;
    if (u49(e59)) {
      if (t(n73))
        n73 = t61;
      else if (n73 !== t61)
        return "uber";
    }
  }
  return r(n73) ? n73 : "uber";
}
function i63(t60) {
  let r59 = A15.INVISIBLE;
  for (const { material: e59 } of t60)
    if (f35(e59)) {
      if (e59.color[3] * e59.opacity < 1)
        return A15.TRANSPARENT;
      r59 = A15.OPAQUE;
    }
  return r59;
}
function c66(t60) {
  let r59 = A15.INVISIBLE;
  for (const { material: e59 } of t60)
    if (f35(e59)) {
      switch (e59.objectTransparency) {
        case A15.TRANSPARENT:
        case A15.INVISIBLE:
          return A15.TRANSPARENT;
        case A15.OPAQUE:
          if (e59.opacity < 1)
            return A15.TRANSPARENT;
      }
      r59 = A15.OPAQUE;
    }
  return r59;
}
function f35(t60) {
  return t60.size * t60.color[3] * t60.opacity > 0;
}
function u49(t60) {
  return t60.size * t60.color[3] > 0;
}
function l47(r59, e59) {
  const n73 = M(r59, e59, true);
  return -1 === n73 ? e59 < r59[0] ? 0 : r59.length : n73;
}
function a57(t60, r59, e59) {
  return t60.length - l47(t60, r59 * e59.minimumEdgeLength);
}
function m38(t60, r59, e59, n73) {
  for (let o61 = 0; o61 < t60.length; o61++) {
    const i66 = t60[o61].index, c67 = r59[o61], f37 = r59[o61 + 1];
    if (n73)
      for (let t61 = c67; t61 < f37; t61++) {
        const r60 = n73[t61];
        e59.set(r60, i66);
      }
    else
      for (let t61 = c67; t61 < f37; t61++)
        e59.set(t61, i66);
  }
}

// node_modules/@arcgis/core/views/3d/webgl-engine/lib/edgeRendering/EdgeView.js
var oe8 = s3.getLogger("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView");
var ne6 = class extends y {
  constructor(e59) {
    super(e59), this.updatingHandles = new c7(), this.perObjectData = /* @__PURE__ */ new Map(), this.perObjectDataEvictionCache = /* @__PURE__ */ new Set(), this.renderers = /* @__PURE__ */ new Map(), this.numberOfRenderedEdges = { [A15.TRANSPARENT]: 0, [A15.OPAQUE]: 0 }, this.gpuMemoryUsage = 0, this.workerAbort = new AbortController(), this.tmpModelPosition = n7(), this.localOrigins = new e55(new j12(e59.renderSR));
  }
  initialize() {
    this.worker = new n35(this.schedule), this.componentColorManager = new r55(this.rctx, 3);
    const e59 = e10.createBuffer(4);
    for (let t60 = 0; t60 < 4; t60++)
      e59.sideness.set(t60, 0, 0 === t60 || 3 === t60 ? 0 : 1), e59.sideness.set(t60, 1, 0 === t60 || 1 === t60 ? 0 : 1);
    this.verticesBufferObject = c10.createVertex(this.rctx, F4.STATIC_DRAW, e59.buffer);
  }
  destroy() {
    this.destroyed || (this.perObjectData.forEach((e59) => this._discardObjectEntry(e59)), this.perObjectData.clear(), this.strokesTexture = s(this.strokesTexture), this.componentColorManager = l(this.componentColorManager), this.workerAbort.abort(), this.worker.destroy(), this.verticesBufferObject = s(this.verticesBufferObject), this.renderers.clear(), this.updatingHandles.destroy());
  }
  get updating() {
    return this.updatingHandles.updating;
  }
  get usedMemory() {
    return this.gpuMemoryUsage;
  }
  get numberOfRenderedPrimitives() {
    return this.numberOfRenderedEdges[A15.TRANSPARENT] + this.numberOfRenderedEdges[A15.OPAQUE];
  }
  shouldRender() {
    return this.renderers.size > 0;
  }
  async addComponentObject(e59, t60, r59, s63, o61, n73, i66, a58) {
    if (this.hasObject(e59))
      return this.getObjectMemoryUsage(e59);
    let c67;
    const d32 = new ce8(new Promise((e60) => c67 = e60), r59.center, r59.radius);
    this.perObjectData.set(e59, d32);
    const l48 = await this.updatingHandles.addPromise(this._addComponentGeometry(t60, d32, s63, o61, n73, i66, a58));
    return this.setNeedsRender(), c67(), l48;
  }
  async addOrUpdateObject3D(e59, t60, r59, s63) {
    if (this.destroyed)
      return void oe8.warn("Attempt to add an object to a destroyed instance");
    const o61 = this.perObjectData.get(e59);
    let n73;
    (o61 == null ? void 0 : o61.renderables.length) > 0 && this.perObjectDataEvictionCache.add(o61);
    const i66 = e59.boundingVolumeWorldSpace.bounds, a58 = new ce8(new Promise((e60) => n73 = e60), E10(i66), k4(i66));
    this.perObjectData.set(e59, a58);
    const c67 = new Array();
    if (r59.mergeGeometries && e59.geometries.length > 1 && ae6(e59))
      c67.push(this._addObjectMergedGeometries(e59, a58, t60, r59, s63));
    else
      for (let d32 = 0; d32 < e59.geometries.length; d32++) {
        const o62 = e59.geometryRecords[d32];
        if (!o62.material.supportsEdges)
          continue;
        const n74 = e59.geometries[d32];
        c67.push(this._addGeometry(e59, a58, n74, o62, t60[0], r59, s63));
      }
    await this.updatingHandles.addPromise(Promise.all(c67)), this.perObjectDataEvictionCache.delete(a58), this._discardObjectEntry(o61), this.setNeedsRender(), n73();
  }
  _discardObjectEntry(e59) {
    e59 && (e59.renderables.length && (e59.renderables.forEach((e60) => this._removeRenderable(e60)), this.setNeedsRender()), e59.loaded = null);
  }
  hasObject(e59) {
    return this.perObjectData.has(e59);
  }
  async updateAllComponentOpacities(e59, t60) {
    const r59 = t60 instanceof Array ? (e60) => t60[e60] : () => t60;
    (await this.updatingHandles.addPromise(this._getObjectEntry(e59))).renderables.forEach((e60) => {
      const t61 = e60.components.meta.length;
      for (let s63 = 0; s63 < t61; s63++) {
        const t62 = r59(s63), o61 = e60.components.meta[s63], n73 = o61.index;
        o61.material.opacity = t62, e60.components.buffer.textureBuffer.setDataElement(n73, 1, 3, 255 * t62);
      }
      this._updateTransparency(e60);
    }), this.setNeedsRender();
  }
  async getObjectMemoryUsage(e59) {
    return (await this._getObjectEntry(e59)).renderables.reduce((e60, t60) => e60 + t60.statistics.gpuMemoryUsage, 0);
  }
  async updateAllComponentMaterials(e59, t60, r59, s63) {
    const o61 = e59 instanceof O9, n73 = !!r59.hasSlicePlane, i66 = o58(t60), a58 = P21.getKey(i66, n73, o61);
    (await this.updatingHandles.addPromise(this._getObjectEntry(e59))).renderables.forEach((e60) => {
      if (a58 !== e60.rendererKey) {
        const t61 = this.renderers.get(e60.rendererKey), r60 = this._acquireRenderer(i66, n73, o61);
        t61.removeRenderable(e60), t61.refCount.decrement(), e60.rendererKey = a58, r60.addRenderable(e60);
      }
      for (let r60 = 0; r60 < t60.length; r60++)
        e60.components.meta[r60].material = t60[r60];
      s63 && this._updateComponentBuffer(e60.components), this._updateTransparency(e60);
    }), this.setNeedsRender();
  }
  async updateAllVerticalOffsets(e59, t60) {
    (await this.updatingHandles.addPromise(this._getObjectEntry(e59))).renderables.forEach((e60) => {
      const r59 = e60.components.meta;
      for (let s63 = 0; s63 < r59.length; s63++)
        e60.components.meta[s63].verticalOffset = (t60 == null ? void 0 : t60[s63]) ?? 0;
      this._updateComponentBuffer(e60.components);
    }), this.setNeedsRender();
  }
  async updateObjectVisibility(e59, t60) {
    (await this.updatingHandles.addPromise(this._getObjectEntry(e59))).renderables.forEach((e60) => e60.visible = t60), this.setNeedsRender();
  }
  removeObject(e59) {
    const t60 = this.perObjectData.get(e59);
    t60 && (this.perObjectData.delete(e59), this._discardObjectEntry(t60));
  }
  async _getObjectEntry(e59) {
    const t60 = this.perObjectData.get(e59);
    if (!t60)
      throw "no object";
    if (await t60.loaded, null == t60.loaded)
      throw m3();
    return t60;
  }
  removeAll() {
    this.perObjectData.forEach((e59, t60) => this.removeObject(t60));
  }
  render(e59, t60) {
    if (this.numberOfRenderedEdges[t60] = 0, t(this.componentColorManager))
      return;
    this.localOrigins.updateViewMatrices(e59.camera.viewMatrix);
    const r59 = e59.camera.viewInverseTransposeMatrix, s63 = n7(), o61 = new c62();
    let n73 = 0, i66 = 0;
    if (this.renderers.forEach((r60) => {
      0 === r60.refCount.value ? (this.renderers.delete(r60.key), r60.dispose()) : r60.forEachRenderable((t61) => {
        t61.visible && (n73 += t61.statistics.averageEdgeLength, i66++, t61.regular && r60.updateTechnique(e59, false), t61.silhouette && r60.updateTechnique(e59, true));
      }, t60);
    }), this.componentColorManager.garbageCollect(), this.componentColorManager.updateTextures(), 0 === i66)
      return;
    const c67 = 40 * n73 / i66, d32 = e59.camera.perScreenPixelRatio, l48 = new a55(c67, d32, t60);
    o3(s63, r59[3], r59[7], r59[11]), o61.set(s63), r7(l48.transformWorldFromViewTH, o61.high), r7(l48.transformWorldFromViewTL, o61.low), a10(l48.transformViewFromCameraRelativeRS, e59.camera.viewMatrix), o10(de7, l48.transformViewFromCameraRelativeRS), u9(l48.transformNormalViewFromGlobal, de7), l48.transformProjFromView = e59.camera.projectionMatrix, this._updateObjectCameraDistances(e59), this.renderers.forEach((t61) => {
      this._renderRegularEdges(t61, e59, l48), this._renderSilhouetteEdges(t61, e59, l48);
    });
  }
  _updateTransparency(e59) {
    const t60 = i63(e59.components.meta), r59 = c66(e59.components.meta);
    t60 === e59.edgeTransparency && r59 === e59.objectTransparency || (e59.edgeTransparency = t60, e59.objectTransparency = r59, this.renderers.get(e59.rendererKey).setRenderablesDirty());
  }
  _computeModelTransformWithLocalOrigin(e59, t60, r59) {
    if (e59.getCombinedStaticTransformation(t60, r59), r(t60.origin))
      this.localOrigins.register(t60.origin);
    else {
      const e60 = o3(this.tmpModelPosition, r59[12], r59[13], r59[14]);
      t60.origin = this.localOrigins.acquire(e60);
    }
    return n70(t60.origin.vec3, r59), t60.origin;
  }
  _updateComponentBuffer(e59) {
    const { meta: t60, buffer: r59 } = e59, s63 = new Uint8Array(4);
    for (let n73 = 0; n73 < t60.length; n73++) {
      const e60 = t60[n73].material, i66 = t60[n73].index, a58 = o4(Math.round(e60.size * T27), 0, 255), c67 = o4(e60.extensionLength, -_29, 255 - _29) + _29, d32 = "solid" === e60.type ? u8.SOLID : u8.SKETCH, l48 = 255 * e60.opacity, m40 = e60.color, g45 = 255 * m40[0], u51 = 255 * m40[1], h44 = 255 * m40[2], p52 = 255 * m40[3];
      r59.textureBuffer.setData(i66, 0, g45, u51, h44, p52), r59.textureBuffer.setData(i66, 1, a58, c67, d32, l48), s34(t60[n73].verticalOffset, s63), r59.textureBuffer.setData(i66, 2, s63[0], s63[1], s63[2], s63[3]);
    }
  }
  _createComponentBuffers(e59) {
    if (t(this.componentColorManager))
      return null;
    const t60 = new Array(), r59 = this.componentColorManager.getBuffer(e59.length);
    for (let o61 = 0; o61 < e59.length; o61++) {
      const s64 = e59[o61], n73 = r59.acquireIndex();
      t60.push({ index: n73, verticalOffset: 0, material: s64 });
    }
    const s63 = { meta: t60, buffer: r59 };
    return this._updateComponentBuffer(s63), s63;
  }
  _extractEdges(e59, t60, r59, s63, o61, n73 = o61.length) {
    return this.worker.process({ data: t60, indices: o61, indicesLength: n73, writerSettings: e59, skipDeduplicate: r59 }, this.workerAbort.signal, s63);
  }
  _createEdgeResources(e59) {
    const t60 = {};
    if (t(this.verticesBufferObject))
      return t60;
    if (e59.regular.lodInfo.lengths.length > 0) {
      const r59 = new f11(this.rctx, o8, { vertices: T4, instances: d4.glLayout }, { vertices: this.verticesBufferObject, instances: c10.createVertex(this.rctx, F4.STATIC_DRAW, e59.regular.instancesData.buffer) });
      t60.regular = { vao: r59, lod: e59.regular.lodInfo };
    }
    if (e59.silhouette.lodInfo.lengths.length > 0) {
      const r59 = new f11(this.rctx, o8, { vertices: T4, instances: w4.glLayout }, { vertices: this.verticesBufferObject, instances: c10.createVertex(this.rctx, F4.STATIC_DRAW, e59.silhouette.instancesData.buffer) });
      t60.silhouette = { vao: r59, lod: e59.silhouette.lodInfo };
    }
    return t60;
  }
  async _addGeometry(e59, t60, r59, s63, o61, n73, i66) {
    const a58 = r59.vertexAttributes.get(O3.POSITION), c67 = r59.indices.get(O3.POSITION), d32 = e12(), l48 = { position: a58, indices: c67, modelTransform: d32, origin: this._computeModelTransformWithLocalOrigin(e59, s63, d32) };
    return this._addPositionData(t60, l48, r59.edgeIndicesLength, o61, n73, i66);
  }
  async _addPositionData(e59, t60, r59, s63, o61, n73 = false) {
    if (null == e59.loaded)
      return;
    const i66 = this._createComponentBuffers([s63]);
    if (t(i66) || r59 <= 0)
      return;
    const c67 = this._acquireRenderer(s63.type, !!o61.hasSlicePlane, true), { modelTransform: d32, origin: l48 } = t60, m40 = t60.indices, g45 = t60.position, u51 = g45.data.length / g45.size, h44 = A7.createBuffer(u51);
    for (let a58 = 0; a58 < u51; a58++)
      h44.position.set(a58, 0, g45.data[a58 * g45.size + 0]), h44.position.set(a58, 1, g45.data[a58 * g45.size + 1]), h44.position.set(a58, 2, g45.data[a58 * g45.size + 2]);
    m38(i66.meta, [0, h44.componentIndex.count], h44.componentIndex);
    const p52 = await this.updatingHandles.addPromise(this._extractEdges(c67.writerSettings, h44, false, n73, m40, r59));
    if (null == e59.loaded)
      return;
    const { regular: f37, silhouette: b23 } = this._createEdgeResources(p52), y33 = (f37 ? f37.vao.size : 0) + (b23 ? b23.vao.size : 0), j36 = { regular: f37, silhouette: b23, transform: { modelMatrix: d32, origin: l48 }, statistics: { gpuMemoryUsage: y33, externalMemoryUsage: false, averageEdgeLength: p52.averageEdgeLength }, components: i66, visible: true, edgeTransparency: i63(i66.meta), objectTransparency: c66(i66.meta), distanceToCamera: 0, rendererKey: c67.key };
    e59.renderables.push(j36), c67.addRenderable(j36), this.gpuMemoryUsage += y33;
  }
  async _addComponentGeometry(e59, t60, r59, s63, o61, n73, i66) {
    if (null == t60.loaded)
      return 0;
    const c67 = this._createComponentBuffers(n73);
    if (t(c67))
      return 0;
    const d32 = o58(n73), l48 = this._acquireRenderer(d32, i66.hasSlicePlane || false, false), m40 = A7.createBuffer(r59.count);
    e14(m40.position, r59), m38(c67.meta, o61, m40.componentIndex, s63);
    const g45 = true, u51 = l48.writerSettings, h44 = await this.updatingHandles.addPromise(this._extractEdges(u51, m40, g45, false, s63));
    if (null == t60.loaded)
      return 0;
    const { regular: p52, silhouette: f37 } = this._createEdgeResources(h44), b23 = (p52 ? p52.vao.size : 0) + (f37 ? f37.vao.size : 0), y33 = { regular: p52, silhouette: f37, transform: e59, statistics: { gpuMemoryUsage: b23, externalMemoryUsage: true, averageEdgeLength: h44.averageEdgeLength }, components: c67, visible: true, edgeTransparency: i63(c67.meta), objectTransparency: c66(c67.meta), distanceToCamera: 0, rendererKey: l48.key };
    return t60.renderables.push(y33), l48.addRenderable(y33), b23;
  }
  async _addObjectMergedGeometries(e59, t60, r59, s63, o61) {
    const n73 = /* @__PURE__ */ new Map();
    let i66 = 0, a58 = null, c67 = 0;
    for (let b23 = 0; b23 < e59.geometries.length; b23++) {
      const t61 = e59.geometries[b23], r60 = e59.geometryRecords[b23];
      if (!r60.material.supportsEdges)
        continue;
      !a58 && r60.origin && (a58 = r60);
      const s64 = t61.vertexAttributes.get(O3.POSITION);
      c67 += s64.data.length / s64.size, i66 += t61.edgeIndicesLength;
    }
    const d32 = c67 >= 65536 ? Uint32Array : Uint16Array, l48 = i66 ? new d32(i66) : null, m40 = [];
    let g45 = 0;
    for (let b23 = 0; b23 < e59.geometries.length; b23++) {
      const t61 = e59.geometries[b23];
      if (!e59.geometryRecords[b23].material.supportsEdges)
        continue;
      const r60 = t61.vertexAttributes.get(O3.POSITION), s64 = t61.indices.get(O3.POSITION);
      let o62 = n73.get(r60.data);
      if (null == o62) {
        o62 = m40.length / 3;
        for (let e60 = 0; e60 < r60.data.length; e60 += r60.size)
          m40.push(r60.data[e60 + 0]), m40.push(r60.data[e60 + 1]), m40.push(r60.data[e60 + 2]);
        n73.set(r60.data, o62);
      }
      if (s64)
        for (let e60 = 0; e60 < t61.edgeIndicesLength; e60++)
          l48[g45++] = o62 + s64[e60];
    }
    const u51 = a58 || e59.geometryRecords[0], h44 = e12(), p52 = this._computeModelTransformWithLocalOrigin(e59, u51, h44);
    for (let b23 = 0; b23 < e59.geometryRecords.length; b23++)
      e59.geometryRecords[b23].origin = p52;
    const f37 = { position: { data: m40, size: 3 }, indices: l48, modelTransform: h44, origin: p52 };
    await this.updatingHandles.addPromise(this._addPositionData(t60, f37, l48.length, r59[0], s63, o61));
  }
  _acquireRenderer(e59, t60, r59) {
    const s63 = P21.getKey(e59, t60, r59);
    let o61 = this.renderers.get(s63);
    return t(this.strokesTexture) && (this.strokesTexture = a56(this.rctx)), o61 || (o61 = new P21(this.rctx, this.techniqueRepository, { type: e59, hasSlicePlane: t60, strokesTexture: this.strokesTexture, legacy: r59, spherical: this.viewingMode === l13.Global }), this.renderers.set(s63, o61)), o61.refCount.increment(), o61;
  }
  _removeRenderable(e59) {
    ie5(e59);
    const t60 = this.renderers.get(e59.rendererKey);
    if (t60) {
      t60.removeRenderable(e59), t60.refCount.decrement(), "origin" in e59.transform && this.localOrigins.release(e59.transform.origin), this.gpuMemoryUsage -= e59.statistics.externalMemoryUsage ? 0 : e59.statistics.gpuMemoryUsage;
      for (const t61 of e59.components.meta)
        e59.components.buffer.releaseIndex(t61.index);
    }
  }
  _updateObjectCameraDistances(e59) {
    const t60 = e59.camera.eye, r59 = e59.camera.viewForward, s63 = n7(), o61 = (e60) => {
      const { center: o62, radius: n73 } = e60;
      J(s63, o62, t60);
      const i66 = P2(s63, r59), a58 = i66 < -n73 ? 1 / 0 : i66 < n73 ? 0 : i66 - n73;
      e60.renderables.forEach((e61) => e61.distanceToCamera = a58);
    };
    this.perObjectData.forEach(o61), this.perObjectDataEvictionCache.forEach(o61);
  }
  _renderRegularEdges(e59, t60, r59) {
    const s63 = e59.bindRegularEdges(r59, t60), o61 = r59.transparency;
    e59.forEachRenderable((n73) => {
      if (!n73.visible || !n73.regular)
        return;
      const i66 = a57(n73.regular.lod.lengths, n73.distanceToCamera, r59), a58 = "origin" in n73.transform ? this.localOrigins.getViewMatrix(n73.transform.origin) : o9;
      e59.renderRegularEdges(s63, n73, t60, i66, a58), this.numberOfRenderedEdges[o61] += i66;
    }, o61);
  }
  _renderSilhouetteEdges(e59, t60, r59) {
    const s63 = e59.bindSilhouetteEdges(r59, t60), o61 = r59.transparency;
    e59.forEachRenderable((n73) => {
      if (!n73.visible || !n73.silhouette)
        return;
      const i66 = a57(n73.silhouette.lod.lengths, n73.distanceToCamera, r59), a58 = "origin" in n73.transform ? this.localOrigins.getViewMatrix(n73.transform.origin) : o9;
      e59.renderSilhouetteEdges(s63, n73, t60, i66, a58), this.numberOfRenderedEdges[o61] += i66;
    }, o61);
  }
};
function ie5(e59) {
  e59.regular && (e59.regular.vao.vertexBuffers.instances.dispose(), e59.regular.vao.dispose(false), e59.regular.vao = null), e59.silhouette && (e59.silhouette.vao.vertexBuffers.instances.dispose(), e59.silhouette.vao.dispose(false), e59.silhouette.vao = null);
}
function ae6(e59) {
  let t60 = null, s63 = null;
  for (let o61 = 0; o61 < e59.geometries.length; o61++) {
    const n73 = e59.geometryRecords[o61];
    if (n73.material.supportsEdges) {
      if (t60) {
        if (!i(t60, n73.transformation))
          return false;
      } else
        t60 = n73.transformation;
      if (!s63 && r(n73.origin))
        s63 = n73;
      else if (r(s63 == null ? void 0 : s63.origin) && r(n73.origin) && s63.origin.id !== n73.origin.id)
        return false;
    }
  }
  return true;
}
e([d({ constructOnly: true })], ne6.prototype, "rctx", void 0), e([d({ constructOnly: true })], ne6.prototype, "renderSR", void 0), e([d({ constructOnly: true })], ne6.prototype, "viewingMode", void 0), e([d({ constructOnly: true })], ne6.prototype, "techniqueRepository", void 0), e([d({ constructOnly: true })], ne6.prototype, "setNeedsRender", void 0), e([d({ constructOnly: true })], ne6.prototype, "schedule", void 0), e([d({ readOnly: true })], ne6.prototype, "updatingHandles", void 0), e([d({ readOnly: true })], ne6.prototype, "updating", null), ne6 = e([n6("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView")], ne6);
var ce8 = class {
  constructor(e59, t60, r59) {
    this.center = t60, this.radius = r59, this.renderables = new Array(), this.loaded = e59, this.loaded.then(() => {
      null != this.loaded && (this.loaded = true);
    });
  }
};
var de7 = e11();

// node_modules/@arcgis/core/views/webgl/Measurement.js
function e57(e59) {
  const u51 = e59.capabilities.disjointTimerQuery;
  return t(u51) ? null : u51.timestampBits() > 0 ? new i64(u51) : r57 ? null : new s62(u51);
}
var i64 = class {
  constructor(t60) {
    this.timer = t60, this.start = t60.createQuery(), t60.createTimestamp(this.start);
  }
  stop(t60, e59 = 50) {
    this.end = this.timer.createQuery(), this.timer.createTimestamp(this.end), this._checkQueryResult(t60, e59);
  }
  _checkQueryResult(t60, e59) {
    if (!this.timer.resultAvailable(this.end))
      return void setTimeout(() => this._checkQueryResult(t60, e59), e59);
    if (this.timer.disjoint())
      return void t60(null);
    const i66 = this.timer.getResult(this.start), s63 = this.timer.getResult(this.end);
    t60((s63 - i66) / 1e6);
  }
};
var s62 = class {
  constructor(t60) {
    this.timer = t60, this.query = t60.createQuery(), r57 = true, this.timer.beginTimeElapsed(this.query);
  }
  stop(t60, e59 = 50) {
    this.timer.endTimeElapsed(), r57 = false, this._checkQueryResult(t60, e59);
  }
  _checkQueryResult(t60, e59) {
    const i66 = this.timer.resultAvailable(this.query), s63 = this.timer.disjoint();
    if (!i66 || s63)
      s63 ? t60(null) : setTimeout(() => this._checkQueryResult(t60, e59), e59);
    else {
      const e60 = this.timer.getResult(this.query);
      t60(e60 / 1e6);
    }
  }
};
var r57 = false;

// node_modules/@arcgis/core/views/3d/webgl-engine/statistics/RendererPerformanceInfo.js
var i65;
!function(e59) {
  e59[e59.Prepare = 0] = "Prepare", e59[e59.Shadowmap = 1] = "Shadowmap", e59[e59.Lineardepth = 2] = "Lineardepth", e59[e59.Normals = 3] = "Normals", e59[e59.SSAO = 4] = "SSAO", e59[e59.Opaque = 5] = "Opaque", e59[e59.OpaqueEdges = 6] = "OpaqueEdges", e59[e59.Transparent = 7] = "Transparent", e59[e59.TransparentEdges = 8] = "TransparentEdges", e59[e59.Hudvisibility = 9] = "Hudvisibility", e59[e59.TransparentTerrain = 10] = "TransparentTerrain", e59[e59.Atmosphere = 11] = "Atmosphere", e59[e59.Laserline = 12] = "Laserline", e59[e59.Occluded = 13] = "Occluded", e59[e59.Antialiasing = 14] = "Antialiasing", e59[e59.Highlights = 15] = "Highlights", e59[e59.HudOccluded = 16] = "HudOccluded", e59[e59.HudNotoccluded = 17] = "HudNotoccluded";
}(i65 || (i65 = {}));
var n71 = ["prepare", "shadowmap", "lineardepth", "normals", "ssao", "opaque", "opaque edges", "transparent", "transparent edges", "hudvisibility", "transparent terrain", "atmosphere", "laserline", "occluded", "antialiasing", "highlights", "hudOccluded", "hudNotoccluded"];
var o59 = class extends e4 {
  constructor() {
    super("total"), this.total = 0, this.frameCount = 0;
  }
};
var m39 = class {
  constructor() {
    this._startTime = n3(0), this._lastSample = n3(0), this._enableGPUTimer = 0, this.totalTime = new o59(), this.gpuTime = new e4("gpu", 9), this.renderPassTimings = n71.map((e59) => new e4(e59));
  }
  get elapsedTime() {
    return n3(performance.now() - this._startTime);
  }
  enableGPUTimer() {
    return ++this._enableGPUTimer, { remove: h2(() => --this._enableGPUTimer) };
  }
  prerender(e59) {
    this._startTime = this._lastSample = n3(performance.now()), this._enableGPUTimer && (this._gpuTimer = e57(e59));
  }
  advance(e59) {
    const r59 = n3(performance.now());
    this.renderPassTimings[e59].record(r59 - this._lastSample), this._lastSample = r59;
  }
  postrender() {
    r(this._gpuTimer) && (this._gpuTimer.stop((r60) => r(r60) && this.gpuTime.record(r60), 16), this._gpuTimer = null);
    const r59 = performance.now() - this._startTime;
    this.totalTime.record(r59), this.totalTime.total += r59, this.totalTime.frameCount++;
  }
};

// node_modules/@arcgis/core/views/3d/webgl-engine/lib/Renderer.js
var oe9 = 0.9;
var _e3 = class extends y {
  constructor(e59, r59, t60, i66, n73, a58, h44, d32, o61) {
    super({}), this._materialRepository = e59, this._shaderTechniqueRepository = t60, this._rctx = i66, this._compositingHelper = n73, this._magnifierHelper = a58, this._requestRender = h44, this._stage = o61, this._materialRenderers = /* @__PURE__ */ new Map(), this._needsTransparentPass = false, this._hasHUDElements = false, this._hasHighlights = false, this._hasWater = false, this._hasOverlayWater = false, this._content = /* @__PURE__ */ new Map(), this._isRendering = false, this._fallbackDepthStencilTexture = null, this.performanceInfo = new m39(), this._antialiasing = e15.SMAA, this._oitEnabled = false, this._multipassTerrain = true, this._transparentTerrain = false, this._hasAnimations = false, this._animationTimestep = n3(0), this._handles = new u4(), this._renderHiddenTransparentEdges = () => {
    }, this._oitUsed = false, this._smaaPass = new R19(this._rctx, t60), this._oitEnabled = this._hasOITSupport, this._requestRender(), this._offscreenRendering = new T26(this._rctx, this._compositingHelper), this._sliceHelper = new n68(), this._shadowMap = new Q5(this._rctx, o61.viewingMode, 2), this._ssaoHelper = new x7(t60, this._rctx, () => this._requestRender()), this._highlight = new O32(t60, this._rctx), this._shadowHighlight = new v35(this._rctx, o61.viewingMode), this._shadowAccumulator = new N21(this._rctx, t60, o61, (e60) => {
      const r60 = this.shadowsEnabled;
      this._shadowMap.enabled = true, this._ensureCameraBindParameters(e60.camera, e60.contentCamera), this._renderPlugins.prepareRender(), this._shadowMap.enabled = r60;
    }, (e60, r60, t61) => {
      e60.shadowMap.start(e60.camera, r60, t61), this._renderShadowCascades(A12.MATERIAL_DEPTH_SHADOWMAP_ALL, e60.shadowMap), e60.camera.setGLViewport(this._rctx), this._ensureCameraBindParameters(e60.camera, e60.contentCamera);
    }, () => this._requestRender()), this._renderContext = new c20(this._rctx, this._offscreenRendering, this._shadowMap, this._ssaoHelper, this._sliceHelper), this._renderPlugins = new i62({ renderContext: this._renderContext, shaderTechniqueRepository: t60, textureRep: r59, materialRep: this._materialRepository, requestRender: this._requestRender, schedule: d32 }), this.renderPassManager = new M21(this._rctx, this._shaderTechniqueRepository), this._renderPlugins.add(this.renderPassManager.slots(), this.renderPassManager), this._handles.add([l6(() => this._stage.state.camera, () => this._requestRender(), w2), l6(() => t25.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES, (e60) => {
      this._renderHiddenTransparentEdges = e60 ? () => this._renderEdges(A15.TRANSPARENT) : () => {
      }, this._requestRender();
    }, h3)]);
  }
  get _bindParameters() {
    return this._renderContext.bindParameters;
  }
  get hasWater() {
    return this._hasWater || this._hasOverlayWater;
  }
  get hasWaterReflection() {
    return this.hasWater && this._waterReflectionEnabled;
  }
  normalizeCtorArgs() {
    return {};
  }
  dispose() {
    this._handles.destroy(), this._smaaPass.dispose(), this._materialRenderers.forEach((e59) => e59.dispose()), this._materialRenderers.clear(), this._edgeView = l(this._edgeView), this._offscreenRendering.dispose(), this._fallbackDepthStencilTexture = s(this._fallbackDepthStencilTexture), this._shadowMap.enabled = false, this._shadowMap.dispose(), this._ssaoHelper.enabled = false, this._ssaoHelper.dispose(), this._highlight.dispose(), this._shadowHighlight.dispose(), this._shadowAccumulator.dispose(), a14.prune(), this._content.clear();
  }
  disposeOffscreenBuffers() {
    this._offscreenRendering.dispose(), this._shadowMap.dispose(), this._smaaPass.disable(), this._ssaoHelper.disposeOffscreenBuffers();
  }
  get updating() {
    return this._antialiasing === e15.SMAA && this._smaaPass.updating || r(this._edgeView) && this._edgeView.updating || this._shadowAccumulator.running || !this.isCameraFinal;
  }
  ensureEdgeView() {
    return t(this._edgeView) && (this._edgeView = new ne6({ rctx: this._rctx, renderSR: this._stage.renderSR, viewingMode: this._stage.viewingMode, techniqueRepository: this._shaderTechniqueRepository, setNeedsRender: () => this._requestRender(), schedule: (e59) => this._stage.resourceController.schedule(e59) }), this._handles.add(l6(() => o(this._edgeView, (e59) => e59.updating), () => this._requestRender(), U3)), this._requestRender()), this._edgeView;
  }
  get edgeView() {
    return this._edgeView;
  }
  get isCameraFinal() {
    return C(this._bindParameters.ssr.reprojectionMatrix, o9);
  }
  set _reprojectionMatrix(e59) {
    c2(this._bindParameters.ssr.reprojectionMatrix, e59) && this.notifyChange("isCameraFinal");
  }
  get shadowsEnabled() {
    var _a;
    return !!((_a = this._shadowMap) == null ? void 0 : _a.enabled);
  }
  setRenderParameters(e59) {
    const { _shadowMap: r59, _ssaoHelper: t60, _bindParameters: s63 } = this;
    if (void 0 !== e59.screenSpaceReflectionsEnabled && s63.ssr.enabled !== e59.screenSpaceReflectionsEnabled && (s63.ssr.enabled = e59.screenSpaceReflectionsEnabled, this._requestRender()), void 0 !== e59.shadowMap && r59.enabled !== e59.shadowMap && (r59.enabled = e59.shadowMap, this._requestRender()), void 0 !== e59.shadowMapMaxCascades && r59.maxCascades !== e59.shadowMapMaxCascades && (r59.maxCascades = e59.shadowMapMaxCascades, this._requestRender()), r(e59.environment)) {
      r(e59.environment.weather) && (this._bindParameters.weather = e59.environment.weather, this._bindParameters.weatherVisible = e59.weatherVisible, this._renderContext.bindParameters.weather = e59.environment.weather, this._renderContext.bindParameters.weatherVisible = e59.weatherVisible), void 0 !== e59.environment.lighting.ambientOcclusionEnabled && t60.enabled !== e59.environment.lighting.ambientOcclusionEnabled && (t60.enabled = e59.environment.lighting.ambientOcclusionEnabled, this._requestRender()), void 0 !== e59.environment.lighting.waterReflectionEnabled && this._waterReflectionEnabled !== e59.environment.lighting.waterReflectionEnabled && (this._waterReflectionEnabled = e59.environment.lighting.waterReflectionEnabled, this._requestRender());
      const r60 = "sun" === e59.environment.lighting.type;
      s63.enableFillLights !== r60 && (s63.enableFillLights = r60, this._requestRender());
    }
    e59.background && this._offscreenRendering.background !== e59.background && (this._offscreenRendering.background = e59.background, this._requestRender());
    const i66 = e59.antialiasingEnabled ? e15.SMAA : e15.NONE;
    void 0 !== e59.antialiasingEnabled && this._antialiasing !== i66 && (this._antialiasing = i66, this._requestRender()), void 0 !== e59.highQualityTransparency && this._multipassTerrain !== e59.highQualityTransparency && (this._multipassTerrain = e59.highQualityTransparency, this._oitEnabled = e59.highQualityTransparency && this._hasOITSupport, this._requestRender()), void 0 !== e59.defaultHighlightOptions && (this._highlight.setDefaultOptions(e59.defaultHighlightOptions), this._shadowHighlight.setDefaultOptions(e59.defaultHighlightOptions), this._requestRender()), void 0 !== e59.overlays && this._bindParameters.overlays !== e59.overlays && (this._bindParameters.overlays = e59.overlays, this._requestRender()), void 0 !== e59.slicePlane && this._sliceHelper.plane !== e59.slicePlane && (this._sliceHelper.plane = e2(e59.slicePlane), this._requestRender()), void 0 !== e59.transparentTerrain && this._transparentTerrain !== e59.transparentTerrain && (this._transparentTerrain = e59.transparentTerrain, this._requestRender()), void 0 !== e59.hasOverlayWater && this._hasOverlayWater !== e59.hasOverlayWater && (this._hasOverlayWater = e59.hasOverlayWater, this._requestRender()), void 0 !== e59.shadowCastOptions && this._shadowAccumulator.setOptions(e59.shadowCastOptions);
  }
  get hasSlicePlane() {
    return !!this._sliceHelper.plane;
  }
  get renderPlugins() {
    return this._renderPlugins;
  }
  get _hasOITSupport() {
    return this._rctx.driverTest.floatBufferBlendWorking;
  }
  modify(e59) {
    this._isRendering && console.warn("Renderer.modify called while rendering");
    const { adds: r59, removes: t60, updates: s63 } = e59;
    if (0 === r59.length && 0 === t60.length && 0 === s63.length)
      return;
    t60.forAll(({ id: e60 }) => this._content.delete(e60)), r59.forAll((e60) => this._content.set(e60.id, e60));
    const n73 = r32(e59);
    let a58 = false;
    n73.forEach((e60, r60) => {
      let t61 = this._materialRenderers.get(r60);
      if (!t61) {
        if (!(e60.adds.length > 0))
          return;
        t61 = new A18(this._rctx, this._materialRepository, r60), this._materialRenderers.set(r60, t61);
      }
      t61.modify(e60), t61.isEmpty && (a58 = true);
    }), a58 && this._materialRenderers.forEach((e60, r60) => {
      e60.isEmpty && (this._materialRenderers.delete(r60), e60.dispose());
    }), this._hasHighlights = n5(this._materialRenderers, (e60) => e60.hasHighlights), this._bindParameters.hasOccludees = n5(this._materialRenderers, (e60) => e60.hasOccludees), this._hasWater = n5(this._materialRenderers, (e60) => e60.hasWater), this._needsTransparentPass = n5(this._materialRenderers, (e60) => e60.requiresSlot(E9.TRANSPARENT_MATERIAL, A12.MATERIAL)), this._hasHUDElements = n5(this._materialRenderers, (e60) => e60.requiresSlot(E9.LINE_CALLOUTS_HUD_DEPTH, A12.MATERIAL) || e60.requiresSlot(E9.HUD_MATERIAL, A12.MATERIAL) || e60.requiresSlot(E9.LABEL_MATERIAL, A12.MATERIAL)), this._requestRender();
  }
  updateAnimation(e59) {
    return this._hasAnimations = false, this._materialRenderers.forEach((r59) => this._hasAnimations = r59.updateAnimation(e59) || this._hasAnimations), this._hasAnimations = this._renderPlugins.updateAnimation(e59) || this._hasAnimations, this._hasAnimations;
  }
  get animationTimestep() {
    return this._animationTimestep;
  }
  updateLightSources(e59, r59, t60) {
    this._bindParameters.lighting.groundLightingFactor = r59, this._bindParameters.lighting.globalFactor = t60, this._bindParameters.lighting.set(e59);
  }
  render(e59, r59, t60, s63) {
    this._isRendering = true, this.performanceInfo.prerender(this._rctx), this._bindParameters.transparencyPassType = O4.NONE;
    const i66 = this._offscreenRendering;
    i66.needLastFrameColorTexture = this.hasWaterReflection, i66.advanceCurrentRenderTarget();
    const n73 = G8(this._sliceHelper.plane);
    s63 === D5.OFF && (this._sliceHelper.plane = null), this._rctx.bindFramebuffer(e59), r59.setGLViewport(this._rctx), this._ensureCameraBindParameters(r59, t60), this._renderPlugins.prepareRender(), this.performanceInfo.advance(i65.Prepare);
    const a58 = this._computeDepthRange(r59);
    this._renderShadowMap(e59, r59, this._bindParameters.lighting.lightingMainDirection, a58), this.performanceInfo.advance(i65.Shadowmap), i66.initializeFrame(r59), this._ensureBindParameters(r59, t60), this._renderLinearDepth(), this.performanceInfo.advance(i65.Lineardepth), this._accumulateShadows(a58, r59, t60), this._renderNormal(), this.performanceInfo.advance(i65.Normals), this._ensureBindParametersSSR(), this._ssaoHelper.computeSSAO(this._bindParameters, i66.linearDepthTexture, i66.normalTexture), this.performanceInfo.advance(i65.SSAO), this._renderContext.pass = A12.MATERIAL, i66.bindFramebuffer(), this._renderOpaqueGeometry(), this.performanceInfo.advance(i65.Opaque);
    const o61 = this._multipassTerrain && this._transparentTerrain;
    this._renderTerrainLinearDepth(o61), this._setMultipassEnabled(o61), this._setTerrainCulling(o61), this._renderEdges(A15.OPAQUE), this.performanceInfo.advance(i65.OpaqueEdges), this._offscreenRendering.bindTarget(this._offscreenRendering.currentColorTarget, this._offscreenRendering.mainDepth), this._renderSlot(E9.VOXEL), this._renderHiddenTransparentEdges();
    const _30 = this._needsTransparentPass || this._renderPlugins.needsTransparentPass;
    _30 && (this._oitEnabled ? this._renderOrderIndependentTransparency(() => this._renderTransparentGeometry(), false) : this._renderTransparentGeometry()), this.performanceInfo.advance(i65.Transparent), this._renderGeometryLinearDepth(o61);
    const l48 = this._renderHUDVisibility();
    o61 || this._renderInternalSlot(E9.LINE_CALLOUTS), this.performanceInfo.advance(i65.Hudvisibility), this._renderEdges(A15.TRANSPARENT, o61), this.performanceInfo.advance(i65.TransparentEdges), this._renderTransparentTerrain(), this._transparentTerrain && l48 && (o61 ? this._renderLineCallouts(c18.Occluded) : i66.compositeTransparentTerrainOntoHUDVisibility(this._bindParameters), this._renderHUD(c18.Occluded, i66.framebuffer), this.performanceInfo.advance(i65.HudOccluded)), this.performanceInfo.advance(i65.TransparentTerrain), this._setTerrainCulling(false), this._transparentTerrain && (i66.compositeTransparentTerrainOntoMain(this._bindParameters), o61 && (this._renderEdges(A15.OPAQUE), this.performanceInfo.advance(i65.OpaqueEdges), _30 && (this._oitEnabled ? this._renderOrderIndependentTransparency(() => this._renderTransparentGeometry(), false) : this._renderTransparentGeometry()), this.performanceInfo.advance(i65.Transparent), this._renderEdges(A15.TRANSPARENT), this.performanceInfo.advance(i65.TransparentEdges))), o61 && this._renderLineCallouts(c18.NotOccluded), this._setMultipassEnabled(false), this._shadowAccumulator.render(this._bindParameters), i66.renderToTargets(() => {
      this._renderInternalSlot(E9.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL), this._renderSlot(E9.POSTPROCESSING_ENVIRONMENT_TRANSPARENT), this._renderSlot(E9.LASERLINES);
    }, i66.currentColorTarget, i66.mainDepth), this.performanceInfo.advance(i65.Atmosphere), this._renderPlugins.needsLaserlineWithContrastControl && i66.renderTmpAndCompositeToMain(() => this._renderSlot(E9.LASERLINES_CONTRAST_CONTROL), this._bindParameters, o30.PremultipliedAlpha), this.performanceInfo.advance(i65.Laserline), this._renderOccluded(), this.performanceInfo.advance(i65.Occluded);
    const c67 = s63 === D5.ON && this._magnifierHelper.enabled, p52 = c67 && t(e59) ? this._offscreenRendering.getFramebuffer(this._offscreenRendering.tmpColor, this._offscreenRendering.tmpDepth) : e59;
    this._rctx.bindFramebuffer(p52);
    const m40 = this._offscreenRendering.colorTexture;
    !this._renderAntiAliasing(this._antialiasing, m40) && r(m40) && this._compositingHelper.composite(this._bindParameters, m40, o30.None), this.performanceInfo.advance(i65.Antialiasing), this._renderHUD(c18.NotOccluded, p52), this.performanceInfo.advance(i65.HudNotoccluded), this._renderHighlights(p52, this._bindParameters), this.performanceInfo.advance(i65.Highlights), c67 && this._magnifierHelper.render(this._rctx, this._bindParameters), p52 !== e59 && (this._rctx.bindFramebuffer(e59), this._compositingHelper.composite(this._bindParameters, this._offscreenRendering.tmpColorTexture, o30.None)), this._disposeOITBuffers(), this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera), this._sliceHelper.plane = n73, this._isRendering = false, this.onPostRender && this.onPostRender(), this.performanceInfo.postrender();
  }
  finish(e59) {
    if (this._hasAnimations || (this._animationTimestep = n3(0)), e59 === t12.BACKGROUND) {
      this._rctx.gl.getError();
      const e60 = this.performanceInfo.elapsedTime / e54;
      this._animationTimestep = n3(Math.max(this._animationTimestep * oe9 + e60 * (1 - oe9), r56));
    }
  }
  readDepthPixels(e59, r59, t60) {
    const s63 = this._offscreenRendering.bindTarget(this._offscreenRendering.linearDepth, this._offscreenRendering.tmpDepth);
    if (!this._needsLinearDepth) {
      this._ensureBindParameters(e59, e59), this._bindParameters.camera.setGLViewport(this._rctx), this._rctx.setClearColor(0, 0, 0, 0);
      const r60 = _2.COLOR_BUFFER_BIT | _2.DEPTH_BUFFER_BIT | _2.STENCIL_BUFFER_BIT;
      this._rctx.clearSafe(r60), this._renderGeometryAndTransparentTerrainPass(A12.MATERIAL_DEPTH);
    }
    s63.readPixels(r59[0], r59[1], r59[2], r59[3], P3.RGBA, G4.UNSIGNED_BYTE, t60);
  }
  readHUDVisibility(e59, r59, t60, s63, i66) {
    this._offscreenRendering.bindTarget(this._offscreenRendering.hudVisibility).readPixels(e59, r59, t60, s63, P3.RGBA, G4.UNSIGNED_BYTE, i66);
  }
  readAccumulatedShadow(e59, r59) {
    return this._shadowAccumulator.readAccumulatedShadow(e59, r59);
  }
  _setMultipassEnabled(e59) {
    this._bindParameters.multipassTerrain.enabled = this._bindParameters.multipassGeometry.enabled = e59;
  }
  _setTerrainCulling(e59) {
    this._bindParameters.multipassTerrain.cullAboveGround = e59;
  }
  _renderSlot(e59) {
    this._bindParameters.slot = e59, this._renderPlugins.render();
  }
  _renderEdges(e59, r59 = false) {
    const t60 = this._edgeView;
    r(t60) && t60.shouldRender() && this._offscreenRendering.renderTmpAndCompositeToMain(() => t60.render(this._bindParameters, e59), this._bindParameters, o30.Alpha, r59);
  }
  _renderShadowMap(e59, r59, t60, s63) {
    const i66 = this._shadowMap;
    i66.enabled && (i66.start(r59, t60, s63), this._shadowHighlight.updateParameters(r59, t60), this.needsShadowHighlight ? (this._renderShadowCascades(A12.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT, this._shadowMap, (e60) => i66.takeCascadeSnapshotTo(e60, J4.Highlight)), i66.clear(), this._renderShadowCascades(A12.MATERIAL_DEPTH_SHADOWMAP_DEFAULT, this._shadowMap, (e60) => {
      i66.takeCascadeSnapshotTo(e60, J4.Default), this._renderGeometryAndTransparentTerrainPass(A12.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT);
    })) : this._renderShadowCascades(A12.MATERIAL_DEPTH_SHADOWMAP_ALL), i66.finish(e59), r59.setGLViewport(this._rctx));
  }
  _renderShadowCascades(e59, r59 = this._shadowMap, t60 = (e60) => {
  }) {
    for (const s63 of r59.getCascades())
      s63.camera.setGLViewport(this._rctx), this._ensureCameraBindParameters(s63.camera, s63.camera), this._renderGeometryAndTransparentTerrainPass(e59), t60(s63);
  }
  get _needsLinearDepth() {
    return this._ssaoHelper.enabled || this._renderPlugins.needsLinearDepth || this._hasWater && this._waterReflectionEnabled || this.needsShadowHighlight || this.needsShadowCast;
  }
  _renderLinearDepth() {
    this._needsLinearDepth ? this._offscreenRendering.renderToTargets(() => this._renderGeometryAndTransparentTerrainPass(A12.MATERIAL_DEPTH), this._offscreenRendering.linearDepth, this._offscreenRendering.tmpDepth, [0, 0, 0, 0], true, true) : this._offscreenRendering.disposeTarget(this._offscreenRendering.linearDepth), this._bindParameters.linearDepthTexture = this._offscreenRendering.linearDepthTexture;
  }
  _renderTerrainLinearDepth(e59) {
    if (e59) {
      const e60 = this._renderContext.pass;
      this._renderContext.pass = A12.MATERIAL_DEPTH, this._offscreenRendering.renderToTargets(() => this._renderTransparentTerrain(), this._offscreenRendering.terrainLinearDepth, this._offscreenRendering.tmpDepth, [-1e10, -1e10, -1e10, 1], true, true), this._renderContext.pass = e60;
    } else
      this._offscreenRendering.disposeTarget(this._offscreenRendering.terrainLinearDepth);
    this._bindParameters.multipassTerrain.linearDepthTexture = this._offscreenRendering.terrainLinearDepthTexture;
  }
  _renderGeometryLinearDepth(e59) {
    if (e59) {
      const e60 = this._renderContext.pass;
      this._offscreenRendering.renderToTargets(() => this._renderGeometryPass(A12.MATERIAL_DEPTH), this._offscreenRendering.geometryLinearDepth, this._offscreenRendering.tmpDepth, [1, 1, 1, 1], true, true), this._renderContext.pass = e60;
    } else
      this._offscreenRendering.disposeTarget(this._offscreenRendering.geometryLinearDepth);
    this._bindParameters.multipassGeometry.linearDepthTexture = this._offscreenRendering.geometryLinearDepthTexture;
  }
  get needsNormal() {
    return this._ssaoHelper.enabled;
  }
  _renderNormal() {
    this.needsNormal ? this._offscreenRendering.renderToTargets(() => {
      this._renderGeometryAndTransparentTerrainPass(A12.MATERIAL_NORMAL);
    }, this._offscreenRendering.normal, this._offscreenRendering.tmpDepth, [0, 0, 0, 0], true, true) : this._offscreenRendering.disposeTarget(this._offscreenRendering.normal);
  }
  get needsDepthRange() {
    return this._shadowMap.enabled || this.needsShadowCast;
  }
  _computeDepthRange(e59) {
    if (!this.needsDepthRange)
      return f33;
    const r59 = M20(e59, this._content, this._stage.layers);
    return t57(r59, this.renderPlugins.queryDepthRange(e59)), r59.near = Math.max(e59.near, r59.near), r59.far = Math.min(e59.far, r59.far), r59;
  }
  _renderGeometryAndTransparentTerrainPass(e59) {
    this._renderContext.pass = e59, this._renderGeometryPass(e59), this._renderTransparentTerrain();
  }
  _renderGeometryPass(e59) {
    this._renderContext.pass = e59, this._renderOpaqueGeometry(), this._renderTransparentGeometry();
  }
  _renderOpaqueGeometry() {
    this._renderSlot(E9.INTEGRATED_MESH), this._renderSlot(E9.OPAQUE_TERRAIN), this._renderInternalSlot(E9.OPAQUE_MATERIAL), this._renderSlot(E9.OPAQUE_MATERIAL), this._renderSlot(E9.POSTPROCESSING_ENVIRONMENT_OPAQUE);
  }
  _renderTransparentGeometry() {
    this._renderInternalSlot(E9.TRANSPARENT_MATERIAL), this._renderSlot(E9.TRANSPARENT_MATERIAL);
  }
  _renderTransparentTerrain() {
    this._renderSlot(E9.TRANSPARENT_TERRAIN);
  }
  _renderHUDVisibility() {
    let e59 = false;
    return this._renderContext.offscreenRenderingHelper && this._renderContext.offscreenRenderingHelper.renderHUDVisibility(() => {
      this._bindParameters.hudVisibilityTexture = this._renderContext.offscreenRenderingHelper.hudVisibilityTexture, e59 = this._renderInternalSlot(E9.OCCLUSION_PIXELS);
    }, this._multipassTerrain && this._transparentTerrain), e59;
  }
  _renderLineCallouts(e59) {
    this._bindParameters.renderTransparentlyOccludedHUD = e59, e59 === c18.Occluded ? this._offscreenRendering.renderToTargets(() => this._renderInternalSlot(E9.LINE_CALLOUTS), this._offscreenRendering.currentColorTarget, this._offscreenRendering.tmpDepth, void 0, true, true) : this._renderInternalSlot(E9.LINE_CALLOUTS);
  }
  _renderHUD(e59, r59) {
    this._hasHUDElements && (this._oitEnabled ? (this._renderOrderIndependentTransparency(() => this._renderHUDElements(e59), true), this._rctx.bindFramebuffer(r59), this._compositingHelper.composite(this._bindParameters, this._offscreenRendering.hudColorTexture, o30.PremultipliedAlpha)) : e59 === c18.Occluded ? this._offscreenRendering.renderToTargets(() => this._renderHUDElements(c18.Occluded), this._offscreenRendering.currentColorTarget, this._offscreenRendering.tmpDepth, void 0, true, true) : this._renderHUDElements(e59));
  }
  _renderHUDElements(e59) {
    this._bindParameters.renderTransparentlyOccludedHUD = e59, this._renderInternalSlot(E9.LINE_CALLOUTS_HUD_DEPTH), this._renderInternalSlot(E9.HUD_MATERIAL), this._renderInternalSlot(E9.LABEL_MATERIAL);
  }
  get needsHighlight() {
    return this._hasHighlights || this._renderPlugins.needsHighlight;
  }
  get needsShadowHighlight() {
    return this._shadowMap.enabled && this._shadowHighlight.isVisible && this.needsHighlight;
  }
  _renderHighlights(e59, r59) {
    if (!this.needsHighlight)
      return void this._offscreenRendering.disposeTarget(this._offscreenRendering.highlight);
    const t60 = this._highlight, s63 = this._offscreenRendering.renderToTargets(() => {
      this._renderGeometryAndTransparentTerrainPass(A12.MATERIAL_HIGHLIGHT), this._rctx.clearSafe(_2.DEPTH_BUFFER_BIT), this._renderHUDElements(c18.Both);
    }, this._offscreenRendering.highlight, this._offscreenRendering.tmpDepth, [0, 0, 0, 0], true, true);
    this._bindParameters.highlightColorTexture = s63.colorTexture, this.needsShadowHighlight && this._shadowHighlight.render(r59, e59), t60.render(this._bindParameters, s63, e59);
  }
  get needsShadowCast() {
    return this._shadowAccumulator.isAccumulating;
  }
  _accumulateShadows(e59, r59, t60) {
    this.needsShadowCast && this._shadowAccumulator.renderAccumulation(this._offscreenRendering.linearDepthTexture, e59, r59, t60);
  }
  _renderOrderIndependentTransparency(e59, r59) {
    const t60 = (t61) => {
      this._bindParameters.transparencyPassType = t61, this._offscreenRendering.renderOITPass(() => e59(), t61, r59);
    }, s63 = this._renderContext.pass;
    this._renderContext.pass = A12.MATERIAL_ALPHA, t60(O4.Alpha), this._renderContext.pass = A12.MATERIAL, t60(O4.Color), t60(O4.FrontFace), this._offscreenRendering.compositeTransparentOntoOpaque(this._bindParameters, r59), this._bindParameters.transparencyPassType = O4.NONE, this._renderContext.pass = s63, this._oitUsed = true;
  }
  _disposeOITBuffers() {
    this._oitUsed || (this._offscreenRendering.disposeTarget(this._offscreenRendering.alphaFloatTarget), this._offscreenRendering.disposeTarget(this._offscreenRendering.colorFloatTarget), this._offscreenRendering.disposeTarget(this._offscreenRendering.frontFaceTarget)), this._oitUsed = false;
  }
  _renderOccluded() {
    let e59 = 0;
    this._materialRenderers.forEach((r60, t61) => {
      t61 && t61.isVisible() && t61.renderOccluded === h10.OccludeAndTransparentStencil && (e59 |= t61.renderOccluded, pe7.push(t61));
    });
    const r59 = this._offscreenRendering, t60 = (t61, s64, i67, n73, a58) => {
      0 != (e59 & s64) && (r59.renderToTargets(i67, r59.tmpColor, r59.mainDepth, [0, 0, 0, 0], n73, a58), r59.compositeOccludedOntoMain(this._bindParameters, t61));
    };
    0 !== pe7.length && (this._renderInternalSlot(E9.OCCLUDER_MATERIAL, pe7), t60(0.5, h10.OccludeAndTransparentStencil, () => this._renderInternalSlot(E9.TRANSPARENT_OCCLUDER_MATERIAL, pe7), false, false), pe7.length = 0), this._materialRenderers.forEach((r60, t61) => {
      t61 && t61.isVisible() && (t61.renderOccluded === h10.OccludeAndTransparent || t61.renderOccluded === h10.Transparent || t61.renderOccluded === h10.Opaque) && (e59 |= t61.renderOccluded, ce9.push(t61));
    });
    const s63 = this._renderPlugins.renderOccludedFlags;
    if (e59 |= s63, !e59)
      return;
    const i66 = (e60) => {
      this._renderContext.renderOccludedMask = e60, s63 > h10.Occlude && this._renderSlot(E9.OCCLUDED_TERRAIN), this._renderInternalSlot(E9.OPAQUE_MATERIAL, ce9), this._renderInternalSlot(E9.TRANSPARENT_MATERIAL, ce9), this._renderInternalSlot(E9.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL, ce9), this._renderContext.resetRenderOccludedMask();
    };
    this._renderContext.pass = A12.MATERIAL, t60(0.5, h10.OccludeAndTransparent, () => i66(h10.OccludeAndTransparent), true, a13.OutlineVisualElementMask), t60(0.5, h10.Transparent, () => i66(h10.Transparent), true, a13.OutlineVisualElementMask), t60(1, h10.Opaque, () => i66(h10.Opaque), true, a13.OutlineVisualElementMask), ce9.length = 0;
  }
  _renderAntiAliasing(e59, r59) {
    if (e59 === e15.SMAA) {
      if (this._smaaPass.enable(() => this._requestRender()) && r(r59))
        return this._smaaPass.render(r59), true;
    } else
      this._smaaPass.disable();
    return false;
  }
  _ensureCameraBindParameters(e59, r59) {
    this._bindParameters.camera = e59, this._bindParameters.contentCamera = r59;
  }
  _ensureBindParameters(e59, r59) {
    this._ensureCameraBindParameters(e59, r59);
    const t60 = this._renderContext.offscreenRenderingHelper;
    this._bindParameters.hudVisibilityTexture = t60.hudVisibilityTexture, this._bindParameters.highlightDepthTexture = t60.depthTexture ?? this._getFallbackDepthTexture();
  }
  _ensureBindParametersSSR() {
    this.hasWaterReflection ? (this._renderContext.lastFrameCamera.equals(this._bindParameters.camera) ? this._reprojectionMatrix = o9 : (h4(ge7, this._bindParameters.camera.viewMatrix), h4(me7, this._bindParameters.camera.projectionMatrix), u5(ue7, ge7, me7), u5(ue7, this._renderContext.lastFrameCamera.viewMatrix, ue7), u5(ue7, this._renderContext.lastFrameCamera.projectionMatrix, ue7), this._reprojectionMatrix = ue7), this._bindParameters.ssr.lastFrameColorTexture = this._offscreenRendering.lastFrameColorTexture) : this._bindParameters.ssr.lastFrameColorTexture = null, this._bindParameters.ssr.enabled = this.hasWaterReflection;
  }
  _renderInternalSlot(e59, r59) {
    let t60 = false;
    return this._bindParameters.slot = e59, r(r59) ? r59.forEach((e60) => {
      if (!e60.shouldRender(this._renderContext))
        return;
      const r60 = this._materialRenderers.get(e60);
      r(r60) && (t60 = r60.render(this._renderContext.pass, this._bindParameters) || t60);
    }) : this._materialRenderers.forEach((e60, r60) => {
      r60.shouldRender(this._renderContext) && e60.render(this._renderContext.pass, this._bindParameters) && (t60 = true);
    }), t60;
  }
  _getFallbackDepthTexture() {
    return this._fallbackDepthStencilTexture || (this._fallbackDepthStencilTexture = p15(this._rctx)), this._fallbackDepthStencilTexture;
  }
  get gpuMemoryUsage() {
    var _a, _b, _c, _d, _e4;
    return { offscreen: ((_a = this._offscreenRendering) == null ? void 0 : _a.gpuMemoryUsage) ?? 0, highlights: (((_b = this._highlight) == null ? void 0 : _b.gpuMemoryUsage) ?? 0) + (((_c = this._shadowHighlight) == null ? void 0 : _c.gpuMemoryUsage) ?? 0), shadows: ((_d = this._shadowMap) == null ? void 0 : _d.gpuMemoryUsage) ?? 0, ssao: ((_e4 = this._ssaoHelper) == null ? void 0 : _e4.gpuMemoryUsage) ?? 0 };
  }
  get test() {
    const e59 = this;
    return { offscreen: this._offscreenRendering, shadowMap: this._shadowMap, ssao: this._ssaoHelper, highlight: this._highlight, lighting: this._bindParameters.lighting, materialRenderers: this._materialRenderers, shadowAccumulator: this._shadowAccumulator, getFramebufferTexture: (r59) => {
      switch (r59) {
        case le7.Color:
          return e59._offscreenRendering.colorTexture;
        case le7.LinearDepth:
          return e59._offscreenRendering.linearDepthTexture;
        case le7.Normals:
          return e59._offscreenRendering.normalTexture;
        case le7.ShadowMap:
          return e59._shadowMap.depthTexture;
        case le7.HudVisibility:
          return e59._offscreenRendering.hudVisibilityTexture;
        case le7.Highlight:
          return e59._offscreenRendering.highlightTexture;
      }
    } };
  }
};
var le7;
e([d()], _e3.prototype, "_shadowAccumulator", void 0), e([d()], _e3.prototype, "_smaaPass", void 0), e([d()], _e3.prototype, "_antialiasing", void 0), e([d()], _e3.prototype, "_edgeView", void 0), e([d()], _e3.prototype, "updating", null), e([d()], _e3.prototype, "isCameraFinal", null), _e3 = e([n6("esri.views.3d.webgl-engine.lib.Renderer")], _e3), function(e59) {
  e59[e59.Color = 0] = "Color", e59[e59.LinearDepth = 1] = "LinearDepth", e59[e59.Normals = 2] = "Normals", e59[e59.ShadowMap = 3] = "ShadowMap", e59[e59.HudVisibility = 4] = "HudVisibility", e59[e59.Highlight = 5] = "Highlight";
}(le7 || (le7 = {}));
var ce9 = [];
var pe7 = [];
var me7 = e12();
var ge7 = e12();
var ue7 = e12();

// node_modules/@arcgis/core/views/3d/webgl-engine/lib/RenderingContext.js
var r58 = class extends y5 {
  constructor(e59, t60, r59) {
    super(e59, t60), this.newCache = r59, this._refCount = 1;
  }
  dispose() {
    --this._refCount > 0 || super.dispose();
  }
  ref() {
    ++this._refCount;
  }
  bindTechnique(t60, r59, s63, n73) {
    this.useProgram(t60.program);
    const o61 = r(s63) ? s63.slot : null;
    return t60.bindPipelineState(this, o61, n73), r(r59) && r(s63) && t60.bindPass(r59, s63), t60.program;
  }
  get test() {
    return this.programCache.test;
  }
};

// node_modules/@arcgis/core/views/3d/webgl-engine/lib/TextureRepository.js
var g42 = s3.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository");
var T28 = class extends y {
  constructor(e59, t60, s63) {
    super({}), this._stage = e59, this._techniqueRepository = t60, this._rctx = s63, this._textures = /* @__PURE__ */ new Map(), this._loadingCount = 0, this._frameUpdates = /* @__PURE__ */ new Map(), this.events = new n8(), this._frameTask = e59.resourceController.scheduler.registerTask(L3.TEXTURE_UNLOAD);
  }
  normalizeCtorArgs() {
    return {};
  }
  dispose() {
    this._frameTask.remove(), this._stage.forEachOfType(e17.Texture, (e59) => e59.unload());
  }
  get updating() {
    return this._loadingCount > 0 || this._frameTask.updating;
  }
  get textureTechnique() {
    return t(this._textureTechnique) && (this._textureTechnique = this._techniqueRepository.acquire(m11, new r33())), this._textureTechnique;
  }
  acquire(e59) {
    const t60 = this._textures.get(e59);
    return t60 ? (t60.ref(), c(t60.loadingPromise, t60)) : this._createNewRef(e59);
  }
  update() {
    let e59 = false;
    this._frameUpdates.forEach((t60) => {
      const r59 = t60.texture.frameUpdate(this._rctx, this.textureTechnique, t60.previousToken);
      r59 >= 0 && r59 !== t60.previousToken && (t60.previousToken = r59, e59 = true);
    }), e59 && this.events.emit("changed", t12.BACKGROUND);
  }
  _createNewRef(e59) {
    const t60 = this._stage.getObject(e59);
    if (t(t60))
      return e16(void 0 !== t60), null;
    const r59 = t60.events.on("unloaded", () => {
      r59.remove(), this._onTextureUnloaded(e59);
    }), s63 = new x29(e59, () => {
      this._frameTask.schedule(() => {
        s63.isUnreferenced && t60.unload();
      });
    });
    return this._textures.set(e59, s63), s63.ref(), r(t60.glTexture) ? (this._updateGLTexture(s63, t60.glTexture), t60.requiresFrameUpdates && this._frameUpdates.set(e59, { texture: t60, previousToken: -1 }), s63) : (this._loadingCount++, s63.loadingPromise = this._stage.schedule(() => {
      const r60 = t60.load(this._rctx, () => this.textureTechnique), o61 = (r61) => (this._loadingCount--, s63.loadingPromise = null, this._updateGLTexture(s63, r61), t60.requiresFrameUpdates && this._frameUpdates.set(e59, { texture: t60, previousToken: -1 }), s63), i66 = (e60) => (this._loadingCount--, s63.loadingPromise = null, g(e60) || g42.error(e60), null);
      return k(r60) ? r60.then(o61, i66) : o61(r60);
    }), s63.loadingPromise);
  }
  _updateGLTexture(e59, t60) {
    e59.glTexture = t60, this.events.emit("changed", t12.UPDATE);
  }
  _onTextureUnloaded(e59) {
    this._textures.delete(e59), this._frameUpdates.delete(e59);
  }
};
e([d()], T28.prototype, "_loadingCount", void 0), e([d()], T28.prototype, "_frameTask", void 0), e([d()], T28.prototype, "updating", null), T28 = e([n6("esri.views.3d.webgl-engine.lib.TextureRepository")], T28);
var x29 = class {
  constructor(e59, t60) {
    this.id = e59, this._release = t60, this._refCount = 0;
  }
  get isUnreferenced() {
    return 0 === this._refCount;
  }
  ref() {
    ++this._refCount;
  }
  release() {
    --this._refCount, this._refCount > 0 || (0 !== this._refCount ? (g42.error("Cannot dereference texture that has no references!"), this._refCount = 0) : this._release());
  }
};

// node_modules/@arcgis/core/views/3d/webgl-engine/materials/internal/WaterTextureRepository.js
var u50 = s3.getLogger("esri.views.3d.webgl-engine.materials.internal.waterMaterialUtils");
var g43 = class extends y {
  constructor() {
    super(...arguments), this._data = new Array(), this._state = i6.NOT_LOADED;
  }
  dispose() {
    this._state = i6.NOT_LOADED, this._data.forEach((t60) => t60.dispose()), this._data.length = 0;
  }
  get updating() {
    return this._state === i6.LOADING;
  }
  get resourceState() {
    return this._state;
  }
  loadTextures(t60) {
    const r59 = [a6("esri/images/materials/water/normals.jpg"), a6("esri/images/materials/water/perturbation.jpg")];
    this._state = i6.LOADING, Promise.all(r59.map((t61) => t11(t61))).then((e59) => {
      e59.forEach((e60) => this._data.push(new u10(t60, { target: M6.TEXTURE_2D, pixelFormat: P3.RGBA, dataType: G4.UNSIGNED_BYTE, wrapMode: D4.REPEAT, samplingMode: L4.LINEAR_MIPMAP_LINEAR, hasMipmap: true, maxAnisotropy: 8, width: e60.width, height: e60.height }, e60))), this._state = i6.LOADED;
    }).catch((t61) => {
      u50.error("Failed to load textures for water material.", t61), this._state = i6.NOT_LOADED;
    });
  }
  bind(t60) {
    this._state === i6.LOADED && (t60.bindTexture("texWaveNormal", this._data[0]), t60.bindTexture("texWavePerturbation", this._data[1]));
  }
};
e([d()], g43.prototype, "_state", void 0), e([d({ type: Boolean, readOnly: true })], g43.prototype, "updating", null), g43 = e([n6("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")], g43);

// node_modules/@arcgis/core/views/3d/webgl-engine/parts/contextCache.js
var n72 = /* @__PURE__ */ new Map();
function t59() {
  return n72;
}

// node_modules/@arcgis/core/views/3d/webgl-engine/parts/ScreenshotManager.js
var g44 = class extends e26 {
  constructor(e59, t60, r59, s63, i66, o61) {
    super(), this._rctx = e59, this._renderScene = t60, this._requestRenderScene = r59, this._renderOverlay = s63, this._forceCameraHook = i66, this._disposeOffscreenBuffers = o61, this.supersample = true, this._screenshotQueue = new Array();
  }
  dispose() {
    this._rctx = null;
  }
  takeScreenshot(e59) {
    this._requestRenderScene(t12.BACKGROUND);
    const t60 = D();
    return this._screenshotQueue.push({ settings: e59, resolver: t60 }), t60.promise;
  }
  update(e59) {
    for (const t60 of this._screenshotQueue) {
      if (this.isDisposed) {
        t60.resolver.reject();
        continue;
      }
      const r59 = { ...t60.settings, pixelRatio: t60.settings.pixelRatio * e59.viewCamera.pixelRatio }, s63 = this._renderScreenshot(e59, r59);
      t60.resolver(s63);
    }
    this._screenshotQueue.length = 0;
  }
  _renderScreenshotOverlay(t60, r59, s63) {
    if (t(this._renderOverlay))
      return r59;
    t60.width = r59.width, t60.height = r59.height;
    const i66 = t60.getContext("2d"), o61 = s63.pixelRatio;
    return i66.save(), i66.translate(0, r59.height), i66.scale(1, -1), s63.region && i66.translate(-s63.region.x, -s63.region.y), i66.scale(o61, o61), r59 = this._renderOverlay(t60, r59), i66.restore(), r59;
  }
  _readbackScreenshot(e59, t60) {
    return e59.resample ? this._readbackScreenshotResampled(e59, t60) : this._readbackScreenshotImmediate(e59, t60);
  }
  _readbackScreenshotResampled(e59, t60) {
    const { framebufferWidth: r59, framebufferHeight: s63, region: i66, resample: o61 } = e59, n73 = this._ensureScreenshotEncodeCanvas();
    let d32 = m8(r59, s63, n73);
    this._rctx.gl.readPixels(0, 0, r59, s63, P3.RGBA, C2.UNSIGNED_BYTE, new Uint8Array(d32.data.buffer)), t60(), d32 = this._renderScreenshotOverlay(n73, d32, { ...e59, region: null });
    const f37 = m8(i66.width, i66.height, n73);
    return p14(d32, f37, true, o61.region.x, s63 - (o61.region.y + o61.region.height), o61.region.width, o61.region.height);
  }
  _readbackScreenshotImmediate(e59, t60) {
    const { framebufferHeight: r59, region: s63 } = e59, i66 = this._ensureScreenshotEncodeCanvas(), o61 = m8(s63.width, s63.height, i66);
    return this._rctx.gl.readPixels(s63.x, r59 - (s63.y + s63.height), s63.width, s63.height, P3.RGBA, C2.UNSIGNED_BYTE, new Uint8Array(o61.data.buffer)), t60(), this._renderScreenshotOverlay(i66, o61, e59);
  }
  _renderScreenshot(e59, r59) {
    let i66 = null;
    const o61 = e59.viewCamera, { framebufferWidth: a58, framebufferHeight: h44 } = r59;
    let c67 = false;
    const l48 = r59.disableDecorations && e59.frameHasDecorations, g45 = a58 !== o61.fullWidth || h44 !== o61.fullHeight, _30 = r59.ignorePadding && o61.pixelRatio !== r59.pixelRatio, m40 = g45 || l48 || _30;
    if (m40) {
      const e60 = o61.clone();
      if (r59.ignorePadding) {
        const t61 = t7(e60.padding);
        for (let s63 = 0; s63 < 4; s63++)
          t61[s63] = Math.round(t61[s63] / e60.pixelRatio * r59.pixelRatio);
        e60.padding = t61;
      }
      e60.fullWidth = a58, e60.fullHeight = h44, e60.pixelRatio = r59.pixelRatio;
      const t60 = o61.fovX - e60.fovX, l49 = o61.fovY - e60.fovY;
      t60 < 0 && t60 < l49 ? e60.fovX = o61.fovX : l49 < 0 && l49 < t60 && (e60.fovY = o61.fovY), this._forceCameraHook(e60), c67 = true, i66 = new D6(this._rctx, { width: e60.fullWidth, height: e60.fullHeight, colorTarget: Y.TEXTURE, depthStencilTarget: V2.DEPTH_STENCIL_RENDER_BUFFER }), this._renderScene(i66, e60, r59.disableDecorations ? D5.OFF : D5.ON), this._disposeOffscreenBuffers();
    }
    const p52 = () => {
      this._rctx.bindFramebuffer(null), s(i66);
    }, v36 = this._readbackScreenshot(r59, p52);
    if (p52(), m40 && !this._rctx.contextAttributes.alpha)
      for (let t60 = 3; t60 < v36.data.length; t60 += 4)
        v36.data[t60] = 255;
    return c67 && this._forceCameraHook(o61), v36;
  }
  _ensureScreenshotEncodeCanvas() {
    return this._screenshotEncodeCanvas || (this._screenshotEncodeCanvas = document.createElement("canvas")), this._screenshotEncodeCanvas;
  }
};

// node_modules/@arcgis/core/views/3d/webgl-engine/parts/testUtils.js
var o60 = { enabled: false, disposeContextCache: () => {
  const o61 = t59();
  o61.forEach((e59) => e59.dispose()), o61.clear();
} };

// node_modules/@arcgis/core/views/3d/webgl-engine/parts/RenderView.js
var B17 = s3.getLogger("esri.views.3d.webgl-engine.parts.View");
var E38 = class extends s23(y) {
  constructor(e59) {
    super({}), this.events = new n8(), this.waterTextureRepository = new g43(), this._magnifierHelper = new N20(), this._needsUpdate = true, this._needsRender = true, this._idleSuspend = true, this._needsWaterReflectionUpdate = false, this._lastAnimationUpdate = 0, this._container = e59.container, this._viewingMode = e59.viewingMode, this._initializeContext(e59), l6(() => {
      var _a;
      return (_a = this.waterTextureRepository) == null ? void 0 : _a.updating;
    }, () => this.requestRender(), h3), this._magnifierHelper.events.on("request-render", () => this.requestRender()), this._stippleTextureRepository = new c22(this._rctx), this._shaderTechniqueRepository = new s22({ rctx: this._rctx, viewingMode: e59.viewingMode, stippleTextureRepository: this._stippleTextureRepository, waterTextureRepository: this.waterTextureRepository }), this._textureRepository = new T28(e59, this._shaderTechniqueRepository, this._rctx), this._textureRepository.events.on("changed", (e60) => this.requestRender(e60)), this._materialRepository = new l18(this._textureRepository, this._shaderTechniqueRepository, () => this.requestRender(), () => this.requestRender()), this._compositingHelper = new _28(this._rctx, this._shaderTechniqueRepository), this._renderer = new _e3(this._materialRepository, this._textureRepository, this._shaderTechniqueRepository, this._rctx, this._compositingHelper, this._magnifierHelper, (e60) => this.requestRender(e60), (t60, r59) => e59.schedule(t60, r59), e59), this._screenshotManager = new g44(this._rctx, (e60, t60, r59) => this._renderer.render(e60, t60, t60, r59), (e60) => this.requestRender(e60), e59.options.screenshot.renderOverlay, (e60) => this.events.emit("force-camera-for-screenshot", e60), () => this._renderer.disposeOffscreenBuffers()), this._registerFrameTask(e59);
  }
  normalizeCtorArgs() {
    return {};
  }
  dispose() {
    this._container.contains(this._canvas) && this._container.removeChild(this._canvas), this._frameTask = a2(this._frameTask), this._shaderTechniqueRepository = s(this._shaderTechniqueRepository), super.dispose(), this._tmpDepthBuffer = null, this._rctx = null;
  }
  get performanceInfo() {
    const e59 = this._rctx.gl;
    return { renderer: this._renderer.performanceInfo, textureMemory: void 0 !== e59.getUsedTextureMemory ? e59.getUsedTextureMemory() : void 0, renderbufferMemory: void 0 !== e59.getUsedRenderbufferMemory ? e59.getUsedRenderbufferMemory() : void 0, VBOMemory: void 0 !== e59.getUsedVBOMemory ? e59.getUsedVBOMemory() : void 0 };
  }
  requestRender(e59 = t12.UPDATE) {
    e59 === t12.UPDATE ? this._needsUpdate = true : this._needsRender = true;
  }
  get updating() {
    return this._needsUpdate || this._needsWaterReflectionUpdate || this._renderer.updating || this._textureRepository.updating || this.waterTextureRepository.updating || this._magnifierHelper.updating;
  }
  ensureEdgeView() {
    return this._renderer.ensureEdgeView();
  }
  get edgeView() {
    return this._renderer.edgeView;
  }
  get textureRepository() {
    return this._textureRepository;
  }
  get compositingHelper() {
    return this._compositingHelper;
  }
  set magnifier(e59) {
    this._magnifierHelper.magnifier = e59;
  }
  updateLightSources(e59, t60, r59) {
    this._renderer.updateLightSources(e59, t60, r59), this.requestRender();
  }
  setRenderParameters(e59) {
    void 0 !== e59.idleSuspend && this._idleSuspend !== !!e59.idleSuspend && (this._idleSuspend = !!e59.idleSuspend, this.requestRender()), this._renderer.setRenderParameters(e59);
  }
  get renderingContext() {
    return this._rctx;
  }
  get capabilities() {
    return this._rctx.capabilities;
  }
  modify(e59) {
    this._renderer.modify(e59), e59.clear();
  }
  get canvas() {
    return this._canvas;
  }
  takeScreenshot(e59) {
    return this._screenshotManager.takeScreenshot(e59);
  }
  getAlpha() {
    return this._rctx.contextAttributes.alpha;
  }
  get shadowsEnabled() {
    return this._renderer.shadowsEnabled;
  }
  readAccumulatedShadow(e59) {
    return this._renderer.readAccumulatedShadow(e59[0], e59[1]);
  }
  readHUDVisibility(e59, t60, r59, i66, s63) {
    this._renderer.readHUDVisibility(e59, t60, r59, i66, s63);
  }
  getMinimalDepthForArea(e59, t60, r59, i66, s63, o61 = s63) {
    const n73 = i66.constrainWindowSize(t60, r59, s63 * i66.pixelRatio, o61 * i66.pixelRatio), p52 = this._ensureDepthBuffer(n73);
    this._renderer.readDepthPixels(i66, n73, p52);
    let d32 = Number.MAX_VALUE;
    for (let a58 = 0; a58 < n73[2] * n73[3]; a58++) {
      const e60 = A37(4 * a58, p52, i66.nearFar);
      d32 > e60 && e60 !== i66.nearFar[0] && e60 !== i66.nearFar[1] && (d32 = e60);
    }
    if (r(e59)) {
      const s64 = e59.pickDepth(t60 * i66.pixelRatio, r59 * i66.pixelRatio, i66);
      r(s64) && d32 > s64 && s64 !== i66.nearFar[0] && s64 !== i66.nearFar[1] && (d32 = s64);
    }
    return d32 === Number.MAX_VALUE ? void 0 : d32;
  }
  _ensureDepthBuffer(e59) {
    const t60 = 4 * e59[2] * e59[3];
    return (t(this._tmpDepthBuffer) || this._tmpDepthBuffer.byteLength < t60) && (this._tmpDepthBuffer = new Uint8Array(t60)), this._tmpDepthBuffer;
  }
  get renderPlugins() {
    return this._renderer.renderPlugins;
  }
  get test() {
    return { renderer: this._renderer };
  }
  get gpuMemoryUsage() {
    return this._renderer.gpuMemoryUsage;
  }
  async reloadShaders() {
    e45(), await this._shaderTechniqueRepository.reloadAll(), this.requestRender();
  }
  get animationTimestep() {
    return this._renderer.animationTimestep;
  }
  _registerFrameTask(e59) {
    const t60 = e59.state, r59 = { viewCamera: t60.camera, frameHasDecorations: false };
    let i66 = false, s63 = t12.BACKGROUND, o61 = false;
    const n73 = { preRender: (r60) => {
      i66 = this.updating, s63 = this._needsUpdate ? t12.UPDATE : t12.BACKGROUND, e59.processSyncLayers();
      const o62 = n3(r60.time - this._lastAnimationUpdate);
      (o62 > this.animationTimestep || r(this.forcedAnimationTime) || i66 || this._needsRender) && (this._renderer.updateAnimation({ camera: t60.camera, dt: o62, forcedTime: this.forcedAnimationTime }) && this.requestRender(t12.BACKGROUND), this._lastAnimationUpdate = r60.time);
    }, render: () => {
      if ((this._needsUpdate || this._needsRender || !this._idleSuspend || !this._renderer.isCameraFinal || this._needsWaterReflectionUpdate) && t60.camera.fullWidth > 0 && t60.camera.fullHeight > 0) {
        const e60 = this._needsUpdate && this._idleSuspend && this._renderer.isCameraFinal;
        this._needsRender = false, this._needsUpdate = false, this._needsWaterReflectionUpdate = false, this._renderer.render(null, t60.camera, t60.contentCamera, D5.ON), o61 = true, e60 && this._renderer.hasWaterReflection && (this.requestRender(t12.BACKGROUND), this._needsWaterReflectionUpdate = true);
      }
    }, update: () => {
      r59.viewCamera = t60.camera, r59.frameHasDecorations = this._renderer.hasSlicePlane || this._magnifierHelper.enabled, this._textureRepository.update(), this._screenshotManager.update(r59);
    }, finish: () => {
      o61 && (this._renderer.finish(s63), o61 = false);
    } };
    this._frameTask = A2(n73);
  }
  _initializeContext(e59) {
    const t60 = e59.options;
    this._canvas = t60.canvas, this._canvas || (this._canvas = document.createElement("canvas")), this._canvas.setAttribute("style", "width: 100%; height:100%; display:block;");
    const r59 = { alpha: t60.alpha || false, premultipliedAlpha: true, antialias: false, depth: true, stencil: null == t60.stencil || t60.stencil, powerPreference: "high-performance", preserveDrawingBuffer: t60.preserveDrawingBuffer ?? false }, s63 = n14("3d", this._canvas, r59);
    if (t(s63)) {
      const e60 = a("esri-force-webgl");
      B17.error(e60);
    } else
      this._rctx = this._newRenderingContext(s63, e59), this._loadShaderOnlyExtensions(), !t60.alpha && this._rctx.contextAttributes.alpha && B17.error("WebGL context has alpha channel even though no alpha channel was requested"), !this._rctx.contextAttributes.alpha && a("safari") >= 11 && (this._container.style.backgroundColor = "black"), this._container.appendChild(this._canvas);
  }
  _newRenderingContext(e59, t60) {
    const r59 = { disabledExtensions: t60.options.deactivatedWebGLExtensions || {}, debugWebGLExtensions: t60.options.debugWebGLExtensions || {}, maxAnisotropy: 8 }, i66 = (e60, r60) => t60.resourceController.memoryController.newCache(e60, r60);
    if (o60.enabled) {
      let t61 = L30.get(e59);
      return t61 ? (t61.configure(r59), t61.newCache = i66, t61.ref(), t61) : (t61 = new r58(e59, r59, i66), L30.set(e59, t61), t61.ref(), t61);
    }
    return new r58(e59, r59, i66);
  }
  _loadShaderOnlyExtensions() {
    this._rctx.capabilities.enable("standardDerivatives"), this._rctx.capabilities.enable("shaderTextureLOD"), this._rctx.capabilities.enable("textureFloat");
  }
  get componentObjectCollection() {
    return t(this._componentObjectCollection) && (this._componentObjectCollection = new Q14(this._renderer.renderPassManager, this._viewingMode)), this._componentObjectCollection;
  }
  set componentObjectCollection(e59) {
    this._componentObjectCollection = e59;
  }
};
e([d({ type: Boolean, readOnly: true })], E38.prototype, "updating", null), e([i22()], E38.prototype, "_rctx", void 0), e([i22()], E38.prototype, "_container", void 0), e([i22()], E38.prototype, "_canvas", void 0), e([i22()], E38.prototype, "_stippleTextureRepository", void 0), e([i22(), d()], E38.prototype, "waterTextureRepository", void 0), e([i22(), d()], E38.prototype, "_magnifierHelper", void 0), e([i22(), d()], E38.prototype, "_textureRepository", void 0), e([i22()], E38.prototype, "_compositingHelper", void 0), e([i22()], E38.prototype, "_renderer", void 0), e([i22()], E38.prototype, "_screenshotManager", void 0), e([i22()], E38.prototype, "componentObjectCollection", null), e([i22()], E38.prototype, "_componentObjectCollection", void 0), e([d()], E38.prototype, "_needsUpdate", void 0), e([d()], E38.prototype, "_needsWaterReflectionUpdate", void 0), E38 = e([n6("esri.views.3d.webgl-engine.parts.RenderView")], E38);
var L30 = t59();

// node_modules/@arcgis/core/views/3d/webgl-engine/Stage.js
var f36;
var w24 = f36 = class extends s23(y) {
  constructor(e59) {
    super(e59), this._handles = new u4(), this._model = new h42(), this._layers = new n2(), this._changeSet = new r31(), this._layerSyncSet = /* @__PURE__ */ new Set();
  }
  initialize() {
    this._set("renderView", new E38(this)), this._frameTask = this.resourceController.scheduler.registerTask(L3.STAGE, this), this._handles.add(this._frameTask);
  }
  destroy() {
    o27.pool.prune(0), this._handles.destroy(), this.dispose();
  }
  get viewingMode() {
    return this.state.viewingMode;
  }
  get updating() {
    return this._model.dirtySet.dirty || this.renderView.updating || this._frameTask.updating;
  }
  add(e59) {
    this._model.add(e59), y8(e59) && (e59.attachStage(this), this._addLayer(e59)), this.renderView.requestRender();
  }
  remove(e59) {
    t(e59) || (this.renderView.requestRender(), this._model.remove(e59), y8(e59) && (this._removeLayer(e59), e59.detachStage()));
  }
  addMany(e59) {
    r(e59) && (this._model.addMany(e59), this.renderView.requestRender());
  }
  removeMany(e59) {
    r(e59) && (this._model.removeMany(e59), this.renderView.requestRender());
  }
  async load(e59) {
    t(e59) || (Array.isArray(e59) || (e59 = [e59]), await Promise.all(e59.filter((e60) => t(e60.glTexture)).map((e60) => this.schedule(() => this._model.has(e60) ? e60.load(this.renderView.renderingContext, () => this.renderView.textureRepository.textureTechnique) : null))));
  }
  loadImmediate(e59) {
    return e59.load(this.renderView.renderingContext, () => this.renderView.textureRepository.textureTechnique);
  }
  forEachOfType(e59, t60) {
    this._model.forEachOfType(e59, t60);
  }
  handleEvent(e59, t60) {
    this.destroyed || (this._model.dirtySet[e59](t60), this.renderView.requestRender());
  }
  get running() {
    return this._model.dirtySet.dirty;
  }
  runTask(e59) {
    this._frameTask.processQueue(e59), e59.done || this._commit();
  }
  _commit() {
    const e59 = this._model.dirtySet;
    f36.DebugSettings.logDirtySet && console.log("Dirty set: " + e59.formatDebugInfo()), e59.commit(this._changeSet), f36.DebugSettings.logDirtySet && (console.log("RGs add: " + this._changeSet.adds.map((e60) => e60.id)), console.log("RGs remove: " + this._changeSet.removes.map((e60) => e60.id))), this._layerSyncSet.clear(), this.renderView.modify(this._changeSet), this.renderView.requestRender();
  }
  schedule(e59, t60) {
    return this._frameTask.schedule(e59, t60);
  }
  syncLayer(e59) {
    this._layerSyncSet.add(e59), this.renderView.requestRender();
  }
  processSyncLayers() {
    const e59 = this._model.dirtySet;
    this._layers.forAll((t60) => {
      (this._layerSyncSet.has(t60.id) || t60.updatePolicy === o16.SYNC) && (e59.commitLayer(t60.id, this._changeSet), this._layerSyncSet.delete(t60.id));
    });
    for (const t60 of this._layerSyncSet)
      e59.commitLayer(t60, this._changeSet);
    this._layerSyncSet.clear(), this.renderView.modify(this._changeSet);
  }
  getObject(e59) {
    return this._model.getObject(e59);
  }
  get layers() {
    return this._layers;
  }
  _addLayer(e59) {
    this._layers.includes(e59) || this._layers.push(e59);
  }
  _removeLayer(e59) {
    this._commit(), null != this._layers.removeUnordered(e59) && (this._model.dirtySet.getResidentRenderGeometries(e59.id, this._changeSet.removes), this.renderView.modify(this._changeSet));
  }
  addRenderPlugin(e59, t60, r59) {
    const s63 = this.renderView.renderPlugins.add(e59, t60, r59), o61 = () => {
      F14(t60) && this.sceneIntersectionHelper.addIntersectionHandler(t60);
    };
    if (k(s63))
      return s63.then(o61);
    o61();
  }
  removeRenderPlugin(e59) {
    F14(e59) && this.sceneIntersectionHelper.removeIntersectionHandler(e59), this.renderView.renderPlugins.remove(e59);
  }
  get performanceInfo() {
    return { renderView: this.renderView.performanceInfo, model: this._model.getStats() };
  }
  get test() {
    const e59 = this;
    return { getCount: (t60) => e59._model.test.content.filter((e60) => e60.type === t60).length, model: e59._model };
  }
};
w24.DebugSettings = { endFrameContentValidation: false, logDirtySet: false }, e([d({ constructOnly: true })], w24.prototype, "resourceController", void 0), e([d({ constructOnly: true })], w24.prototype, "options", void 0), e([d({ constructOnly: true })], w24.prototype, "state", void 0), e([d({ constructOnly: true })], w24.prototype, "sceneIntersectionHelper", void 0), e([d({ readOnly: true })], w24.prototype, "viewingMode", null), e([d({ constructOnly: true })], w24.prototype, "container", void 0), e([d({ constructOnly: true })], w24.prototype, "renderSR", void 0), e([d({ constructOnly: true })], w24.prototype, "_handles", void 0), e([d({ readOnly: true })], w24.prototype, "updating", null), e([d({ constructOnly: true })], w24.prototype, "_model", void 0), e([i22(), d()], w24.prototype, "renderView", void 0), w24 = f36 = e([n6("esri.views.3d.webgl-engine.Stage")], w24);

// node_modules/@arcgis/core/views/ui/3d/DefaultUI3D.js
var e58 = class extends _5 {
  constructor(o61) {
    super(o61), this.components = ["attribution", "zoom", "navigation-toggle", "compass"];
  }
};
e([d()], e58.prototype, "components", void 0), e58 = e([n6("esri.views.ui.3d.DefaultUI3D")], e58);
var p51 = e58;

// node_modules/@arcgis/core/views/SceneView.js
var ot2 = s3.getLogger("esri.views.SceneView");
var lt2 = class extends w8(g9(p18(G7))) {
  constructor(e59) {
    super(e59), this._userClippingArea = null, this._clippingArea = null, this._initialDefaultSpatialReference = null, this._defaults = {}, this._externallySet = { environment: false }, this._createGraphicsViewController = null, this._resolveWhenReady = [], this.propertiesPool = new o23({ slicePlane: z4 }, this), this._resourceController = f26(this), this._defaultToMapOptions = { include: /* @__PURE__ */ new Set() }, this._defaultHitTestOptions = { exclude: /* @__PURE__ */ new Set() }, this.deconflictor = new _18({ view: this }), this.labeler = new F13({ view: this, deconflictor: this.deconflictor.labels }), this.sharedSymbolResources = null, this.analyses = new n26(), this.basemapTerrain = null, this.elevationProvider = null, this.camera = null, this.canvas = null, this.center = null, this.constraints = new c32(), this.environmentManager = new L13(), this.extent = null, this.floors = new j4(), this.fullOpacity = 1, this.graphicsView = null, this.analysisViewManager = new D8({ view: this }), this.groundView = null, this.navigating = false, this.map = null, this.screenSizePerspectiveEnabled = true, this.state = new _19(), this.scale = null, this.spatialReference = null, this.alphaCompositingEnabled = false, this.preserveDrawingBufferEnabled = false, this.supersampleScreenshotsEnabled = true, this.type = "3d", this.ui = new p51(), this._numUpdating = 0, this._lastUpdateTime = 0, this.updatingProgress = 0.5, this.viewpoint = null, this.zoom = null, this.highlightOptions = new l35(), this.voxelWasm = null, this.voxelWasmPromise = null, c15(), e59 && e59.environment || (this._defaults.environment = new b7(), this.environment = this._defaults.environment);
    const t60 = (e60 = null) => {
      r(e60) && e60.type === E3.MOVE || (this._updatingChanged(), this.map && this.map.allLayers.forEach(async (e61) => {
        try {
          await e61.when();
        } catch {
        }
        this._updatingChanged();
      }));
    };
    this.handles.add([a5(() => {
      var _a;
      return (_a = this.map) == null ? void 0 : _a.allLayers;
    }, "after-changes", (e60) => t60(e60), { onListenerAdd: () => t60(), onListenerRemove: () => t60(), sync: true }), this.allLayerViews.on("after-changes", (e60) => this._updateUpdatingMonitors(e60)), l6(() => this.map, (e60) => {
      e60 && "load" in e60 && e60.load && e60.load().catch(() => {
      });
    })]), this.inputManager = new C15({ view: this }), this.stateManager = new J10({ view: this });
  }
  initialize() {
    this.groundView = new h20({ view: this }), this._updateUpdatingMonitors();
    const e59 = () => this._updateDefaultToMapOptions();
    this.handles.add(a5(() => {
      var _a;
      return (_a = this.map) == null ? void 0 : _a.allLayers;
    }, "after-changes", e59, { onListenerAdd: e59, onListenerRemove: e59 })), this.updatingHandles.add(() => this.qualitySettings.memoryLimit, (e60) => {
      this.resourceController && (this.resourceController.memoryController.maxMemory = e60);
    }, h3), this.updatingHandles.add(() => this.qualitySettings.additionalCacheMemory, (e60) => {
      this.resourceController && (this.resourceController.memoryController.additionalCacheMemory = e60);
    }, h3), this.updatingHandles.add(() => this.qualitySettings.frameRate, (e60) => F(e60 > 0 ? 1e3 / Math.ceil(e60) : 0), h3), this.updatingHandles.add(() => {
      var _a;
      return (_a = this.map) == null ? void 0 : _a.ground;
    }, e59, w2), this.updatingHandles.add(() => {
      var _a, _b;
      return (_b = (_a = this.map) == null ? void 0 : _a.ground) == null ? void 0 : _b.opacity;
    }, () => this._updateDefaultHitTestOptions(), w2), this.handles.add(l6(() => this.spatialReference, () => this.notifyChange("clippingArea"), U3));
  }
  destroy() {
    this.destroyed || (this.invalidate(), this.activeTool = null, this.layerViewManager.clear(), this._exitSurface(), this._disposeGraphicsView(), this.sharedSymbolResources = l(this.sharedSymbolResources), this.labeler.destroy(), this._set("labeler", null), this.deconflictor.destroy(), this._set("deconflictor", null), this._resourceController = l(this._resourceController), this.stateManager.destroy(), this._set("stateManager", null), this.inputManager.destroy(), this._set("inputManager", null), this.propertiesPool.destroy(), this.handles.remove("updatingMonitors"), this.environmentManager.destroy(), this._set("environmentManager", null), this.groundView = l(this.groundView));
  }
  get renderSpatialReference() {
    return this.renderCoordsHelper && this.renderCoordsHelper.spatialReference;
  }
  get basemapSpatialReference() {
    var _a;
    return (_a = this.basemapTerrain) == null ? void 0 : _a.spatialReference;
  }
  installContentCameraReset(e59 = { sticky: false }) {
    return this.stateManager.installContentCameraReset(e59);
  }
  get clippingArea() {
    if ("global" === this.viewingMode)
      return null;
    let e59 = this._userClippingArea || this.get("map.clippingArea");
    return !(!!this._userClippingArea || this.get("map.clippingEnabled")) || t(e59) ? (this._clippingArea = null, null) : e59 instanceof M3 ? this.spatialReference && (e59 = dt2(e59, this.spatialReference), t(e59)) ? (ot2.error("#clippingArea", "setting clippingArea with incompatible SpatialReference"), this._clippingArea) : (e59 = e59.clone(), t(e59.intersection(this.groundAndLayersExtent)) && (e59.xmin = e59.xmax, e59.ymin = e59.ymax), e59.zmin = void 0, e59.zmax = void 0, e59.equals(this._clippingArea) || (this._clippingArea = e59), this._clippingArea) : (ot2.error("#clippingArea", "only clippingArea geometries of type Extent are supported"), this._clippingArea);
  }
  set clippingArea(e59) {
    this.ready && "global" === this.viewingMode && r(e59) ? ot2.error("#clippingArea=", "Clipping area is only supported in local viewingMode") : this._userClippingArea = e59;
  }
  get renderDataExtent() {
    if (this.state.viewingMode === l13.Global)
      return null;
    const e59 = this.renderSpatialReference, t60 = this.dataExtent;
    return t(t60) || t(e59) || t60.spatialReference.equals(e59) ? t60 : dt2(t60, e59);
  }
  get dataExtent() {
    let e59 = this.groundAndLayersExtent;
    const t60 = this.spatialReference || k2.WGS84, i66 = dt2(this.clippingArea, t60);
    r(i66) && (e59 = r(e59) ? e59.intersection(i66) : i66);
    const r59 = this._get("dataExtent");
    return r(e59) && e59.equals(r59) ? r59 : e59;
  }
  get groundAndLayersExtent() {
    const e59 = this.spatialReference || k2.WGS84;
    let t60;
    const i66 = (i67) => {
      const r60 = dt2(i67, e59);
      t(r60) || (r(t60) ? t60.union(r60) : t60 = r60.clone());
    }, r59 = this.basemapTerrain;
    if (r59 == null ? void 0 : r59.spatialReference) {
      const e60 = r59.groundExtent;
      i66(new M3({ xmin: e60[0], ymin: e60[1], zmin: 0, xmax: e60[2], ymax: e60[3], zmax: 0, spatialReference: r59.spatialReference }));
    }
    if (this.map) {
      const e60 = (e61) => {
        !r(e61.fullExtent) || "graphics" === e61.type && e61.internal || i66(e61.fullExtent);
      };
      this.map.allLayers.forEach((t61) => e60(t61));
    }
    if (t(t60))
      return null;
    t60.hasZ ? (t60.zmin = Math.min(0, t60.zmin), t60.zmax = Math.max(0, t60.zmax)) : (t60.zmin = 0, t60.zmax = 0);
    const s63 = this._get("groundAndLayersExtent");
    return t60.equals(s63) ? s63 : t60;
  }
  set environment(e59) {
    e59 !== this._defaults.environment && (this._externallySet.environment = true), this._set("environment", e59);
  }
  castEnvironment(e59) {
    return e59 ? e59 instanceof b7 ? e59 : e59 instanceof y12 ? null != this.environment ? this.environment.cloneWithWebsceneEnvironment(e59) : b7.fromWebsceneEnvironment(e59) : b(b7, e59) : new b7();
  }
  get initialExtentRequired() {
    return this.stateManager && !this.stateManager.hasInitialView;
  }
  get _defaultsFromMapSettings() {
    return { required: { tileInfo: false, heightModelInfo: true, extent: false } };
  }
  get interacting() {
    return this.navigating || r(this.activeTool);
  }
  get stationary() {
    return !this.animation && !this.resizing && (t(this.state) || this.state.stationary);
  }
  set qualityProfile(e59) {
    o50.isValidProfile(e59) && (o50.apply(e59, this.qualitySettings), this._set("qualityProfile", e59));
  }
  get qualityProfile() {
    return this._get("qualityProfile") || o50.getDefaultProfile();
  }
  set slicePlane(e59) {
    if (r(this._stage) && this._stage.renderView.setRenderParameters({ slicePlane: e59 }), t(e59))
      return void this._set("slicePlane", null);
    const t60 = this.propertiesPool.get("slicePlane");
    X2(e59, t60), this._set("slicePlane", t60);
  }
  get typeSpecificPreconditionsReady() {
    return !!this.viewingMode;
  }
  get resolution() {
    return null != this.spatialReference ? i14(this.scale, this.spatialReference) : 0;
  }
  get heightModelInfo() {
    const e59 = this.getDefaultHeightModelInfo();
    return null != e59 ? v5.deriveUnitFromSR(e59, this.spatialReference) : null;
  }
  get updating() {
    var _a, _b, _c;
    if (this.destroyed)
      return false;
    let e59 = 0, t60 = this.layerViewManager.updating, i66 = t60 ? this.layerViewManager.updatingRemaining : 0;
    this.allLayerViews.forEach((r59) => {
      if (r59.isFulfilled()) {
        if (r59.updating) {
          if (t60 = true, r59.suspended || x5(r59))
            return;
          ++i66, e59 += r59.updatingProgress;
        }
      } else
        ++i66;
    });
    for (const r59 of [this.graphicsView, this.basemapView, this._resourceController, this._stage, this.featureTiles, this.pointsOfInterest, this.environmentManager, this.overlay, this.featureTreeDebugger, this.toolViewManager, this.analysisViewManager])
      if (r(r59) && r59.updating) {
        const t61 = 0.1;
        i66 += t61, e59 += 0.5 * t61;
      }
    for (const r59 of [this.deconflictor, this.labeler, this.basemapTerrain])
      r(r59) && r59.updating && (++i66, e59 += r59.updatingProgress);
    if (t60 = !!(t60 || i66 > 0 || this.updatingHandles.updating || !this.ready || !this.stationary || this._createGraphicsViewController || ((_a = this.inputManager) == null ? void 0 : _a.hasPendingInputs) || ((_c = (_b = this.map) == null ? void 0 : _b.allLayers) == null ? void 0 : _c.some((e60) => !e60.isFulfilled()))), t60 ? (this._numUpdating = Math.max(i66, this._numUpdating), e59 += this._numUpdating - i66) : this._numUpdating = 0, this._numUpdating > 0 ? e59 /= this._numUpdating : e59 = t60 ? 0 : 1, this._get("updatingProgress") !== e59) {
      const i67 = performance.now();
      if (e59 < 1) {
        const t61 = Math.min((i67 - this._lastUpdateTime) / 2e3, 1);
        e59 = this.updatingProgress * (1 - t61) + e59 * t61;
      }
      this._set("updatingProgress", e59), this._lastUpdateTime = t60 && e59 < 1 ? i67 : 0;
    }
    return t60;
  }
  get viewingMode() {
    var _a;
    const e59 = this._predeterminedViewingMode;
    if (r(e59))
      return a15(e59);
    const t60 = this.spatialReference;
    return t60 ? r((_a = this.defaultsFromMap) == null ? void 0 : _a.viewingMode) && t60.equals(this.defaultsFromMap.spatialReference) ? a15(this.defaultsFromMap.viewingMode) : r35(t60, l13.Global) ? "global" : "local" : "global";
  }
  set viewingMode(e59) {
    this.ready ? ot2.error("#viewingMode", "viewingMode cannot be set once view is ready") : e59 ? this._override("viewingMode", e59) : void 0 === e59 && this._clearOverride("viewingMode");
  }
  get resourceController() {
    return this._resourceController;
  }
  get performanceInfo() {
    return new a46(this);
  }
  forceAnimationTime(e59) {
    this._stage.renderView.forcedAnimationTime = this.basemapTerrain.overlayManager.forcedAnimationTime = e59;
  }
  on(e59, t60, i66, r59) {
    const s63 = this.viewEvents.on(e59, t60, i66, r59);
    return s63 || super.on(e59, t60);
  }
  hasEventListener(e59) {
    return super.hasEventListener(e59) || this.viewEvents.hasHandler(e59);
  }
  toMap(e59, t60) {
    if (!this.ready)
      return ot2.error("#toMap()", "Scene view cannot be used before it is ready"), null;
    const i66 = t60 ? this.externalToInternalIntersectOptions(t60) : this._defaultToMapOptions, r59 = r(i66.graphics) && (r(i66.graphics.include) || r(i66.graphics.exclude)), s63 = o24(e59) ? r26(this, e59) : e59, n73 = d2(s63);
    i66.enableDraped = i66.include && !i66.include.has(j8) || i66.exclude && i66.exclude.has(j8);
    const a58 = this.sceneIntersectionHelper, o61 = x6(this.state.viewingMode);
    if (o61.options.selectionMode = true, o61.options.store = r59 ? t27.ALL : t27.MIN, a58.intersectIntersectorScreen(n73, o61, i66), r59) {
      for (const e60 of o61.results.all) {
        const t61 = h17(e60, this);
        if (t(t61))
          return this._intersectResultToMapPoint(e60);
        if ("graphic" !== t61.type || this._testGraphicUidFilter(i66.graphics, t61.graphic))
          return this._intersectResultToMapPoint(e60);
      }
      return null;
    }
    return this._intersectResultToMapPoint(o61.results.min);
  }
  toScreen(e59) {
    if (!this.ready)
      return ot2.error("#toScreen()", "Scene view cannot be used before it is ready"), null;
    const t60 = c(null == e59.z && i21(this.elevationProvider, e59), 0);
    return Hn(e59, ut2, this.renderSpatialReference, t60), this.state.camera.projectToScreen(ut2, gt2), c4(gt2[0], gt2[1]);
  }
  pixelSizeAt(e59) {
    return this.ready ? e59 ? (Hn(e59, ut2, this.renderSpatialReference), this.state.camera.computeScreenPixelSizeAt(ut2)) : 0 : (ot2.error("#pixelSizeAt()", "Scene view cannot be used before it is ready"), null);
  }
  overlayPixelSizeInMapUnits(e59) {
    const t60 = this.basemapTerrain.overlayManager;
    return t60 ? t60.overlayPixelSizeInMapUnits(e59) : 1;
  }
  hitTest(e59, t60) {
    if (!this.ready)
      return ot2.error("#hitTest()", "Scene view cannot be used before it is ready"), null;
    const i66 = o24(e59) ? r26(this, e59) : e59, r59 = i3(i66.x, i66.y), s63 = t60 ? this.externalToInternalIntersectOptions(t60) : this._defaultHitTestOptions;
    s63.requiresGroundFeedback = true, s63.enableDraped = true;
    const n73 = x6(this.state.viewingMode);
    n73.options.selectionMode = true, n73.options.store = t27.ALL, this.sceneIntersectionHelper.intersectIntersectorScreen(r59, n73, s63);
    const a58 = this._intersectResultsToHits(n73.results.all, s63.graphics), o61 = n73.results.ground, l48 = m14(o61, this), p52 = r(l48) && "type" in l48 && "integrated-mesh" === l48.type ? l48 : null, h44 = { screenPoint: i66, results: a58, ground: { mapPoint: this._intersectResultToMapPoint(o61), distance: c21(o61) ? o61.distanceInRenderSpace : 0, layer: p52 } };
    return t25.SCENEVIEW_HITTEST_RETURN_INTERSECTOR && (h44.intersector = n73), Promise.resolve(h44);
  }
  async popupHitTest(e59) {
    const { results: t60, ground: i66 } = await n38(this, e59);
    let r59 = null;
    return !(0 === t60.length || Math.abs(c(t60[0].distance, 0) - i66.distance) < 1e-5) || i66.layer && "integrated-mesh" === i66.layer.type || (r59 = i66.mapPoint), { results: t60, screenPoint: e59, mapPoint: r59 };
  }
  goTo(e59, t60) {
    return this.updatingHandles.addPromise(this.stateManager.goTo(e59, t60));
  }
  async whenAnalysisView(e59) {
    if (t(e59.parent))
      throw new s4("view:no-analysisview-for-analysis", "The analysis has not been added to view.analyses", { analysis: e59 });
    if ("line-of-sight" === e59.parent.type) {
      return (await this.whenLayerView(e59.parent)).whenAnalysisView();
    }
    return this.analysisViewManager.whenAnalysisView(e59);
  }
  whenLayerView(e59) {
    return super.whenLayerView(e59);
  }
  async takeScreenshot(e59) {
    const t60 = this._completeSettings(e59);
    await this.whenReady();
    const i66 = await this._stage.renderView.takeScreenshot(t60);
    return r17(i66, t60, this._pixelFormat());
  }
  async _takeScreenshot(e59) {
    const t60 = this._completeSettings(e59);
    await this.whenReady();
    const i66 = await this._stage.renderView.takeScreenshot(t60);
    return l10(i66, this._pixelFormat());
  }
  _completeSettings(e59) {
    const t60 = a12(e59, this);
    return t60.pixelRatio /= this.state.pixelRatio, y4(t60, this.supersampleScreenshotsEnabled, this.padding);
  }
  _pixelFormat() {
    return { flipY: true, premultipliedAlpha: this._stage.renderView.getAlpha() };
  }
  get test() {
    return { takeScreenshot: (e59) => this._takeScreenshot(e59) };
  }
  addUpdatingPromise(e59) {
    return this.updatingHandles.addPromise(e59);
  }
  importLayerView(e59) {
    return l23.importLayerView(e59);
  }
  hasLayerViewModule(e59) {
    return l23.hasLayerViewModule(e59);
  }
  forceDOMReadyCycle() {
    this.forceReadyCycle();
  }
  getDefaultSpatialReference() {
    var _a, _b, _c, _d;
    return this.map && "initialViewProperties" in this.map && ((_b = (_a = this.map) == null ? void 0 : _a.initialViewProperties) == null ? void 0 : _b.spatialReference) || ((_c = this.defaultsFromMap) == null ? void 0 : _c.spatialReference) || ((_d = this.defaultsFromMap) == null ? void 0 : _d.ready) && this._initialDefaultSpatialReference || null;
  }
  async validate() {
    let e59 = i20(this.type);
    if (a("safari") && a("safari") < 9 && (e59 = new s4("sceneview:browser-not-supported", "This browser is not supported by SceneView (Safari < 9)", { type: "safari", requiredVersion: 9, detectedVersion: a("safari") })), r(e59))
      throw ot2.warn("#validate()", e59.message), e59;
  }
  get _predeterminedViewingMode() {
    var _a;
    const e59 = this._isOverridden("viewingMode") ? this._get("viewingMode") : (this.map && "initialViewProperties" in this.map ? (_a = this.map.initialViewProperties) == null ? void 0 : _a.viewingMode : null) ?? null;
    return r(e59) ? o17(e59) : null;
  }
  getSpatialReferenceSupport({ spatialReference: e59, layer: t60 }) {
    const i66 = this._predeterminedViewingMode;
    if (r(i66))
      return this._validateSpatialReferenceForViewingMode(e59, t60, i66) ? { constraints: this._makeSpatialReferenceConstraints(e59, t60, i66) } : null;
    const r59 = this._validateSpatialReferenceForViewingMode(e59, t60, l13.Local), s63 = this._validateSpatialReferenceForViewingMode(e59, t60, l13.Global);
    return r59 || s63 ? r59 && s63 ? { constraints: this._makeSpatialReferenceConstraints(e59, t60, null) } : r59 ? { constraints: this._makeSpatialReferenceConstraints(e59, t60, l13.Local) } : { constraints: this._makeSpatialReferenceConstraints(e59, t60, l13.Global) } : null;
  }
  _validateSpatialReferenceForViewingMode(e59, t60, i66) {
    return !!r35(e59, i66) && (!!t(t60) || (!!r16(t60) || (!t10(t60) || !t(C5(t60, e59, i66))) && (!n15(t60) || i66 !== l13.Global)));
  }
  _makeSpatialReferenceConstraints(e59, t60, i66) {
    if (t(t60))
      return [{ spatialReference: e59, viewingMode: i66 }];
    const r59 = e59.isWebMercator, s63 = e59.isWGS84;
    if (r16(t60) && (r59 || s63)) {
      return !s63 || i66 === l13.Local || null === L8(t60.tileInfo, t60.fullExtent, e59, l13.Global) ? [{ spatialReference: e59, viewingMode: i66 }, { spatialReference: k2.WebMercator, viewingMode: i66 }] : [{ spatialReference: r59 ? k2.WGS84 : k2.WebMercator, viewingMode: i66 }];
    }
    return t10(t60) || n15(t60) || !r59 && !s63 ? t10(t60) && r59 && i66 !== l13.Global ? [{ spatialReference: e59, viewingMode: i66 }, { spatialReference: k2.WGS84, viewingMode: l13.Local }] : [{ spatialReference: e59, viewingMode: i66 }] : [{ spatialReference: e59, viewingMode: i66 }, { spatialReference: r59 ? k2.WGS84 : k2.WebMercator, viewingMode: i66 }];
  }
  _validateSpatialReference(e59) {
    const t60 = r(this.getSpatialReferenceSupport({ spatialReference: e59 })), i66 = this._predeterminedViewingMode;
    return t60 || (r(i66) ? ot2.warnOnce(`Spatial reference defined on view not supported in ${a15(i66)} viewing mode.`) : e59.isGeographic && ot2.warnOnce("Spatial reference is geographic but not supported.")), t60;
  }
  whenReady() {
    return new Promise((e59) => {
      this.ready ? e59(this) : this._resolveWhenReady.push(e59);
    });
  }
  computeMapPointFromVec3d(e59, t60) {
    let i66 = this.spatialReference || k2.WGS84;
    return Bn(e59, this.renderSpatialReference, e59, i66) || (i66 = k2.WGS84, Bn(e59, this.renderSpatialReference, e59, i66)), t60 ? (t60.x = e59[0], t60.y = e59[1], t60.z = e59[2], t60.spatialReference = i66) : t60 = new j(e59, i66), t60;
  }
  trackGraphicState(e59) {
    if (!e59.graphic)
      return ot2.error("trackGraphicState", "GraphicState.graphic must not be null or undefined to start tracking"), null;
    const t60 = this.getViewForGraphic(e59.graphic);
    let i66 = null, r59 = false;
    const s63 = (t61) => {
      var _a;
      !r59 && r(t61) && "processor" in t61 && "graphics-3d" === ((_a = t61.processor) == null ? void 0 : _a.type) && t61.processor.graphicsCore && (i66 = t61.processor.graphicsCore.trackGraphicState(e59));
    };
    return r(t60) ? s63(t60) : this.whenViewForGraphic(e59.graphic, { waitForLayer: true }).then((e60) => s63(e60), () => {
    }).catch(() => {
    }), { remove: () => {
      r59 = true, r(i66) && (i66.remove(), i66 = null);
    } };
  }
  highlight(e59) {
    if (Array.isArray(e59))
      return r2(e59.map((e60) => this.highlight(e60)));
    if (j4.isCollection(e59))
      return r2(e59.toArray().map((e60) => this.highlight(e60)));
    const t60 = this.getViewForGraphic(e59);
    return t60 && "highlight" in t60 ? t60.highlight(e59) : n();
  }
  maskOccludee(e59) {
    if (!e59)
      return ot2.error("maskOccludee", "GraphicState.graphic must not be null or undefined to mask an occludee"), null;
    const t60 = this.getViewForGraphic(e59);
    let i66 = null, r59 = false;
    const s63 = (t61) => {
      !r59 && r(t61) && t18(t61) && (i66 = t61.maskOccludee(e59));
    };
    return r(t60) ? s63(t60) : this.whenViewForGraphic(e59, { waitForLayer: true }).then((e60) => s63(e60), () => {
    }).catch(() => {
    }), { remove: () => {
      r59 = true, r(i66) && (i66.remove(), i66 = null);
    } };
  }
  getViewForGraphic(e59) {
    return e59.layer === this.graphics ? this.graphicsView : e59.layer ? this.allLayerViews.find((t60) => t60.layer === e59.layer) : null;
  }
  graphicChanged(e59) {
    r(this.graphicsView) && this.graphicsView.graphicChanged(e59);
  }
  async whenViewForGraphic(e59, t60) {
    if (e59.layer === this)
      return await j5(() => this.graphicsView), this.graphicsView;
    if (!e59.layer || !this.map)
      throw new s4("no-view-for-graphic");
    return t60 && t60.waitForLayer && !this.map.allLayers.includes(e59.layer) ? new Promise((t61, i66) => {
      const r59 = this.map.allLayers.on("change", (s63) => {
        s63.added.includes(e59.layer) && (r59.remove(), this.whenLayerView(e59.layer).then(t61, i66));
      });
    }) : this.whenLayerView(e59.layer);
  }
  externalToInternalIntersectOptions(e59) {
    const t60 = this._externalToInternalRenderItems(e59.include, ct2.INCLUDE), i66 = this._externalToInternalRenderItems(e59.exclude, ct2.EXCLUDE);
    return { include: t60.layerUids, exclude: i66.layerUids, graphics: { include: t60.graphicUids, exclude: i66.graphicUids } };
  }
  _intersectResultToMapPoint(e59, t60) {
    return e59.getIntersectionPoint(ut2) ? (t60 = this.computeMapPointFromVec3d(ut2, t60), e59.intersector === i23.TERRAIN && this.basemapTerrain && (t60.z = c(i21(this.basemapTerrain, t60), 0)), t60) : null;
  }
  _intersectResultsToHits(e59, t60) {
    const i66 = new Array();
    let r59 = null;
    for (let s63 = 0; s63 < e59.length; s63++) {
      const n73 = e59[s63], a58 = m14(n73, this);
      if (r(a58) && (a58 === this.map.ground || "type" in a58 && "integrated-mesh" === a58.type))
        break;
      const o61 = h17(n73, this);
      if (t(o61))
        continue;
      if ("graphic" === o61.type) {
        if (t(r59) && s63 !== e59.length - 1 && (r59 = /* @__PURE__ */ new Set()), r(r59)) {
          const e60 = this._getGraphicFilterUid(o61.graphic);
          if (r59.has(e60))
            continue;
          r59.add(e60);
        }
        if (!this._testGraphicUidFilter(t60, o61.graphic))
          continue;
      }
      const l48 = this._intersectResultToMapPoint(n73), p52 = n73.distanceInRenderSpace;
      i66.push({ ...o61, mapPoint: l48, distance: p52 });
    }
    return i66;
  }
  _getGraphicFilterUid(e59) {
    if (e59.layer && "objectIdField" in e59.layer) {
      const t60 = e59.attributes[e59.layer.objectIdField];
      if (t60)
        return `o-${e59.layer.id}-${t60}`;
    }
    return `u-${e59.uid}`;
  }
  _testGraphicUidFilter(e59, t60) {
    const i66 = this._getGraphicFilterUid(t60);
    return t(e59) || (t(e59.include) || e59.include.has(i66)) && (t(e59.exclude) || !e59.exclude.has(i66));
  }
  _externalToInternalRenderItems(e59, t60, r59 = { layerUids: null, graphicUids: null }) {
    if (!e59)
      return r59;
    if (e59 instanceof g7)
      ht2(r59, this._getGraphicFilterUid(e59)), t60 === ct2.INCLUDE && (r(this.graphicsView) && e59.layer === this ? pt2(r59, this.graphicsView.processor.layer.id) : e59.layer && pt2(r59, e59.layer.uid));
    else if (t3(e59))
      for (const i66 of e59)
        i66 === this.graphics && r(this.graphicsView) ? pt2(r59, this.graphicsView.processor.layer.id) : i66 === this.map.ground ? pt2(r59, j8) : this._externalToInternalRenderItems(i66, t60, r59);
    else
      "uid" in e59 && pt2(r59, e59.uid);
    return r59;
  }
  _initBasemapTerrain() {
    this._set("basemapTerrain", new $e({ view: this })), this._set("elevationProvider", new u38({ view: this })), this.elevationProvider.register("ground", this.basemapTerrain);
  }
  _exitBasemapTerrain() {
    this.basemapTerrain && (this.elevationProvider.unregister(this.basemapTerrain), this.elevationProvider.destroy(), this._set("elevationProvider", null), this.basemapTerrain.destroy(), this._set("basemapTerrain", null));
  }
  _initGlobe() {
    this._initCoordinateSystem(), this.state.createInitialCamera(), this._initBasemapTerrain(), this._set("pointsOfInterest", new E28({ view: this })), this._set("featureTiles", new j27({ renderCoordsHelper: this.renderCoordsHelper, cameraOnSurface: this.pointsOfInterest.contentCameraOnSurface, focus: this.pointsOfInterest.focus, tilingSchemeOwner: this.basemapTerrain, viewState: this.state, scheduler: this._resourceController.scheduler, terrain: this.basemapTerrain }));
    const e59 = () => {
      var _a;
      const e60 = (_a = this.basemapTerrain) == null ? void 0 : _a.extent;
      if (this.clippingArea || e60)
        if (e60 && this.basemapTerrain.spatialReference) {
          const e61 = r(this.basemapTerrain.extent) ? rn(f6(this.basemapTerrain.extent, this.basemapTerrain.spatialReference), this.spatialReference) : null;
          r(this.clippingArea) ? this.featureTiles.filterExtent = this.clippingArea.intersection(e61) : this.featureTiles.filterExtent = e61;
        } else
          this.featureTiles.filterExtent = this.clippingArea;
      else
        this.featureTiles.filterExtent = null;
    };
    this.handles.add([this.updatingHandles.add(() => t25.FEATURE_TILE_TREE_SHOW_TILES, (e60) => {
      e60 && this.featureTiles && !this.featureTreeDebugger ? this.updatingHandles.addPromise(import("./FeatureTileTree3DDebugger-WPSDJGEY.js")).then(({ FeatureTileTree3DDebugger: e61 }) => {
        !this.featureTreeDebugger && t25.FEATURE_TILE_TREE_SHOW_TILES && (this.featureTreeDebugger = new e61({ view: this }));
      }) : e60 || !this.featureTreeDebugger || t25.FEATURE_TILE_TREE_SHOW_TILES || (this.featureTreeDebugger.destroy(), this.featureTreeDebugger = null);
    }, w2), this.updatingHandles.add(() => this.clippingArea, e59, w2), this.updatingHandles.add(() => this.basemapTerrain.extent, e59, w2)], "feature-tiles"), this.stateManager.init();
  }
  _exitGlobe() {
    this.state && (this.stateManager.deinit(), this.handles.remove("render-coords-helper"), this.handles.remove("feature-tiles"), this.featureTiles.destroy(), this._set("featureTiles", null), this.pointsOfInterest.destroy(), this._set("pointsOfInterest", null), this._exitBasemapTerrain(), this.state.exit(), this._exitCoordinateSystem());
  }
  _initCoordinateSystem() {
    if (this.spatialReference) {
      const e59 = this.spatialReference;
      this.mapCoordsHelper && this.mapCoordsHelper.spatialReference.equals(e59) || this._set("mapCoordsHelper", new a44(this.map, e59));
      const t60 = this.state.isGlobal, i66 = H4(t60, e59);
      i66 !== this.renderSpatialReference && (this._set("renderCoordsHelper", x8.create(this.state.viewingMode, i66)), t60 || this.handles.add(l6(() => {
        var _a;
        return (_a = this.basemapTerrain) == null ? void 0 : _a.extent;
      }, (e60) => {
        const t61 = this.renderCoordsHelper.spatialReference;
        e60 && (0 !== e60[0] || 0 !== e60[1] || 0 !== e60[2] || 0 !== e60[3]) && zn(e60, this.basemapTerrain.spatialReference, mt2, t61) && (this.renderCoordsHelper.extent = mt2);
      }, U3), "render-coords-helper"), this.sceneIntersectionHelper && this.sceneIntersectionHelper.setTolerance(A17 / this.renderCoordsHelper.unitInMeters));
    } else
      this._set("mapCoordsHelper", null), this._set("renderCoordsHelper", null);
  }
  _exitCoordinateSystem() {
    this.mapCoordsHelper && (this.handles.remove("render-coords-helper"), this._set("renderCoordsHelper", null), this._set("mapCoordsHelper", null));
  }
  _updatingChanged() {
    this.notifyChange("updating");
  }
  _updateUpdatingMonitors(e59 = null) {
    r(e59) && e59.type === E3.MOVE || (this.handles.remove("updatingMonitors"), this.allLayerViews.forEach((e60) => {
      e60.destroyed || (this.handles.add(l6(() => [e60.updating, e60.updatingProgress], () => this._updatingChanged(), U3), "updatingMonitors"), e60.when(() => this._updatingChanged(), () => this._updatingChanged()));
    }), this._updatingChanged());
  }
  _renderScreenshotOverlay(e59, t60) {
    if (!this.overlay || !this.overlay.hasVisibleItems)
      return t60;
    const i66 = e59.getContext("2d");
    return i66.putImageData(t60, 0, 0), this.overlay.renderCanvas(e59), i66.getImageData(0, 0, t60.width, t60.height);
  }
  _initStage() {
    const e59 = { deactivatedWebGLExtensions: this.deactivatedWebGLExtensions, debugWebGLExtensions: this.debugWebGLExtensions, alpha: this.alphaCompositingEnabled, preserveDrawingBuffer: this.preserveDrawingBufferEnabled, canvas: this.renderCanvas, screenshot: { renderOverlay: (e60, t61) => this._renderScreenshotOverlay(e60, t61) } }, t60 = new H16(this.state.viewingMode, (e60) => this._stage.layers.forAll(e60), this);
    this._set("sceneIntersectionHelper", t60);
    const i66 = e8(this.surface), { resourceController: r59, state: s63, renderSpatialReference: l48 } = this;
    this._stage = new w24({ options: e59, container: i66, resourceController: r59, state: s63, sceneIntersectionHelper: t60, renderSR: l48 }), this._stage.renderView.setRenderParameters({ slicePlane: this.slicePlane }), this._lostWebGLContextHandle = r3(this._stage.renderView.canvas, "webglcontextlost", () => this.fatalError = new s4("webgl-context-lost")), this.handles.add([this.updatingHandles.add(() => this.qualitySettings.antialiasingEnabled, () => this._stage.renderView.setRenderParameters({ antialiasingEnabled: this.qualitySettings.antialiasingEnabled }), h3), this.updatingHandles.add(() => this.qualitySettings.highQualityTransparency, () => this._stage.renderView.setRenderParameters({ highQualityTransparency: this.qualitySettings.highQualityTransparency }), h3), l6(() => this.magnifier, (e60) => this._stage.renderView.magnifier = e60, w2)], "stage");
    const p52 = () => {
      this._stage.renderView.setRenderParameters({ defaultHighlightOptions: l35.toEngineOptions(this.highlightOptions) });
    };
    this.handles.add(this.updatingHandles.add(() => [this.highlightOptions.color, this.highlightOptions.haloColor, this.highlightOptions.haloOpacity, this.highlightOptions.fillOpacity, this.highlightOptions.shadowOpacity, this.highlightOptions.shadowColor, this.highlightOptions.shadowDifference], p52), "stage"), p52(), this.renderCoordsHelper && this.sceneIntersectionHelper.setTolerance(A17 / this.renderCoordsHelper.unitInMeters), this._set("canvas", this._stage.renderView.canvas);
  }
  _exitStage() {
    this._set("sceneIntersectionHelper", null), this._stage.destroy(), this._stage = null, this._lostWebGLContextHandle.remove(), this._lostWebGLContextHandle = null, this.handles.remove("stage"), this._set("canvas", null);
  }
  _initSurface(e59) {
    this._exitSurface(), this.state.init(e59, this.spatialReference), this._initStage(), this._initGlobe(), this.sharedSymbolResources = new h34({ view: this, viewingMode: e59, resourceController: this._resourceController, pointsOfInterest: this.pointsOfInterest, viewState: this.state, objectResourceCache: new c52() });
  }
  _exitSurface() {
    this.sharedSymbolResources && (this.sharedSymbolResources.objectResourceCache.destroy(), this.sharedSymbolResources.destroy(), this.sharedSymbolResources = null, this._exitGlobe(), this._exitStage());
  }
  _createGraphicsViewIfNeeded() {
    if (this.graphicsView || this._createGraphicsViewController)
      return;
    if (0 === this.graphics.length)
      return;
    this.handles.remove("graphics-view"), this._createGraphicsViewController = new AbortController();
    const e59 = () => {
      this._createGraphicsViewController = null, this._updatingChanged();
    };
    this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(e59, e59), this._updatingChanged();
  }
  async _createGraphicsViewAsync(e59) {
    const t60 = (await import("./GraphicsView3D-7JEGUAR5.js")).default;
    f(e59), await j5(() => {
      var _a;
      return (_a = this.basemapTerrain) == null ? void 0 : _a.ready;
    }, e59), this._set("graphicsView", new t60({ view: this }));
  }
  _disposeGraphicsView() {
    this._createGraphicsViewController && (this._createGraphicsViewController.abort(), this._createGraphicsViewController = null), this.handles.remove("graphics-view"), r(this.graphicsView) && (this.handles.remove(this.graphicsView.processor.layer.id), this.graphicsView.destroy(), this._set("graphicsView", null));
  }
  _startup() {
    const e59 = o17(this.viewingMode);
    if (e59 === l13.Global && (this._clippingArea = null), this._initSurface(e59), this._set("ready", true), this.handles.add(a5(() => this.graphics, "after-changes", () => this._createGraphicsViewIfNeeded()), "graphics-view"), this._createGraphicsViewIfNeeded(), !this._externallySet.environment) {
      const e60 = this.get("map.initialViewProperties.environment");
      e60 && (this.environment = e60);
    }
    this.labeler.setup(), this.environmentManager.connectView(this), this.inputManager.connect();
    const t60 = this._resolveWhenReady;
    this._resolveWhenReady = [], t60.forEach((e60) => e60(this));
  }
  _teardown() {
    this._initialDefaultSpatialReference = null, this.inputManager.disconnect(), this.environmentManager.disconnectView(), this.labeler.dispose(), this._disposeGraphicsView(), this.handles.remove("graphics-view"), this._exitSurface(), this._set("ready", false);
  }
  _updateDefaultToMapOptions() {
    if (this._defaultToMapOptions.include.clear(), this.map) {
      this.map.ground && this._defaultToMapOptions.include.add(j8);
      for (const e59 of this.map.allLayers.items)
        "integrated-mesh" === e59.type && this._defaultToMapOptions.include.add(e59.uid);
    }
  }
  _updateDefaultHitTestOptions() {
    if (this._defaultHitTestOptions.exclude.clear(), this.map) {
      this.map.ground && this.map.ground.opacity < 1 && this._defaultHitTestOptions.exclude.add(j8);
      for (const e59 of this.map.allLayers.items)
        "integrated-mesh" === e59.type && e59.opacity < 1 && this._defaultToMapOptions.exclude.add(e59.uid);
    }
  }
  addVoxelLayerViewToWasm(e59) {
    return t(this.voxelWasm) ? (t(this.voxelWasmPromise) && (this.voxelWasmPromise = import("./VoxelWasmPerSceneView-QMNGZNFG.js").then((e60) => (this.voxelWasm = new e60.default(this), this.voxelWasm))), this.voxelWasmPromise.then((t60) => t60.addVoxelLayer(e59))) : this.voxelWasm.addVoxelLayer(e59);
  }
  removeVoxelLayerViewFromWasm(e59) {
    if (r(this.voxelWasm)) {
      this.voxelWasm.removeVoxelLayer(e59) < 1 && (this.voxelWasm = null, this.voxelWasmPromise = null);
    }
  }
};
function pt2(e59, t60) {
  e59.layerUids || (e59.layerUids = /* @__PURE__ */ new Set()), e59.layerUids.add(t60);
}
function ht2(e59, t60) {
  e59.graphicUids || (e59.graphicUids = /* @__PURE__ */ new Set()), e59.graphicUids.add(t60);
}
function dt2(e59, t60) {
  return r(e59) && An(e59.spatialReference, t60) ? rn(e59, t60) : null;
}
var ct2;
lt2.type = "3d", e([d()], lt2.prototype, "_userClippingArea", void 0), e([d()], lt2.prototype, "_resourceController", void 0), e([d()], lt2.prototype, "_stage", void 0), e([d({ readOnly: true })], lt2.prototype, "deconflictor", void 0), e([d({ readOnly: true })], lt2.prototype, "labeler", void 0), e([d(a19(n26, "analyses"))], lt2.prototype, "analyses", void 0), e([d({ type: n29, readOnly: true, aliasOf: "state.animation" })], lt2.prototype, "animation", void 0), e([d({ readOnly: true })], lt2.prototype, "basemapTerrain", void 0), e([d({ readOnly: true })], lt2.prototype, "elevationProvider", void 0), e([d({ type: d7, aliasOf: "stateManager.camera" })], lt2.prototype, "camera", void 0), e([d({ type: d7, aliasOf: "stateManager.contentCamera" })], lt2.prototype, "contentCamera", void 0), e([d({ readOnly: true })], lt2.prototype, "canvas", void 0), e([d({ type: j, aliasOf: "stateManager.center" })], lt2.prototype, "center", void 0), e([d({ type: M3 })], lt2.prototype, "clippingArea", null), e([d({ type: c32 })], lt2.prototype, "constraints", void 0), e([d({ type: M3, readOnly: true })], lt2.prototype, "renderDataExtent", null), e([d({ type: M3, readOnly: true })], lt2.prototype, "dataExtent", null), e([d({ type: M3, readOnly: true })], lt2.prototype, "groundAndLayersExtent", null), e([d({ value: null, type: b7 })], lt2.prototype, "environment", null), e([s7("environment")], lt2.prototype, "castEnvironment", null), e([d({ readOnly: true })], lt2.prototype, "environmentManager", void 0), e([d({ type: M3, aliasOf: "stateManager.extent" })], lt2.prototype, "extent", void 0), e([d()], lt2.prototype, "floors", void 0), e([d({ readOnly: true, aliasOf: "stateManager.screenCenter" })], lt2.prototype, "screenCenter", void 0), e([d({ aliasOf: "stateManager.frustum" })], lt2.prototype, "frustum", void 0), e([d({ type: Number, readOnly: true })], lt2.prototype, "fullOpacity", void 0), e([d({ readOnly: true })], lt2.prototype, "graphicsView", void 0), e([d({ readOnly: true })], lt2.prototype, "analysisViewManager", void 0), e([d()], lt2.prototype, "groundView", void 0), e([d({ type: Boolean })], lt2.prototype, "initialExtentRequired", null), e([d()], lt2.prototype, "_defaultsFromMapSettings", null), e([d({ type: Boolean, readOnly: true })], lt2.prototype, "interacting", null), e([d()], lt2.prototype, "stationary", null), e([d({ aliasOf: "state.navigating" })], lt2.prototype, "navigating", void 0), e([d()], lt2.prototype, "map", void 0), e([d({ readOnly: true })], lt2.prototype, "mapCoordsHelper", void 0), e([d({ aliasOf: "stateManager.padding" })], lt2.prototype, "padding", void 0), e([d({ type: E28, readOnly: true })], lt2.prototype, "pointsOfInterest", void 0), e([d({ type: j27, readOnly: true })], lt2.prototype, "featureTiles", void 0), e([d()], lt2.prototype, "featureTreeDebugger", void 0), e([d({ type: Boolean })], lt2.prototype, "screenSizePerspectiveEnabled", void 0), e([d({ constructOnly: true })], lt2.prototype, "deactivatedWebGLExtensions", void 0), e([d({ constructOnly: true })], lt2.prototype, "debugWebGLExtensions", void 0), e([d({ constructOnly: true })], lt2.prototype, "renderCanvas", void 0), e([d({ constructOnly: true })], lt2.prototype, "state", void 0), e([d({ readOnly: true })], lt2.prototype, "inputManager", void 0), e([d({ readOnly: true })], lt2.prototype, "stateManager", void 0), e([d({ type: ["low", "medium", "high"] })], lt2.prototype, "qualityProfile", null), e([d({ type: c56, get() {
  let e59 = this._get("qualitySettings");
  return e59 || (e59 = new c56(), o50.apply(this.qualityProfile, e59)), e59;
} })], lt2.prototype, "qualitySettings", void 0), e([d()], lt2.prototype, "slicePlane", null), e([d({ readOnly: true })], lt2.prototype, "typeSpecificPreconditionsReady", null), e([d({ readOnly: true })], lt2.prototype, "renderCoordsHelper", void 0), e([d({ readOnly: true })], lt2.prototype, "sceneIntersectionHelper", void 0), e([d({ type: Number, dependsOn: ["scale", "spatialReference"], readOnly: true })], lt2.prototype, "resolution", null), e([d({ type: Number, aliasOf: "stateManager.scale" })], lt2.prototype, "scale", void 0), e([d()], lt2.prototype, "heightModelInfo", null), e([d()], lt2.prototype, "spatialReference", void 0), e([d({ type: Boolean, constructOnly: true })], lt2.prototype, "alphaCompositingEnabled", void 0), e([d({ constructOnly: true })], lt2.prototype, "preserveDrawingBufferEnabled", void 0), e([d({ type: Boolean })], lt2.prototype, "supersampleScreenshotsEnabled", void 0), e([d({ readOnly: true })], lt2.prototype, "type", void 0), e([d({ type: p51 })], lt2.prototype, "ui", void 0), e([d({ type: Boolean, readOnly: true, dependsOn: ["graphicsView.updating", "basemapView.updating", "basemapTerrain.updating", "layerViewManager.updating", "layerViewManager.updatingRemaining", "_resourceController.updating", "_stage.updating", "featureTiles.updating", "pointsOfInterest.updating", "environmentManager.updating", "overlay.updating", "updatingHandles.updating", "featureTreeDebugger.updating", "labeler.updating", "deconflictor.updating", "ready", "stationary", "inputManager.hasPendingInputs", "toolViewManager.updating", "analysisViewManager.updating"] })], lt2.prototype, "updating", null), e([d({ type: Number, readOnly: true, dependsOn: ["updating"] })], lt2.prototype, "updatingProgress", void 0), e([d({ type: ["global", "local"] })], lt2.prototype, "viewingMode", null), e([d({ type: u14, aliasOf: "stateManager.viewpoint" })], lt2.prototype, "viewpoint", void 0), e([d({ type: Number, aliasOf: "stateManager.zoom" })], lt2.prototype, "zoom", void 0), e([d({ type: l35 })], lt2.prototype, "highlightOptions", void 0), lt2 = e([n6("esri.views.SceneView")], lt2), function(e59) {
  e59[e59.INCLUDE = 0] = "INCLUDE", e59[e59.EXCLUDE = 1] = "EXCLUDE";
}(ct2 || (ct2 = {}));
var ut2 = n7();
var gt2 = i3();
var mt2 = u6();
var ft2 = lt2;
export {
  ft2 as default
};
//# sourceMappingURL=@arcgis_core_views_SceneView.js.map
