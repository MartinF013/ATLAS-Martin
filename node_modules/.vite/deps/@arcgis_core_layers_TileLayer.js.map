{
  "version": 3,
  "sources": ["../../@arcgis/core/layers/TileLayer.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../chunks/tslib.es6.js\";import r from\"../request.js\";import t from\"../core/Error.js\";import{HandleOwnerMixin as s}from\"../core/HandleOwner.js\";import{isSome as i}from\"../core/maybe.js\";import{MultiOriginJSONMixin as o}from\"../core/MultiOriginJSONSupport.js\";import{throwIfAbortError as a}from\"../core/promiseUtils.js\";import{urlToObject as l,objectToQuery as n,makeAbsolute as p}from\"../core/urlUtils.js\";import{property as c}from\"../core/accessorSupport/decorators/property.js\";import\"../core/arrayUtils.js\";import\"../core/has.js\";import{cast as u}from\"../core/accessorSupport/decorators/cast.js\";import{reader as m}from\"../core/accessorSupport/decorators/reader.js\";import{subclass as h}from\"../core/accessorSupport/decorators/subclass.js\";import{writer as d}from\"../core/accessorSupport/decorators/writer.js\";import y from\"../geometry/SpatialReference.js\";import f from\"./Layer.js\";import{APIKeyMixin as v}from\"./mixins/APIKeyMixin.js\";import{ArcGISCachedService as g}from\"./mixins/ArcGISCachedService.js\";import{ArcGISMapService as S}from\"./mixins/ArcGISMapService.js\";import{ArcGISService as _}from\"./mixins/ArcGISService.js\";import{BlendLayer as j}from\"./mixins/BlendLayer.js\";import{CustomParametersMixin as b}from\"./mixins/CustomParametersMixin.js\";import{OperationalLayer as w}from\"./mixins/OperationalLayer.js\";import{PortalLayer as T}from\"./mixins/PortalLayer.js\";import{RefreshableLayer as O}from\"./mixins/RefreshableLayer.js\";import{ScaleRangeLayer as L}from\"./mixins/ScaleRangeLayer.js\";import{SublayersOwner as R}from\"./mixins/SublayersOwner.js\";import{parse as U,isHostedAgolService as x,isArcGISUrl as P}from\"./support/arcgisLayerUrl.js\";import{url as A}from\"./support/commonProperties.js\";import M from\"./support/Sublayer.js\";const W=[\"Canvas/World_Dark_Gray_Base\",\"Canvas/World_Dark_Gray_Reference\",\"Canvas/World_Light_Gray_Base\",\"Canvas/World_Light_Gray_Reference\",\"Elevation/World_Hillshade\",\"Elevation/World_Hillshade_Dark\",\"Ocean/World_Ocean_Base\",\"Ocean/World_Ocean_Reference\",\"Ocean_Basemap\",\"Reference/World_Boundaries_and_Places\",\"Reference/World_Boundaries_and_Places_Alternate\",\"Reference/World_Transportation\",\"World_Imagery\",\"World_Street_Map\",\"World_Topo_Map\"];let I=class extends(j(R(L(w(T(g(S(_(o(s(O(v(b(f)))))))))))))){constructor(...e){super(...e),this.listMode=\"show\",this.isReference=null,this.operationalLayerType=\"ArcGISTiledMapServiceLayer\",this.resampling=!0,this.sourceJSON=null,this.spatialReference=null,this.path=null,this.sublayers=null,this.type=\"tile\",this.url=null}normalizeCtorArgs(e,r){return\"string\"==typeof e?{url:e,...r}:e}load(e){const r=i(e)?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:[\"Map Service\"]},e).catch(a).then((()=>this._fetchService(r)))),Promise.resolve(this)}get attributionDataUrl(){const e=this.parsedUrl?.path.toLowerCase();return e&&this._getDefaultAttribution(this._getMapName(e))}readSpatialReference(e,r){return(e=e||r.tileInfo&&r.tileInfo.spatialReference)&&y.fromJSON(e)}writeSublayers(e,r,t,s){if(!this.loaded||!e)return;const i=e.slice().reverse().flatten((({sublayers:e})=>e&&e.toArray().reverse())).toArray(),o=[],a={writeSublayerStructure:!1,...s};i.forEach((e=>{const r=e.write({},a);o.push(r)}));o.some((e=>Object.keys(e).length>1))&&(r.layers=o)}get tileServers(){return this._getDefaultTileServers(this.parsedUrl.path)}castTileServers(e){return Array.isArray(e)?e.map((e=>l(e).path)):null}fetchTile(e,t,s,i={}){const{signal:o}=i,a=this.getTileUrl(e,t,s),l={responseType:\"image\",signal:o,query:{...this.refreshParameters}};return r(a,l).then((e=>e.data))}getTileUrl(e,r,t){const s=!this.tilemapCache&&this.supportsBlankTile,i=n({...this.parsedUrl.query,blankTile:!s&&null,...this.customParameters,token:this.apiKey}),o=this.tileServers;return`${o&&o.length?o[r%o.length]:this.parsedUrl.path}/tile/${e}/${r}/${t}${i?\"?\"+i:\"\"}`}_fetchService(e){return new Promise(((s,o)=>{if(this.sourceJSON){if(null!=this.sourceJSON.bandCount&&null!=this.sourceJSON.pixelSizeX)throw new t(\"tile-layer:unsupported-url\",\"use ImageryTileLayer to open a tiled image service\");return void s({data:this.sourceJSON})}if(!this.parsedUrl)throw new t(\"tile-layer:undefined-url\",\"layer's url is not defined\");const a=U(this.parsedUrl.path);if(i(a)&&\"ImageServer\"===a.serverType)throw new t(\"tile-layer:unsupported-url\",\"use ImageryTileLayer to open a tiled image service\");r(this.parsedUrl.path,{query:{f:\"json\",...this.parsedUrl.query,...this.customParameters,token:this.apiKey},responseType:\"json\",signal:e}).then(s,o)})).then((r=>{if(r.ssl&&(this.url=this.url.replace(/^http:/i,\"https:\")),this.sourceJSON=r.data,this.read(r.data,{origin:\"service\",url:this.parsedUrl}),10.1===this.version&&!x(this.url))return this._fetchServerVersion(this.url,e).then((e=>{this.read({currentVersion:e})})).catch((()=>{}))}))}_fetchServerVersion(e,s){if(!P(e))return Promise.reject();const i=e.replace(/(.*\\/rest)\\/.*/i,\"$1\")+\"/info\";return r(i,{query:{f:\"json\",...this.customParameters,token:this.apiKey},responseType:\"json\",signal:s}).then((e=>{if(e.data&&e.data.currentVersion)return e.data.currentVersion;throw new t(\"tile-layer:version-not-available\")}))}_getMapName(e){const r=e.match(/^(?:https?:)?\\/\\/(server\\.arcgisonline\\.com|services\\.arcgisonline\\.com|ibasemaps-api\\.arcgis\\.com)\\/arcgis\\/rest\\/services\\/([^\\/]+(\\/[^\\/]+)*)\\/mapserver/i);return r&&r[2]}_getDefaultAttribution(e){if(!e)return;let r;e=e.toLowerCase();for(let t=0,s=W.length;t<s;t++)if(r=W[t],r.toLowerCase().includes(e))return p(\"//static.arcgis.com/attribution/\"+r)}_getDefaultTileServers(e){const r=-1!==e.search(/^(?:https?:)?\\/\\/server\\.arcgisonline\\.com/i),t=-1!==e.search(/^(?:https?:)?\\/\\/services\\.arcgisonline\\.com/i);return r||t?[e,e.replace(r?/server\\.arcgisonline/i:/services\\.arcgisonline/i,r?\"services.arcgisonline\":\"server.arcgisonline\")]:[]}get hasOverriddenFetchTile(){return!this.fetchTile.__isDefault__}};e([c({readOnly:!0})],I.prototype,\"attributionDataUrl\",null),e([c({type:[\"show\",\"hide\",\"hide-children\"]})],I.prototype,\"listMode\",void 0),e([c({json:{read:!0,write:!0}})],I.prototype,\"blendMode\",void 0),e([c({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],I.prototype,\"isReference\",void 0),e([c({readOnly:!0,type:[\"ArcGISTiledMapServiceLayer\"]})],I.prototype,\"operationalLayerType\",void 0),e([c({type:Boolean})],I.prototype,\"resampling\",void 0),e([c()],I.prototype,\"sourceJSON\",void 0),e([c({type:y})],I.prototype,\"spatialReference\",void 0),e([m(\"spatialReference\",[\"spatialReference\",\"tileInfo\"])],I.prototype,\"readSpatialReference\",null),e([c({type:String,json:{origins:{\"web-scene\":{read:!0,write:!0}},read:!1}})],I.prototype,\"path\",void 0),e([c({readOnly:!0})],I.prototype,\"sublayers\",void 0),e([d(\"sublayers\",{layers:{type:[M]}})],I.prototype,\"writeSublayers\",null),e([c({json:{read:!1,write:!1}})],I.prototype,\"popupEnabled\",void 0),e([c()],I.prototype,\"tileServers\",null),e([u(\"tileServers\")],I.prototype,\"castTileServers\",null),e([c({readOnly:!0,json:{read:!1}})],I.prototype,\"type\",void 0),e([c(A)],I.prototype,\"url\",void 0),I=e([h(\"esri.layers.TileLayer\")],I),I.prototype.fetchTile.__isDefault__=!0;const C=I;export{C as default};\n"],
  "mappings": "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",
  "names": ["I", "a", "s", "n", "o", "e", "r", "t", "i", "d"]
}
