{
  "version": 3,
  "sources": ["../../@arcgis/core/views/2d/viewStateUtils.js", "../../@arcgis/core/views/2d/layers/support/ExportStrategy.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nconst t=Math.PI/180;function n(n){return n*t}function o(t,n,o){const{resolution:r,size:u}=o;return t[0]=r*(Math.round(n[0]/r)+u[0]%2*.5),t[1]=r*(Math.round(n[1]/r)+u[1]%2*.5),t}function r(t,o){const r=n(o.rotation),u=Math.abs(Math.cos(r)),a=Math.abs(Math.sin(r)),[s,c]=o.size;return t[0]=Math.round(c*a+s*u),t[1]=Math.round(c*u+s*a),t}function u(t,n,o,r){const[u,a]=n,[s,c]=r,i=.5*o;return t[0]=u-i*s,t[1]=a-i*c,t[2]=u+i*s,t[3]=a+i*c,t}function a(t,n){const[o,r,u,a]=t,[s,c,i,e]=n;return!(o>i||u<s||r>e||a<c)}export{a as bboxIntersects,u as getBBox,r as getOuterSize,o as snapToPixel};\n", "/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport{_ as t}from\"../../../../chunks/tslib.es6.js\";import e from\"../../../../core/Accessor.js\";import{debounce as i}from\"../../../../core/promiseUtils.js\";import{property as o}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/arrayUtils.js\";import\"../../../../core/has.js\";import\"../../../../core/accessorSupport/ensureType.js\";import{subclass as r}from\"../../../../core/accessorSupport/decorators/subclass.js\";import s from\"../../../../geometry/Extent.js\";import{create as a}from\"../../../../geometry/support/aaBoundingRect.js\";import{getInfo as p}from\"../../../../geometry/support/spatialReferenceUtils.js\";import n from\"../../../../layers/support/TileInfo.js\";import{getOuterSize as m,getBBox as l}from\"../../viewStateUtils.js\";import{Bitmap as d}from\"../../engine/Bitmap.js\";import h from\"../../tiling/TileInfoView.js\";import c from\"../../tiling/TileKey.js\";const u=a(),g=[0,0],f=new c(0,0,0,0),x={container:null,fetchSource:null,requestUpdate:null,imageMaxWidth:2048,imageMaxHeight:2048,imageRotationSupported:!1,imageNormalizationSupported:!1,hidpi:!1};let y=class extends e{constructor(t){super(t),this._imagePromise=null,this.bitmaps=[],this.hidpi=x.hidpi,this.imageMaxWidth=x.imageMaxWidth,this.imageMaxHeight=x.imageMaxHeight,this.imageRotationSupported=x.imageRotationSupported,this.imageNormalizationSupported=x.imageNormalizationSupported,this.update=i((async(t,e)=>{if(!t.stationary||this.destroyed)return null;const i=t.state,o=p(i.spatialReference),r=this.hidpi?t.pixelRatio:1,s=this.imageNormalizationSupported&&i.worldScreenWidth&&i.worldScreenWidth<i.size[0];s?(g[0]=i.worldScreenWidth,g[1]=i.size[1]):this.imageRotationSupported?(g[0]=i.size[0],g[1]=i.size[1]):m(g,i);const a=Math.floor(g[0]*r)>this.imageMaxWidth||Math.floor(g[1]*r)>this.imageMaxHeight,n=o&&(i.extent.xmin<o.valid[0]||i.extent.xmax>o.valid[1]),l=!this.imageNormalizationSupported&&n,d=!a&&!l,h=this.imageRotationSupported?i.rotation:0;if(d){const t=s?i.paddedViewState.center:i.center;this._imagePromise=this._singleExport(i,g,t,i.resolution,h,r,e)}else{let t=Math.min(this.imageMaxWidth,this.imageMaxHeight);l&&(t=Math.min(i.worldScreenWidth,t)),this._imagePromise=this._tiledExport(i,t,r,e)}return this._imagePromise.then((async t=>{if(this._imagePromise=null,!this.destroyed){this.bitmaps=t??[];for(const e of this.container.children)t.includes(e)||e.fadeOut().then((()=>{e.remove()}));for(const e of t)this.container.addChild(e),e.fadeIn()}})).catch((t=>{throw this._imagePromise=null,t}))}),5e3)}destroy(){this.bitmaps=[]}get updating(){return!this.destroyed&&null!==this._imagePromise}updateExports(t){for(const e of this.container.children){if(!e.visible||!e.stage)return;t(e),e.invalidateTexture(),e.requestRender()}}async _export(t,e,i,o,r,s){const a=await this.fetchSource(t,Math.floor(e*r),Math.floor(i*r),{rotation:o,pixelRatio:r,signal:s}),p=new d(a,\"additive\");return p.x=t.xmin,p.y=t.ymax,p.resolution=t.width/e,p.rotation=o,p.pixelRatio=r,p}async _singleExport(t,e,i,o,r,a,p){l(u,i,o,e);const n=new s(u[0],u[1],u[2],u[3],t.spatialReference);return[await this._export(n,e[0],e[1],r,a,p)]}_tiledExport(t,e,i,o){const r=n.create({size:e,spatialReference:t.spatialReference,scales:[t.scale]}),a=new h(r),p=a.getTileCoverage(t);if(!p)return null;const m=[];return p.forEach(((r,p,n,l)=>{f.set(r,p,n,l),a.getTileBounds(u,f);const d=new s(u[0],u[1],u[2],u[3],t.spatialReference);m.push(this._export(d,e,e,0,i,o))})),Promise.all(m)}};t([o()],y.prototype,\"_imagePromise\",void 0),t([o()],y.prototype,\"bitmaps\",void 0),t([o()],y.prototype,\"container\",void 0),t([o()],y.prototype,\"fetchSource\",void 0),t([o()],y.prototype,\"hidpi\",void 0),t([o()],y.prototype,\"imageMaxWidth\",void 0),t([o()],y.prototype,\"imageMaxHeight\",void 0),t([o()],y.prototype,\"imageRotationSupported\",void 0),t([o()],y.prototype,\"imageNormalizationSupported\",void 0),t([o()],y.prototype,\"requestUpdate\",void 0),t([o()],y.prototype,\"updating\",null),y=t([r(\"esri.views.2d.layers.support.ExportStrategy\")],y);const S=y;export{S as default};\n"],
  "mappings": "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",
  "names": ["n", "t", "r", "n", "u", "u", "e", "x", "y", "t", "r", "n", "d", "h", "p", "S"]
}
