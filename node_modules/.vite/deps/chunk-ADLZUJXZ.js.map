{
  "version": 3,
  "sources": ["../../@arcgis/core/views/2d/layers/features/support/TileStore.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport e from\"../../../../../core/Evented.js\";import t from\"../../../../../core/has.js\";import{r as s}from\"../../../../../chunks/rbush.js\";import{Tile as i}from\"./Tile.js\";import o from\"../../../tiling/TileCoverage.js\";import h from\"../../../tiling/TileKey.js\";const n={added:[],removed:[]},r=new Set,d=new h(0,0,0,0);class l extends e{constructor(e){super(),this._tiles=new Map,this._index=s(9,t(\"esri-csp-restrictions\")?e=>({minX:e.bounds[0],minY:e.bounds[1],maxX:e.bounds[2],maxY:e.bounds[3]}):[\".bounds[0]\",\".bounds[1]\",\".bounds[2]\",\".bounds[3]\"]),this.tiles=[],this.tileScheme=e}destroy(){this.clear()}clear(){this.tiles.length=0,this._tiles.clear(),this._index.clear()}has(e){return this._tiles.has(e)}get(e){return this._tiles.get(e)}boundsIntersections(e){return this._index.search({minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]})}updateTiles(e){const t={added:[],removed:[]};for(const s of e.added)if(!this.has(s)){const e=new i(this.tileScheme,s);this._tiles.set(s,e),this._index.insert(e),t.added.push(e)}for(const s of e.removed)if(this.has(s)){const e=this.get(s);this._tiles.delete(s),this._index.remove(e),t.removed.push(e)}this.tiles.length=0,this._tiles.forEach((e=>this.tiles.push(e))),(t.added.length||t.removed.length)&&this.emit(\"update\",t)}setViewState(e){const t=this.tileScheme.getTileCoverage(e,0);if(!t)return;const{spans:s,lodInfo:h}=t,{level:l}=h;if(s.length>0)for(const{row:o,colFrom:a,colTo:m}of s)for(let e=a;e<=m;e++){const t=d.set(l,o,h.normalizeCol(e),h.getWorldForColumn(e)).id;if(r.add(t),!this.has(t)){const e=new i(this.tileScheme,t);this._tiles.set(t,e),this._index.insert(e),this.tiles.push(e),n.added.push(e)}}for(let i=this.tiles.length-1;i>=0;i--){const e=this.tiles[i];r.has(e.id)||(this._tiles.delete(e.id),this.tiles.splice(i,1),this._index.remove(e),n.removed.push(e))}(n.added.length||n.removed.length)&&this.emit(\"update\",n),o.pool.release(t),r.clear(),n.added.length=0,n.removed.length=0}}export{l as default};\n"],
  "mappings": "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",
  "names": ["n", "l", "e", "a", "t", "i"]
}
