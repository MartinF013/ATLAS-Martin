{
  "version": 3,
  "sources": ["../../@arcgis/core/widgets/support/InteractiveAnalysisViewModel.js", "../../@arcgis/core/views/3d/interactive/measurementTools/support/PickRequest.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport{_ as s}from\"../../chunks/tslib.es6.js\";import e from\"../../core/Handles.js\";import{isSome as i,applySome as t,abortMaybe as n,destroyMaybe as a,isNone as r}from\"../../core/maybe.js\";import{createTask as o,throwIfAborted as l,isAbortError as h,isAborted as c}from\"../../core/promiseUtils.js\";import{watch as y,sync as w,syncAndInitial as p,whenOnce as _}from\"../../core/reactiveUtils.js\";import{property as V}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/arrayUtils.js\";import\"../../core/has.js\";import\"../../core/accessorSupport/ensureType.js\";import{subclass as d}from\"../../core/accessorSupport/decorators/subclass.js\";import{InteractiveToolViewModel as u}from\"./InteractiveToolViewModel.js\";var m;!function(s){s[s.PENDING=0]=\"PENDING\",s[s.WAIT_FOR_VIEW_READY=1]=\"WAIT_FOR_VIEW_READY\",s[s.RUNNING=2]=\"RUNNING\"}(m||(m={}));let v=class extends u{constructor(s={}){super(s),this.analysisView=null,this._reconnectViewTask=null,this._analysisBaseHandles=new e,this._parentChangeFromReconnect=!1,this._startUserOperation=null;const t=s?.analysis;i(t)?this.analysis=t:(this._set(\"analysis\",this.constructAnalysis()),this._set(\"isAnalysisOwner\",!0))}normalizeCtorArgs(s){const{analysis:e,...i}=s;return i}initialize(){this._analysisBaseHandles.add([y((()=>t(this.analysis,(({parent:s})=>s))),(s=>{this._parentChangeFromReconnect||s===this.view||this._set(\"isAnalysisOwner\",!1);const e=!this._parentChangeFromReconnect;this._parentChangeFromReconnect=!1,e&&this._scheduleViewReconnect()}),w),y((()=>({view:this.view,ready:i(this.view)&&this.view.ready,supported:this.supported})),(({view:s},{view:e})=>{s!==e&&(this._startUserOperation=n(this._startUserOperation),this._disconnectFromView(e)),this._scheduleViewReconnect()}),p),y((()=>this.analysis.isEditable),((s,e)=>{r(this.analysisView)||(s&&!e&&r(this.tool)?this.createTool():!s&&e&&i(this.tool)&&!this.tool.active&&this.removeTool())}))])}destroy(){this._analysisBaseHandles=a(this._analysisBaseHandles),this._reconnectViewTask=n(this._reconnectViewTask),this._startUserOperation=n(this._startUserOperation),i(this.analysisView)&&(this.analysisView.visible=void 0),this._disconnectFromView(this.view),i(this.analysis)&&this.isAnalysisOwner&&(this.analysis.destroy(),this._set(\"analysis\",null))}set analysis(s){s!==this._get(\"analysis\")&&(this._startUserOperation=n(this._startUserOperation),this._disconnectFromView(this.view),this._setExternalAnalysis(s),this._scheduleViewReconnect())}get ready(){return i(this.analysisView)&&!this.connectingToView}get connectingToView(){return i(this._reconnectViewTask)}get isAnalysisOwner(){return this._get(\"isAnalysisOwner\")}set visible(s){this._set(\"visible\",s),i(this.analysisView)&&(this.analysisView.visible=s)}async start(){this.clear();const s={task:null,abort:null,state:m.PENDING},e=o((async e=>{s.state=m.WAIT_FOR_VIEW_READY,await _((()=>this.ready),e),s.state=m.RUNNING,this.createTool({interactive:!0})}));return s.task=e,s.abort=()=>e.abort(),this._startUserOperation=s,e.promise}clear(){this._startUserOperation=n(this._startUserOperation),this.removeTool(),this.analysis.clear()}onConnectToAnalysisView(s){}onDisconnectFromAnalysisView(){}_scheduleViewReconnect(){this._reconnectViewTask=n(this._reconnectViewTask);const s=o((async e=>{try{await this._reconnectView(e)}catch(i){if(l(e),!h(i))return void this.logger.warn(\"Failed to use analysis in view model\",i);throw i}finally{s===this._reconnectViewTask&&(this._reconnectViewTask=null)}}));this._reconnectViewTask=s}async _reconnectView(s){const{view:e}=this,t=i(e)&&e.ready&&this.supported,n=this.analysis;if(this._startUserOperation=O(this._startUserOperation),this._disconnectFromView(e),t&&!r(e)&&!r(n)){if(this.isAnalysisOwner){if(i(n.parent))return void this.logError(\"expected owned analysis to have null parent when connecting to view\");this._parentChangeFromReconnect=!0,e.analyses.add(n)}this.analysisView=await e.whenAnalysisView(n),c(s)?this._startUserOperation=O(this._startUserOperation):(this.analysisView.visible=this.visible,this.onConnectToAnalysisView(this.analysisView),this.createTool())}}_disconnectFromView(s){this.removeTool(),i(s)&&this.isAnalysisOwner&&(this._parentChangeFromReconnect=!0,s.analyses.remove(this.analysis),this.analysis.clear()),this.analysisView=null,this.onDisconnectFromAnalysisView()}_setExternalAnalysis(s){if(i(this.analysisView)&&!this.isAnalysisOwner&&(this.analysisView.visible=!0),this.analysisView=null,this._set(\"isAnalysisOwner\",!1),this._set(\"analysis\",s),this._parentChangeFromReconnect=!1,!s.isEditable){const e=s.nonEditableMessage;this.logger.warn(`The assigned ${s.type} analysis object will not be editable in the view. ${e}`)}}get testInfo(){return{analysisView:this.analysisView}}};function O(s){return i(s)&&s.state>=m.RUNNING?(s.abort(),null):s}s([V({nonNullable:!0})],v.prototype,\"analysis\",null),s([V()],v.prototype,\"analysisView\",void 0),s([V()],v.prototype,\"ready\",null),s([V()],v.prototype,\"connectingToView\",null),s([V({readOnly:!0})],v.prototype,\"isAnalysisOwner\",null),s([V({type:Boolean,value:!0})],v.prototype,\"visible\",null),s([V()],v.prototype,\"_reconnectViewTask\",void 0),v=s([d(\"esri.widgets.support.InteractiveAnalysisViewModel\")],v);export{v as InteractiveAnalysisViewModel};\n", "/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nclass s{constructor(s,t=null){this.screenPoint=s,this.result=t}}class t{constructor(s,t){this.scenePoint=s,this.mapPoint=t}}export{s as PickRequest,t as PickResult};\n"],
  "mappings": "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",
  "names": ["s", "v", "t", "e", "l", "n", "O", "s", "t"]
}
