{
  "version": 3,
  "sources": ["../../@arcgis/core/views/3d/layers/i3s/PointCloudWorkerUtil.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport{isNone as e,isSome as o}from\"../../../../core/maybe.js\";import r from\"../../../../renderers/PointCloudClassBreaksRenderer.js\";import t from\"../../../../renderers/PointCloudStretchRenderer.js\";import l from\"../../../../renderers/PointCloudUniqueValueRenderer.js\";import{createGeometryIndexFromSchema as n,createTypedView as s,readBinaryAttribute as i}from\"./I3SBinaryReader.js\";import{decodeXYZ as u}from\"./LEPCC.js\";function f(e,o,n,s){const{rendererJSON:i,isRGBRenderer:u}=e;let f=null,c=null;if(o&&u)f=o;else if(o&&\"pointCloudUniqueValueRenderer\"===i.type){c=l.fromJSON(i);const e=c.colorUniqueValueInfos;f=new Uint8Array(3*s);const r=p(c.fieldTransformType);for(let t=0;t<s;t++){const l=(r?r(o[t]):o[t])+\"\";for(let o=0;o<e.length;o++)if(e[o].values.includes(l)){f[3*t]=e[o].color.r,f[3*t+1]=e[o].color.g,f[3*t+2]=e[o].color.b;break}}}else if(o&&\"pointCloudStretchRenderer\"===i.type){c=t.fromJSON(i);const e=c.stops;f=new Uint8Array(3*s);const r=p(c.fieldTransformType);for(let t=0;t<s;t++){const l=r?r(o[t]):o[t],n=e.length-1;if(l<e[0].value)f[3*t]=e[0].color.r,f[3*t+1]=e[0].color.g,f[3*t+2]=e[0].color.b;else if(l>=e[n].value)f[3*t]=e[n].color.r,f[3*t+1]=e[n].color.g,f[3*t+2]=e[n].color.b;else for(let o=1;o<e.length;o++)if(l<e[o].value){const r=(l-e[o-1].value)/(e[o].value-e[o-1].value);f[3*t]=e[o].color.r*r+e[o-1].color.r*(1-r),f[3*t+1]=e[o].color.g*r+e[o-1].color.g*(1-r),f[3*t+2]=e[o].color.b*r+e[o-1].color.b*(1-r);break}}}else if(o&&\"pointCloudClassBreaksRenderer\"===i.type){c=r.fromJSON(i);const e=c.colorClassBreakInfos;f=new Uint8Array(3*s);const t=p(c.fieldTransformType);for(let r=0;r<s;r++){const l=t?t(o[r]):o[r];for(let o=0;o<e.length;o++)if(l>=e[o].minValue&&l<=e[o].maxValue){f[3*r]=e[o].color.r,f[3*r+1]=e[o].color.g,f[3*r+2]=e[o].color.b;break}}}else{f=new Uint8Array(3*s);for(let e=0;e<f.length;e++)f[e]=255}if(n&&c&&c.colorModulation){const e=c.colorModulation.minValue,o=c.colorModulation.maxValue,r=.3;for(let t=0;t<s;t++){const l=n[t],s=l>=o?1:l<=e?r:r+(1-r)*(l-e)/(o-e);f[3*t]=s*f[3*t],f[3*t+1]=s*f[3*t+1],f[3*t+2]=s*f[3*t+2]}}return f}function c(o,r){if(null==o.encoding||\"\"===o.encoding){const t=n(r,o);if(e(t.vertexAttributes.position))return;const l=s(r,t.vertexAttributes.position),i=t.header.fields,u=[i.offsetX,i.offsetY,i.offsetZ],f=[i.scaleX,i.scaleY,i.scaleZ],c=l.length/3,a=new Float64Array(3*c);for(let e=0;e<c;e++)a[3*e]=l[3*e]*f[0]+u[0],a[3*e+1]=l[3*e+1]*f[1]+u[1],a[3*e+2]=l[3*e+2]*f[2]+u[2];return a}if(\"lepcc-xyz\"===o.encoding)return u(r).result}function a(e,r,t){return o(e)&&e.attributeInfo.useElevation?d(r,t):o(e)?i(e.attributeInfo.storageInfo,e.buffer,t):null}function d(e,o){const r=new Float64Array(o);for(let t=0;t<o;t++)r[t]=e[3*t+2];return r}function m(e,o,r,t,l){const n=e.length/3;let s=0;for(let i=0;i<n;i++){let n=!0;for(let e=0;e<t.length&&n;e++){const{filterJSON:o}=t[e],r=l[e].values[i];switch(o.type){case\"pointCloudValueFilter\":{const e=\"exclude\"===o.mode;o.values.includes(r)===e&&(n=!1);break}case\"pointCloudBitfieldFilter\":{const e=b(o.requiredSetBits),t=b(o.requiredClearBits);(r&e)===e&&0==(r&t)||(n=!1);break}case\"pointCloudReturnFilter\":{const e=15&r,t=r>>>4&15,l=t>1,s=1===e,i=e===t;let u=!1;for(const r of o.includedReturns)if(\"last\"===r&&i||\"firstOfMany\"===r&&s&&l||\"lastOfMany\"===r&&i&&l||\"single\"===r&&!l){u=!0;break}u||(n=!1);break}}}n&&(r[s]=i,e[3*s]=e[3*i],e[3*s+1]=e[3*i+1],e[3*s+2]=e[3*i+2],o[3*s]=o[3*i],o[3*s+1]=o[3*i+1],o[3*s+2]=o[3*i+2],s++)}return s}function p(e){return null==e||\"none\"===e?null:\"low-four-bit\"===e?e=>15&e:\"high-four-bit\"===e?e=>(240&e)>>4:\"absolute-value\"===e?e=>Math.abs(e):\"modulo-ten\"===e?e=>e%10:null}function b(e){let o=0;for(const r of e||[])o|=1<<r;return o}export{d as elevationFromPositions,f as evaluateRenderer,m as filterInPlace,a as getAttributeValues,c as readGeometry};\n"],
  "mappings": "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",
  "names": ["f", "c", "a", "e", "r", "t", "o", "n", "s", "d", "l", "i"]
}
