{
  "version": 3,
  "sources": ["../../@arcgis/core/views/3d/layers/PointCloudWorker.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport{isSome as t}from\"../../../core/maybe.js\";import{isArrayBuffer as r}from\"../../../core/typedArrayUtil.js\";import{c as e}from\"../../../chunks/quat.js\";import{c as a}from\"../../../chunks/quatf32.js\";import{q as o}from\"../../../chunks/vec3.js\";import{f,c as s}from\"../../../chunks/vec3f32.js\";import{projectBuffer as i}from\"../../../geometry/projection.js\";import n from\"../../../geometry/SpatialReference.js\";import{readGeometry as u,getAttributeValues as l,evaluateRenderer as b,filterInPlace as m}from\"./i3s/PointCloudWorkerUtil.js\";class c{transform(e){const a=this._transform(e),o=[a.points.buffer,a.rgb.buffer];t(a.pointIdFilterMap)&&o.push(a.pointIdFilterMap.buffer);for(const t of a.attributes)\"buffer\"in t.values&&r(t.values.buffer)&&t.values.buffer!==a.rgb.buffer&&o.push(t.values.buffer);return Promise.resolve({result:a,transferList:o})}_transform(r){const e=u(r.schema,r.geometryBuffer);let a=e.length/3,o=null;const f=[],s=l(r.primaryAttributeData,e,a);t(r.primaryAttributeData)&&s&&f.push({attributeInfo:r.primaryAttributeData.attributeInfo,values:s});const i=l(r.modulationAttributeData,e,a);t(r.modulationAttributeData)&&i&&f.push({attributeInfo:r.modulationAttributeData.attributeInfo,values:i});let c=b(r.rendererInfo,s,i,a);if(r.filterInfo&&r.filterInfo.length>0&&t(r.filterAttributesData)){const t=r.filterAttributesData.map((t=>{const r=l(t,e,a),o={attributeInfo:t.attributeInfo,values:r};return f.push(o),o}));o=new Uint32Array(a),a=m(e,c,o,r.filterInfo,t)}for(const t of r.userAttributesData){const r=l(t,e,a);f.push({attributeInfo:t.attributeInfo,values:r})}3*a<c.length&&(c=new Uint8Array(c.buffer.slice(0,3*a))),this._applyElevationOffsetInPlace(e,a,r.elevationOffset);const p=this._transformCoordinates(e,a,r.obb,n.fromJSON(r.inSR),n.fromJSON(r.outSR));return{obb:r.obb,points:p,rgb:c,attributes:f,pointIdFilterMap:o}}_transformCoordinates(t,r,a,n,u){if(!i(t,n,0,t,u,0,r))throw Error(\"Can't reproject\");const l=f(a.center[0],a.center[1],a.center[2]),b=s(),m=s();e(p,a.quaternion);const c=new Float32Array(3*r);for(let e=0;e<r;e++)b[0]=t[3*e]-l[0],b[1]=t[3*e+1]-l[1],b[2]=t[3*e+2]-l[2],o(m,b,p),a.halfSize[0]=Math.max(a.halfSize[0],Math.abs(m[0])),a.halfSize[1]=Math.max(a.halfSize[1],Math.abs(m[1])),a.halfSize[2]=Math.max(a.halfSize[2],Math.abs(m[2])),c[3*e]=b[0],c[3*e+1]=b[1],c[3*e+2]=b[2];return c}_applyElevationOffsetInPlace(t,r,e){if(0!==e)for(let a=0;a<r;a++)t[3*a+2]+=e}}const p=a();function h(){return new c}export{h as default};\n"],
  "mappings": "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",
  "names": ["c", "e", "a", "o", "r", "f", "t", "p", "n", "m", "S"]
}
