import {
  l
} from "./chunk-G2GJVIQC.js";
import {
  m
} from "./chunk-YZNDHJDJ.js";
import {
  d,
  n8 as n,
  y3 as y
} from "./chunk-2QOWZFCU.js";
import {
  e
} from "./chunk-IVBXK6OP.js";

// node_modules/@arcgis/core/views/2d/tiling/TileQueue.js
function n2(e2, t) {
  return e2.length = 0, t.forEach((t2) => e2.push(t2)), e2;
}
var u = /* @__PURE__ */ new Set();
var c = [];
var a = /* @__PURE__ */ new Map();
var h = [0, 0];
var l2 = class extends y {
  constructor(e2) {
    super(e2), this._keyToItem = /* @__PURE__ */ new Map(), this.concurrency = 6, this.strategy = "scale-first", this.tileInfoView = null;
  }
  initialize() {
    const { concurrency: e2, process: t, strategy: s } = this;
    this._queue = new l({ concurrency: e2, process: (e3, s2) => {
      const r = this._keyToItem.get(e3);
      return t(r, { signal: s2 });
    }, peeker: "scale-first" === s ? (e3) => this._peekByScaleFirst(e3) : (e3) => this._peekByCenterFirst(e3) });
  }
  destroy() {
    this.clear(), this._queue.destroy(), this._queue = null;
  }
  get length() {
    return this._queue ? this._queue.length : 0;
  }
  get onGoingCount() {
    return this._keyToItem.size;
  }
  get updating() {
    return this.length > 0 || this.onGoingCount > 0;
  }
  abort(e2) {
    const t = "string" == typeof e2 ? e2 : e2.id;
    this._queue.abort(t);
  }
  clear() {
    this._queue.clear(), this._keyToItem.clear(), this.notifyChange("updating");
  }
  has(e2) {
    return "string" == typeof e2 ? this._keyToItem.has(e2) : this._keyToItem.has(e2.id);
  }
  isOngoing(e2) {
    const t = "string" == typeof e2 ? e2 : e2.id;
    return this.has(t) && this._queue.isOngoing(t);
  }
  pause() {
    this._queue.pause();
  }
  push(e2) {
    const t = e2.key.id;
    if (this._queue.has(t))
      return this._queue.get(t);
    const s = this._queue.push(t), r = () => {
      this._keyToItem.delete(t), this.notifyChange("updating");
    };
    return this._keyToItem.set(t, e2), s.then(r, r), this.notifyChange("updating"), s;
  }
  reset() {
    this._queue.reset();
  }
  resume() {
    this._queue.resume();
  }
  _peekByScaleFirst(e2) {
    if (!this.state)
      return e2.values().next().value;
    const t = this.tileInfoView;
    let s = Number.NEGATIVE_INFINITY, r = Number.POSITIVE_INFINITY;
    e2.forEach((e3) => {
      const t2 = this._keyToItem.get(e3), o2 = this.tileInfoView.getTileScale(t2.key);
      a.has(o2) || (a.set(o2, []), s = Math.max(o2, s), r = Math.min(o2, r)), a.get(o2).push(t2.key), u.add(o2);
    });
    let o = this.state.scale;
    a.has(o) || (n2(c, u), c.sort((e3, t2) => e3 - t2), o = c.reduce((e3, t2) => Math.abs(t2 - o) < Math.abs(e3 - o) ? t2 : e3, c[0])), o = Math.min(o, s), o = Math.max(o, r);
    const i = a.get(o), h2 = t.getClosestInfoForScale(o), l3 = h2.getColumnForX(this.state.center[0]), p2 = h2.getRowForY(this.state.center[1]);
    return i.sort((e3, t2) => {
      const s2 = h2.denormalizeCol(e3.col, e3.world), r2 = h2.denormalizeCol(t2.col, t2.world);
      return Math.sqrt((l3 - s2) * (l3 - s2) + (p2 - e3.row) * (p2 - e3.row)) - Math.sqrt((l3 - r2) * (l3 - r2) + (p2 - t2.row) * (p2 - t2.row));
    }), u.clear(), a.clear(), i[0].id;
  }
  _peekByCenterFirst(e2) {
    if (!this.state)
      return e2.values().next().value;
    const t = this.tileInfoView, s = this.state.center;
    let r = Number.POSITIVE_INFINITY, i = null;
    return e2.forEach((e3) => {
      const n3 = this._keyToItem.get(e3);
      t.getTileCoords(h, n3.key);
      const u2 = m(h, s);
      u2 < r && (r = u2, i = n3.key);
    }), i.id;
  }
};
e([d({ constructOnly: true })], l2.prototype, "concurrency", void 0), e([d({ constructOnly: true })], l2.prototype, "process", void 0), e([d()], l2.prototype, "state", void 0), e([d({ constructOnly: true })], l2.prototype, "strategy", void 0), e([d({ constructOnly: true })], l2.prototype, "tileInfoView", void 0), e([d({ readOnly: true })], l2.prototype, "updating", null), l2 = e([n("esri.views.2d.tiling.TileQueue")], l2);
var p = l2;

export {
  p
};
//# sourceMappingURL=chunk-BBO6WYBO.js.map
