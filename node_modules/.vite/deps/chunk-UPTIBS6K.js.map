{
  "version": 3,
  "sources": ["../../@arcgis/core/views/3d/terrain/RasterTile.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport{disposeMaybe as t,isSome as e,isNone as r}from\"../../../core/maybe.js\";import{C as s}from\"../../../chunks/RasterColorizer.glsl.js\";import{TextureSamplingMode as i}from\"../../webgl/enums.js\";import{createTransformTexture as o,getCommonUniforms as a,getColormapUniforms as h,getStretchUniforms as n,getShadedReliefUniforms as l,createRasterTexture as u,createColormapTexture as m}from\"../../webgl/rasterUtils.js\";const d={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:\"none\",type:\"stretch\"};class _{constructor(t,e,r=null,s=null){this.type=\"raster-tile\",this._memoryUsed=null,this._source=null,this._symbolizerParameters=null,this._bandIds=null,this._interpolation=null,this._dirty=!1,this._transformGrid=null,this.isRendereredSource=!1,this.symbolizerRenderer=null,this.rawPixelData=null,this.lij=null,this.opacity=1,this.lij=t,this.source=e,this.width=r||e.width,this.height=s||e.height}get source(){return this._source}set source(e){this._source=e,this._rasterTexture=t(this._rasterTexture),this._memoryUsed=null}get symbolizerParameters(){return this.isRendereredSource?{...d,maxCutOff:[1,1,1],factor:[1,1,1]}:this._symbolizerParameters||d}set symbolizerParameters(t){this._symbolizerParameters=t}get bandIds(){return this._bandIds}set bandIds(t){if(e(t)&&t.length>0){this._bandIds&&t.every(((t,e)=>!!this._bandIds[e]&&t===this._bandIds[e]))||(this._bandIds=t,this._dirty=!0)}else this._bandIds=null}get interpolation(){return this._interpolation||\"nearest\"}set interpolation(t){if(this._interpolation=t,e(this._rasterTexture)){const e=this._getRasterTextureInterpolation(t);this._rasterTexture.setSamplingMode(\"bilinear\"===e?i.LINEAR:i.NEAREST)}}get transformGrid(){return this._transformGrid}set transformGrid(e){this._transformGrid=e,this._transformGridTexture=t(this._transformGridTexture),this._memoryUsed=null}bind(t){return!!(this.source&&this.source.pixels&&this.source.pixels.length>0)&&((r(this._rasterTexture)||this._dirty)&&this._updateRasterTexture(t,this.bandIds),e(this._rasterTexture)&&(this._updateColormapTexture(t),this.transformGrid&&r(this._transformGridTexture)&&(this._transformGridTexture=o(t,this.transformGrid))),!0)}getUniforms(){const{symbolizerParameters:t,transformGrid:e,width:r,height:i,opacity:o}=this,u=a(e,[r,i],[this.source.width,this.source.height],o),m=h(t.colormap,t.colormapOffset),d=\"stretch\"===this.symbolizerParameters.type?n(this.symbolizerParameters):null,_=\"hillshade\"===this.symbolizerParameters.type?l(this.symbolizerParameters):null;return new s(u,m,d||_,this._rasterTexture,this._transformGridTexture,this._colormapTexture)}get memoryUsage(){if(r(this._memoryUsed)){const t=[this._rasterTexture,this._transformGridTexture,this._colormapTexture];this._memoryUsed=t.map((t=>e(t)?t.descriptor.width*t.descriptor.height*4:0)).reduce(((t,e)=>t+e),0)}return this._memoryUsed}release(){return this._rasterTexture=t(this._rasterTexture),this._transformGridTexture=t(this._transformGridTexture),this._colormapTexture=t(this._colormapTexture),this.source=null,this.transformGrid=null,this.rawPixelData=null,!0}_updateRasterTexture(s,i){const o=this.source?this.source.extractBands(i):null;if(!(o&&o.pixels&&o.pixels.length>0))return void(this._rasterTexture=t(this._rasterTexture));const a=r(i)&&r(this.bandIds)||e(i)&&e(this.bandIds)&&i.join(\"\")===this.bandIds.join(\"\");if(e(this._rasterTexture)&&a)return;this._rasterTexture=t(this._rasterTexture);const h=this._getRasterTextureInterpolation(this.interpolation);this._rasterTexture=u(s,o,h,this.isRendereredSource||this.hasStretchTypeNone())}hasStretchTypeNone(){return\"stretchType\"in this.symbolizerParameters&&\"none\"===this.symbolizerParameters.stretchType&&!this.symbolizerParameters.useGamma&&\"u8\"===this.source.pixelType}_getRasterTextureInterpolation(t){return\"lut\"===this.symbolizerParameters.type||\"nearest\"===t||\"majority\"===t?\"nearest\":\"bilinear\"}_updateColormapTexture(e){const r=this._colormap,s=this.symbolizerParameters.colormap;return s?r?s.length!==r.length||s.some(((t,e)=>t!==r[e]))?(this._colormapTexture=t(this._colormapTexture),this._colormapTexture=m(e,s),void(this._colormap=s)):void 0:(this._colormapTexture=m(e,s),void(this._colormap=s)):(this._colormapTexture=t(this._colormapTexture),void(this._colormap=null))}}export{_ as RasterTile};\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;AAIka,IAAMA,KAAE,EAAC,WAAU,GAAE,QAAO,GAAE,QAAO,GAAE,WAAU,CAAC,GAAE,GAAE,CAAC,GAAE,WAAU,CAAC,KAAI,KAAI,GAAG,GAAE,QAAO,CAAC,IAAE,KAAI,IAAE,KAAI,IAAE,GAAG,GAAE,UAAS,OAAG,OAAM,CAAC,GAAE,GAAE,CAAC,GAAE,iBAAgB,CAAC,GAAE,GAAE,CAAC,GAAE,UAAS,MAAK,gBAAe,MAAK,aAAY,QAAO,MAAK,UAAS;AAAE,IAAMC,KAAN,MAAO;AAAA,EAAC,YAAYC,IAAE,GAAEC,KAAE,MAAKC,KAAE,MAAK;AAAC,SAAK,OAAK,eAAc,KAAK,cAAY,MAAK,KAAK,UAAQ,MAAK,KAAK,wBAAsB,MAAK,KAAK,WAAS,MAAK,KAAK,iBAAe,MAAK,KAAK,SAAO,OAAG,KAAK,iBAAe,MAAK,KAAK,qBAAmB,OAAG,KAAK,qBAAmB,MAAK,KAAK,eAAa,MAAK,KAAK,MAAI,MAAK,KAAK,UAAQ,GAAE,KAAK,MAAIF,IAAE,KAAK,SAAO,GAAE,KAAK,QAAMC,MAAG,EAAE,OAAM,KAAK,SAAOC,MAAG,EAAE;AAAA,EAAM;AAAA,EAAC,IAAI,SAAQ;AAAC,WAAO,KAAK;AAAA,EAAO;AAAA,EAAC,IAAI,OAAO,GAAE;AAAC,SAAK,UAAQ,GAAE,KAAK,iBAAe,EAAE,KAAK,cAAc,GAAE,KAAK,cAAY;AAAA,EAAI;AAAA,EAAC,IAAI,uBAAsB;AAAC,WAAO,KAAK,qBAAmB,EAAC,GAAGJ,IAAE,WAAU,CAAC,GAAE,GAAE,CAAC,GAAE,QAAO,CAAC,GAAE,GAAE,CAAC,EAAC,IAAE,KAAK,yBAAuBA;AAAA,EAAC;AAAA,EAAC,IAAI,qBAAqBE,IAAE;AAAC,SAAK,wBAAsBA;AAAA,EAAC;AAAA,EAAC,IAAI,UAAS;AAAC,WAAO,KAAK;AAAA,EAAQ;AAAA,EAAC,IAAI,QAAQA,IAAE;AAAC,QAAG,EAAEA,EAAC,KAAGA,GAAE,SAAO,GAAE;AAAC,WAAK,YAAUA,GAAE,MAAO,CAACA,IAAE,MAAI,CAAC,CAAC,KAAK,SAAS,CAAC,KAAGA,OAAI,KAAK,SAAS,CAAC,CAAE,MAAI,KAAK,WAASA,IAAE,KAAK,SAAO;AAAA,IAAG;AAAM,WAAK,WAAS;AAAA,EAAI;AAAA,EAAC,IAAI,gBAAe;AAAC,WAAO,KAAK,kBAAgB;AAAA,EAAS;AAAA,EAAC,IAAI,cAAcA,IAAE;AAAC,QAAG,KAAK,iBAAeA,IAAE,EAAE,KAAK,cAAc,GAAE;AAAC,YAAM,IAAE,KAAK,+BAA+BA,EAAC;AAAE,WAAK,eAAe,gBAAgB,eAAa,IAAE,EAAE,SAAO,EAAE,OAAO;AAAA,IAAC;AAAA,EAAC;AAAA,EAAC,IAAI,gBAAe;AAAC,WAAO,KAAK;AAAA,EAAc;AAAA,EAAC,IAAI,cAAc,GAAE;AAAC,SAAK,iBAAe,GAAE,KAAK,wBAAsB,EAAE,KAAK,qBAAqB,GAAE,KAAK,cAAY;AAAA,EAAI;AAAA,EAAC,KAAKA,IAAE;AAAC,WAAM,CAAC,EAAE,KAAK,UAAQ,KAAK,OAAO,UAAQ,KAAK,OAAO,OAAO,SAAO,QAAM,EAAE,KAAK,cAAc,KAAG,KAAK,WAAS,KAAK,qBAAqBA,IAAE,KAAK,OAAO,GAAE,EAAE,KAAK,cAAc,MAAI,KAAK,uBAAuBA,EAAC,GAAE,KAAK,iBAAe,EAAE,KAAK,qBAAqB,MAAI,KAAK,wBAAsB,EAAEA,IAAE,KAAK,aAAa,KAAI;AAAA,EAAG;AAAA,EAAC,cAAa;AAAC,UAAK,EAAC,sBAAqBA,IAAE,eAAc,GAAE,OAAMC,IAAE,QAAO,GAAE,SAAQ,EAAC,IAAE,MAAK,IAAE,EAAE,GAAE,CAACA,IAAE,CAAC,GAAE,CAAC,KAAK,OAAO,OAAM,KAAK,OAAO,MAAM,GAAE,CAAC,GAAE,IAAE,EAAED,GAAE,UAASA,GAAE,cAAc,GAAEF,KAAE,cAAY,KAAK,qBAAqB,OAAK,EAAE,KAAK,oBAAoB,IAAE,MAAKC,KAAE,gBAAc,KAAK,qBAAqB,OAAK,EAAE,KAAK,oBAAoB,IAAE;AAAK,WAAO,IAAI,EAAE,GAAE,GAAED,MAAGC,IAAE,KAAK,gBAAe,KAAK,uBAAsB,KAAK,gBAAgB;AAAA,EAAC;AAAA,EAAC,IAAI,cAAa;AAAC,QAAG,EAAE,KAAK,WAAW,GAAE;AAAC,YAAMC,KAAE,CAAC,KAAK,gBAAe,KAAK,uBAAsB,KAAK,gBAAgB;AAAE,WAAK,cAAYA,GAAE,IAAK,CAAAA,OAAG,EAAEA,EAAC,IAAEA,GAAE,WAAW,QAAMA,GAAE,WAAW,SAAO,IAAE,CAAE,EAAE,OAAQ,CAACA,IAAE,MAAIA,KAAE,GAAG,CAAC;AAAA,IAAC;AAAC,WAAO,KAAK;AAAA,EAAW;AAAA,EAAC,UAAS;AAAC,WAAO,KAAK,iBAAe,EAAE,KAAK,cAAc,GAAE,KAAK,wBAAsB,EAAE,KAAK,qBAAqB,GAAE,KAAK,mBAAiB,EAAE,KAAK,gBAAgB,GAAE,KAAK,SAAO,MAAK,KAAK,gBAAc,MAAK,KAAK,eAAa,MAAK;AAAA,EAAE;AAAA,EAAC,qBAAqBE,IAAE,GAAE;AAAC,UAAM,IAAE,KAAK,SAAO,KAAK,OAAO,aAAa,CAAC,IAAE;AAAK,QAAG,EAAE,KAAG,EAAE,UAAQ,EAAE,OAAO,SAAO;AAAG,aAAO,MAAK,KAAK,iBAAe,EAAE,KAAK,cAAc;AAAG,UAAM,IAAE,EAAE,CAAC,KAAG,EAAE,KAAK,OAAO,KAAG,EAAE,CAAC,KAAG,EAAE,KAAK,OAAO,KAAG,EAAE,KAAK,EAAE,MAAI,KAAK,QAAQ,KAAK,EAAE;AAAE,QAAG,EAAE,KAAK,cAAc,KAAG;AAAE;AAAO,SAAK,iBAAe,EAAE,KAAK,cAAc;AAAE,UAAM,IAAE,KAAK,+BAA+B,KAAK,aAAa;AAAE,SAAK,iBAAe,EAAEA,IAAE,GAAE,GAAE,KAAK,sBAAoB,KAAK,mBAAmB,CAAC;AAAA,EAAC;AAAA,EAAC,qBAAoB;AAAC,WAAM,iBAAgB,KAAK,wBAAsB,WAAS,KAAK,qBAAqB,eAAa,CAAC,KAAK,qBAAqB,YAAU,SAAO,KAAK,OAAO;AAAA,EAAS;AAAA,EAAC,+BAA+BF,IAAE;AAAC,WAAM,UAAQ,KAAK,qBAAqB,QAAM,cAAYA,MAAG,eAAaA,KAAE,YAAU;AAAA,EAAU;AAAA,EAAC,uBAAuB,GAAE;AAAC,UAAMC,KAAE,KAAK,WAAUC,KAAE,KAAK,qBAAqB;AAAS,WAAOA,KAAED,KAAEC,GAAE,WAASD,GAAE,UAAQC,GAAE,KAAM,CAACF,IAAEG,OAAIH,OAAIC,GAAEE,EAAC,CAAE,KAAG,KAAK,mBAAiB,EAAE,KAAK,gBAAgB,GAAE,KAAK,mBAAiB,EAAE,GAAED,EAAC,GAAE,MAAK,KAAK,YAAUA,OAAI,UAAQ,KAAK,mBAAiB,EAAE,GAAEA,EAAC,GAAE,MAAK,KAAK,YAAUA,QAAK,KAAK,mBAAiB,EAAE,KAAK,gBAAgB,GAAE,MAAK,KAAK,YAAU;AAAA,EAAM;AAAC;",
  "names": ["d", "_", "t", "r", "s", "e"]
}
