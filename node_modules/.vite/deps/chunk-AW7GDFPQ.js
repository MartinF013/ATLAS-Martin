import {
  _,
  x
} from "./chunk-YLU2PLJS.js";
import {
  B
} from "./chunk-5Z5455ZY.js";
import {
  s as s3
} from "./chunk-D7DLEBS2.js";
import {
  L,
  S,
  m
} from "./chunk-OOZMA7DN.js";
import {
  s2
} from "./chunk-HFTNOKM2.js";
import {
  s
} from "./chunk-CVWDM4C7.js";

// node_modules/@arcgis/core/layers/support/labelFormatUtils.js
var s4 = s.getLogger("esri.layers.support.labelFormatUtils");
var c = { type: "simple", evaluate: () => null };
var f = { getAttribute: (e, r) => e.field(r) };
async function p(r, t, a) {
  if (!r || !r.symbol)
    return c;
  const n = r.where, o = x(r), p2 = n ? await import("./WhereClause-XG56H2W3.js") : null;
  let m2;
  if ("arcade" === o.type) {
    const r2 = await s3(o.expression, a, t);
    m2 = { type: "arcade", evaluate(t2) {
      try {
        const e = r2.evaluate({ $feature: "attributes" in t2 ? r2.repurposeFeature(t2) : t2 });
        if (null != e)
          return e.toString();
      } catch (a2) {
        s4.error(new s2("arcade-expression-error", "Encountered an error when evaluating label expression for feature", { feature: t2, expression: o }));
      }
      return null;
    }, needsHydrationToEvaluate: () => null == _(o.expression) };
  } else
    m2 = { type: "simple", evaluate: (e) => o.expression.replace(/{[^}]*}/g, (r2) => {
      const a2 = r2.slice(1, -1), n2 = t.get(a2);
      if (!n2)
        return r2;
      let o2 = null;
      if ("attributes" in e) {
        e && e.attributes && (o2 = e.attributes[n2.name]);
      } else
        o2 = e.field(n2.name);
      return null == o2 ? "" : d(o2, n2);
    }) };
  if (n) {
    let r2;
    try {
      r2 = p2.WhereClause.create(n, t);
    } catch (g) {
      return s4.error(new s2("bad-where-clause", "Encountered an error when evaluating where clause, ignoring", { where: n, error: g })), c;
    }
    const a2 = m2.evaluate;
    m2.evaluate = (t2) => {
      const o2 = "attributes" in t2 ? void 0 : f;
      try {
        if (r2.testFeature(t2, o2))
          return a2(t2);
      } catch (g) {
        s4.error(new s2("bad-where-clause", "Encountered an error when evaluating where clause for feature", { where: n, feature: t2, error: g }));
      }
      return null;
    };
  }
  return m2;
}
function d(e, r) {
  if (null == e)
    return "";
  const l = r.domain;
  if (l) {
    if ("codedValue" === l.type || "coded-value" === l.type) {
      const r2 = e;
      for (const e2 of l.codedValues)
        if (e2.code === r2)
          return e2.name;
    } else if ("range" === l.type) {
      const r2 = +e, t = "range" in l ? l.range[0] : l.minValue, a = "range" in l ? l.range[1] : l.maxValue;
      if (t <= r2 && r2 <= a)
        return l.name;
    }
  }
  let i = e;
  return "date" === r.type || "esriFieldTypeDate" === r.type ? i = L(i, S("short-date")) : B(r) && (i = m(+i)), i || "";
}

export {
  p,
  d
};
//# sourceMappingURL=chunk-AW7GDFPQ.js.map
