{
  "version": 3,
  "sources": ["../../@arcgis/core/views/3d/layers/ImageryTileLayerView3D.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import r from\"../../../core/Error.js\";import{unwrap as t,isNone as i}from\"../../../core/maybe.js\";import{whenOnce as s}from\"../../../core/reactiveUtils.js\";import{property as a}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/arrayUtils.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import{subclass as l}from\"../../../core/accessorSupport/decorators/subclass.js\";import{LayerView3D as n}from\"./LayerView3D.js\";import{TiledLayerView3D as o}from\"./TiledLayerView3D.js\";import{RasterTile as m}from\"../terrain/RasterTile.js\";import p from\"../../layers/ImageryTileLayerView.js\";import h from\"../../layers/LayerView.js\";import c from\"../../layers/RefreshableLayerView.js\";import{createQueryGeometry as y}from\"../../support/drapedUtils.js\";import{getWebGLCapabilities as d}from\"../../webgl/capabilities.js\";let f=class extends(p(c(o(n(h))))){constructor(){super(...arguments),this.type=\"imagery-tile-3d\",this.isAlignedMapTile=!0}initialize(){this.layer.increaseRasterJobHandlerUsage(),null==this.fullExtent&&this.addResolvingPromise(Promise.reject(new r(\"layerview:spatial-reference-incompatible\",\"The layer extent cannot be projected to the view's spatial reference\",{layer:this.layer})));const e=s((()=>this.view?.basemapTerrain?.tilingSchemeLocked)).then((()=>{const e=this.view.basemapTerrain.tilingScheme,{tileInfo:r}=this.layer,t=[\"png\",\"png24\",\"png32\",\"jpg\",\"mixed\"].includes(r.format)&&e.compatibleWith(r);this.isAlignedMapTile=t;const i=t?r:e.toTileInfo();this.tileInfo=i,this.updatingHandles.add((()=>[this.layer.renderer,this.layer.interpolation,this.layer.bandIds,this.layer.multidimensionalDefinition]),(()=>this.refresh()))}));this.addResolvingPromise(e)}destroy(){this.layer.decreaseRasterJobHandlerUsage(),this.view=null}get _blankTile(){const e=document.createElement(\"canvas\"),r=e.getContext(\"2d\"),[t,i]=this.tileInfo.size;return e.width=t,e.height=i,r.clearRect(0,0,t,i),r.getImageData(0,0,t,i)}get imageFormatIsOpaque(){return\"jpg\"===this.layer.tileInfo.format}get hasMixedImageFormats(){return\"mixed\"===this.layer.tileInfo.format}get dataLevelRange(){const e=this.tileInfo.lods,r=this.layer.tileInfo.lods,t=e[0].scale,i=r[r.length-1].scale;return this.levelRangeFromScaleRange(t,i)}_getfullExtent(){return this.projectFullExtent(this.view.basemapTerrain&&null!==this.view.basemapTerrain.spatialReference?this.view.basemapTerrain.spatialReference:this.view.spatialReference)}async fetchTile(e,r,s,a){const l=this.tileInfo,n=this._canSymbolizeInWebGL(),o={tileInfo:l,requestRawData:n,signal:t(a.signal),requestAsImageElement:this.isAlignedMapTile},p=await this.layer.fetchTile(e,r,s,o);if(p instanceof HTMLImageElement)return p;let h=p&&p.pixelBlock;if(i(h))return this._blankTile;if(!n&&(h=await this.layer.applyRenderer(p),i(h)))return this._blankTile;const c=new m([e,r,s],h,l.size[0],l.size[1]);return n?(c.symbolizerRenderer=this.layer.symbolizer.rendererJSON,c.symbolizerParameters=this.layer.symbolizer.generateWebGLParameters(this._getSymbolizerOptions(e)),c.transformGrid=p.transformGrid):c.isRendereredSource=!0,c.interpolation=this.layer.interpolation,c.bandIds=this.layer.bandIds,c}_getSymbolizerOptions(e){const r=this.tileInfo.lodAt(e).resolution;return{pixelBlock:null,isGCS:this.view.basemapTerrain?this.view.basemapTerrain.spatialReference.isGeographic:this.view.spatialReference.isGeographic,resolution:{x:r,y:r},bandIds:this.layer.bandIds}}ensureSymbolizerParameters(e){this._canSymbolizeInWebGL()&&JSON.stringify(e.symbolizerRenderer)!==JSON.stringify(this.layer.symbolizer.rendererJSON)&&(e.symbolizerParameters=this.layer.symbolizer.generateWebGLParameters(this._getSymbolizerOptions(e.lij[0])))}createFetchPopupFeaturesQueryGeometry(e,r){return y(e,r,this.view)}refresh(){this.emit(\"data-changed\")}async doRefresh(){this.suspended||this.emit(\"data-changed\")}_canSymbolizeInWebGL(){return d(\"3d\").supportsTextureFloat&&this.layer.symbolizer.canRenderInWebGL}};e([a({readOnly:!0})],f.prototype,\"_blankTile\",null),e([a({readOnly:!0})],f.prototype,\"imageFormatIsOpaque\",null),e([a({readOnly:!0})],f.prototype,\"hasMixedImageFormats\",null),e([a({readOnly:!0})],f.prototype,\"dataLevelRange\",null),f=e([l(\"esri.views.3d.layers.ImageryTileLayerView3D\")],f);const g=f;export{g as default};\n"],
  "mappings": "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",
  "names": ["n", "e", "t", "i", "s", "a", "l", "c"]
}
