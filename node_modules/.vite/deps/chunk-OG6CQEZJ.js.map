{
  "version": 3,
  "sources": ["../../@arcgis/core/layers/mixins/PortalLayer.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport{_ as t}from\"../../chunks/tslib.es6.js\";import{id as r}from\"../../kernel.js\";import e from\"../../request.js\";import{result as s}from\"../../core/asyncUtils.js\";import o from\"../../core/Error.js\";import i from\"../../core/Logger.js\";import{isNone as a,isSome as l}from\"../../core/maybe.js\";import{throwIfAborted as p,isAbortError as n,throwIfAbortError as m}from\"../../core/promiseUtils.js\";import{normalize as c,hasSamePortal as u}from\"../../core/urlUtils.js\";import{property as d}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/arrayUtils.js\";import\"../../core/has.js\";import\"../../core/accessorSupport/ensureType.js\";import{reader as h}from\"../../core/accessorSupport/decorators/reader.js\";import{subclass as f}from\"../../core/accessorSupport/decorators/subclass.js\";import{writer as y}from\"../../core/accessorSupport/decorators/writer.js\";import g from\"../../portal/Portal.js\";import I from\"../../portal/PortalItem.js\";import j from\"../../portal/PortalUser.js\";const w=i.getLogger(\"esri.layers.mixins.PortalLayer\"),v=i=>{let v=class extends i{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0}destroy(){this.portalItem?.destroy(),this.portalItem=null}set portalItem(t){t!==this._get(\"portalItem\")&&(this.removeOrigin(\"portal-item\"),this._set(\"portalItem\",t))}readPortalItem(t,r,e){if(r.itemId)return new I({id:r.itemId,portal:e&&e.portal})}writePortalItem(t,r){t&&t.id&&(r.itemId=t.id)}async loadFromPortal(t,r){if(this.portalItem&&this.portalItem.id)try{const e=await import(\"../../portal/support/layersLoader.js\");return p(r),await e.load({instance:this,supportedTypes:t.supportedTypes,validateItem:t.validateItem,supportsData:t.supportsData},r)}catch(e){throw n(e)||w.warn(`Failed to load layer (${this.title}, ${this.id}) portal item (${this.portalItem.id})\\n  ${e}`),e}}async finishLoadEditablePortalLayer(t){this._set(\"userHasEditingPrivileges\",await this._fetchUserHasEditingPrivileges(t).catch((t=>(m(t),!0))))}async _fetchUserHasEditingPrivileges(t){const e=this.url?r?.findCredential(this.url):null;if(!e)return!0;const s=P.credential===e?P.user:await this._fetchEditingUser(t);return P.credential=e,P.user=s,a(s)||null==s.privileges||s.privileges.includes(\"features:user:edit\")}async _fetchEditingUser(t){const o=this.portalItem?.portal?.user;if(o)return o;const i=r.findServerInfo(this.url);if(!i?.owningSystemUrl)return null;const a=`${i.owningSystemUrl}/sharing/rest`,p=g.getDefault();if(p&&p.loaded&&c(p.restUrl)===c(a))return p.user;const n=`${a}/community/self`,m=l(t)?t.signal:null,u=await s(e(n,{authMode:\"no-prompt\",query:{f:\"json\"},signal:m}));return u.ok?j.fromJSON(u.value.data):null}read(t,r){r&&(r.layer=this),super.read(t,r)}write(t,r){const e=r&&r.portal,s=this.portalItem&&this.portalItem.id&&(this.portalItem.portal||g.getDefault());return e&&s&&!u(s.restUrl,e.restUrl)?(r.messages&&r.messages.push(new o(\"layer:cross-portal\",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(t,{...r,layer:this})}};return t([d({type:I})],v.prototype,\"portalItem\",null),t([h(\"web-document\",\"portalItem\",[\"itemId\"])],v.prototype,\"readPortalItem\",null),t([y(\"web-document\",\"portalItem\",{itemId:{type:String}})],v.prototype,\"writePortalItem\",null),t([d({clonable:!1})],v.prototype,\"resourceReferences\",void 0),t([d({readOnly:!0})],v.prototype,\"userHasEditingPrivileges\",void 0),v=t([f(\"esri.layers.mixins.PortalLayer\")],v),v},P={credential:null,user:null};export{v as PortalLayer};\n"],
  "mappings": "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",
  "names": ["w", "v", "t", "r", "e", "n", "s", "o", "i", "a", "p"]
}
