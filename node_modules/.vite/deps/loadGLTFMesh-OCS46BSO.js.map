{
  "version": 3,
  "sources": ["../../@arcgis/core/geometry/support/meshUtils/loadGLTFMesh.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport t from\"../../../Color.js\";import e from\"../../../request.js\";import{getOrCreateMapValue as r}from\"../../../core/MapUtils.js\";import{hasScaling as o}from\"../../../core/mathUtils.js\";import{unwrap as n,applySome as s,isSome as i,isNone as a}from\"../../../core/maybe.js\";import{a as c}from\"../../../chunks/mat3.js\";import{c as l}from\"../../../chunks/mat3f64.js\";import{f as u}from\"../../../chunks/vec3f64.js\";import{f}from\"../../../chunks/vec4f64.js\";import m from\"../MeshComponent.js\";import p from\"../MeshMaterialMetallicRoughness.js\";import d from\"../MeshTexture.js\";import{MeshVertexAttributes as g}from\"../MeshVertexAttributes.js\";import{BufferViewVec3f64 as h,BufferViewVec3f as x,BufferViewVec4f as v,BufferViewVec4u8 as w,BufferViewVec2f as b,BufferViewVec4u16 as j,BufferViewVec3u8 as y,BufferViewVec3u16 as A}from\"../buffer/BufferView.js\";import{t as M,a as C,n as T,s as E,b as R}from\"../../../chunks/vec32.js\";import{t as k,n as B,s as F,a as $}from\"../../../chunks/vec42.js\";import{createBuffer as I}from\"../buffer/utils.js\";import{georeferenceByTransform as L}from\"./georeference.js\";import{DefaultLoadingContext as S}from\"../../../views/3d/glTF/DefaultLoadingContext.js\";import{load as N}from\"../../../views/3d/glTF/loader.js\";import{triangleFanToTriangles as O,triangleStripToTriangles as _,trianglesToTriangles as D}from\"../../../views/3d/glTF/internal/indexUtils.js\";import{generateIndexArray as G}from\"../../../views/3d/webgl-engine/lib/geometryDataUtils.js\";import{COLOR_GAMMA as P}from\"../../../views/3d/webgl-engine/materials/DefaultMaterial_COLOR_GAMMA.js\";import{PrimitiveType as U,TextureWrapMode as V}from\"../../../views/webgl/enums.js\";import{f as q,c as z}from\"../../../chunks/vec33.js\";import{f as K,c as Q}from\"../../../chunks/vec43.js\";import{n as H,f as J}from\"../../../chunks/vec22.js\";async function W(t,e,r){const o=new S(X(r)),n=(await N(o,e,r,!0)).model,s=n.lods.shift(),a=new Map,c=new Map;n.textures.forEach(((t,e)=>a.set(e,et(t)))),n.materials.forEach(((t,e)=>c.set(e,rt(t,a))));const l=tt(s);for(const i of l.parts)ot(l,i,c);const{position:u,normal:f,tangent:m,color:p,texCoord0:d}=l.vertexAttributes,h={position:u.typedBuffer,normal:i(f)?f.typedBuffer:null,tangent:i(m)?m.typedBuffer:null,uv:i(d)?d.typedBuffer:null,color:i(p)?p.typedBuffer:null},x=L(h,t,r);return{transform:x.transform,components:l.components,spatialReference:t.spatialReference,vertexAttributes:new g({position:x.vertexAttributes.position,normal:x.vertexAttributes.normal,tangent:x.vertexAttributes.tangent,color:h.color,uv:h.uv})}}function X(t){return t?.resolveFile?{busy:!1,request:async(r,o,n)=>{const s=t.resolveFile(r),a=\"image\"===o?\"image\":\"binary\"===o?\"array-buffer\":\"json\";return(await e(s,{responseType:a,signal:i(n)?n.signal:null})).data}}:null}function Y(t,e){if(a(t))return\"-\";const o=t.typedBuffer;return`${r(e,o.buffer,(()=>e.size))}/${o.byteOffset}/${o.byteLength}`}function Z(t){return i(t)?t.toString():\"-\"}function tt(t){let e=0;const o={color:!1,tangent:!1,normal:!1,texCoord0:!1},n=new Map,s=new Map,i=[];for(const a of t.parts){const{attributes:{position:t,normal:c,color:l,tangent:u,texCoord0:f}}=a,m=`\\n      ${Y(t,n)}/\\n      ${Y(c,n)}/\\n      ${Y(l,n)}/\\n      ${Y(u,n)}/\\n      ${Y(f,n)}/\\n      ${Z(a.transform)}\\n    `;let p=!1;const d=r(s,m,(()=>(p=!0,{start:e,length:t.count})));p&&(e+=t.count),c&&(o.normal=!0),l&&(o.color=!0),u&&(o.tangent=!0),f&&(o.texCoord0=!0),i.push({gltf:a,writeVertices:p,region:d})}return{vertexAttributes:{position:I(h,e),normal:o.normal?I(x,e):null,tangent:o.tangent?I(v,e):null,color:o.color?I(w,e):null,texCoord0:o.texCoord0?I(b,e):null},parts:i,components:[]}}function et(t){return new d({data:t.data,wrap:at(t.parameters.wrap)})}function rt(e,r){const o=new t(ut(e.color,e.opacity)),i=e.emissiveFactor?new t(ft(e.emissiveFactor)):null;return new p({color:o,colorTexture:n(s(e.textureColor,(t=>r.get(t)))),normalTexture:n(s(e.textureNormal,(t=>r.get(t)))),emissiveColor:i,emissiveTexture:n(s(e.textureEmissive,(t=>r.get(t)))),occlusionTexture:n(s(e.textureOcclusion,(t=>r.get(t)))),alphaMode:it(e.alphaMode),alphaCutoff:e.alphaCutoff,doubleSided:e.doubleSided,metallic:e.metallicFactor,roughness:e.roughnessFactor,metallicRoughnessTexture:n(s(e.textureMetallicRoughness,(t=>r.get(t))))})}function ot(t,e,r){e.writeVertices&&nt(t,e);const o=e.gltf,n=st(o.indices||o.attributes.position.count,o.primitiveType),s=e.region.start;if(s)for(let i=0;i<n.length;i++)n[i]+=s;t.components.push(new m({faces:n,material:r.get(o.material),trustSourceNormals:!0}))}function nt(t,e){const{position:r,normal:n,tangent:s,color:a,texCoord0:u}=t.vertexAttributes,f=e.region.start,{attributes:m,transform:p}=e.gltf,d=m.position.count;if(M(r.slice(f,d),m.position,p),i(m.normal)&&i(n)){const t=c(l(),p),e=n.slice(f,d);C(e,m.normal,t),o(t)&&T(e,e)}else i(n)&&q(n,0,0,1,{dstIndex:f,count:d});if(i(m.tangent)&&i(s)){const t=c(l(),p),e=s.slice(f,d);k(e,m.tangent,t),o(t)&&B(e,e)}else i(s)&&K(s,0,0,1,1,{dstIndex:f,count:d});if(i(m.texCoord0)&&i(u)?H(u.slice(f,d),m.texCoord0):i(u)&&J(u,0,0,{dstIndex:f,count:d}),i(m.color)&&i(a)){const t=m.color,e=a.slice(f,d);if(4===t.elementCount)t instanceof v?F(e,t,255):t instanceof w?Q(e,t):t instanceof j&&$(e,t,8);else{K(e,255,255,255,255);const r=y.fromTypedArray(e.typedBuffer,e.typedBufferStride);t instanceof x?E(r,t,255):t instanceof y?z(r,t):t instanceof A&&R(r,t,8)}}else i(a)&&K(a.slice(f,d),255,255,255,255)}function st(t,e){switch(e){case U.TRIANGLES:return D(t,G);case U.TRIANGLE_STRIP:return _(t);case U.TRIANGLE_FAN:return O(t)}}function it(t){switch(t){case\"OPAQUE\":return\"opaque\";case\"MASK\":return\"mask\";case\"BLEND\":return\"blend\"}}function at(t){return{horizontal:ct(t.s),vertical:ct(t.t)}}function ct(t){switch(t){case V.CLAMP_TO_EDGE:return\"clamp\";case V.MIRRORED_REPEAT:return\"mirror\";case V.REPEAT:return\"repeat\"}}function lt(t){return t**(1/P)*255}function ut(t,e){return f(lt(t[0]),lt(t[1]),lt(t[2]),e)}function ft(t){return u(lt(t[0]),lt(t[1]),lt(t[2]))}export{W as loadGLTFMesh};\n"],
  "mappings": "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",
  "names": ["t", "e", "r", "o", "n", "c", "a", "l", "i", "u", "f", "m", "p", "d", "x", "E"]
}
