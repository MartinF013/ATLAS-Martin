{
  "version": 3,
  "sources": ["../../@arcgis/core/views/3d/interactive/editingTools/dragEventPipeline3D.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport{isSome as e,isNone as r,unwrapOr as t}from\"../../../../core/maybe.js\";import{screenPointObjectToArray as n,castScreenPointArray as o,createScreenPointArray as s}from\"../../../../core/screenUtils.js\";import{c,l,b as i,e as a,g as u,a as p,f as m}from\"../../../../chunks/vec3.js\";import{c as d}from\"../../../../chunks/vec3f64.js\";import{projectPoint as f}from\"../../../../geometry/projection.js\";import{intersectRay as g,fromPositionAndNormal as y,create as E}from\"../../../../geometry/support/plane.js\";import{create as S}from\"../../../../geometry/support/ray.js\";import{projectPoint as j}from\"../../../../geometry/support/vector.js\";import{sv2d as v}from\"../../../../geometry/support/vectorStacks.js\";import{getZForElevationMode as b,getGraphicEffectiveElevationInfo as x}from\"../../../../support/elevationInfoUtils.js\";import{fromScreen as R}from\"../../support/geometryUtils/ray.js\";import{newIntersector as I}from\"../../webgl-engine/lib/Intersector.js\";import{StoreResults as w,IntersectorType as H}from\"../../webgl-engine/lib/IntersectorInterfaces.js\";import{TERRAIN_ID as U}from\"../../webgl-engine/lib/verticalOffsetUtils.js\";import{EventPipeline as O}from\"../../../interactive/dragEventPipeline.js\";function C(e,r){return D(e,(()=>r))}function T(e){return D(e,(e=>e.plane))}function D(t,s){const c=d(),l=d();let i=!1;return a=>{const u=s(a);if(\"start\"===a.action){const r=n(a.screenStart,o(v.get())),s=R(t.state.camera,r,L);e(s)&&(i=g(u,s,c))}if(!i)return null;const p=n(a.screenEnd,o(v.get())),m=R(t.state.camera,p,L);return r(m)?null:g(u,m,l)?{...a,renderStart:c,renderEnd:l,plane:u,ray:m}:null}}function M(t,n,o,c=null,l=null){let i=null;return a=>{if(\"start\"===a.action&&(i=t.sceneIntersectionHelper.intersectElevationFromScreen(s(a.screenStart.x,a.screenStart.y),n,o,l),e(i)&&e(c)&&!f(i,i,c)))return null;if(r(i))return null;const u=t.sceneIntersectionHelper.intersectElevationFromScreen(s(a.screenEnd.x,a.screenEnd.y),n,o,l);return e(u)?e(c)&&!f(u,u,c)?null:{...a,mapStart:i,mapEnd:u}:null}}function N(e,r,t,n=null,o=null){return M(e,t,b(r,e,t),n,o)}function P(e,r,t,n=null,o=null){return N(e,t,x(r),n,o)}function h(r,t,n,o){const s=t.toMap(r.screenStart,{include:[n]});return e(s)?P(t,n,s,o):null}function k(e,r){const t=J,n=K,o=E();e.renderCoordsHelper.worldUpAtPosition(r,t);const s=m(o,t,i(n,r,e.state.camera.eye));return m(s,s,t),y(r,s,o)}function G(e,r,t){let n=null;const o=new O;return o.next(C(e,k(e,r))).next(A(e,r)).next(F(e,t)).next((e=>{e.mapEnd.x=e.mapStart.x,e.mapEnd.y=e.mapStart.y,n=e})),e=>(n=null,o.execute(e),n)}function A(e,r){const t=d(),n=l(r);e.renderCoordsHelper.worldUpAtPosition(r,t);const o=d(),s=d(),m=o=>{if(i(o,o,r),j(t,o,o),\"global\"===e.viewingMode){l(o)*Math.sign(a(t,o))<.001-n&&i(o,u(o,t,.001),r)}return p(o,o,r),o};return e=>(e.renderStart=m(c(o,e.renderStart)),e.renderEnd=m(c(s,e.renderEnd)),e)}function F(r,t){const n=r.renderCoordsHelper;return r=>{const o=n.fromRenderCoords(r.renderStart,t),s=n.fromRenderCoords(r.renderEnd,t);return e(o)&&e(s)?{...r,mapStart:o,mapEnd:s}:null}}var q;function z(r){let t=null;return n=>{switch(n.action){case\"start\":t=r.disableDisplay();break;case\"end\":case\"cancel\":e(t)&&(t.remove(),t=null)}return n}}function B(o,c=null){const l=I(o.state.viewingMode);l.options.selectionMode=!0,l.options.store=w.MIN,l.options.hud=!1;const i=s(),a={requiresGroundFeedback:!0,enableDraped:!0,exclude:new Set},u=d(),p=t(c,o.spatialReference),m=e=>{o.map.ground&&o.map.ground.opacity<1?a.exclude.add(U):a.exclude.delete(U),o.sceneIntersectionHelper.intersectIntersectorScreen(n(e,i),l,a);const r=l.results.min;let t;if(r.getIntersectionPoint(u))t=r.intersector===H.TERRAIN?q.GROUND:q.OTHER;else{if(!l.results.ground.getIntersectionPoint(u))return null;t=q.GROUND}return{location:o.renderCoordsHelper.fromRenderCoords(u,p),surfaceType:t}};let f;return t=>{if(\"start\"===t.action){const r=m(t.screenStart);f=e(r)?r.location:null}if(r(f))return null;const n=m(t.screenEnd);return e(n)&&e(n.location)?{...t,mapStart:f,mapEnd:n.location,surfaceType:n.surfaceType}:null}}!function(e){e[e.GROUND=0]=\"GROUND\",e[e.OTHER=1]=\"OTHER\"}(q||(q={}));const J=d(),K=d(),L=S();export{q as SurfaceType,F as convertToMapCoordinates,z as hideManipulatorWhileDragging,A as projectToWorldUp,B as screenToMap3D,N as screenToMapXYAtLocation,h as screenToMapXYForGraphic,P as screenToMapXYForGraphicAtLocation,C as screenToRenderPlane,T as screenToRenderPlaneFromEvent,G as screenToZConstrained};\n"],
  "mappings": "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",
  "names": ["e", "r", "t", "s", "c", "l", "i", "u", "q", "p", "n", "P", "_", "G", "o", "d"]
}
