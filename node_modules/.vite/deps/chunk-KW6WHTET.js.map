{
  "version": 3,
  "sources": ["../../@arcgis/core/views/3d/layers/graphics/featureExpressionInfoUtils.js", "../../@arcgis/core/views/3d/layers/graphics/ElevationContext.js"],
  "sourcesContent": ["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport e from\"../../../../core/Logger.js\";import{hydrateGeometry as t}from\"../../../../layers/graphics/hydratedFeatures.js\";import{loadArcade as r}from\"../../../../support/arcadeOnDemand.js\";const n=e.getLogger(\"esri.views.3d.layers.graphics.featureExpressionInfoUtils\");function c(e){return{cachedResult:e.cachedResult,arcade:e.arcade?{func:e.arcade.func,context:e.arcade.modules.arcadeUtils.createExecContext(null,{sr:e.arcade.context.spatialReference}),modules:e.arcade.modules}:null}}function o(e){const t=e&&e.expression;if(\"string\"==typeof t){const e=p(t);if(null!=e)return{cachedResult:e}}return null}async function a(e,t,n){const c=e&&e.expression;if(\"string\"!=typeof c)return null;const o=p(c);if(null!=o)return{cachedResult:o};const a=await r(),u=a.arcadeUtils,s=u.createSyntaxTree(c);return u.dependsOnView(s)?(null!=n&&n.error(\"Expressions containing '$view' are not supported on ElevationInfo\"),{cachedResult:0}):{arcade:{func:u.createFunction(s),context:u.createExecContext(null,{sr:t}),modules:a}}}function u(e,t,r){return e.arcadeUtils.createFeature(t.attributes,t.geometry,r)}function s(e,r){if(null!=e&&!f(e)){if(!r||!e.arcade)return void n.errorOncePerTick(\"Arcade support required but not provided\");const c=r;c._geometry&&(c._geometry=t(c._geometry)),e.arcade.modules.arcadeUtils.updateExecContext(e.arcade.context,r)}}function l(e){if(null!=e){if(f(e))return e.cachedResult;const t=e.arcade;let r=e.arcade.modules.arcadeUtils.executeFunction(t.func,t.context);return\"number\"!=typeof r&&(e.cachedResult=0,r=0),r}return 0}function i(e,t=!1){let r=e&&e.featureExpressionInfo;const n=r&&r.expression;return t||\"0\"===n||(r=null),r}const d={cachedResult:0};function f(e){return null!=e.cachedResult}function p(e){return\"0\"===e?0:null}export{c as clone,a as createContext,o as createContextWithoutExpressionSupport,u as createFeature,l as execute,i as extractExpressionInfo,s as setContextFeature,d as zeroContext};\n", "/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.24/esri/copyright.txt for details.\n*/\nimport{unwrapOr as t,isNone as e,isSome as n}from\"../../../../core/maybe.js\";import{getMetersPerUnit as s,supportsUnit as i}from\"../../../../symbols/support/unitConversionUtils.js\";import{execute as r,clone as o,setContextFeature as f,createFeature as u}from\"./featureExpressionInfoUtils.js\";class h{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit=\"meters\",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(t){this._unit=t,this._metersPerElevationInfoUnit=s(t)}get requiresSampledElevationInfo(){return\"absolute-height\"!==this.mode}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit=\"meters\"}set offsetMeters(t){this._meterUnitOffset=t,this._renderUnitOffset=0}set offsetElevationInfoUnits(t){this._meterUnitOffset=t*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(t){this._renderUnitOffset+=t}geometryZWithOffset(t,e){const n=this.calculateOffsetRenderUnits(e);return null!=this.featureExpressionInfoContext?n:t+n}calculateOffsetRenderUnits(t){let e=this._meterUnitOffset;const n=this.featureExpressionInfoContext;return null!=n&&(e+=r(n)*this._metersPerElevationInfoUnit),e/t.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){this.mode=e.mode,this.unit=i(e.unit)?e.unit:\"meters\",this.offsetElevationInfoUnits=t(e.offset,0)}updateFeatureExpressionInfoContext(t,s,i){if(e(t))return void(this._featureExpressionInfoContext=null);const r=t&&t.arcade;r&&n(s)&&n(i)?(this._featureExpressionInfoContext=o(t),f(this._featureExpressionInfoContext,u(r.modules,s,i))):this._featureExpressionInfoContext=t}static fromElevationInfo(t){const e=new h;return n(t)&&e.setFromElevationInfo(t),e}}export{h as ElevationContext};\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;AAI+L,IAAMA,KAAE,EAAE,UAAU,0DAA0D;AAAE,SAASC,GAAE,GAAE;AAAC,SAAM,EAAC,cAAa,EAAE,cAAa,QAAO,EAAE,SAAO,EAAC,MAAK,EAAE,OAAO,MAAK,SAAQ,EAAE,OAAO,QAAQ,YAAY,kBAAkB,MAAK,EAAC,IAAG,EAAE,OAAO,QAAQ,iBAAgB,CAAC,GAAE,SAAQ,EAAE,OAAO,QAAO,IAAE,KAAI;AAAC;AAAC,SAAS,EAAE,GAAE;AAAC,QAAMC,KAAE,KAAG,EAAE;AAAW,MAAG,YAAU,OAAOA,IAAE;AAAC,UAAMC,KAAE,EAAED,EAAC;AAAE,QAAG,QAAMC;AAAE,aAAM,EAAC,cAAaA,GAAC;AAAA,EAAC;AAAC,SAAO;AAAI;AAAC,eAAeC,GAAE,GAAEF,IAAEF,IAAE;AAAC,QAAMC,KAAE,KAAG,EAAE;AAAW,MAAG,YAAU,OAAOA;AAAE,WAAO;AAAK,QAAMI,KAAE,EAAEJ,EAAC;AAAE,MAAG,QAAMI;AAAE,WAAM,EAAC,cAAaA,GAAC;AAAE,QAAMD,KAAE,MAAM,EAAE,GAAEE,KAAEF,GAAE,aAAYG,KAAED,GAAE,iBAAiBL,EAAC;AAAE,SAAOK,GAAE,cAAcC,EAAC,KAAG,QAAMP,MAAGA,GAAE,MAAM,mEAAmE,GAAE,EAAC,cAAa,EAAC,KAAG,EAAC,QAAO,EAAC,MAAKM,GAAE,eAAeC,EAAC,GAAE,SAAQD,GAAE,kBAAkB,MAAK,EAAC,IAAGJ,GAAC,CAAC,GAAE,SAAQE,GAAC,EAAC;AAAC;AAAC,SAAS,EAAE,GAAEF,IAAEM,IAAE;AAAC,SAAO,EAAE,YAAY,cAAcN,GAAE,YAAWA,GAAE,UAASM,EAAC;AAAC;AAAC,SAASD,GAAE,GAAEC,IAAE;AAAC,MAAG,QAAM,KAAG,CAACC,GAAE,CAAC,GAAE;AAAC,QAAG,CAACD,MAAG,CAAC,EAAE;AAAO,aAAO,KAAKR,GAAE,iBAAiB,0CAA0C;AAAE,UAAMC,KAAEO;AAAE,IAAAP,GAAE,cAAYA,GAAE,YAAU,EAAEA,GAAE,SAAS,IAAG,EAAE,OAAO,QAAQ,YAAY,kBAAkB,EAAE,OAAO,SAAQO,EAAC;AAAA,EAAC;AAAC;AAAC,SAAS,EAAE,GAAE;AAAC,MAAG,QAAM,GAAE;AAAC,QAAGC,GAAE,CAAC;AAAE,aAAO,EAAE;AAAa,UAAMP,KAAE,EAAE;AAAO,QAAIM,KAAE,EAAE,OAAO,QAAQ,YAAY,gBAAgBN,GAAE,MAAKA,GAAE,OAAO;AAAE,WAAM,YAAU,OAAOM,OAAI,EAAE,eAAa,GAAEA,KAAE,IAAGA;AAAA,EAAC;AAAC,SAAO;AAAC;AAAC,SAAS,EAAE,GAAEN,KAAE,OAAG;AAAC,MAAIM,KAAE,KAAG,EAAE;AAAsB,QAAMR,KAAEQ,MAAGA,GAAE;AAAW,SAAON,MAAG,QAAMF,OAAIQ,KAAE,OAAMA;AAAC;AAAC,IAAM,IAAE,EAAC,cAAa,EAAC;AAAE,SAASC,GAAE,GAAE;AAAC,SAAO,QAAM,EAAE;AAAY;AAAC,SAAS,EAAE,GAAE;AAAC,SAAM,QAAM,IAAE,IAAE;AAAI;;;ACAj7C,IAAM,IAAN,MAAO;AAAA,EAAC,cAAa;AAAC,SAAK,mBAAiB,GAAE,KAAK,oBAAkB,GAAE,KAAK,QAAM,UAAS,KAAK,8BAA4B,GAAE,KAAK,gCAA8B,MAAK,KAAK,2BAAyB,MAAK,KAAK,OAAK;AAAA,EAAI;AAAA,EAAC,IAAI,+BAA8B;AAAC,WAAO,KAAK;AAAA,EAA6B;AAAA,EAAC,IAAI,kBAAiB;AAAC,WAAO,KAAK;AAAA,EAAgB;AAAA,EAAC,IAAI,OAAM;AAAC,WAAO,KAAK;AAAA,EAAK;AAAA,EAAC,IAAI,KAAKC,IAAE;AAAC,SAAK,QAAMA,IAAE,KAAK,8BAA4BC,GAAED,EAAC;AAAA,EAAC;AAAA,EAAC,IAAI,+BAA8B;AAAC,WAAM,sBAAoB,KAAK;AAAA,EAAI;AAAA,EAAC,QAAO;AAAC,SAAK,OAAK,MAAK,KAAK,mBAAiB,GAAE,KAAK,oBAAkB,GAAE,KAAK,gCAA8B,MAAK,KAAK,OAAK;AAAA,EAAQ;AAAA,EAAC,IAAI,aAAaA,IAAE;AAAC,SAAK,mBAAiBA,IAAE,KAAK,oBAAkB;AAAA,EAAC;AAAA,EAAC,IAAI,yBAAyBA,IAAE;AAAC,SAAK,mBAAiBA,KAAE,KAAK,6BAA4B,KAAK,oBAAkB;AAAA,EAAC;AAAA,EAAC,qBAAqBA,IAAE;AAAC,SAAK,qBAAmBA;AAAA,EAAC;AAAA,EAAC,oBAAoBA,IAAE,GAAE;AAAC,UAAME,KAAE,KAAK,2BAA2B,CAAC;AAAE,WAAO,QAAM,KAAK,+BAA6BA,KAAEF,KAAEE;AAAA,EAAC;AAAA,EAAC,2BAA2BF,IAAE;AAAC,QAAI,IAAE,KAAK;AAAiB,UAAME,KAAE,KAAK;AAA6B,WAAO,QAAMA,OAAI,KAAG,EAAEA,EAAC,IAAE,KAAK,8BAA6B,IAAEF,GAAE,eAAa,KAAK;AAAA,EAAiB;AAAA,EAAC,qBAAqB,GAAE;AAAC,SAAK,OAAK,EAAE,MAAK,KAAK,OAAK,EAAE,EAAE,IAAI,IAAE,EAAE,OAAK,UAAS,KAAK,2BAAyB,EAAE,EAAE,QAAO,CAAC;AAAA,EAAC;AAAA,EAAC,mCAAmCA,IAAEG,IAAEC,IAAE;AAAC,QAAG,EAAEJ,EAAC;AAAE,aAAO,MAAK,KAAK,gCAA8B;AAAM,UAAMC,KAAED,MAAGA,GAAE;AAAO,IAAAC,MAAG,EAAEE,EAAC,KAAG,EAAEC,EAAC,KAAG,KAAK,gCAA8BC,GAAEL,EAAC,GAAEG,GAAE,KAAK,+BAA8B,EAAEF,GAAE,SAAQE,IAAEC,EAAC,CAAC,KAAG,KAAK,gCAA8BJ;AAAA,EAAC;AAAA,EAAC,OAAO,kBAAkBA,IAAE;AAAC,UAAM,IAAE,IAAI;AAAE,WAAO,EAAEA,EAAC,KAAG,EAAE,qBAAqBA,EAAC,GAAE;AAAA,EAAC;AAAC;",
  "names": ["n", "c", "t", "e", "a", "o", "u", "s", "r", "f", "t", "r", "n", "s", "i", "c"]
}
